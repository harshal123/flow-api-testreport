<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:742,&quot;tests&quot;:1384,&quot;passes&quot;:1384,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2018-10-17T09:50:19.449Z&quot;,&quot;end&quot;:&quot;2018-10-17T10:09:06.967Z&quot;,&quot;duration&quot;:1127518,&quot;testsRegistered&quot;:1384,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false,&quot;passPercentClass&quot;:&quot;success&quot;,&quot;pendingPercentClass&quot;:&quot;danger&quot;},&quot;suites&quot;:{&quot;uuid&quot;:&quot;2c769335-b3ca-4b86-bc21-098da438aeaa&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;33b8c304-4bbe-4cba-9541-dbeb686a8491&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\activity\\listActivities.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activity\\listActivities.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c89bf7fb-538a-460a-8fab-fd2466ad3173&quot;,&quot;title&quot;:&quot;Activity.ListActivities&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\activity\\listActivities.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activity\\listActivities.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3727,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3eb0cae7-6d74-4aaf-a675-dd94e2efcc0d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;872a087f-933a-4778-8133-7ba5f280aa7c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of \&quot;all\&quot; activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities Should get list of \&quot;all\&quot; activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2377,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            expect(_.first(res.body.output)).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;59d138f5-9a0c-4068-ac0d-38093b2415a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of \&quot;category\&quot; activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities Should get list of \&quot;category\&quot; activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2458,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?type=category&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.be.all.keys([&#x27;_id&#x27;, &#x27;act&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;926e5836-8de9-4419-9cc2-00b99e547f4e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of \&quot;category\&quot; activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities Should get list of \&quot;category\&quot; activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?type=condition&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.name).to.be.equal(&#x27;condition&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60247d0a-a78c-4729-899d-f5922443cd23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of \&quot;searchAuth\&quot; activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities Should get list of \&quot;searchAuth\&quot; activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2268,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?type=searchAuth&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.Array;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ad87f2c-f0dc-4484-bacc-ec044d4e2eca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;872a087f-933a-4778-8133-7ba5f280aa7c&quot;,&quot;59d138f5-9a0c-4068-ac0d-38093b2415a0&quot;,&quot;926e5836-8de9-4419-9cc2-00b99e547f4e&quot;,&quot;60247d0a-a78c-4729-899d-f5922443cd23&quot;,&quot;5ad87f2c-f0dc-4484-bacc-ec044d4e2eca&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7167,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;813f436c-cf64-4a27-96a1-41e7a9dbec25&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\activity\\searchActivities.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activity\\searchActivities.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6c2ef41e-8b0e-45f7-a247-ffac18ff1582&quot;,&quot;title&quot;:&quot;Activity.SearchActivities&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\activity\\searchActivities.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activity\\searchActivities.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.SearchActivities \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2714,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                //console.log(&#x27;err&#x27;, err)\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dadd51c9-be5d-4a94-a2dd-7f5050145bce&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of \&quot;search\&quot; param activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.SearchActivities Should get list of \&quot;search\&quot; param activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({ search: &#x27;test&#x27; })\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9cf3196c-9f02-4f25-9602-28a23dc66ba1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9cf3196c-9f02-4f25-9602-28a23dc66ba1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:40,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3a883bc1-039f-4370-91d3-05fe1b6aef37&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\activityBuilder\\validateCode.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activityBuilder\\validateCode.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d412bf1b-07b9-468b-9b54-47b7c57cac53&quot;,&quot;title&quot;:&quot;ActivityBuilder.Validate&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\activityBuilder\\validateCode.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activityBuilder\\validateCode.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2559,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2820ce00-ac91-4196-9cf8-b07cfa604d7e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e41a53d-d391-40c7-83da-1c9ae69a8174&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;code\&quot; is not having value as string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should give error, if \&quot;code\&quot; is not having value as string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCodeKey = { code: {} }\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidCodeKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.INVALID_CODE_KEY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4bf1e7b-7e3d-427f-812a-0c07e8519271&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if json schema has invalid keys like \&quot;input\&quot;, \&quot;output\&quot;, \&quot;execute\&quot;.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should give error, if json schema has invalid keys like \&quot;input\&quot;, \&quot;output\&quot;, \&quot;execute\&quot;.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidJsonForKeys)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.status.should.equal(&#x27;failed&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c44656ce-83bd-4502-8b1e-9bd2417089e9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if json schema has invalid schema.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should give error, if json schema has invalid schema.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidJsonSchema)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.status.should.equal(&#x27;failed&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16915af5-6456-4aad-93ab-2fed6c1353fb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if data is string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should give error, if data is string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(\&quot;\&quot;)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Code key should be of type string.&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2db12511-337e-4cb0-a9fe-9070d9acd67f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should be valid, if passed json schema is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should be valid, if passed json schema is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCodeKey = { code: {} }\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(validJson)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.status.should.equal(&#x27;passed&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3fc77fc2-ed89-4f37-8a9e-90ed9350859f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0e41a53d-d391-40c7-83da-1c9ae69a8174&quot;,&quot;d4bf1e7b-7e3d-427f-812a-0c07e8519271&quot;,&quot;c44656ce-83bd-4502-8b1e-9bd2417089e9&quot;,&quot;16915af5-6456-4aad-93ab-2fed6c1353fb&quot;,&quot;2db12511-337e-4cb0-a9fe-9070d9acd67f&quot;,&quot;3fc77fc2-ed89-4f37-8a9e-90ed9350859f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:210,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;50d66237-a7f2-444c-b38b-dab9bfe5bd47&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;77eddb33-fe42-4235-bde0-4d245cb53a83&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;32c6060c-dffa-42d2-a778-6e1e43164056&quot;,&quot;title&quot;:&quot;AddOn.addAddOn&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOn \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            saveAddOns({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                },\n                function(error, addOns) {\n                    savedAddOns = addOns;\n                    done();\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83e3a37f-04c4-476b-ac37-c1e3dfe965d6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOn \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ae0a0c7f-c62e-48a6-8481-e8ae43ef7979&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should apply addon.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOn Should apply addon.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:352,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyAddOn(httpmock, function(error) {\n    if (error) {\n        false.should.equal(true);\n        done();\n    } else {\n        commonMock.braintreeTransaction(httpmock, \&quot;enterprise\&quot;);\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .send({})\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.message.should.equal(messageList.ADDON_APPLY_SUCCESS);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eaba89a3-ff4a-462e-8b8c-aeeafbb17d2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOn Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;07b3ef66-3f2d-4dc7-a221-d808e50adf4c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;eaba89a3-ff4a-462e-8b8c-aeeafbb17d2a&quot;,&quot;07b3ef66-3f2d-4dc7-a221-d808e50adf4c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:362,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a71b458e-dbe6-4055-bd98-2fa5993e39f5&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fdab29de-259d-462d-9539-404e72945fb2&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9ad5854d-0096-4489-b04a-59bca1152722&quot;,&quot;title&quot;:&quot;AddOn.addAddOnOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOnOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:222,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        saveAddOns({\n                authtoken: authToken,\n                user_uid: user_uid\n            },\n            function(error, addOns) {\n                savedAddOns = addOns;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60e8fd65-4320-4112-9e1d-2946013d57e0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOnOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39aac8dc-82d4-463b-b1f7-4ebc27ce38c5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should apply addon.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOnOrg Should apply addon.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:385,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyAddOn({\n    httpmock: httpmock,\n    authToken: authToken\n}, function(error) {\n    if (error) {\n        false.should.equal(true);\n        done();\n    } else {\n        commonMock.braintreeTransaction(httpmock, \&quot;enterprise\&quot;);\n        api.post(apiURL)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .send({})\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    if (res.body.output.message == messageList.ADDON_APPLY_SUCCESS) {\n                        _models.User.findOne({ uid: org_account_uid }, function(error, user) {\n                            user.allocated_credits.should.equal(credits + 1000);\n                            done();\n                        });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;03aa90fb-e8d5-401d-a3c7-a1d1e91d4ecb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOnOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72cfc2a9-266a-4a4c-8378-2e4c20ba0890&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;03aa90fb-e8d5-401d-a3c7-a1d1e91d4ecb&quot;,&quot;72cfc2a9-266a-4a4c-8378-2e4c20ba0890&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:394,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dacc9b5e-0113-41eb-861f-d956ba50f769&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;867f6c7b-bc65-4774-a143-aeae1320d508&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9f46b1a5-19f0-4275-8277-477b77435555&quot;,&quot;title&quot;:&quot;AddOn.list&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.list \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            saveAddOns({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                },\n                function(error, userLogs) {\n                    savedUserLogs = userLogs;\n                    done();\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7da0697-3326-4fbf-89f9-a16d48247eea&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.list \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dfa03315-1e49-4b6a-a244-b4ee8d194402&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plan addons.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.list Should get list of plan addons.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:150,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPlan(httpmock, function(error, userPlanOutput) {\n    api.get(apiURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.should.be.instanceOf(Array);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;67751e3c-55c9-4b20-b992-a0c56ee8d771&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.list Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff04050d-5070-48fe-be93-3cbb5c7422cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;67751e3c-55c9-4b20-b992-a0c56ee8d771&quot;,&quot;ff04050d-5070-48fe-be93-3cbb5c7422cf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:161,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;021a9a8a-e0bc-4169-b660-b05f8836a529&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;17082a2c-c387-4343-a839-4234c10e3f0f&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cb5c86f1-21da-44c2-bab1-5659d855c541&quot;,&quot;title&quot;:&quot;AddOn.listOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.listOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:202,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        saveAddOns({\n                authtoken: authToken,\n                user_uid: user_uid\n            },\n            function(error, addOns) {\n                savedAddOns = addOns;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a99da7f5-6569-4b47-b546-f392d1b711a4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.listOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aedffe8b-7e1f-4409-a3ba-6996e77193c4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plan addons.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.listOrg Should get list of plan addons.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:158,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPlan(httpmock, function(error, userPlanOutput) {\n    api.get(apiURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.should.be.instanceOf(Array);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47213515-fd6a-45ab-a18b-7fcd9ef34e21&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.listOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05dad6f6-7b93-432b-aec1-7a6cb7817294&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;47213515-fd6a-45ab-a18b-7fcd9ef34e21&quot;,&quot;05dad6f6-7b93-432b-aec1-7a6cb7817294&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:167,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;efd3ff57-530b-47fd-abc9-ffbaeac20d97&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8bd8764b-1614-4c47-b857-7814b5bafd1e&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;69d8e63a-0fd4-48c8-bbeb-81751044c677&quot;,&quot;title&quot;:&quot;AddOn.selectAddOn&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOn \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            saveAddOns({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                },\n                function(error, addOns) {\n                    savedAddOns = addOns;\n                    done();\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e696c56-3091-418d-93a2-e2a758f60d9e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOn \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1a69bf1-36ef-4952-8a63-6ed393ee002b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should apply addon.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOn Should apply addon.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:198,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPlan(httpmock, function(error, userPlanOutput) {\n    api.get(\&quot;/enterprise/v1/addons\&quot;)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var addon_uid = _.first(res.body.output).uid;\n                api.put(apiURL)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .send({\n                        \&quot;addon_uid\&quot;: addon_uid\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            if (res.body.output.message == messageList.ADDON_ASSIGNED) {\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, authToken)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            res.body.output.addon_uid.should.equal(addon_uid);\n                                            done();\n                                        }\n                                    });\n                            } else {\n                                (true).should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1198210-83fc-4e98-97b2-98d6c1200988&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOn Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b27f10ad-8c8b-4202-9a63-687fc1037a6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c1198210-83fc-4e98-97b2-98d6c1200988&quot;,&quot;b27f10ad-8c8b-4202-9a63-687fc1037a6e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:210,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0a5ac270-93e8-40eb-a03d-ec78075e2f46&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d91e13d0-4aa9-46f1-b6f8-2b8848bc1e4f&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c928a069-f194-4e5f-b688-2c8ce6c606d7&quot;,&quot;title&quot;:&quot;AddOn.selectAddOnOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOnOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:186,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        saveAddOns({\n                authtoken: authToken,\n                user_uid: user_uid\n            },\n            function(error, userLogs) {\n                savedUserLogs = userLogs;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0aa4b50c-686a-43dc-a84c-74f8b4f266f0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOnOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18d68eb4-de5e-48fb-a5a3-e0392e84d051&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should apply addon.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOnOrg Should apply addon.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:232,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPlan(httpmock, function(error, userPlanOutput) {\n    api.get(\&quot;/enterprise/v1/addons\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var addon_uid = _.first(res.body.output || []).uid || \&quot;\&quot;;\n                api.put(apiURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .send({\n                        \&quot;addon_uid\&quot;: addon_uid\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            if (res.body.output.message == messageList.ADDON_ASSIGNED) {\n                                _models.User.findOne({ uid: org_account_uid }, function(error, user) {\n                                    user.addon_uid.should.equal(addon_uid);\n                                    done();\n                                });\n                            } else {\n                                (true).should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9dec8281-e6cb-45b2-ad1e-1758fbb69f16&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOnOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed143340-87c2-498a-8543-5c4a3f658f6d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9dec8281-e6cb-45b2-ad1e-1758fbb69f16&quot;,&quot;ed143340-87c2-498a-8543-5c4a3f658f6d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:240,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;41b78171-a87c-46e5-a4bd-fdce1fa2fb0f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\createUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\createUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;786ef90f-58c3-4057-837e-3e3045e8ddea&quot;,&quot;title&quot;:&quot;Agent.CreateUserAgent&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\createUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\createUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.CreateUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2765,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8751b4a-4328-414e-9522-7eac3a5a9c4d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.CreateUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;248274c0-cf4e-45e4-92f0-360ab913dd42&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.CreateUserAgent Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76ccab52-e5c3-4f1f-8575-a410955a37da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.CreateUserAgent Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar agentBody = _.clone(agentData);\nagentBody = _.omit(agentBody, &#x27;name&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(agentBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;253243b9-38cb-4459-bb47-9344cdc731e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create agent, if agent data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.CreateUserAgent Should create agent, if agent data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(agentData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userAgent = res.body.output;\n            userAgent.should.have.property(&#x27;name&#x27;);\n            //expect(userAgent).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dee8763a-0b9d-44cb-b6fb-91a30863022b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;76ccab52-e5c3-4f1f-8575-a410955a37da&quot;,&quot;253243b9-38cb-4459-bb47-9344cdc731e5&quot;,&quot;dee8763a-0b9d-44cb-b6fb-91a30863022b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:94,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0f464d6e-a95e-4b4c-afd8-a017cbd0e7ba&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\deleteUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\deleteUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dfa7c1a7-aa60-433a-836a-b9eb1a1fa889&quot;,&quot;title&quot;:&quot;Agent.DeleteUserAgent&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\deleteUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\deleteUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.DeleteUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2572,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(agentData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userAgent = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8bcaba84-ce1f-469e-a7c4-cd263527d4a8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.DeleteUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47797cab-58ce-4f19-adb7-cf8b71a4ef7f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.DeleteUserAgent Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/&#x27; + userAgent.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76e32a07-069b-468a-af1d-583a98fb09ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user agent not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.DeleteUserAgent Should get error if user agent not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/dummyAgent&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ name: &#x27;updated&#x27; })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.AGENT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;26956a40-53f0-46c2-9562-81ce1295840d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete agent, if user agent found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.DeleteUserAgent Should delete agent, if user agent found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/&#x27; + userAgent.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userAgent = res.body.output;\n            expect(userAgent.deleted_at).not.to.be.null;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87b59e9d-6052-492f-9079-a324aed35518&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;76e32a07-069b-468a-af1d-583a98fb09ee&quot;,&quot;26956a40-53f0-46c2-9562-81ce1295840d&quot;,&quot;87b59e9d-6052-492f-9079-a324aed35518&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:103,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2df59435-9f4c-4336-bc12-a75f711cad2d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\initUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\initUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9194a966-e5d4-4fa6-a564-cb733d15b005&quot;,&quot;title&quot;:&quot;Agent.InitUserAgent&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\initUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\initUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2610,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(&#x27;/enterprise/v1/user/agents&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(agentData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userAgent = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46994e9e-7b1a-46a5-b205-7283ba7a9994&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02133ce4-003a-4211-b5e1-65fd1df804f1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get error if \&quot;gateway_key\&quot; key missing or not valid in request headers.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent Should get error if \&quot;gateway_key\&quot; key missing or not valid in request headers.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;gatewaykey&#x27;, &#x27;invalid key&#x27;)\n    .send(body)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Unauthorized&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1cacfba1-b568-4f4f-a80e-6c2e32eed464&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user agent not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent Should get error if user agent not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;gateway_key&#x27;, &#x27;invalid key&#x27;)\n    .send(body)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.AGENT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9669c770-a98e-439e-bf2d-0740adb5ddbe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should init agent, if agent data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent Should init agent, if agent data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;gateway_key&#x27;, userAgent.uid)\n    .send(body)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.contain.any.keys([&#x27;service&#x27;, &#x27;credentials&#x27;, &#x27;admin_key&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c8ae4df8-3884-481b-a1f4-d0eca8b5b65c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should init agent, if agent without any data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent Should init agent, if agent without any data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;gateway_key&#x27;, userAgent.uid)\n    .send()\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.contain.any.keys([&#x27;service&#x27;, &#x27;credentials&#x27;, &#x27;admin_key&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2565b78-b176-4301-9dee-3e6849be47d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1cacfba1-b568-4f4f-a80e-6c2e32eed464&quot;,&quot;9669c770-a98e-439e-bf2d-0740adb5ddbe&quot;,&quot;c8ae4df8-3884-481b-a1f4-d0eca8b5b65c&quot;,&quot;a2565b78-b176-4301-9dee-3e6849be47d4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e4caedca-43ae-4b36-9e9d-2dcb7eace9b1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\listUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\listUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bd87cb95-b5bb-45fd-a385-fbe362412ef6&quot;,&quot;title&quot;:&quot;Agent.ListUserAgent&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\listUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\listUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ListUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2608,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(agentData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userAgent = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;34884ba2-a062-4f5f-ad7a-ec89dca3a41c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ListUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32f410e9-4878-4929-b275-57900981efea&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ListUserAgent Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7cc44e7-f6f0-451e-81e3-b7a254ef95f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user agent list, if user is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ListUserAgent Should get user agent list, if user is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.a(&#x27;array&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a82dde42-73aa-4593-93d0-57567284dc2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e7cc44e7-f6f0-451e-81e3-b7a254ef95f5&quot;,&quot;a82dde42-73aa-4593-93d0-57567284dc2e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:55,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3c419047-7d14-4b4b-a40a-313206e1f1bb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\updateUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\updateUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;93498325-a7a7-44d7-bda1-f4c64f650ee8&quot;,&quot;title&quot;:&quot;Agent.UpdateUserAgent&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\updateUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\updateUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2675,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(agentData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userAgent = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fab22c81-a556-44ab-be82-6973751a5068&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8517ec5-5894-45d4-966b-59c8cd57aac1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + userAgent.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dbc45c6d-b1fd-4ab4-a764-69a17e9d3fe7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar agentBody = _.clone(agentData);\nagentBody = _.omit(agentBody, &#x27;name&#x27;);\napi.put(apiURL + userAgent.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(agentBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd01e251-fe90-418c-8a7c-f4be9e83c536&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user agent not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent Should get error if user agent not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + &#x27;dummyAgent&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ name: &#x27;updated&#x27; })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.AGENT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f21dac46-e77c-4cdc-8b8f-c04f2791658e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update agent, if agent data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent Should update agent, if agent data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + userAgent.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ name: &#x27;updated&#x27; })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userAgent = res.body.output;\n            expect(userAgent.name).to.be.equal(&#x27;updated&#x27;);\n            expect(userAgent).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17610e6e-4e71-488c-af32-f3a491326309&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dbc45c6d-b1fd-4ab4-a764-69a17e9d3fe7&quot;,&quot;dd01e251-fe90-418c-8a7c-f4be9e83c536&quot;,&quot;f21dac46-e77c-4cdc-8b8f-c04f2791658e&quot;,&quot;17610e6e-4e71-488c-af32-f3a491326309&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:139,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e6ce8b55-beaf-49a8-b25d-8e6f390c2cf6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\validateUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\validateUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bb4b34ec-6fd8-4d09-95ee-67c7c4a0b473&quot;,&quot;title&quot;:&quot;Agent.ValidateUserAgent&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\agent\\validateUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\validateUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ValidateUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2754,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(&#x27;/enterprise/v1/user/agents&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(agentData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userAgent = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8cd1e8ca-e88b-400e-bb47-2a0230c0ef62&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ValidateUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3f21a99-c7be-4cd2-ba30-b432066a29ee&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get error if \&quot;gateway_key\&quot; key missing or not valid in request headers.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ValidateUserAgent Should get error if \&quot;gateway_key\&quot; key missing or not valid in request headers.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;gatewaykey&#x27;, &#x27;invalid key&#x27;)                \n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Unauthorized&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;483335cd-ca84-4d09-a390-7f9537ff27b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user agent not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ValidateUserAgent Should get error if user agent not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;gateway_key&#x27;, &#x27;invalid key&#x27;)               \n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.AGENT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c908803-dded-4d95-a0e0-7cf8ea3ec496&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate agent, if agent data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ValidateUserAgent Should validate agent, if agent data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4809,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;gateway_key&#x27;, userAgent.uid)               \n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.contain.any.keys([&#x27;message&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75d174e1-6c54-48ee-9754-b409f88846c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;483335cd-ca84-4d09-a390-7f9537ff27b4&quot;,&quot;2c908803-dded-4d95-a0e0-7cf8ea3ec496&quot;,&quot;75d174e1-6c54-48ee-9754-b409f88846c0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4831,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5fbe7959-fbb2-4c7d-9f73-b1395c02de00&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d33140f0-00a2-4356-aebd-32c3ba87bcc8&quot;,&quot;title&quot;:&quot;authyUser&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;37d8e526-1f64-4539-9a50-9f1f06a8fc1d&quot;,&quot;title&quot;:&quot;authyUser.requestSMS&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise authyUser authyUser.requestSMS \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:270,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;096a7269-5048-449f-bf31-f885e58dff1c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise authyUser authyUser.requestSMS \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cdaf5af0-b170-43ec-acd0-bc69838c13f0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should send otp with SMS.&quot;,&quot;fullTitle&quot;:&quot;Enterprise authyUser authyUser.requestSMS Should send otp with SMS.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var authy_userId = res.body.output.authy.authy_userId;\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send({\n                    authy_user_uid: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.success.should.equal(\&quot;true\&quot;);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;58a95b0a-ca9e-42af-a1fc-f2e1f9588393&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send otp with SMS by passing email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise authyUser authyUser.requestSMS Should send otp with SMS by passing email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:72,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send({\n                    email: res.body.output.email\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.success.should.equal(\&quot;true\&quot;);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b959f67-9f26-4f25-b01b-b8bc127b03d9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as user not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise authyUser authyUser.requestSMS Should give error as user not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var authy_userId = res.body.output.authy.authy_userId;\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send({})\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.USER_NOT_FOUND);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e030f922-ed1a-42e6-8ce4-ffc99c7befe5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;58a95b0a-ca9e-42af-a1fc-f2e1f9588393&quot;,&quot;9b959f67-9f26-4f25-b01b-b8bc127b03d9&quot;,&quot;e030f922-ed1a-42e6-8ce4-ffc99c7befe5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:232,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;28613889-b055-411c-8dfd-04951df4ce7e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\createUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\createUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bb2bc3a9-99dd-4734-8d6c-8fb9c0207751&quot;,&quot;title&quot;:&quot;Connection.CreateUserConnection&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\createUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\createUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:194,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        done()\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ac90aef-95ff-4a6a-bcdb-81d31cd4cd05&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n    done(err)\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4608e85f-f4cd-4184-8586-be2453cd435f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3d21c75-a6d6-492c-9cf8-0792421cd9f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;data\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection Should get error if \&quot;data\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.clone(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;data&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ae8418d3-c454-4845-a41f-f3ef7f23f169&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;input\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection Should get error if \&quot;input\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.cloneDeep(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;input&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e94cafb-a573-4cd8-9c4d-4a78459c4061&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.cloneDeep(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;name&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6eabbb3-5ff5-4fc7-ae4e-b4e6ca03e0c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create connection, if connection data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection Should create connection, if connection data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.cloneDeep(testData.connectionBody);\nvar opt = { body: data, path: &#x27;/connection/create&#x27; }\ncommonMock.connectionCreateSuccess(opt)\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.connectionBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userConnection = res.body.output\n            expect(userConnection).to.have.any.keys(_.union(_.keys(testData.connectionBody), [&#x27;uid&#x27;, &#x27;user&#x27;]));\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;65f99efc-3dde-4899-adff-7c27d80a106d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d3d21c75-a6d6-492c-9cf8-0792421cd9f0&quot;,&quot;ae8418d3-c454-4845-a41f-f3ef7f23f169&quot;,&quot;6e94cafb-a573-4cd8-9c4d-4a78459c4061&quot;,&quot;f6eabbb3-5ff5-4fc7-ae4e-b4e6ca03e0c4&quot;,&quot;65f99efc-3dde-4899-adff-7c27d80a106d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:176,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3a5c2db6-72d0-4cb3-a9e6-b6ed4700ae53&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\deleteUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\deleteUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;65634fe5-2982-4c81-9925-28029299d052&quot;,&quot;title&quot;:&quot;Connection.DeleteUserConnection&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\deleteUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\deleteUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.DeleteUserConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:206,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        var conndata = _.cloneDeep(connectionData)\n        conndata.user = dummyUser.uid\n        _models.UserConnection.create(conndata, function(err, result) {\n            if (result) {\n                userConnection = result.toJSON()\n            }\n            done()\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc9b5d89-adc3-470f-a789-049b3b3e9cc5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.DeleteUserConnection \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3bc2078a-46dc-4fed-9a3c-012709de5771&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.DeleteUserConnection Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + userConnection.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cec05d99-2c78-4021-bcaf-79e26d93a712&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user connection not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.DeleteUserConnection Should get error, if user connection not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;dummyUser&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.CONNECTION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75da9ec5-b689-41eb-9610-856f219a49c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete connection, if user connection found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.DeleteUserConnection Should delete connection, if user connection found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.cloneDeep(testData.connectionBody);\nvar opt = { path: &#x27;/connection/&#x27; + userConnection.uid };\ncommonMock.connectionDeleteSuccess(opt);\napi.delete(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.notice).to.be.equal(messageList.CONNECTION_DELETED_SUCCESSFULLY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1fdc4c60-4128-49a5-91e1-0136d0d75c76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cec05d99-2c78-4021-bcaf-79e26d93a712&quot;,&quot;75da9ec5-b689-41eb-9610-856f219a49c2&quot;,&quot;1fdc4c60-4128-49a5-91e1-0136d0d75c76&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:118,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;878e9d56-af51-4dcc-8d32-722075ae1f30&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\getUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\getUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c7bb270f-d936-44f7-a72c-9e5d18c901cf&quot;,&quot;title&quot;:&quot;Connection.GetUserConnection&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\getUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\getUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:236,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        var conndata = _.cloneDeep(connectionData)\n        conndata.user = dummyUser.uid\n        _models.UserConnection.create(conndata, function(err, result) {\n            if (result) {\n                userConnection = result.toJSON()\n            }\n            done()\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce1b8359-d99a-430b-a5a8-d7273dfd8f2c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnection \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23883c22-6caf-4274-a4af-f340a30cf753&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnection Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + userConnection.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a10ac46a-8ec1-4b1d-ba2e-3a86a5167499&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user connection not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnection Should get error, if user connection not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: &#x27;/connection/dummyUser/details&#x27; };\ncommonMock.connectionGetNotFound(opt);\napi.get(apiURL + &#x27;dummyUser&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.CONNECTION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;03b2f628-9827-44d2-bd34-d8c121df7cad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get connection, if user connection found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnection Should get connection, if user connection found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: &#x27;/connection/&#x27; + userConnection.uid + &#x27;/details&#x27; };\ncommonMock.connectionGetSuccess(opt);\napi.get(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userConnection = res.body.output\n            expect(userConnection).to.have.all.keys([&#x27;connection&#x27;]);\n            expect(userConnection.connection).to.have.any.keys(_.union(_.keys(connectionData), [&#x27;uid&#x27;, &#x27;user&#x27;]));\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00e35b8e-1833-4bb8-b479-3b854799cf60&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a10ac46a-8ec1-4b1d-ba2e-3a86a5167499&quot;,&quot;03b2f628-9827-44d2-bd34-d8c121df7cad&quot;,&quot;00e35b8e-1833-4bb8-b479-3b854799cf60&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:114,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;93b6b2fc-32db-4146-9ee8-46999acfb573&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\getUserConnections.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\getUserConnections.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;841263a1-6029-41a2-b4ae-964555899a86&quot;,&quot;title&quot;:&quot;Connection.GetUserConnections&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\getUserConnections.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\getUserConnections.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnections \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2693,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            var entUser = _.cloneDeep(testData.userObj)\n            _models.User.create(entUser, function(err, newuser) {\n                cbk(err, newuser);\n            })\n        })\n    },\n    function(user, cbk) {\n        fakeUser = user\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        var conndata = _.cloneDeep(connectionData)\n        conndata.user = dummyUser.uid\n        _models.UserConnection.create(conndata, function(err, result) {\n            if (result) {\n                userConnection = result.toJSON()\n            }\n            cbk(err, userConnection)\n        })\n    }\n], function(err, res) {\n    done(err);\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb609740-4e9a-4a2d-96d2-1ae54e1d2b3b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnections \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.User.remove({ uid: fakeUser.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ffd38aac-c042-42c8-adec-4b7947ecb078&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnections Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36927bc5-bdb9-4751-a4dc-ff07a32ca1fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get connection, if user connection found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnections Should get connection, if user connection found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.all.keys([&#x27;_id&#x27;, &#x27;userauths&#x27;, &#x27;icons&#x27;,&#x27;label&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a82226d5-6a2b-433d-8ab3-17427cc7c7af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;36927bc5-bdb9-4751-a4dc-ff07a32ca1fc&quot;,&quot;a82226d5-6a2b-433d-8ab3-17427cc7c7af&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b0da9423-8a35-4cbc-b83d-cf8bc62d9acc&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\listConnections.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\listConnections.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4ec1fbaf-9d79-43df-b4db-b191603b04e4&quot;,&quot;title&quot;:&quot;Connection.ListConnections&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\listConnections.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\listConnections.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.ListConnections \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2714,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87fac29e-be15-4247-af27-e91e303cabf6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of connection.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.ListConnections Should get list of connection.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc092398-4dbd-43bf-a5cf-da5c3004ace1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.ListConnections Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4b3f035a-6cbb-4e66-a78e-67b2b362e8cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bc092398-4dbd-43bf-a5cf-da5c3004ace1&quot;,&quot;4b3f035a-6cbb-4e66-a78e-67b2b362e8cd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:57,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5e554ef5-469b-4ebf-9f42-a950cddb8d6d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\testUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\testUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;328cbe8c-480e-4575-9948-45e75b82ffbc&quot;,&quot;title&quot;:&quot;Connection.TestUserConnection&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\testUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\testUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.TestUserConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:223,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        var conndata = _.cloneDeep(connectionData)\n        conndata.user = dummyUser.uid\n        _models.UserConnection.create(conndata, function(err, result) {\n            if (result) {\n                userConnection = result.toJSON()\n            }\n            done()\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;42c96438-2aac-4dee-97d0-0d0d5f60bbb1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.TestUserConnection \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    done(err)\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b08058a7-e87a-4696-9bac-7ee722baa6c9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.TestUserConnection Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + userConnection.uid + &#x27;/validate&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a0ab463-eb0a-405b-b66d-5d380fc0630d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update connection, if connection data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.TestUserConnection Should update connection, if connection data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.cloneDeep(testData.connectionBody);\nconnectionData.uid = userConnection.uid;\nvar opt = { uid: userConnection.uid, path: &#x27;/connection/&#x27; + userConnection.uid + &#x27;/validate&#x27; };\ncommonMock.connectionTestSuccess(opt);\napi.get(apiURL + userConnection.uid + &#x27;/validate&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userConnection = res.body.output\n            expect(userConnection).to.have.any.keys(_.union(_.keys(testData.connectionBody), [&#x27;uid&#x27;, &#x27;user&#x27;]));\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;969c1eb1-2be0-4584-89c7-780300b0a069&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2a0ab463-eb0a-405b-b66d-5d380fc0630d&quot;,&quot;969c1eb1-2be0-4584-89c7-780300b0a069&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:47,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0340de97-b17d-481c-823c-7ad8649a98d4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\updateUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\updateUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f24ece13-ad41-45cb-a8d1-e1deabdec103&quot;,&quot;title&quot;:&quot;Connection.UpdateUserConnection&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\connection\\updateUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\updateUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:214,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        var conndata = _.cloneDeep(connectionData)\n        conndata.user = dummyUser.uid\n        _models.UserConnection.create(conndata, function(err, result) {\n            if (result) {\n                userConnection = result.toJSON()\n            }\n            done()\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e22ef33-f7e6-48cc-b76d-1200fc2ccf43&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    done(err)\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14d778d2-ac4a-49d0-a16c-84906da081bb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + userConnection.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;858f6dc2-cf92-453a-a8e2-906b9cc92c63&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;data\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should get error if \&quot;data\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.clone(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;data&#x27;);\napi.put(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30d21447-a683-412a-83f4-863917b60976&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;input\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should get error if \&quot;input\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.clone(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;input&#x27;);\napi.put(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bd263755-e6f4-4ee9-af51-238f84c09942&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.clone(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;name&#x27;);\napi.put(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d920bb13-a762-442d-a5a3-21365da33186&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user connection not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should get error if user connection not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n// var opt = { path: &#x27;/connection/dummyUser&#x27; };\n// commonMock.connectionGetNotFound(opt);\nvar connectionObj = _.clone(connectionData);\napi.put(apiURL + &#x27;dummyUser&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionObj)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CONNECTION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e348159-df21-459e-80a2-57e3a51a4dfb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update connection, if connection data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should update connection, if connection data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.cloneDeep(testData.connectionBody);\nconnectionData.uid = userConnection.uid;\nconnectionData.label = &#x27;updated connection&#x27;;\nvar opt = { path: &#x27;/connection/&#x27; + userConnection.uid };\ncommonMock.connectionsUpdateSuccess(opt);\napi.put(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userConnection = res.body.output\n            expect(userConnection.label).to.be.equal(&#x27;updated connection&#x27;);\n            expect(userConnection).to.have.any.keys(_.union(_.keys(testData.connectionBody), [&#x27;uid&#x27;, &#x27;user&#x27;]));\n            var opt = { path: getTriggerPath, body: getTriggerPath };\n            commonMock.triggerGetSuccess(opt);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;234cc706-b1bb-4ecb-8b30-537be89ab101&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;858f6dc2-cf92-453a-a8e2-906b9cc92c63&quot;,&quot;30d21447-a683-412a-83f4-863917b60976&quot;,&quot;bd263755-e6f4-4ee9-af51-238f84c09942&quot;,&quot;d920bb13-a762-442d-a5a3-21365da33186&quot;,&quot;4e348159-df21-459e-80a2-57e3a51a4dfb&quot;,&quot;234cc706-b1bb-4ecb-8b30-537be89ab101&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:213,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;01950799-39f4-4ffa-a977-6e4bc81d9be1&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\deleteAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteAnnouncement.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;697f0dc8-a999-4cf2-9d99-12a45e1c304e&quot;,&quot;title&quot;:&quot;contentStack.deleteAnnouncement&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\deleteAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteAnnouncement.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteAnnouncement \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMessage.remove({ title: \&quot;UNIT_TEST_ANNOUNCEMENT\&quot; }, function(error, message) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a27d86b-682b-4d2f-9607-bae8c28cc1f0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteAnnouncement \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ad8f2187-fd9d-4140-9948-3617c2dede31&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete announcement.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteAnnouncement Should delete announcement.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/announcements\&quot;)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.Announcement.find({ title: \&quot;UNIT_TEST_ANNOUNCEMENT\&quot; },\n                function(error, users) {\n                    var uid = (users || [{ uid: \&quot;\&quot; }])[0].uid || \&quot;\&quot;;\n                    var paramUrl = apiURL + uid;\n                    api.delete(paramUrl)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _models.CmsMessage.find({ title: \&quot;UNIT_TEST_ANNOUNCEMENT\&quot; },\n                                    function(error, users) {\n                                        (error == null &amp;&amp; (users || []).length == 0).should.equal(true);\n                                        done();\n                                    });\n                            }\n                        });\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f5060fe-1694-4fa6-8f07-e88e55338691&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4f5060fe-1694-4fa6-8f07-e88e55338691&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2e3cde7e-0864-49b5-8ced-ddd6d78748b5&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\deleteEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6ccf2709-caa5-4937-9808-f1e59e5aa030&quot;,&quot;title&quot;:&quot;contentStack.deleteEmailTemplate&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\deleteEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteEmailTemplate \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMail.remove({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; }, function(error, template) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02df5a9e-a83a-4e86-913a-ee4fc28acac1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteEmailTemplate \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d34c0b1-d823-4cd1-a9ff-7b8f97aae916&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete email template.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteEmailTemplate Should delete email template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.CmsMail.find({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; },\n                function(error, templates) {\n                    var uid = (templates || [{ uid: \&quot;\&quot; }])[0].uid || \&quot;\&quot;;\n                    var paramUrl = apiURL + uid;\n                    api.delete(paramUrl)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _models.CmsMail.find({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; },\n                                    function(error, templates) {\n                                        (error == null &amp;&amp; (templates || []).length == 0).should.equal(true);\n                                        done();\n                                    });\n                            }\n                        });\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2ce8200-6cff-475d-9c96-2d934ae897f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d2ce8200-6cff-475d-9c96-2d934ae897f2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7cea0fb8-7b04-4c45-a4cd-62b85279e885&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\deleteMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteMessage.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a4e299fe-04dd-49fa-a9ff-b22ac9887526&quot;,&quot;title&quot;:&quot;contentStack.deleteMessage&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\deleteMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteMessage.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteMessage \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMessage.remove({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; }, function(error, message) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23b91bdc-3d81-4589-aea1-9e2a5c02ea8d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteMessage \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29a4ce00-f6a2-4236-b467-2b9d6c9cadd9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteMessage Should delete message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.CmsMessage.find({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; },\n                function(error, users) {\n                    var uid = (users || [{ uid: \&quot;\&quot; }])[0].uid || \&quot;\&quot;;\n                    var paramUrl = apiURL + uid;\n                    api.delete(paramUrl)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _models.CmsMessage.find({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; },\n                                    function(error, users) {\n                                        (error == null &amp;&amp; (users || []).length == 0).should.equal(true);\n                                        done();\n                                    });\n                            }\n                        });\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd2f57a1-0677-4281-af8d-9752afd787cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cd2f57a1-0677-4281-af8d-9752afd787cf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8ff4fa77-3c50-4737-a5aa-dc045551c3da&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\deletePlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deletePlansFaq.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f08393af-68b5-4dee-8939-e26229d4fce7&quot;,&quot;title&quot;:&quot;contentStack.deletePlansFaq&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\deletePlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deletePlansFaq.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deletePlansFaq \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.PlansFaq.remove({ question_title: \&quot;UNIT_TEST_QUESTION\&quot; }, function(error, message) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1462b15-febf-4e48-9e42-c667ce3e9c78&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deletePlansFaq \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e4c8b24-f87b-4534-aa79-327a904ea6c4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete planfaqs.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deletePlansFaq Should delete planfaqs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/planfaqs\&quot;)\n    .send(planFaqBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.PlansFaq.find({ question_title: \&quot;UNIT_TEST_QUESTION\&quot; },\n                function(error, planFaqs) {\n                    var uid = (planFaqs || [{ uid: \&quot;\&quot; }])[0].uid || \&quot;\&quot;;\n                    var paramUrl = apiURL + uid;\n                    api.delete(paramUrl)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _models.PlansFaq.find({ question_title: \&quot;UNIT_TEST_QUESTION\&quot; },\n                                    function(error, planFaqs) {\n                                        (error == null &amp;&amp; (planFaqs || []).length == 0).should.equal(true);\n                                        done();\n                                    });\n                            }\n                        });\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86efe4fd-803e-4bd2-97fa-ec35b5bfec9c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;86efe4fd-803e-4bd2-97fa-ec35b5bfec9c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;940f6efa-6d6a-4028-b06e-71c6c370eca7&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\getAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getAnnouncement.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a9f787c8-d7fe-43f0-ae26-a0b4431eaf43&quot;,&quot;title&quot;:&quot;contentStack.getAnnouncement&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\getAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getAnnouncement.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getAnnouncement \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c72d669-08bf-4d52-aabe-703560033782&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getAnnouncement \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21e26867-52f3-4232-9a4d-d9ef413b8509&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get enterprise announcements.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getAnnouncement Should get enterprise announcements.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/announcements\&quot;)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(apiGetURL)\n                .set(\&quot;authtoken\&quot;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = Array.isArray(res.body.output.objects);\n                        if (isValid) {\n                            _.each(res.body.output.objects, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e966633b-cff7-4b44-84a7-ff17fae12e46&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get particular enterprise announcement.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getAnnouncement Should get particular enterprise announcement.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/announcements\&quot;)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(apiGetURL + \&quot;/\&quot; + announcementBody.entry.uid)\n                .set(\&quot;authtoken\&quot;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == announcementBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11bdf313-b1a4-4da6-8b54-1abc240d7d7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e966633b-cff7-4b44-84a7-ff17fae12e46&quot;,&quot;11bdf313-b1a4-4da6-8b54-1abc240d7d7e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:110,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d9baad87-d89e-4658-913c-ef6316b30e2a&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\getEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dcad3e31-b24b-4cb6-9624-f970b24f55a7&quot;,&quot;title&quot;:&quot;contentStack.getEmailTemplate&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\getEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5265,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMail.remove({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; }, function(error, template) {\n    _models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        enterpriseAuthToken = res.body.output.authtoken;\n                        var tempRegistrationBody = global.getImmutable(registrationBody);\n                        tempRegistrationBody.email = \&quot;test.user+100000@raweng.com\&quot;;\n                        commonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n                            email: tempRegistrationBody.email\n                        });\n                        api.post(\&quot;/express/v1/signup\&quot;)\n                            .send(tempRegistrationBody)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    expressAuthToken = res.body.output.authtoken;\n                                    done();\n                                }\n                            });\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c5005d8-ea68-4474-a7d9-9b9bbf908f17&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;329618d4-1509-40a2-aee0-de173727e92d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get enterprise email templates.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate Should get enterprise email templates.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nemailTemplateBody.entry.enterprise = true;\nemailTemplateBody.entry.express = false;\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/templates\&quot;)\n                .expect(httpStatus.OK)\n                .set(\&quot;authtoken\&quot;, enterpriseAuthToken)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = Array.isArray(res.body.output);\n                        if (isValid) {\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3698a875-e4f5-4d55-b718-3dd6b90a8840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get specific enterprise email template.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate Should get specific enterprise email template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nemailTemplateBody.entry.enterprise = true;\nemailTemplateBody.entry.express = false;\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/templates/UNIT_TEST_TEMPLATE\&quot;)\n                .expect(httpStatus.OK)\n                .set(\&quot;authtoken\&quot;, enterpriseAuthToken)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == emailTemplateBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f05241a7-af2e-403a-8230-16b0a8b8863e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get express email templates.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate Should get express email templates.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nemailTemplateBody.entry.enterprise = false;\nemailTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/express/v1/cms/templates\&quot;)\n                .expect(httpStatus.OK)\n                .set(\&quot;authtoken\&quot;, expressAuthToken)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = Array.isArray(res.body.output);\n                        if (isValid) {\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd319cbb-6723-4597-a21b-efb22d6a6da0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get specific express email template.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate Should get specific express email template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nemailTemplateBody.entry.enterprise = false;\nemailTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/express/v1/cms/templates/UNIT_TEST_TEMPLATE\&quot;)\n                .expect(httpStatus.OK)\n                .set(\&quot;authtoken\&quot;, expressAuthToken)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == emailTemplateBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aa17172f-eed4-444a-aea0-868531ac1a2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get template not found error message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate Should get template not found error message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nemailTemplateBody.entry.enterprise = false;\nemailTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/express/v1/cms/templates/UNIT_TEST_TEMPLATE0\&quot;)\n                .set(\&quot;authtoken\&quot;, expressAuthToken)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.CMS_EMAIL_TEMPLATE_NOT_FOUND);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;09846cbd-cfc6-45a5-a829-f6167303843d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3698a875-e4f5-4d55-b718-3dd6b90a8840&quot;,&quot;f05241a7-af2e-403a-8230-16b0a8b8863e&quot;,&quot;fd319cbb-6723-4597-a21b-efb22d6a6da0&quot;,&quot;aa17172f-eed4-444a-aea0-868531ac1a2e&quot;,&quot;09846cbd-cfc6-45a5-a829-f6167303843d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:274,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c2d69df8-7271-480d-8ca6-3a8f4010bcfc&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\getLatestAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getLatestAnnouncement.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;543e8c34-7ad2-4013-98b1-2d92642a403e&quot;,&quot;title&quot;:&quot;contentStack.getLatestAnnouncement&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\getLatestAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getLatestAnnouncement.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getLatestAnnouncement \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;772c11fd-796b-4454-9813-2929322b179c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getLatestAnnouncement \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea27e7e1-66a3-47e3-8073-d5b66f58658f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get latest enterprise announcement.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getLatestAnnouncement Should get latest enterprise announcement.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/announcements\&quot;)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(apiGetURL)\n                .set(\&quot;authtoken\&quot;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.uid.should.not.equal(\&quot;\&quot;);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f0f1d58-57f9-487d-8fb0-88d9ff2c9c30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5f0f1d58-57f9-487d-8fb0-88d9ff2c9c30&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:69,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7982b5cf-b9c7-4b54-99ea-be67de7c288f&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\getMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getMessage.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a6a9f2e9-54db-4edd-a8e3-0d723f85d0ef&quot;,&quot;title&quot;:&quot;contentStack.getMessage&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\getMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getMessage.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5340,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMessage.remove({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; }, function(error, message) {\n    _models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        enterpriseAuthToken = res.body.output.authtoken;\n                        var tempRegistrationBody = global.getImmutable(registrationBody);\n                        tempRegistrationBody.email = \&quot;test.user+100000@raweng.com\&quot;;\n                        commonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n                            email: tempRegistrationBody.email\n                        });\n                        api.post(\&quot;/express/v1/signup\&quot;)\n                            .send(tempRegistrationBody)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    expressAuthToken = res.body.output.authtoken;\n                                    done();\n                                }\n                            });\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0bbfcb48-c2eb-42ef-abd3-e4dd265bb922&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c473cec8-6d6c-40e0-9e78-a8a93cecf010&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get enterprise messages.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage Should get enterprise messages.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nmessageTemplateBody.entry.enterprise = true;\nmessageTemplateBody.entry.express = false;\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/messages\&quot;)\n                .set(\&quot;authtoken\&quot;, enterpriseAuthToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = Array.isArray(res.body.output);\n                        if (isValid) {\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;decf2f77-1423-447e-881d-f28f2e0a7c76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get specific enterprise message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage Should get specific enterprise message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nmessageTemplateBody.entry.enterprise = true;\nmessageTemplateBody.entry.express = false;\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/messages/UNIT_TEST_MESSAGE\&quot;)\n                .set(\&quot;authtoken\&quot;, enterpriseAuthToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == messageTemplateBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18f6235e-fbbc-45d2-96d1-8a9cd31268bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get express messages.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage Should get express messages.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nmessageTemplateBody.entry.enterprise = false;\nmessageTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/express/v1/cms/messages\&quot;)\n                .set(\&quot;authtoken\&quot;, expressAuthToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n\n                        var isValid = Array.isArray(res.body.output);\n                        if (isValid) {\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a760e769-91d4-4dbb-9b9a-2722030fcc9e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get specific express message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage Should get specific express message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nmessageTemplateBody.entry.enterprise = false;\nmessageTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/express/v1/cms/messages/UNIT_TEST_MESSAGE\&quot;)\n                .set(\&quot;authtoken\&quot;, expressAuthToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == messageTemplateBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;604b7071-8ae0-40e8-9313-39c48f998562&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get message not found error message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage Should get message not found error message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nmessageTemplateBody.entry.enterprise = false;\nmessageTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/messages/UNIT_TEST_MESSAGE0\&quot;)\n                .set(\&quot;authtoken\&quot;, enterpriseAuthToken)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.CMS_MESSAGE_NOT_FOUND);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bbfbe4e5-76eb-4fef-9411-9ec3014b2ae1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;decf2f77-1423-447e-881d-f28f2e0a7c76&quot;,&quot;18f6235e-fbbc-45d2-96d1-8a9cd31268bf&quot;,&quot;a760e769-91d4-4dbb-9b9a-2722030fcc9e&quot;,&quot;604b7071-8ae0-40e8-9313-39c48f998562&quot;,&quot;bbfbe4e5-76eb-4fef-9411-9ec3014b2ae1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:309,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;50226068-20f2-41cd-849b-b984952f6425&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\getPlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getPlansFaq.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1cb6ebcb-b97c-4b20-a6a9-895f284f6723&quot;,&quot;title&quot;:&quot;contentStack.getPlansFaq&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\getPlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getPlansFaq.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getPlansFaq \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3d5115d-85fb-4e77-84c5-301fb81c0ee9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getPlansFaq \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48843ed9-88ca-4520-afda-666b30b92138&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get enterprise planfaq.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getPlansFaq Should get enterprise planfaq.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/planfaqs\&quot;)\n    .send(planFaqBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/planfaqs\&quot;)\n                .set(\&quot;authtoken\&quot;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = Array.isArray(res.body.output);\n                        if (isValid) {\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6675906-fe30-4527-81e8-d4cea8c5ba1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get particular enterprise planfaq.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getPlansFaq Should get particular enterprise planfaq.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/planfaqs\&quot;)\n    .send(planFaqBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/planfaqs/\&quot; + planFaqBody.entry.uid)\n                .set(\&quot;authtoken\&quot;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == planFaqBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6351190c-7d4f-4eec-b258-826e0857eab6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b6675906-fe30-4527-81e8-d4cea8c5ba1a&quot;,&quot;6351190c-7d4f-4eec-b258-826e0857eab6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:102,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;091c0a9c-c6d0-4c71-9d38-8201ce3d1f7b&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\saveAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveAnnouncement.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7264ad27-9eed-4442-8326-af2acb2d2956&quot;,&quot;title&quot;:&quot;contentStack.saveAnnouncement&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\saveAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveAnnouncement.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveAnnouncement \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Announcement.remove({ title: \&quot;UNIT_TEST_ANNOUNCEMENT\&quot; }, function(error, message) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d8042b5-532c-4bc4-bb6d-86d293c68d60&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveAnnouncement \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2293d276-7587-4f99-a5be-fd2adda8ce43&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create announcement.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveAnnouncement Should create announcement.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.status.should.equal(\&quot;success\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17797ab2-fa81-4f94-8932-0a96e8aa0e5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give require validators errors.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveAnnouncement Should give require validators errors.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;entry.uid\&quot;].message == messageList.CMS_ANNOUNCEMENT_UID_NOT_FOUND;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e186abbc-7210-438e-9f9b-6c48bebd3e8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update existing announcement.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveAnnouncement Should update existing announcement.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            announcementBody.entry.rich_text_editor = \&quot;UNIT_TEST_ANNOUNCEMENT_BODY_00\&quot;;\n            api.post(apiURL)\n                .send(announcementBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _models.Announcement.find({ title: \&quot;UNIT_TEST_ANNOUNCEMENT\&quot; },\n                            function(error, announcement) {\n                                var isValid =\n                                    (announcement || []).length == 1 &amp;&amp;\n                                    (announcement || [{ raw_html_body: \&quot;\&quot; }])[0].raw_html_body == \&quot;UNIT_TEST_ANNOUNCEMENT_BODY_00\&quot; &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                isValid.should.equal(true);\n                                done();\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6f9b8bb-a0fc-4ca0-a111-f49c11df7012&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;17797ab2-fa81-4f94-8932-0a96e8aa0e5c&quot;,&quot;e186abbc-7210-438e-9f9b-6c48bebd3e8f&quot;,&quot;f6f9b8bb-a0fc-4ca0-a111-f49c11df7012&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:57,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1174f99e-3616-437d-af53-f1b72b3c73f8&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\saveEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;105b2acc-15db-4103-bf2b-8af268405f16&quot;,&quot;title&quot;:&quot;contentStack.saveEmailTemplate&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\saveEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveEmailTemplate \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMail.remove({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; }, function(error, template) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bfb173ce-5e3b-4fe5-8b55-4576001fdd32&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveEmailTemplate \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8442227b-1547-41e7-9162-ae6aaa0f91e3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create email template.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveEmailTemplate Should create email template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.status == \&quot;success\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2ba1ae7b-7b2f-4c7c-b4a0-a5c21158997a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give require validators errors.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveEmailTemplate Should give require validators errors.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;entry.uid\&quot;].message == messageList.CMS_EMAIL_UID_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.enterprise\&quot;].message == messageList.CMS_EMAIL_ENTERPRISE_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.express\&quot;].message == messageList.CMS_EMAIL_EXPRESS_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.template_id\&quot;].message == messageList.CMS_EMAIL_TEMPLATES_UID_NOT_FOUND;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b2b91b0-b9a1-46cc-aee0-db7991d6a17a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update existing email template.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveEmailTemplate Should update existing email template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            emailTemplateBody.entry.title = \&quot;TITLE_GOT_CHANGED\&quot;;\n            api.post(apiURL)\n                .send(emailTemplateBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _models.CmsMail.find({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; },\n                            function(error, templates) {\n                                var isValid =\n                                    (templates || []).length == 1 &amp;&amp;\n                                    (templates || [{ title: \&quot;\&quot; }])[0].title == \&quot;TITLE_GOT_CHANGED\&quot; &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                isValid.should.equal(true);\n                                done();\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a130d57-62ad-4c60-8e6d-57c58c266d89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2ba1ae7b-7b2f-4c7c-b4a0-a5c21158997a&quot;,&quot;0b2b91b0-b9a1-46cc-aee0-db7991d6a17a&quot;,&quot;4a130d57-62ad-4c60-8e6d-57c58c266d89&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:67,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;01b04162-d151-48cd-bd12-4fca6e13bce5&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\saveMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveMessage.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;76b5a8e1-1164-401b-ab75-b0b594a220b3&quot;,&quot;title&quot;:&quot;contentStack.saveMessage&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\saveMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveMessage.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveMessage \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMessage.remove({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; }, function(error, message) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;230cb1d0-03b3-4850-a16b-5772917e3b27&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveMessage \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe331188-24ff-4590-b24d-0c8dea057a64&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveMessage Should create message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.status == \&quot;success\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;24e06ad0-76e8-47db-aa4c-0732f8fd9724&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give require validators errors.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveMessage Should give require validators errors.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;entry.uid\&quot;].message == messageList.CMS_MESSAGE_UID_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.enterprise\&quot;].message == messageList.CMS_MESSAGE_ENTERPRISE_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.express\&quot;].message == messageList.CMS_MESSAGE_EXPRESS_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.message_id\&quot;].message == messageList.CMS_MESSAGE_TEMPLATES_UID_NOT_FOUND;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a7473ef-32b0-4e25-9531-e0b2fb8abc92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update existing message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveMessage Should update existing message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            messageTemplateBody.entry.title = \&quot;TITLE_GOT_CHANGED\&quot;;\n            api.post(apiURL)\n                .send(messageTemplateBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _models.CmsMessage.find({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; },\n                            function(error, messages) {\n                                var isValid =\n                                    (messages || []).length == 1 &amp;&amp;\n                                    (messages || [{ title: \&quot;\&quot; }])[0].title == \&quot;TITLE_GOT_CHANGED\&quot; &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                isValid.should.equal(true);\n                                done();\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d506ed1-a002-4059-be43-29b0e8a2d199&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;24e06ad0-76e8-47db-aa4c-0732f8fd9724&quot;,&quot;2a7473ef-32b0-4e25-9531-e0b2fb8abc92&quot;,&quot;7d506ed1-a002-4059-be43-29b0e8a2d199&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:74,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;83ec58bc-f0f0-4c3e-b3b6-302496bd0179&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\savePlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\savePlansFaq.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;54be8933-8d5c-4e75-b604-12e3068c8db3&quot;,&quot;title&quot;:&quot;contentStack.savePlansFaq&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\contentStack\\savePlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\savePlansFaq.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.savePlansFaq \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f92aebd7-a6b8-49f5-92b7-13ee4ee305d3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.savePlansFaq \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55c0c331-e5bf-4697-93fd-050d495e945c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should save planfaqs.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.savePlansFaq Should save planfaqs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(planFaqBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.status == \&quot;success\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c3e2080-b5f8-4f94-bc22-94fdc4ede67e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give require validators errors.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.savePlansFaq Should give require validators errors.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;entry.uid\&quot;].message == messageList.CMS_PLANFAQ_UID_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;message\&quot;] == messageList.PLEASE_SEND_VALID_PARAMETERS\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;905ad658-a211-4662-9a30-2ba890e26848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update existing planfaqs.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.savePlansFaq Should update existing planfaqs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(planFaqBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            planFaqBody.entry.answer = \&quot;UNIT_TEST_ANSWER00\&quot;;\n            api.post(apiURL)\n                .send(planFaqBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _models.PlansFaq.find({ question_title: \&quot;UNIT_TEST_QUESTION\&quot; },\n                            function(error, planFaq) {\n                                var isValid =\n                                    (planFaq || []).length == 1 &amp;&amp;\n                                    (planFaq || [{ question_title: \&quot;\&quot; }])[0].answer == \&quot;UNIT_TEST_ANSWER00\&quot; &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n\n                                isValid.should.equal(true);\n                                done();\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18844e4f-f42a-4ad4-83d0-865308e1c738&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8c3e2080-b5f8-4f94-bc22-94fdc4ede67e&quot;,&quot;905ad658-a211-4662-9a30-2ba890e26848&quot;,&quot;18844e4f-f42a-4ad4-83d0-865308e1c738&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:52,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c0262af8-c4ee-4d63-8548-9e9048426d33&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\createCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\createCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3c1702b0-d6c7-48db-a4fe-34d60cfc0981&quot;,&quot;title&quot;:&quot;CustomIntegration.Create&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\createCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\createCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2661,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b570948e-290f-46bb-b63e-9cfc6f073329&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18dd8d6b-5490-4ced-bc3f-59cfa87f432e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f37463e6-aa96-48e4-8b01-f73ff438a805&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;label\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;label\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.label = &#x27;&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e644189f-1450-4b1b-a47f-9fbe291b1fa0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;code_template\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;code_template\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.code_template = &#x27;&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;373e3cbd-ed9f-49eb-8461-e4247750218f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compile_error\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;compile_error\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.compile_error = &#x27;&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1696845a-f1f9-4639-af49-29a7f2d6692a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compiled_result\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;compiled_result\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.compiled_result = &#x27;&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d871006-2f32-45d1-a8cc-4a6564723cfa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;code_template\&quot; key is not string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;code_template\&quot; key is not string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCodeTemplate = _.clone(data)\ninvalidCodeTemplate.code_template = {};\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidCodeTemplate)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_PARAM_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;43fe3118-5d06-4d6b-9ac8-24c6013d09dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compiled_result\&quot; key is not string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;compiled_result\&quot; key is not string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCompiledResult = _.clone(data)\ninvalidCompiledResult.compiled_result = {};\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidCompiledResult)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_PARAM_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9fbbbd5-b1c6-4b92-ad00-9e3af44ceb59&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create custom integration if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should create custom integration if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.user_uid).to.be.equal(dummyUser.uid);\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d38a1ed6-0cf6-41bc-a447-64e37db895f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f37463e6-aa96-48e4-8b01-f73ff438a805&quot;,&quot;e644189f-1450-4b1b-a47f-9fbe291b1fa0&quot;,&quot;373e3cbd-ed9f-49eb-8461-e4247750218f&quot;,&quot;1696845a-f1f9-4639-af49-29a7f2d6692a&quot;,&quot;5d871006-2f32-45d1-a8cc-4a6564723cfa&quot;,&quot;43fe3118-5d06-4d6b-9ac8-24c6013d09dd&quot;,&quot;c9fbbbd5-b1c6-4b92-ad00-9e3af44ceb59&quot;,&quot;d38a1ed6-0cf6-41bc-a447-64e37db895f3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:323,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;eb4d62bd-15d0-4b4e-9b1b-8603f5087c99&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\deleteCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\deleteCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;794445fe-4740-4537-b89b-e7222bb8bed8&quot;,&quot;title&quot;:&quot;CustomIntegration.Delete&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\deleteCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\deleteCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Delete \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2728,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        customIntegration = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6aacf6cc-5d64-4f0a-b6d3-29c12cf76384&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Delete \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;34c0c040-3deb-47ba-ac1e-d290637ae8a8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Delete Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;686e6244-d817-4214-9e54-2c495477631e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if integration not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Delete Should give error, if integration not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/dummyIntegration&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c19fc725-4424-4fe5-b48e-0145af8b4c9e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete custom if integration found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Delete Should delete custom if integration found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.result).to.be.equal(&#x27;success&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;654a4f5d-0244-4dad-93ea-3c801b787e1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;686e6244-d817-4214-9e54-2c495477631e&quot;,&quot;c19fc725-4424-4fe5-b48e-0145af8b4c9e&quot;,&quot;654a4f5d-0244-4dad-93ea-3c801b787e1d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:110,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a5e923a9-b4b6-494a-809c-6ea205e04743&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\getCompiledCustomIntegrationByUserUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCompiledCustomIntegrationByUserUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5a5a15d3-c1e7-43c1-b4c3-3b68cf3160d8&quot;,&quot;title&quot;:&quot;CustomIntegration.GetByUserUID&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\getCompiledCustomIntegrationByUserUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCompiledCustomIntegrationByUserUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2817,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        customIntegration = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b655657-d0b3-45a3-9757-57417723f9a7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2dedbac4-9d50-453d-b6e6-8bbab304b4f4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/compiled&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54570c80-00bf-4722-93bb-abf418d073ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get custom if integration found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID Should get custom if integration found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/compiled&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.a(&#x27;array&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;43e91be4-d336-4e53-af90-645afe30e175&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;54570c80-00bf-4722-93bb-abf418d073ff&quot;,&quot;43e91be4-d336-4e53-af90-645afe30e175&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:57,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b9227bbe-1df1-4b16-ab55-73385f465dd0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\getCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8111626f-2a77-46d2-b29f-86d723d50207&quot;,&quot;title&quot;:&quot;CustomIntegration.Update&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\getCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2617,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        customIntegration = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a8b675fc-3ec7-420b-bbe2-bf6cf5f53ef2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5e04b49-69dd-400c-82d0-be894e399439&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/css&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b69f553e-7a4f-42ea-aa89-f9890e99f8c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get custom integration css.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should get custom integration css.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/css&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).to.be.equal(1);\n            expect(_.first(res.body.output).integration_uid).not.to.be.equal(null)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d28a2960-59e1-481a-a35b-7bd9f5ecf63b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b69f553e-7a4f-42ea-aa89-f9890e99f8c7&quot;,&quot;d28a2960-59e1-481a-a35b-7bd9f5ecf63b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:81,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;82feb496-12cb-4a13-b245-9a01e8c98519&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\getCustomIntegrationByUserUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCustomIntegrationByUserUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ae8b5681-d986-4e50-a5b2-824d4c1f43e7&quot;,&quot;title&quot;:&quot;CustomIntegration.GetByUserUID&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\getCustomIntegrationByUserUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCustomIntegrationByUserUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2675,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        customIntegration = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4fa7f2d-b412-40ed-b1d3-38b3b1493316&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ee45a5d-17d5-4fe8-831d-9bfe60e15a1f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab1e1fad-7555-4907-a619-99e156ac04b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get custom if integration found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID Should get custom if integration found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).to.be.equal(1);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d955272-9f1f-412a-8aa8-53749e074dac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ab1e1fad-7555-4907-a619-99e156ac04b9&quot;,&quot;5d955272-9f1f-412a-8aa8-53749e074dac&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:67,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2c52d570-370f-4bd9-8acf-013842556351&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\getFlowsByCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getFlowsByCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;faf5734d-7f25-4052-a827-77cfc3dca33d&quot;,&quot;title&quot;:&quot;CustomIntegration.GetFlows&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\getFlowsByCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getFlowsByCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2875,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        customIntegration = result.body.output;\n        flowData.activities[2].uid = customIntegration.uid;\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;beafbc8a-f95c-489c-97a1-036151ca45f9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2cc48677-b036-4b01-9707-24a7ea50aa4e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/&#x27; + customIntegration.uid + &#x27;/flows&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;932e9a90-5449-464c-9985-50194fd78fec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows of custom  integrtion.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows Should get list of flows of custom  integrtion.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/&#x27; + customIntegration.uid + &#x27;/flows&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output[0]).to.contain.all.keys([&#x27;uid&#x27;, &#x27;name&#x27;])\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c2c6fad-ee0c-4d57-8c2d-53d921431590&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;932e9a90-5449-464c-9985-50194fd78fec&quot;,&quot;8c2c6fad-ee0c-4d57-8c2d-53d921431590&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ecb2df2c-e910-4cfc-98f1-e787ab51b8ce&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\updateCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\updateCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6ced4480-5515-4c98-b973-54c7a438d6ae&quot;,&quot;title&quot;:&quot;CustomIntegration.Update&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\customeIntegration\\updateCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\updateCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2770,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        customIntegration = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a00bcaa-2378-49d6-a589-4a9fefe68314&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6a105562-d9bc-4178-b9de-28ce18e970ad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;168295e8-5bc2-4adb-9383-e678fca9ac07&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;label\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;label\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.label = &#x27;&#x27;;\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e2a365fb-43a5-40ff-b2dc-671f5e6763eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;code_template\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;code_template\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.code_template = &#x27;&#x27;;\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27feded9-a63f-4587-aef0-0b34c801c2bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compile_error\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;compile_error\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.compile_error = &#x27;&#x27;;\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11266686-bbd7-4edf-a934-37dd103c1df8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compiled_result\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;compiled_result\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.compiled_result = &#x27;&#x27;;\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aaed250d-2617-41a6-bf8f-9be6b35acb28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;code_template\&quot; key is not string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;code_template\&quot; key is not string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCodeTemplate = _.clone(data)\ninvalidCodeTemplate.code_template = {};\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidCodeTemplate)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_PARAM_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2eb40257-c966-425c-82a6-7d6dd1745596&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compiled_result\&quot; key is not string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;compiled_result\&quot; key is not string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCompiledResult = _.clone(data)\ninvalidCompiledResult.compiled_result = {};\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidCompiledResult)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_PARAM_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25a4abd1-2381-42dc-be14-ab40998d7aec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if integration not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if integration not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + &#x27;/dummyIntegration&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bd8c8322-a5e9-4580-9476-607259e7157b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update custom integration if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should update custom integration if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndata.label = &#x27;updated&#x27;;\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.label).to.be.equal(&#x27;updated&#x27;);\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;640e9ef2-d92b-4a4b-a911-f0451be5bfc4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;168295e8-5bc2-4adb-9383-e678fca9ac07&quot;,&quot;e2a365fb-43a5-40ff-b2dc-671f5e6763eb&quot;,&quot;27feded9-a63f-4587-aef0-0b34c801c2bb&quot;,&quot;11266686-bbd7-4edf-a934-37dd103c1df8&quot;,&quot;aaed250d-2617-41a6-bf8f-9be6b35acb28&quot;,&quot;2eb40257-c966-425c-82a6-7d6dd1745596&quot;,&quot;25a4abd1-2381-42dc-be14-ab40998d7aec&quot;,&quot;bd8c8322-a5e9-4580-9476-607259e7157b&quot;,&quot;640e9ef2-d92b-4a4b-a911-f0451be5bfc4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:341,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ce649000-fd20-435f-bbff-5621282eff0c&quot;,&quot;title&quot;:&quot;DevOps&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\devOps\\getFlowDetails.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\devOps\\getFlowDetails.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;82efbb05-cee2-4d8f-a4ed-a059c93ef12b&quot;,&quot;title&quot;:&quot;DevOps.GetFlowDetails&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\devOps\\getFlowDetails.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\devOps\\getFlowDetails.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error ui_admin_key is invalid.&quot;,&quot;fullTitle&quot;:&quot;DevOps DevOps.GetFlowDetails Should give unauthenticated user error ui_admin_key is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Unauthorized&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9ccef7dd-d54a-41da-bb04-805a026f3733&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get data, if valid ui_admin_key sent.&quot;,&quot;fullTitle&quot;:&quot;DevOps DevOps.GetFlowDetails Should get data, if valid ui_admin_key sent.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc9991cf-ce1d-48b0-a470-a5e15dda3315&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9ccef7dd-d54a-41da-bb04-805a026f3733&quot;,&quot;bc9991cf-ce1d-48b0-a470-a5e15dda3315&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;809ed59c-5bf0-4fdf-9e2d-ad62db3df7d3&quot;,&quot;title&quot;:&quot;DevOps&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\devOps\\getUserDetails.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\devOps\\getUserDetails.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;120d4ea9-72d5-4c36-b906-c1e1cbca25cc&quot;,&quot;title&quot;:&quot;DevOps.GetUserDetails&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\devOps\\getUserDetails.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\devOps\\getUserDetails.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error ui_admin_key is invalid.&quot;,&quot;fullTitle&quot;:&quot;DevOps DevOps.GetUserDetails Should give unauthenticated user error ui_admin_key is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Unauthorized&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66f8cc18-b7cf-46cd-8524-d66f2ecc9d8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get data, if valid ui_admin_key sent.&quot;,&quot;fullTitle&quot;:&quot;DevOps DevOps.GetUserDetails Should get data, if valid ui_admin_key sent.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d31f11e-95c5-4231-958a-2d7461f58384&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;66f8cc18-b7cf-46cd-8524-d66f2ecc9d8c&quot;,&quot;3d31f11e-95c5-4231-958a-2d7461f58384&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4f6daec0-d7f0-43f1-ba45-3d4b9fa1bd0d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\environment\\createEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\createEnvironment.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2f7ebf75-7029-47b4-9565-52000a800991&quot;,&quot;title&quot;:&quot;Environment.Create&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\environment\\createEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\createEnvironment.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Create \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:224,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken;\n        done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e01eba6-c499-40e6-b5c2-e87a3f78cd5c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Environment.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [env.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;312a4deb-85e4-4f12-8fc0-7ef7a843b0b9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Create Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;969fa106-ced1-42a8-bcf6-2441efff6e76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create env, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Create Should create env, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            env = res.body.output\n            expect(env.name).equal(projectData.name);\n            expect(env).to.have.any.keys([&#x27;name&#x27;, &#x27;owner_uid&#x27;]);\n            done()\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe10d2ab-823e-4abe-a802-f4ce97f17d4c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if env name is blank.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Create Should get error if env name is blank.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;&#x27;\nprojectData.user_uid = dummyUser.uid\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            expect(res.body.error.name.message).equal(messageList.ENV_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9da33b1-5efa-4e2e-b391-119c608e5c5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;969fa106-ced1-42a8-bcf6-2441efff6e76&quot;,&quot;fe10d2ab-823e-4abe-a802-f4ce97f17d4c&quot;,&quot;e9da33b1-5efa-4e2e-b391-119c608e5c5d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:88,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4291888c-3a34-4a1d-b3ee-3f8c65f208f9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\environment\\getEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\getEnvironment.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;28d1f2a9-5d8b-4bf4-bb8a-858a7725b718&quot;,&quot;title&quot;:&quot;Environment.Get&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\environment\\getEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\getEnvironment.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Get \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:243,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken;\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken })\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    env = res.body.output\n                    done()\n                }\n            });\n   // });\n   // done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ecd5b68-91c6-44e5-85ba-551ade1a4a5f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Get \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Environment.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [env.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;548d933f-a124-4da1-a165-caab6796bb13&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Get Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + env.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee3ab360-c902-4d34-bb96-6bf7760b1859&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update env, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Get Should update env, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + env.uid)\n    .set({ authtoken: dummyUser.authtoken })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            env = res.body.output\n            expect(env.name).equal(projectData.name);\n            done()\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;793d78a2-43b6-4cc0-9357-50f31e66bfa0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if env not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Get Should get error if env not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;&#x27;\nprojectData.user_uid = dummyUser.uid\napi.get(apiURL + &#x27;dummyEnv&#x27;)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.ENV_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bed9b4ce-826a-4adf-90f1-35ce7afa1d94&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ee3ab360-c902-4d34-bb96-6bf7760b1859&quot;,&quot;793d78a2-43b6-4cc0-9357-50f31e66bfa0&quot;,&quot;bed9b4ce-826a-4adf-90f1-35ce7afa1d94&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:101,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;759a1eb1-6195-450f-ab3a-d923371ff8a1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\environment\\listEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\listEnvironment.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e6ace0b9-2d4d-4248-9c40-45f75da872b8&quot;,&quot;title&quot;:&quot;Environment.List&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\environment\\listEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\listEnvironment.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.List \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:287,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken;\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken })\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    env = res.body.output\n                    done()\n                }\n            });\n   // });\n   // done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f0cb397-549e-4b1e-9514-5e349b917e97&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.List \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Environment.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [env.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;71b9ff5f-9435-41e8-af19-233de0bd4f10&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.List Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fac6344f-4903-4135-b456-9a3055489618&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update env, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.List Should update env, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            env = res.body.output\n            expect(env.length).gte(1);\n            done()\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;afb569d6-2e4d-4be9-b6c6-f17f6327ef0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fac6344f-4903-4135-b456-9a3055489618&quot;,&quot;afb569d6-2e4d-4be9-b6c6-f17f6327ef0a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:57,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;66ca5f49-b44b-47f4-bf8e-72219f6ac580&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\cloneUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\cloneUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e38a6852-ea4d-4ada-a468-a15b7de28839&quot;,&quot;title&quot;:&quot;Flow.CloneUserFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\cloneUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\cloneUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:419,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerCreateSuccess(opt)\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n                function(cbk) {\n                    api.get(&#x27;/enterprise/v1/user&#x27;)\n                        .set(&#x27;authtoken&#x27;, orgData.owner.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                dummyUser = res.body.output;\n                                cbk(err, dummyUser)\n                            }\n                        });\n                },\n                function(dummyUser, cbk) {\n                    testData.mongoUserTriggerObj.user_uid = dummyUser.uid\n                    _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                        cbk(err, userTrigger);\n                    })\n                },\n                function(userTrigger, cbk) {\n                    //var flowData = _.cloneDeep(testData.enterpriseFlowBody)\n                    // _id = dummyUser._id\n                    userTrigger = userTrigger.toJSON()\n                    flowData.trigger.handlers = [userTrigger]\n                    flowData.configurations[0].params = [{\n                        \&quot;key\&quot;: \&quot;1\&quot;,\n                        \&quot;value\&quot;: \&quot;2\&quot;,\n                        \&quot;required\&quot;: true\n                    }, {\n                        \&quot;key\&quot;: \&quot;3\&quot;,\n                        \&quot;value\&quot;: \&quot;2\&quot;,\n                        \&quot;required\&quot;: false\n                    }];\n                    flowData.configurations[0].project_params = [{\n                        \&quot;uid\&quot;: \&quot;random\&quot;,\n                        \&quot;key\&quot;: \&quot;param1\&quot;,\n                        \&quot;value\&quot;: \&quot;parawal\&quot;,\n                        \&quot;required\&quot;: true,\n                        \&quot;isPassword\&quot;: false,\n                        \&quot;hasError\&quot;: false\n                    }]\n                    api.post(flowURL)\n                        .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                        .send(flowData)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            cbk(err, res)\n                        })\n                },\n                function(result, cbk) {\n                    userFlow = result.body.output;\n                    projectData.owner_uid = dummyUser.uid\n                    projectData.env_uid = dummyUser.default_env\n                    api.post(&#x27;/enterprise/v1/projects&#x27;)\n                        .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                        .send(projectData)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, result) {\n                            cbk(err, result);\n                        })\n                }\n            ],\n            function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var query = _models.Project.findOne({ name: config.default_project, owner_uid: dummyUser.uid })\n                    query.lean().exec(function(err, result) {\n                        if (result) {\n                            dummyUser.default_project = result.uid\n                        }\n                        project = res.body.output;\n                        done()\n                    })\n                }\n            })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d1310da2-3216-4b54-8a69-7d5d0a1802b4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveFlow(createdFlows.concat([userFlow.uid, clonedFlow.flow.uid]), done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5112ab56-9e36-4a96-b3b4-aa69218b9e92&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/clone&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;28977737-4cb0-4c1e-afad-6c81e0449f57&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/dummyFlow/clone&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8b0e464-4320-4f4a-ae88-54a16dc3a224&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should clone flow, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should clone flow, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:124,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: createTriggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true };\ncommonMock.triggerPushSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/clone&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ \&quot;project_uid\&quot;: userFlow.project_uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            clonedFlow = res.body.output;\n            expect(clonedFlow).to.have.all.keys([&#x27;flow&#x27;, &#x27;page&#x27;]);\n            expect(clonedFlow.flow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e4b99163-4741-4781-adc0-873cf65cb946&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should clone flow in other project, if user sends \&quot;project_uid\&quot; in body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should clone flow in other project, if user sends \&quot;project_uid\&quot; in body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:145,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: createTriggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true };\ncommonMock.triggerPushSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nvar cloneOpt = { path: createTriggerPath, getPath: &#x27;/triggers/clone&#x27;, body: { \&quot;uid\&quot;: [/^fl\\w*/] }, update: true };\ncommonMock.triggerCloneSuccess(cloneOpt);\nvar orgDefaultProj = _.find(orgData.org_projects, { name: config.default_project })\nvar projectParamObj = _.merge(projectParams, { uid: &#x27;random&#x27;, type: &#x27;param&#x27;, project_uid: dummyUser.default_project, user_uid: dummyUser.uid })\nvar projectParams = [{\n    \&quot;uid\&quot;: \&quot;random\&quot;,\n    \&quot;key\&quot;: \&quot;param1\&quot;,\n    \&quot;value\&quot;: \&quot;parawal\&quot;,\n    \&quot;required\&quot;: true,\n    \&quot;isPassword\&quot;: false,\n    \&quot;hasError\&quot;: false\n}, {\n    \&quot;uid\&quot;: \&quot;random1\&quot;,\n    \&quot;key\&quot;: \&quot;param1\&quot;,\n    \&quot;value\&quot;: \&quot;parawal\&quot;,\n    \&quot;required\&quot;: true,\n    \&quot;isPassword\&quot;: false,\n    \&quot;hasError\&quot;: false\n}]\nvar params = [{\n    \&quot;key\&quot;: \&quot;1\&quot;,\n    \&quot;value\&quot;: \&quot;\&quot;,\n    \&quot;required\&quot;: true\n}, {\n    \&quot;key\&quot;: \&quot;3\&quot;,\n    \&quot;value\&quot;: \&quot;\&quot;,\n    \&quot;required\&quot;: false\n}]\n_models.ConfigSchema.create(projectParamObj, function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        projectParam = result.toJSON()\n        api.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/clone&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send({ \&quot;project_uid\&quot;: project.uid, project_params: projectParams, params: params })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    clonedFlow = res.body.output;\n                    expect(clonedFlow).to.have.all.keys([&#x27;flow&#x27;, &#x27;page&#x27;]);\n                    expect(clonedFlow.flow.errors_obj.length).eq(6)\n                    expect(clonedFlow.flow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n                    expect(clonedFlow.flow.project_uid).to.be.equal(project.uid);\n                    _models.ConfigSchema.find({ type: &#x27;param&#x27;, project_uid: project.uid }, function(err, result) {\n                        if (err) {\n                            done(err)\n                        } else {\n                            expect(result.length).eq(2)\n                            expect(_.first(result).project_uid).equal(project.uid)\n                            var query = _models.ConfigData.find({ flow_uid: clonedFlow.flow.uid })\n                            query.lean().exec(function(err, results) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var authData = _.find(results, { type: &#x27;auth&#x27; })\n                                    var connData = _.find(results, { type: &#x27;connection&#x27; })\n                                    expect(!_.has(authData, &#x27;auth&#x27;)).to.be.equal(true)\n                                    expect(!_.has(authData, &#x27;connection&#x27;)).to.be.equal(true)\n                                    expect(_.first(results).project_uid).to.be.equal(project.uid)\n                                    var query = _models.UserConfig.findOne({ project_uid: clonedFlow.flow.project_uid })\n                                    query.lean().exec(function(err, config) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            expect(_.first(results).config_uid).to.be.equal(config.uid)\n                                            done();\n                                        }\n                                    })\n                                }\n                            })\n                        }\n                    })\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4110e05e-2efc-4f80-a8e9-9dbf5a202120&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should clone flow in inactive state, if user exceeds active flow limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should clone flow in inactive state, if user exceeds active flow limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:154,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: createTriggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true };\ncommonMock.triggerPushSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nasync.waterfall([\n    function(cbk) {\n        var userFlowLimit = (dummyUser.user_plan.flow || {}).active\n        var flowData = _.cloneDeep(testData.enterpriseFlowBody)\n        flowData.owner_uid = dummyUser.uid;\n        flowData.author = [dummyUser.uid];\n        flowData.active = true;\n        async.times(userFlowLimit, function(n, next) {\n            _models.newFlow.create(flowData, function(err, userTrigger) {\n                next(err, userTrigger);\n            })\n        }, function(err, result) {\n            createdFlows = _.map(_.flattenDeep(result), &#x27;uid&#x27;)\n            cbk(err, result)\n        })\n    },\n    function(result, cbk) {\n        api.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/clone&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        clonedFlow = res.body.output;\n        //expect(res.body.output.flow.active).to.be.false;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44d2c2e8-4f9b-4792-8560-87f809968660&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/clone&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.FLOW_COPY_USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6cf96d8-dfeb-483d-a946-1ace71439419&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;28977737-4cb0-4c1e-afad-6c81e0449f57&quot;,&quot;b8b0e464-4320-4f4a-ae88-54a16dc3a224&quot;,&quot;e4b99163-4741-4781-adc0-873cf65cb946&quot;,&quot;4110e05e-2efc-4f80-a8e9-9dbf5a202120&quot;,&quot;44d2c2e8-4f9b-4792-8560-87f809968660&quot;,&quot;a6cf96d8-dfeb-483d-a946-1ace71439419&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:523,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3d0af279-ec23-4d71-81bc-66f6428ae9dd&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\createProjectTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createProjectTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;095af7a4-ec0d-46ce-9d58-1a0df74edf6c&quot;,&quot;title&quot;:&quot;Project.CreateTemplate&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\createProjectTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createProjectTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:367,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger.toJSON()\n                flowWithAllData.trigger.handlers = []\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowWithAllData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                orgFlow = res.body.output;\n                _models.newFlow._findOneAndUpdate({ uid: orgFlow.uid }, { is_draft: false }, function(err, updateFlow) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        orgFlow = updateFlow\n                        project = dummyUser.default_project\n                        api.get(&#x27;/enterprise/v1/projects/&#x27; + dummyUser.default_project + &#x27;/templateschema&#x27;)\n                            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (res) {\n                                    json_schema = res.body.output\n                                }\n                                done(err)\n                            })\n                    }\n                })\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf2ba508-c24a-48c7-a6e7-3d360198afc9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.ProjectTemplate.remove(function(err, deletedFlow) {\n            cb(err, deletedFlow);\n        })\n    },\n    function(cb) {\n        _models.WorkFlowTemplate.remove(function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0231bfee-3b50-441d-9128-34682328f720&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + project + &#x27;/templates&#x27;)\n    .send(userFlow)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79b17c8e-2dc1-4cb1-9fa8-d6f5b79080ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project import template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate Should create project import template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nbody.json_schema = json_schema\napi.post(apiURL + project + &#x27;/templates&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var result = res.body.output\n            expect(result).to.have.any.keys([&#x27;uid&#x27;])\n                // expect(result.workflowTemplates.length).to.equal(1)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e50c167-ef4c-4ff9-a497-d8f5e68f46fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project share template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate Should create project share template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nbody.json_schema = json_schema\nbody.shared_to = [&#x27;abc@xyz.com&#x27;]\napi.post(apiURL + project + &#x27;/templates&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var result = res.body.output\n            expect(result.published).equal(true)\n            expect(result.shared_to.length).gt(0)\n            //expect(result.projectTemplate.shared_to.length).to.equal(1)\n            //expect(result.workflowTemplates.length).to.equal(1)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73559c36-cd6b-41a9-b738-ccc5b9cf234e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error if  project template is not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate Should give error if  project template is not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + &#x27;dummyProject/templates&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e988fac7-0863-4610-9204-ee845ae4dbae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error if  project template flow is not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate Should give error if  project template flow is not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.newFlow.remove({ uid: orgFlow.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(apiURL + project + &#x27;/templates&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(body)\n            .expect(httpStatus.NOT_FOUND)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.NO_DATA_FOUND);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6de2d930-7a06-4104-b49b-a0567775802c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;79b17c8e-2dc1-4cb1-9fa8-d6f5b79080ff&quot;,&quot;3e50c167-ef4c-4ff9-a497-d8f5e68f46fd&quot;,&quot;73559c36-cd6b-41a9-b738-ccc5b9cf234e&quot;,&quot;e988fac7-0863-4610-9204-ee845ae4dbae&quot;,&quot;6de2d930-7a06-4104-b49b-a0567775802c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:241,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4782a1f1-04ab-4ac2-add6-dd4aa382b213&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\createTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bd9b8e3d-bc53-45a8-94c6-6ff13fd7bcba&quot;,&quot;title&quot;:&quot;Flow.CreateTemplate&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\createTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3028,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar opt = { path: triggerPath, body: triggerPath, times: 3 };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        var userTriggerObj = userTrigger;\n        var flowData = _.cloneDeep(testData.flowBody);\n        flowData.isExpress = false;\n        async.parallel({\n            triggerFlow: function(cb) {\n                var triggerFlow = _.cloneDeep(flowData)\n                triggerFlow.trigger.handlers = [userTriggerObj.uid]\n                createFlow(flowURL, triggerFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            },\n            draftFlow: function(cb) {\n                var draftFlow = _.cloneDeep(flowData);\n                draftFlow.is_draft = true;\n                createFlow(flowURL, draftFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            },\n            invalidEnvFlow: function(cb) {\n                var IVWHFlow = _.cloneDeep(flowData);\n                IVWHFlow.activities[2].next = [];\n                createFlow(flowURL, IVWHFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            }\n        }, function(err, result) {\n            cbk(err, result)\n        })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userTriggerFlow = res.triggerFlow._doc;\n        userDraftFlow = res.draftFlow;\n        invalidEnvFlow = res.invalidEnvFlow._doc;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a0641cb-f3c8-4884-8c2c-2de854dbb51e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1446,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nvar flowUIDS = [userTriggerFlow.uid, userDraftFlow.uid, invalidEnvFlow.uid];\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: flowUIDS } }, function(err, deletedFlows) {\n            cb(err, deletedFlows)\n        });\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(cb) {\n        _models.Bill.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Payload.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Log.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bcfd9761-5610-4915-9d65-75b2e7d6c505&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b9e72fe-d1ad-4b17-a83e-400c90ada001&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;flow\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should get error, if \&quot;flow\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;efd5e6e3-d211-4d7f-ba5b-495a38b6168d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar dummyFlowData = getExecuteBody(userTriggerFlow)\ndummyFlowData.flow.uid = &#x27;dummyFlow&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(dummyFlowData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b32fef69-12c9-4849-ac2a-d554d1cfbce4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(userDraftFlow))\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_DRAFT_STATE_ENTERPRISE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b530c0d2-d86a-45c7-87a8-3f1fb776b2b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if activities are not valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should get error, if activities are not valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerGetSuccess(opt);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(invalidEnvFlow))\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_CONFIGURE_ERROR);\n            done();\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5e5040d-4ba3-45a7-916d-bd8fa61a8fe4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should create template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:245,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath, times: 2 };\ncommonMock.triggerGetSuccess(opt);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var template = res.body.output\n            expect(template).to.have.all.keys(responseKeys);\n            expect(template.flow_data).to.have.all.keys([&#x27;lookup&#x27;, &#x27;project_params&#x27;, &#x27;params&#x27;, &#x27;auth&#x27;, &#x27;connection&#x27;, &#x27;trigger&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4de9ebdb-cc04-4b1e-92ed-6228262c0e1e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(getExecuteBody(userTriggerFlow))\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.FLOW_SUBMIT_USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10ad9851-f997-440c-a510-53d8cf0e7401&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8b9e72fe-d1ad-4b17-a83e-400c90ada001&quot;,&quot;efd5e6e3-d211-4d7f-ba5b-495a38b6168d&quot;,&quot;b32fef69-12c9-4849-ac2a-d554d1cfbce4&quot;,&quot;b530c0d2-d86a-45c7-87a8-3f1fb776b2b7&quot;,&quot;f5e5040d-4ba3-45a7-916d-bd8fa61a8fe4&quot;,&quot;4de9ebdb-cc04-4b1e-92ed-6228262c0e1e&quot;,&quot;10ad9851-f997-440c-a510-53d8cf0e7401&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:514,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;aeaf1df9-ead7-496e-ad98-ea66ad7ab03c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\createUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7794598f-b3b1-4c89-af62-9f30ecd06f9e&quot;,&quot;title&quot;:&quot;Flow.CreateUserFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\createUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:336,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                api.get(&#x27;/enterprise/v1/user&#x27;)\n                    .set(&#x27;authtoken&#x27;, orgData.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            dummyUser = res.body.output;\n                            cbk(err, dummyUser)\n                        }\n                    });\n            },\n            function(dummyUser, cbk) {\n                flowData.owner_uid = dummyUser.uid;\n                flowData.trigger.handlers = [testData.expressTriggerResponse.uid]\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(&#x27;/enterprise/v1/projects&#x27;)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                project = res.body.output;\n                done()\n            }\n        })\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cebe8554-5ea4-488c-8211-837eaa931cfd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\ncreatedFlows.push(userFlow.uid)\n_models.newFlow.remove({ uid: { $in: createdFlows } }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        clearRecords(function(err, result) {\n            done(err)\n        })\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14ecc8fe-6a86-4827-9996-88acb222490c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL)\n    .send(flowData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c5afad9-34ab-4e01-96ba-ccb50ae8971d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidFlowData = _.omit(flowData, &#x27;name&#x27;)\napi.post(flowURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidFlowData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;96d17515-5ac2-4f96-9a10-e8b5d3bb5b4c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create flow, if flow data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should create flow, if flow data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(flowData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userFlow = res.body.output\n            expect(userFlow).to.contain.all.keys(validKeys)\n            expect(userFlow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            expect(userFlow.version).to.be.equal(1);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;103c4eb5-db38-449b-a12c-177b3ac3251b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create flow in inactive state, if user exceeds active flow limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should create flow in inactive state, if user exceeds active flow limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:109,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        var userFlowLimit = (dummyUser.user_plan.flow || {}).active\n        flowData.owner_uid = dummyUser.uid;\n        flowData.author = [dummyUser.uid];\n        async.times(userFlowLimit, function(n, next) {\n            _models.newFlow.create(flowData, function(err, userTrigger) {\n                next(err, userTrigger);\n            })\n        }, function(err, result) {\n            createdFlows = _.map(_.flattenDeep(result), &#x27;uid&#x27;)\n            cbk(err, result)\n        })\n    },\n    function(result, cbk) {\n        var flowObj = _.cloneDeep(testData.enterpriseFlowBody)\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowObj)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        expect(res.body.output.active).to.be.false;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a90d1ff-b609-43ea-a0a4-19ec2ca519ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create flow in other project, if user sends \&quot;project_uid\&quot; in body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should create flow in other project, if user sends \&quot;project_uid\&quot; in body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowData2 = _.cloneDeep(flowData)\n    //flowData2.project_uid = project.uid\napi.post(flowURL)\n    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, project_uid: project.uid })\n    .send(flowData2)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output;\n            expect(flow.project_uid).to.be.equal(project.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e91f1d5-e939-4ea5-aa3a-2ce251ce2525&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create flow within organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should create flow within organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:117,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = orgBody;\n// var opt = { path: getTriggerPath, body: getTriggerPath, times: 2 };\n// commonMock.triggerCreateSuccess(opt);\nvar orgFlow = _.cloneDeep(flowData)\napi.post(flowURL)\n    .set({ &#x27;authtoken&#x27;: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .send(orgFlow)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output;\n            expect(flow.org_uid).to.be.equal(orgData.organization.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47c81ae0-76c6-47f2-b781-f58e4beae8c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowData)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3fb5495-0f82-474a-9cdc-3ff228b47971&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1c5afad9-34ab-4e01-96ba-ccb50ae8971d&quot;,&quot;96d17515-5ac2-4f96-9a10-e8b5d3bb5b4c&quot;,&quot;103c4eb5-db38-449b-a12c-177b3ac3251b&quot;,&quot;1a90d1ff-b609-43ea-a0a4-19ec2ca519ca&quot;,&quot;4e91f1d5-e939-4ea5-aa3a-2ce251ce2525&quot;,&quot;47c81ae0-76c6-47f2-b781-f58e4beae8c8&quot;,&quot;a3fb5495-0f82-474a-9cdc-3ff228b47971&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:530,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a9e37922-c905-44f7-bcaa-35d38bab1a27&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\deleteUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\deleteUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3ba805cd-f1ae-4b58-99c1-451a1799c1b3&quot;,&quot;title&quot;:&quot;Flow.deleteUserFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\deleteUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\deleteUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:386,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(&#x27;/enterprise/v1/projects&#x27;)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            },\n            function(result, cbk) {\n                project = result.body.output;\n                async.parallel([\n                    function(cb) {\n                        saveFlow(flowURL, dummyUser, flowData, function(err, result) {\n                            cb(err, result)\n                        })\n                    },\n                    function(cb) {\n                        var flowData2 = _.cloneDeep(flowData)\n                        api.post(flowURL)\n                            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, project_uid: project.uid })\n                            .send(flowData2)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                cb(err, res)\n                            })\n                    }\n                ], function(err, results) {\n                    cbk(err, results)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res[0].body.output\n                userFlowWithProject = res[1].body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d82229cc-8ccb-4455-a786-180fe590a914&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;037debd4-db99-4fcf-ac6a-3158331292dd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4037bb2a-5e38-418e-8ace-3e3a7ba511a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + &#x27;/dummyFlow&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e886af73-e629-49f6-9074-166e2d05e272&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete flow with trigger, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow Should delete flow with trigger, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = {\n    path: &#x27;/triggers/handlers/pull&#x27;,\n    body: {\n        \&quot;flow_uid\&quot;: userFlow.uid,\n        \&quot;org_uid\&quot;: userFlow.org_uid || null,\n        \&quot;env_uid\&quot;: userFlow.env_uid,\n        \&quot;project_uid\&quot;: userFlow.project_uid\n    }\n};\ncommonMock.flowTriggerDeleteSuccess(opt);\napi.delete(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.notice).to.equal(messageList.FLOW_DELETE_SUCCESS);\n            _models.newFlow.findOne({ uid: userFlow.uid }, function(err, result) {\n                if (err) {\n                    done(err)\n                } else {\n                    expect(result.deleted_at).not.to.be.null\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6142cc87-84ae-42a3-96ac-14dc18581dc2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete flow without trigger, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow Should delete flow without trigger, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = { deleted_at: null, trigger: testData.defaultTriggerObj }\n_models.newFlow.findOneAndUpdate({ uid: userFlow.uid }, data, { new: true }, function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        api.delete(flowURL + &#x27;/&#x27; + userFlow.uid)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(res.body.output.notice).to.equal(messageList.FLOW_DELETE_SUCCESS);\n                    _models.newFlow.findOne({ uid: userFlow.uid }, function(err, result) {\n                        if (err) {\n                            done(err)\n                        } else {\n                            expect(result.deleted_at).not.to.be.null\n                            _models.newFlow.findOne({ uid: userFlow.uid }, function(err, result2) {\n                                expect(result2.deleted_at).not.to.be.null\n                                done();\n                            })\n                        }\n                    })\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f3184b9-c66c-4762-8a94-b05a50c6d7f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete flow other project, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow Should delete flow other project, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = { deleted_at: null, trigger: testData.defaultTriggerObj }\n_models.newFlow.findOneAndUpdate({ uid: userFlowWithProject.uid }, data, { new: true }, function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        api.delete(flowURL + &#x27;/&#x27; + userFlowWithProject.uid)\n            .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(res.body.output.notice).to.equal(messageList.FLOW_DELETE_SUCCESS);\n                    _models.newFlow.findOne({ uid: userFlowWithProject.uid }, function(err, result) {\n                        if (err) {\n                            done(err)\n                        } else {\n                            expect(result.deleted_at).not.to.be.null\n                            expect(result.project_uid).to.be.equal(project.uid)\n                            done();\n                        }\n                    })\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02497454-db5d-4832-ab91-333270bddb8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4037bb2a-5e38-418e-8ace-3e3a7ba511a6&quot;,&quot;e886af73-e629-49f6-9074-166e2d05e272&quot;,&quot;6142cc87-84ae-42a3-96ac-14dc18581dc2&quot;,&quot;6f3184b9-c66c-4762-8a94-b05a50c6d7f7&quot;,&quot;02497454-db5d-4832-ab91-333270bddb8a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:309,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1deaf066-498c-424a-a44a-6e3f0de97b54&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\deleteUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\deleteUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5ab01d01-68c3-4f53-b6a9-5906d5bf10b3&quot;,&quot;title&quot;:&quot;Flow.deleteUserFlowVersion&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\deleteUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\deleteUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:399,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(&#x27;/enterprise/v1/projects&#x27;)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            },\n            function(result, cbk) {\n                project = result.body.output;\n                async.parallel([\n                    function(cb) {\n                        saveFlow(flowURL, dummyUser, flowData, function(err, result) {\n                            cb(err, result)\n                        })\n                    },\n                    function(cb) {\n                        var flowData2 = _.cloneDeep(flowData)\n                        api.post(flowURL)\n                            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, project_uid: project.uid })\n                            .send(flowData2)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                cb(err, res)\n                            })\n                    }\n                ], function(err, results) {\n                    cbk(err, results)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res[0].body.output\n                userFlowWithProject = res[1].body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c1365e1-2876-4305-8f15-069b8c3f147c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.newFlowVersion.remove({ uid: userFlow.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n            if (err) {\n                done(err)\n            } else {\n                done()\n            }\n        })\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c152458-6c4e-4fc0-8cc6-893f95954973&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + userFlow.uid + &#x27;/version/1&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eafa65df-bbb7-45a0-b5df-88a55a682122&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + &#x27;dummyFlow&#x27; + &#x27;/version/1&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df75997b-dbbd-4e3d-87d2-e6cf14eb8af8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow version not found not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion Should get error, if flow version not found not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + userFlow.uid + &#x27;/version/21&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_VERSION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a12f7ae-74dd-42dd-a107-6541a8f89abf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow version not valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion Should get error, if flow version not valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + userFlow.uid + &#x27;/version/dummy&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e27d829-ea74-4814-8779-172151bf2f2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tried to delete current flow version.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion Should get error, if user tried to delete current flow version.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + userFlow.uid + &#x27;/version/1&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CURRENT_VERSION_DELETE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16100487-577f-48ae-bea0-16ac51ea9685&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;eafa65df-bbb7-45a0-b5df-88a55a682122&quot;,&quot;df75997b-dbbd-4e3d-87d2-e6cf14eb8af8&quot;,&quot;3a12f7ae-74dd-42dd-a107-6541a8f89abf&quot;,&quot;4e27d829-ea74-4814-8779-172151bf2f2e&quot;,&quot;16100487-577f-48ae-bea0-16ac51ea9685&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:227,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c54a7a28-3ef5-4573-8f09-4807729019d7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\executeUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\executeUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;48599cf1-bd32-4731-864a-63f3a26d0c88&quot;,&quot;title&quot;:&quot;Flow.ExecuteUserFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\executeUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\executeUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:652,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        customRoleProject = _.find(orgData.org_projects, { name: &#x27;proj2&#x27; })\n        async.waterfall([\n            function(cbk) {\n                var query = _models.newFlow.remove()\n                query.exec(function(err) {\n                    dummyUser = orgData.owner;\n                    dummyUser.authtoken = dummyUser.authtoken;\n                    testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                    _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                        cbk(err, userTrigger);\n                    })\n                })\n            },\n            function(userTrigger, cbk) {\n                var userTriggerObj = userTrigger;\n                var flowData = _.cloneDeep(testData.flowBody);\n                flowData.isExpress = false;\n                flowData.trigger.handlers = [userTriggerObj]\n                async.parallel({\n                    triggerFlow: function(cb) {\n                        createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    inactiveFlow: function(cb) {\n                        var inactiveFlow = _.cloneDeep(flowData);\n                        inactiveFlow.active = false;\n                        createFlow(flowURL, inactiveFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    draftFlow: function(cb) {\n                        var draftFlow = _.cloneDeep(flowData);\n                        draftFlow.is_draft = true;\n                        createFlow(flowURL, draftFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    webHookFlow: function(cb) {\n                        var WHFlow = _.cloneDeep(flowData);\n                        WHFlow.trigger = testData.defaultTriggerObj;\n                        WHFlow.settings = testData.webHookSetting;\n                        WHFlow.active = true;\n                        WHFlow.settings = testData.webHookSetting;\n                        createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    orgFlow: function(cb) {\n                        var WHFlow = _.cloneDeep(flowData);\n                        WHFlow.trigger = testData.defaultTriggerObj;\n                        WHFlow.settings = testData.webHookSetting;\n                        WHFlow.active = true;\n                        WHFlow.settings = testData.webHookSetting;\n                        api.post(flowURL)\n                            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n                            .send(flowData)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                var flow = res.body.output;\n                                if (!flowData.is_draft) {\n                                    _models.newFlow.findOneAndUpdate({ uid: flow.uid }, { is_draft: false, preserve_version: true }, { new: true }, function(err, result) {\n                                        cb(err, result)\n                                    })\n                                } else {\n                                    cb(err, flow)\n                                }\n                            })\n                    },\n                    invalidEnvFlow: function(cb) {\n                        var IVWHFlow = _.cloneDeep(flowData);\n                        IVWHFlow.trigger = testData.defaultTriggerObj;\n                        IVWHFlow.settings = testData.webHookSetting;\n                        IVWHFlow.environment[0].params.push({ key: \&quot;body\&quot;, required: true });\n                        createFlow(flowURL, IVWHFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    }\n                }, function(err, result) {\n                    cbk(err, result)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userTriggerFlow = res.triggerFlow._doc;\n                userDraftFlow = res.draftFlow;\n                userWebHookFlow = res.webHookFlow._doc;\n                orgFlow = res.orgFlow._doc;\n                invalidEnvFlow = res.invalidEnvFlow._doc;\n                inactiveFlow = res.inactiveFlow._doc;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b306f663-f321-42f6-91f4-f5be6f7d87e8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1606,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nvar flowUIDS = [userTriggerFlow.uid, userDraftFlow.uid, userWebHookFlow.uid, invalidEnvFlow.uid];\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: flowUIDS } }, function(err, deletedFlows) {\n            cb(err, deletedFlows)\n        });\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(cb) {\n        _models.Bill.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Payload.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Log.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        //clearRecords(function(err, result) {\n        done()\n            //})\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;323499a9-c7ee-4d87-9b48-d5fd18bd272e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userTriggerFlow.uid + &#x27;/execute&#x27;)\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7294576f-9ede-4500-9814-332a9d657309&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should execute flow with web hook.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should execute flow with web hook.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { user_uid: dummyUser.uid }\ncommonMock.executeFlowTimeOut(opt)\napi.post(flowURL + &#x27;/&#x27; + userTriggerFlow.uid + &#x27;/execute&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(400)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.QMANGER_SERVER_DOWN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3282b51b-43e5-4077-882f-0468ffac7483&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/dummyFlow/execute&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64516bc5-53a1-4e38-a081-84eb9e06d8af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userDraftFlow.uid + &#x27;/execute&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(userDraftFlow))\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PARAM_MISSING_IN_ACTIVITY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;22a46b27-f275-4195-b16a-9b0517440668&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow is inavlid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should get error, if flow is inavlid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + inactiveFlow.uid + &#x27;/execute&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(inactiveFlow))\n    .expect(422)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_INACTIVE_STATE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d97fc95f-8b9a-4e50-ac47-e25a0a112be1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(flowURL + &#x27;/&#x27; + userWebHookFlow.uid + &#x27;/execute&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.FLOW_RUN_USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;877a3c2f-b93e-4c74-8649-f8e39c87dc75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7294576f-9ede-4500-9814-332a9d657309&quot;,&quot;3282b51b-43e5-4077-882f-0468ffac7483&quot;,&quot;64516bc5-53a1-4e38-a081-84eb9e06d8af&quot;,&quot;22a46b27-f275-4195-b16a-9b0517440668&quot;,&quot;d97fc95f-8b9a-4e50-ac47-e25a0a112be1&quot;,&quot;877a3c2f-b93e-4c74-8649-f8e39c87dc75&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:265,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f61be383-c06f-4ac3-b8a0-7e395719c445&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\executeUserTriggerFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\executeUserTriggerFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4554e7ea-8080-43af-a58d-dc8e6d3c68ca&quot;,&quot;title&quot;:&quot;Flow.ExecuteUserTriggerFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\executeUserTriggerFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\executeUserTriggerFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2666,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        var userTriggerObj = userTrigger;\n        var flowData = _.clone(testData.flowBody);\n        flowData.environment[0].params = []\n        flowData.isExpress = false;\n        flowData.trigger.handlers = [userTriggerObj.uid]\n        async.parallel({\n            triggerFlow: function(cb) {\n                createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            },\n            draftFlow: function(cb) {\n                var draftFlow = _.clone(flowData);\n                draftFlow.is_draft = true;\n                createFlow(flowURL, draftFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            },\n            webHookFlow: function(cb) {\n                var WHFlow = _.clone(flowData);\n                WHFlow.trigger = undefined;\n                WHFlow.settings = testData.webHookSetting;\n                createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            },\n            invalidEnvFlow: function(cb) {\n                var IVWHFlow = _.clone(flowData);\n                IVWHFlow.trigger = undefined;\n                IVWHFlow.settings = testData.webHookSetting;\n                IVWHFlow.environment[0].params.push({ key: \&quot;body\&quot;, required: true });\n                createFlow(flowURL, IVWHFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            }\n        }, function(err, result) {\n            cbk(err, result)\n        })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userTriggerFlow = res.triggerFlow._doc;\n        userDraftFlow = res.draftFlow;\n        userWebHookFlow = res.webHookFlow._doc;\n        invalidEnvFlow = res.invalidEnvFlow._doc;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a6aaf24-a896-405c-b140-31ab52003e16&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowUIDS = [userTriggerFlow.uid];\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: flowUIDS } }, function(err, deletedFlows) {\n            cb(err, deletedFlows)\n        });\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(cb) {\n        _models.Bill.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Payload.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Log.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f32b2c91-548f-46df-9cc0-027cf9730c6b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + userTriggerFlow.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Unauthorized&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c765f633-922a-44cd-8d3a-f1a8c181d71b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + &#x27;dummyFlow&#x27;)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41c49056-f67e-4b7f-bff5-a4e202a1a102&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + userDraftFlow.uid)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PARAM_MISSING_IN_ACTIVITY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ccecde3-ff0f-4387-98b1-cc4e9a36f01e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger not in active state.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should get error, if trigger not in active state.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + userWebHookFlow.uid)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(422)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_ACTIVE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78822ed7-8394-4576-aaa1-70957067adbb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger not found in flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should get error, if trigger not found in flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.newFlow.findOneAndUpdate({ uid: invalidEnvFlow.uid }, { trigger: undefined }, { new: true }, function(err, result) {\n    if (!result) {\n        err = err || messageList.FLOW_NOT_FOUND\n        done(err);\n    } else {\n        api.post(apiURL + invalidEnvFlow.uid)\n            .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33221a15-70ea-4e28-8f4d-0beafd12ef07&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should execute flow with trigger.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should execute flow with trigger.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { user_uid: dummyUser.uid }\ncommonMock.executeFlowSuccess(opt)\napi.post(apiURL + userTriggerFlow.uid)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body).to.have.all.keys(responseKeys);\n            expect(res.body.response).to.be.equal(messageList.FLOW_ENQUE_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52bae88c-be8d-42d1-ad96-c67077e0eee9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error,if user account has been suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should get error,if user account has been suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        _models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, updatedUser) {\n            cbk(err, updatedUser);\n        })\n    },\n    function(result, cbk) {\n        // var updatedUser = result.body.output;\n        api.post(apiURL + userTriggerFlow.uid)\n            .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n            .expect(httpStatus.PAYMENT_REQUIRED)\n            .end(function(err, res) {\n                cbk(err, res);\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        expect(res.body.error.message).to.be.equal(messageList.USER_ACCOUNT_EXPIRED);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8af80f3f-7543-4b0f-b257-ce2b7a45ebaf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c765f633-922a-44cd-8d3a-f1a8c181d71b&quot;,&quot;41c49056-f67e-4b7f-bff5-a4e202a1a102&quot;,&quot;4ccecde3-ff0f-4387-98b1-cc4e9a36f01e&quot;,&quot;78822ed7-8394-4576-aaa1-70957067adbb&quot;,&quot;33221a15-70ea-4e28-8f4d-0beafd12ef07&quot;,&quot;52bae88c-be8d-42d1-ad96-c67077e0eee9&quot;,&quot;8af80f3f-7543-4b0f-b257-ce2b7a45ebaf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:137,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;32181102-fb84-4654-8d8f-13c3ed58bba6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\generateFlowSID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\generateFlowSID.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;df678155-003b-4f87-91f5-ef89ac646e6e&quot;,&quot;title&quot;:&quot;Flow.generateSID&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\generateFlowSID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\generateFlowSID.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2868,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        testData.mongoUserTriggerObj.user_uid = user.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result, userTriggerObj);\n            })\n    },\n    function(result, userTriggerObj, cbk) {\n        dummyUser = result.body.output;\n        //flowWithAllData.trigger.handlers[0] = userTriggerObj\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowWithAllData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fcdc136-196d-4b62-8e18-f35831233f2d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n            cb(err, deletedFlow);\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7bb3d05-9f18-476e-895a-53e77d842caf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/generatesid&#x27;)\n    .send(userFlow)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38f72df0-25a6-4e49-be55-7995733fd48f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/dummyFlow&#x27; + &#x27;/generatesid&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3074e071-5a0d-46a7-bb95-1e86c1c94d70&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should generate SID,  if user sends a valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID Should generate SID,  if user sends a valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/generatesid&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({})\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output\n            expect(flow.sid).to.not.equal(userFlow.sid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;729eae5b-21ea-447e-b8a8-82461188411d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;38f72df0-25a6-4e49-be55-7995733fd48f&quot;,&quot;3074e071-5a0d-46a7-bb95-1e86c1c94d70&quot;,&quot;729eae5b-21ea-447e-b8a8-82461188411d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:120,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4aec067c-23e7-437d-88c1-f08df764ce92&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\generateWebhookToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\generateWebhookToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c6090f7a-fdb2-4a5f-b5e2-ef319fb50a55&quot;,&quot;title&quot;:&quot;Flow.generateWebHookToken&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\generateWebhookToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\generateWebhookToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateWebHookToken \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2605,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acf43622-0d92-4c94-9342-eb62a9758b0c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateWebHookToken Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a19c4c1-27dd-44c9-9bac-187337c6909e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateWebHookToken Should get flow, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).not.null\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4dff8b4b-f4f7-462c-bd0b-6a76ebaf213a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2a19c4c1-27dd-44c9-9bac-187337c6909e&quot;,&quot;4dff8b4b-f4f7-462c-bd0b-6a76ebaf213a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:71,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e2f3cea2-0798-4571-b45a-c4ee698191a6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getFlowTestDataByFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getFlowTestDataByFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dd74ed8e-78d7-4860-a13c-9749e4b39675&quot;,&quot;title&quot;:&quot;Flows.getFlowTestsDataByFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getFlowTestDataByFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getFlowTestDataByFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:218,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner\n                dummyUser.authtoken = dummyUser.authtoken\n                flowTestObj.user_uid = dummyUser.uid\n                flowTestObj.env_uid = dummyUser.default_env\n                _models.FlowTest.create(flowTestObj, function(err, result) {\n                    cbk(err, result);\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                flowTestData = res.toJSON()\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86373be6-f4e4-4c5c-b3b8-0728c3358aa9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.FlowTest.remove(function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c82e28a3-61c3-42b9-ae8c-7027ca93fc44&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?flow_uid=&#x27; + flowTestData.flow_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11635b8c-6b13-424c-8e1c-54bc932664ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flowTest data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByFlow Should get list of flowTest data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?flow_uid=&#x27; + flowTestData.flow_uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output).flow_uid).to.be.equal(flowTestData.flow_uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;435c3664-8ec8-4a2e-9919-d3c44ec64ba1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;11635b8c-6b13-424c-8e1c-54bc932664ff&quot;,&quot;435c3664-8ec8-4a2e-9919-d3c44ec64ba1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:52,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7e4fcc80-9ba7-4333-a874-9741cb8a5f41&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getFlowTestDataByUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getFlowTestDataByUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e73abe54-4dc5-4cbe-9d84-8a506225475d&quot;,&quot;title&quot;:&quot;Flows.getFlowTestsDataByUID&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getFlowTestDataByUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getFlowTestDataByUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByUID \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:185,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner\n                dummyUser.authtoken = dummyUser.authtoken\n                flowTestObj.user_uid = dummyUser.uid\n                flowTestObj.env_uid = dummyUser.default_env\n                _models.FlowTest.remove(function(err) {\n                    _models.FlowTest.create(flowTestObj, function(err, result) {\n                        cbk(err, result);\n                    })\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                flowTestData = res.toJSON()\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a1fe478-7167-44ec-99ce-8886adb30347&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByUID \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.FlowTest.remove(function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e2a5dbea-fcf9-43d3-a9b9-7c886334658d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByUID Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + flowTestObj.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9835020c-9a90-4bd1-b434-a34a6284ac47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByUID Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;dummy&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.NO_DATA_FOUND)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;129720b6-3713-4842-affd-d00c2371b9c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flowTest data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByUID Should get flowTest data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + flowTestObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.flow_uid).to.be.equal(flowTestObj.flow_uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;837d6281-988f-452c-9ee7-ef16983b20c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9835020c-9a90-4bd1-b434-a34a6284ac47&quot;,&quot;129720b6-3713-4842-affd-d00c2371b9c6&quot;,&quot;837d6281-988f-452c-9ee7-ef16983b20c9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:97,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;596d5d6d-5e34-4303-be0b-f25a454ae966&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a517a2e9-912e-4799-9aff-d3f27f328f74&quot;,&quot;title&quot;:&quot;Flow.GetUserFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:353,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner\n                dummyUser.authtoken = dummyUser.authtoken\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(result, cbk) {\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(testData.enterpriseFlowBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            },\n            function(result, cbk) {\n                userFlow = result.body.output;\n                api.post(flowURL)\n                    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n                    .send(testData.enterpriseFlowBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                orgFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;43eec663-179b-4f4f-8f8b-2f729b6cfa42&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f42f499-893b-449c-9e8f-620989a55488&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;50acb253-29c6-4ebd-a315-819551ca3efb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4eab7566-1f49-46bd-a44c-a6088839ca9c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow Should get flow, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerGetSuccess(opt);\napi.get(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.have.property(&#x27;name&#x27;);\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a9926f9-7ab8-4fc0-898a-bc023808c924&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get org flow, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow Should get org flow, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerGetSuccess(opt);\napi.get(flowURL + &#x27;/&#x27; + orgFlow.uid)\n    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.have.property(&#x27;name&#x27;);\n            expect(res.body.output.org_uid).equal(orgData.organization.uid);\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e093d910-b683-4582-b621-f89dd6ad0d25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;50acb253-29c6-4ebd-a315-819551ca3efb&quot;,&quot;4eab7566-1f49-46bd-a44c-a6088839ca9c&quot;,&quot;5a9926f9-7ab8-4fc0-898a-bc023808c924&quot;,&quot;e093d910-b683-4582-b621-f89dd6ad0d25&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:188,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e83f40bd-3ecf-4a99-8a33-cb5dd1a8b0a3&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUserFlowLastRun.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserFlowLastRun.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c286a017-740a-4f25-abf0-678623742c72&quot;,&quot;title&quot;:&quot;Flow.GetUserFlowLastRun&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUserFlowLastRun.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserFlowLastRun.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlowLastRun \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2651,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        testData.mongoUserTriggerObj.user_uid = user.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.enterpriseFlowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4cd09b7a-d9d7-4347-95d4-64d76879d9ed&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlowLastRun \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f762fb42-d94c-4be1-a261-d37f805fa362&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlowLastRun Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6a2a5f0b-3d3d-46ec-9a74-7b9005dfbbc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlowLastRun Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9028e0cb-2386-45e1-a5a3-ebab86b6eedb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow last run, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlowLastRun Should get flow last run, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/lastrun&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.have.all.keys([&#x27;duration&#x27;, &#x27;credits&#x27;])\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eb9bbc24-4e50-4213-a40e-84ea61d79250&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6a2a5f0b-3d3d-46ec-9a74-7b9005dfbbc6&quot;,&quot;9028e0cb-2386-45e1-a5a3-ebab86b6eedb&quot;,&quot;eb9bbc24-4e50-4213-a40e-84ea61d79250&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:122,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c9e9e3d9-1d8e-452e-8a3f-068b100963f8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;03c2afed-9881-4acb-812b-7139be8e89df&quot;,&quot;title&quot;:&quot;Flow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;816af001-0430-4385-8200-68e35de45f57&quot;,&quot;title&quot;:&quot;Flow.getUsersDistinctFlowNames&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNames \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3053,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                saveUserFlows({\n                    authtoken: authToken,\n                    user_uid: res.body.output.uid\n                }, function(error, flows) {\n                    saveBillEntries({\n                        authtoken: authToken,\n                        user_uid: res.body.output.uid,\n                        flow_uid: flows[0].uid\n                    }, function(error, billEntries) {\n                        done();\n                    });\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3349893c-4c54-48c1-a5a8-e4e91789bab5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNames \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0079d9b-ea13-4934-a190-1c07800ae8ec&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNames \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7602afe0-e1b1-46e0-8136-3e18e2d74382&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user flows.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNames Should get list of user flows.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 5;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12ddc93d-e16f-48f3-9089-43caec266223&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNames Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;59bdf8d9-30dc-420d-9c75-826a39d23eff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;12ddc93d-e16f-48f3-9089-43caec266223&quot;,&quot;59bdf8d9-30dc-420d-9c75-826a39d23eff&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:55,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3fc3edbe-0d9e-4713-9ec7-110a8b037a8f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f3709b02-32fa-47c7-80c7-6f97423d571e&quot;,&quot;title&quot;:&quot;Flow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;89f67a2c-8319-40a1-b855-8e88433d6357&quot;,&quot;title&quot;:&quot;Flow.getUsersDistinctFlowNamesOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNamesOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:179,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1db64b8f-7bc7-4298-9e7b-dda580e972a4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNamesOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9c7c5056-9110-4a84-8983-3583c22fb168&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNamesOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1410b72d-97e7-4239-870a-eea421a67976&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user flows.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNamesOrg Should get list of user flows.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 5;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;206ac844-6a03-47e7-903d-842f350a92e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNamesOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3088d152-8718-4078-911a-43ed8b2e790f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;206ac844-6a03-47e7-903d-842f350a92e7&quot;,&quot;3088d152-8718-4078-911a-43ed8b2e790f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f0ed5836-64ae-417d-97de-3d3633edd92c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUserTags.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserTags.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;158fb940-5fd9-4e17-98be-32cfb06232a4&quot;,&quot;title&quot;:&quot;Flows.GetUserTags&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\getUserTags.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserTags.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.GetUserTags \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2506,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;853fb343-dda2-4358-ac56-d315c84fe35a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.GetUserTags Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .send(searchParam)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0006c043-e85b-426b-a8e5-d7122963ea19&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of tags.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.GetUserTags Should get list of tags.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e190ace-eaab-4395-b9ca-c19da25c4687&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0006c043-e85b-426b-a8e5-d7122963ea19&quot;,&quot;0e190ace-eaab-4395-b9ca-c19da25c4687&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:61,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5f293b44-ca03-4a62-a33c-a8e03c5f45b0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlows.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlows.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ce438ec5-0d82-47ae-b027-f70162611a51&quot;,&quot;title&quot;:&quot;Flows.ListFlows&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlows.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlows.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2882,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        testData.mongoUserTriggerObj.user_uid = user.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        testData.flowBody.trigger.handlers = [userTriggerObj.uid]\n        async.times(2, function(n, next) {\n            api.post(flowURL)\n                .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                .send(testData.flowBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (!err) {\n                        res = res.body.output\n                    }\n                    next(err, res)\n                })\n        }, function(err, result) {\n            cbk(err, result)\n        })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlows = res;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6989165e-3bf9-4226-83f5-4a1737788ef5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: _.map(userFlows, &#x27;uid&#x27;) } }, function(err, deletedFlows) {\n            cb(err, deletedFlows);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2729e92-1fc8-49d1-b246-065d454ecb73&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c68b0317-a41a-4d35-94a3-aeffa7ee5ecb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user flows.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of user flows.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.size(res.body.output.objects)).to.be.equal(2)\n            expect(res.body.output.count).to.be.equal(2)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4fce7d69-cfe4-4372-95a6-7380fa376df0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user flows, when applying filter and tags.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of user flows, when applying filter and tags.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.have.all.keys([&#x27;objects&#x27;, &#x27;count&#x27;])\n            expect(_.first(res.body.output.objects)).to.have.any.keys([&#x27;name&#x27;, &#x27;description&#x27;, &#x27;uid&#x27;, &#x27;updated_at&#x27;, &#x27;sid&#x27;])\n            expect(_.first(res.body.output.objects)).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c6e5869-f2dd-4c57-a637-110f72db04af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of lean flows.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of lean flows.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;?lean=true&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;name&#x27;, &#x27;description&#x27;, &#x27;uid&#x27;, &#x27;updated_at&#x27;, &#x27;sid&#x27;, &#x27;flow_version&#x27;])\n            expect(_.first(res.body.output)).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;28c47977-84bf-41cc-be61-d88ef92c7fb1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of lean flows uids.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of lean flows uids.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;?lean=true&amp;get=flow_uids&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;uid&#x27;])\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a8dd5be-1e23-48c9-80f7-8c8d7aba0db2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of lean flows excluding flow mentioned in URL.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of lean flows excluding flow mentioned in URL.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;?lean=true&amp;exclude=&#x27; + [_.first(userFlows).uid])\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.map(res.body.output, &#x27;uid&#x27;)).not.to.be.include(_.first(userFlows).uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb6a6568-0041-4be3-bade-3d6f44780004&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows, even if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of flows, even if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.get(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(_.size(res.body.output.objects)).to.be.equal(2)\n                    expect(res.body.output.count).to.be.equal(2)\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;668d0bba-0fb8-4d4e-ab4d-c754e5d772af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c68b0317-a41a-4d35-94a3-aeffa7ee5ecb&quot;,&quot;4fce7d69-cfe4-4372-95a6-7380fa376df0&quot;,&quot;7c6e5869-f2dd-4c57-a637-110f72db04af&quot;,&quot;28c47977-84bf-41cc-be61-d88ef92c7fb1&quot;,&quot;7a8dd5be-1e23-48c9-80f7-8c8d7aba0db2&quot;,&quot;cb6a6568-0041-4be3-bade-3d6f44780004&quot;,&quot;668d0bba-0fb8-4d4e-ab4d-c754e5d772af&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:303,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9148153c-a229-4b28-af2a-04922625e1f5&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlowsByAgent.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByAgent.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;097e1d41-9213-433d-8c0e-af6731e28dc3&quot;,&quot;title&quot;:&quot;Flows.ListFlowsByAgent&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlowsByAgent.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByAgent.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2502,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a395dde1-d340-400e-afeb-fab29ee26753&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAgent Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(searchParam)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc8b94da-e047-4050-9709-b34f7b42ce7d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if enterpriseagent UID param is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAgent Should get error, if enterpriseagent UID param is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30e16ede-f51d-487c-9bbd-a549fcdda6aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows by enterpriseagent, if enterpriseagent UID param is passed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAgent Should get list of flows by enterpriseagent, if enterpriseagent UID param is passed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27cfa3e7-ebe9-43d9-a0fb-f76a6e0f2f6d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fc8b94da-e047-4050-9709-b34f7b42ce7d&quot;,&quot;30e16ede-f51d-487c-9bbd-a549fcdda6aa&quot;,&quot;27cfa3e7-ebe9-43d9-a0fb-f76a6e0f2f6d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:110,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b9b3a486-71cb-4d6f-ba82-cbc72d059e59&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlowsByAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;21667990-4629-46a7-8b6d-cbb0be419cda&quot;,&quot;title&quot;:&quot;Flows.ListFlowsByAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlowsByAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAuth \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2639,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6e8c4bc-63fd-4f8c-8bc0-4ce90b7ce58d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(searchParam)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a158b17-ed11-4248-b460-e2d22cb2195d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if auth UID param is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAuth Should get error, if auth UID param is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7c509ec-a74e-4e8f-9c4d-d8fdbb6c389e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows by auth, if auth UID param is passed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAuth Should get list of flows by auth, if auth UID param is passed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02a150b2-fed8-4fd6-8377-e005742a19d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7a158b17-ed11-4248-b460-e2d22cb2195d&quot;,&quot;c7c509ec-a74e-4e8f-9c4d-d8fdbb6c389e&quot;,&quot;02a150b2-fed8-4fd6-8377-e005742a19d0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:93,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6c8ca0df-968f-4344-9a58-cdafcff12c02&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlowsByConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;730a9b30-f6dd-465b-95a5-d0e7be97bbcb&quot;,&quot;title&quot;:&quot;Flows.ListFlowsByConnection&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlowsByConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2641,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8efdcfb-46bb-419b-aba6-92149124ca05&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByConnection Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(searchParam)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c4e3fd58-ce3e-4f3f-a430-295df8b5f55e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if connection UID param is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByConnection Should get error, if connection UID param is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;90d34d41-35b4-4668-93df-7708fb7863cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows by auth, if connection UID param is passed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByConnection Should get list of flows by auth, if connection UID param is passed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b966b1ea-f46b-48ee-9712-0c394785f411&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c4e3fd58-ce3e-4f3f-a430-295df8b5f55e&quot;,&quot;90d34d41-35b4-4668-93df-7708fb7863cf&quot;,&quot;b966b1ea-f46b-48ee-9712-0c394785f411&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:100,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a3a22de0-f42f-4372-9f62-cbf602dceeec&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlowsByCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1d90fb1f-6387-47f1-affa-feaa701f88e0&quot;,&quot;title&quot;:&quot;CustomIntegration.GetFlows&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlowsByCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2675,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        customIntegration = result.body.output;\n        flowData.activities[2].uid = customIntegration.uid;\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;995ca5a4-558d-43c2-843a-cc364bf1485d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97702ec7-0d97-4a68-bc27-e3acf0d1b475&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/&#x27; + customIntegration.uid + &#x27;/flows&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64915832-b091-401e-b7f7-1dca62bf33b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows of custom  integrtion.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows Should get list of flows of custom  integrtion.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/&#x27; + customIntegration.uid + &#x27;/flows&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output[0]).to.contain.all.keys([&#x27;uid&#x27;, &#x27;name&#x27;, &#x27;flow_version&#x27;])\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10801a82-ad0a-4b4b-b917-f36ddfefc501&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;64915832-b091-401e-b7f7-1dca62bf33b1&quot;,&quot;10801a82-ad0a-4b4b-b917-f36ddfefc501&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6a0d24ad-72a7-415a-9eec-c83ddc6aa1aa&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlowsByTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e361ccf1-19e8-4d2e-9880-e5cba0092657&quot;,&quot;title&quot;:&quot;Flows.ListFlowsByTrigger&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\listFlowsByTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2607,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb73bc0b-6e84-425c-be8d-8a7f7f38cde2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByTrigger Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(searchParam)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;301aae94-4b00-4ed8-96c0-6f09a84b8aa4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger UID param is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByTrigger Should get error, if trigger UID param is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;080751c4-891f-4b27-90e0-a2a4e9fcbcc7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows by auth, if trigger UID param is passed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByTrigger Should get list of flows by auth, if trigger UID param is passed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4633c7d6-2d44-4b7a-97a3-30b92dd4dadf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;301aae94-4b00-4ed8-96c0-6f09a84b8aa4&quot;,&quot;080751c4-891f-4b27-90e0-a2a4e9fcbcc7&quot;,&quot;4633c7d6-2d44-4b7a-97a3-30b92dd4dadf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:103,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ca7085b7-2b74-4590-bde6-460e93318f01&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\revertUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\revertUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8a68a824-491d-4b07-af4a-c45d429ec6af&quot;,&quot;title&quot;:&quot;Flow.revertUserFlowVersion&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\revertUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\revertUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:421,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                testData.mongoUserTriggerObj.uid = &#x27;tg9b42e22c50a119f6729d68&#x27;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(&#x27;/enterprise/v1/projects&#x27;)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            },\n            function(result, cbk) {\n                project = result.body.output;\n                async.parallel([\n                    function(cb) {\n                        saveFlow(flowURL, dummyUser, flowWithAllDataWithoutTrigger, function(err, result) {\n                            cb(err, result)\n                        })\n                    },\n                    function(cb) {\n                        var flowData2 = _.cloneDeep(flowData)\n                        api.post(flowURL)\n                            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, project_uid: project.uid })\n                            .send(flowData2)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                cb(err, res)\n                            })\n                    }\n                ], function(err, results) {\n                    cbk(err, results)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res[0].body.output\n                userFlowWithProject = res[1].body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca6047ab-c8fd-4518-858a-37090bc69379&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;abd72c9f-54de-4715-868b-1940e50cd915&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n    .send({ flow_version: 1 })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e5397d5c-ecb4-41da-8044-5d37d29accbc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;dummyFlow&#x27; + &#x27;/revert&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ flow_version: 1 })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4966c0f4-db2a-454f-aa35-4d3215b85e31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow version not found not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should get error, if flow version not found not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ flow_version: 21 })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_VERSION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95202299-0d63-4cb2-8602-4269d21aee34&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow version not valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should get error, if flow version not valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ flow_version: &#x27;dummy&#x27; })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2e016af-b46d-49e9-86c2-d5940d9dd632&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tried to delete current flow version.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should get error, if user tried to delete current flow version.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\napi.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .send({ flow_version: 1 })\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CURRENT_VERSION_REVERT_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a4dee728-b04e-40f9-a33b-ebc6d1e92fdb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should revert flow version.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should revert flow version.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:359,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nflowWithAllData.trigger.handlers.uid = flowData.trigger.handlers[0]\napi.put(flowURL + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(flowWithAllData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var opt1 = { path: getTriggerPath, body: getTriggerPath, times: 2 };\n        commonMock.triggerGetSuccess(opt1);\n        opt1.getPath = getTriggerPath + &#x27;/handlers&#x27;;\n        opt1.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\n        commonMock.triggerPullSuccess(opt);\n        opt1.body = { \&quot;push\&quot;: [/^fl\\w*/] };\n        commonMock.triggerPushSuccess(opt);\n        api.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send({ flow_version: 1 })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(res.body.output.flow_version).equal(3);\n                    expect(res.body.output.active).equal(true);\n                    //expect(res.body.output.name).equal(&#x27;dummy flow&#x27;);\n                    //done();\n                    var opt2 = { path: getTriggerPath, body: getTriggerPath, times: 2 };\n                    commonMock.triggerGetSuccess(opt2);\n                    opt2.getPath = getTriggerPath + &#x27;/handlers&#x27;;\n                    opt2.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\n                    commonMock.triggerPullSuccess(opt);\n                    opt2.body = { \&quot;push\&quot;: [/^fl\\w*/] };\n                    commonMock.triggerPushSuccess(opt2);\n                    api.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n                        .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                        .send({ flow_version: 2 })\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                expect(res.body.output.flow_version).equal(4);\n                                expect(res.body.output.active).equal(true);\n                                expect(res.body.output.errors_obj.length).equal(0);\n                                expect(res.body.output.trigger.handlers[0].uid).equal(flowWithAllData.trigger.handlers[0].uid);\n                                expect(res.body.output.name).equal(&#x27;Config&#x27;);\n                                done();\n                            }\n                        });\n                }\n            });\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2280a388-348e-4ae3-8e9d-3e8eb7ce5af4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e5397d5c-ecb4-41da-8044-5d37d29accbc&quot;,&quot;4966c0f4-db2a-454f-aa35-4d3215b85e31&quot;,&quot;95202299-0d63-4cb2-8602-4269d21aee34&quot;,&quot;a2e016af-b46d-49e9-86c2-d5940d9dd632&quot;,&quot;a4dee728-b04e-40f9-a33b-ebc6d1e92fdb&quot;,&quot;2280a388-348e-4ae3-8e9d-3e8eb7ce5af4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:587,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d6721b31-56fe-42dc-98ea-d941340d6d9d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\shareUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\shareUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;73f2069a-3674-4ad1-9e04-112caed17eb8&quot;,&quot;title&quot;:&quot;Flow.ShareUserFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\shareUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\shareUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:254,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                _id = dummyUser._id\n                flowData.trigger.handlers = [userTriggerObj]\n                    //var flowData = _.clone(testData.flowBody)\n                flowData.environment[0].params = [{\n                    \&quot;key\&quot;: \&quot;1\&quot;,\n                    \&quot;value\&quot;: \&quot;2\&quot;,\n                    \&quot;required\&quot;: true\n                }, {\n                    \&quot;key\&quot;: \&quot;3\&quot;,\n                    \&quot;value\&quot;: \&quot;2\&quot;,\n                    \&quot;required\&quot;: false\n                }];\n                flowData.environment[0].project_params = [{\n                    \&quot;uid\&quot;: \&quot;random\&quot;,\n                    \&quot;key\&quot;: \&quot;param1\&quot;,\n                    \&quot;value\&quot;: \&quot;parawal\&quot;,\n                    \&quot;required\&quot;: true,\n                    \&quot;isPassword\&quot;: false,\n                    \&quot;hasError\&quot;: false\n                }];\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;03256564-d2bb-461d-a550-990e1dae4e8c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cb) {\n        _models.newFlow.findOne({ owner_uid: shareCriteria.users }, function(err, sharedFlow) {\n            cb(err, sharedFlow);\n        })\n    },\n    function(sharedFlow, cb) {\n        removeFlow([userFlow.uid, (sharedFlow || {}).uid], function(err, deletedFlows) {\n            cb(err, deletedFlows);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c59a54b-cffe-4193-abc2-a5b315e3f9f0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n    .send(shareCriteria)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ddb939cc-3826-47e3-b289-b9d32e511a58&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should share flow, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should share flow, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath }\ncommonMock.triggerCreateSuccess(opt);\nshareCriteria.users = [orgData.role1.email]\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(&#x27;Workflow shared successfully with 1 user(s)&#x27;)\n            var query = _models.UserStream.find({ type: &#x27;share-flow&#x27; })\n            query.lean().exec(function(err, results) {\n                if (err) {\n                    done(err);\n                } else {\n                    var shareTo = _.find(results, { metadata:{to_email: shareCriteria.users[0] }})\n                    var shareFrom = _.find(results, { metadata:{from_email: dummyUser.email }})\n                    if (shareFrom &amp;&amp; shareTo) {\n                        done()\n                    }\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;08be3449-b9c5-44e0-8ec5-4df6a4820e16&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/dummyFlow/share&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6af53a1-f10a-4e96-a98b-8669372d9a27&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;users\&quot; params is missing OR empty.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should get error, if \&quot;users\&quot; params is missing OR empty.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingUsers = _.omit(shareCriteria, &#x27;users&#x27;);\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingUsers)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f10fdf8c-aa0f-42f0-88aa-ab0dd0c69319&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should share flow with organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should share flow with organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar projectParams = [{\n    \&quot;uid\&quot;: \&quot;random\&quot;,\n    \&quot;key\&quot;: \&quot;param1\&quot;,\n    \&quot;value\&quot;: \&quot;parawal\&quot;,\n    \&quot;required\&quot;: true,\n    \&quot;isPassword\&quot;: false,\n    \&quot;hasError\&quot;: false\n}, {\n    \&quot;uid\&quot;: \&quot;random1\&quot;,\n    \&quot;key\&quot;: \&quot;param1\&quot;,\n    \&quot;value\&quot;: \&quot;parawal\&quot;,\n    \&quot;required\&quot;: true,\n    \&quot;isPassword\&quot;: false,\n    \&quot;hasError\&quot;: false\n}]\nvar opt = { path: getTriggerPath, body: getTriggerPath, times: 2 };\ncommonMock.triggerCreateSuccess(opt);\nvar orgDefaultProj = _.find(orgData.org_projects, { name: config.default_project })\nvar projectParam = _.merge(projectParams[0], { type: &#x27;param&#x27;, project_uid: orgDefaultProj.uid, user_uid: orgData.organization_account.uid })\n_models.ConfigSchema.create(projectParam, function(err, result) {\n    var shareWithOrgs = _.cloneDeep(shareCriteria)\n    shareWithOrgs.users = &#x27;&#x27;;\n    shareWithOrgs.orgs = [orgData.organization.name]\n    shareWithOrgs.project_params = projectParams\n    shareWithOrgs.params = [{\n        \&quot;key\&quot;: \&quot;3\&quot;,\n        \&quot;value\&quot;: \&quot;2\&quot;,\n        \&quot;required\&quot;: false\n    }]\n    api.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n        .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n        .send(shareWithOrgs)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(&#x27;Workflow shared successfully with 1 organization(s)&#x27;)\n                var query = _models.ConfigSchema.find({ type: &#x27;param&#x27;, project_uid: orgDefaultProj.uid })\n                query.lean().exec(function(err, results) {\n                    if (results) {\n                        var shareProjectParamsUIDS = _.map(results, &#x27;uid&#x27;)\n                        var projectParamsUIDS = _.map(projectParams, &#x27;uid&#x27;)\n                        if (_.isEqual(shareProjectParamsUIDS, projectParamsUIDS)) {\n                            done();\n                        } else {\n                            done(&#x27;PROJECT_PARAMS_MISMATCH&#x27;);\n                        }\n                    }\n                })\n            }\n        });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62be4862-3d65-4320-af28-63bf590ca39e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tries to share flow with himself.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should get error, if user tries to share flow with himself.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nshareCriteria.users = testData.testRegistrationBody.email\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_CANNOT_BE_SHARE_WITH_SAME_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c20480e9-610f-44de-81b7-d46b3ac913d9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tries to share flow with more than 10 users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should get error, if user tries to share flow with more than 10 users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nshareCriteria.users = [&#x27;1@a.com&#x27;, &#x27;2@a.com&#x27;, &#x27;3@a.com&#x27;, &#x27;4@a.com&#x27;, &#x27;5@a.com&#x27;, &#x27;6@a.com&#x27;, &#x27;7@a.com&#x27;, &#x27;8@a.com&#x27;, &#x27;9@a.com&#x27;, &#x27;10@a.com&#x27;, &#x27;11@a.com&#x27;]\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;The workflow can not be shared with more than 10 users at a time.&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3512cfb5-55a2-47aa-a951-dab8e9511ed8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.FLOW_SHARE_USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;63d1900c-4eb4-4efa-9d82-c30db6b7041c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ddb939cc-3826-47e3-b289-b9d32e511a58&quot;,&quot;08be3449-b9c5-44e0-8ec5-4df6a4820e16&quot;,&quot;a6af53a1-f10a-4e96-a98b-8669372d9a27&quot;,&quot;f10fdf8c-aa0f-42f0-88aa-ab0dd0c69319&quot;,&quot;62be4862-3d65-4320-af28-63bf590ca39e&quot;,&quot;c20480e9-610f-44de-81b7-d46b3ac913d9&quot;,&quot;3512cfb5-55a2-47aa-a951-dab8e9511ed8&quot;,&quot;63d1900c-4eb4-4efa-9d82-c30db6b7041c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:344,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0b73ea45-933c-40a6-ab50-a14c47344c45&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\stopUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\stopUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;892c1206-554f-4364-b5a1-747e799a9507&quot;,&quot;title&quot;:&quot;Flow.StopUserFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\stopUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\stopUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2904,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        testData.mongoUserTriggerObj.user_uid = user.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        //testData.flowBody.trigger.handlers = [userTriggerObj.uid]\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.flowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        var billBody = {\n            \&quot;flow_uid\&quot;: userFlow.uid,\n            \&quot;billable\&quot;: true,\n            \&quot;user_uid\&quot;: dummyUser.uid,\n            \&quot;flow_name\&quot;: \&quot;dummy flow\&quot;,\n            \&quot;result\&quot;: \&quot;pending\&quot;,\n            \&quot;duration\&quot;: 0,\n            \&quot;manual_run\&quot;: true,\n            \&quot;deleted_at\&quot;: null,\n            \&quot;credits\&quot;: 0,\n            \&quot;__v\&quot;: 0\n        }\n        _models.Bill.create(billBody, function(err, billObj) {\n            flowBill = billObj;\n            stopData.bill_uid = flowBill.uid;\n        })\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab8fac00-14ee-479e-957e-8ca7d647c271&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlows) {\n            cb(err, deletedFlows);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.Bill.remove({ uid: flowBill.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b69221d-4b9f-4d32-83d7-9ad64eca941b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/stop&#x27;)\n    .send(stopData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f2d812e-1285-4431-9dd5-46e438f5f38b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if key \&quot;bill_uid\&quot; is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow Should get error, if key \&quot;bill_uid\&quot; is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.clone(stopData)\ndata.bill_uid = null;\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/stop&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a688861-644e-41c3-94e4-b03a5ef99547&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if key \&quot;bill_uid\&quot; is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow Should get error, if key \&quot;bill_uid\&quot; is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.clone(stopData)\ndata.bill_uid = &#x27;ABC&#x27;;\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/stop&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.BILL_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b5600b1f-451f-4151-bdd2-4e9c85fbe5bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should stop flow, if bill is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow Should stop flow, if bill is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { bill_uid: stopData.bill_uid, user_uid: dummyUser.uid }\ncommonMock.stopFlowSuccess(opt)\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/stop&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(stopData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.result.should.equal(&#x27;OK&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;831e85a3-b7ed-4c86-89b8-46fe4011ee5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5f2d812e-1285-4431-9dd5-46e438f5f38b&quot;,&quot;9a688861-644e-41c3-94e4-b03a5ef99547&quot;,&quot;b5600b1f-451f-4151-bdd2-4e9c85fbe5bf&quot;,&quot;831e85a3-b7ed-4c86-89b8-46fe4011ee5c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:149,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e6394708-9cee-4488-95a4-1fbde57631a7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\toggleUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\toggleUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5bd7e7e7-3c88-4e75-9060-b3727fb16132&quot;,&quot;title&quot;:&quot;Flow.ToggleUserFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\toggleUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\toggleUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2743,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        testData.mongoUserTriggerObj.user_uid = user.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        testData.flowBody.trigger.handlers = [userTriggerObj]\n        dummyUser = result.body.output;\n        var flowBody = _.cloneDeep(testData.flowBody);\n        async.parallel({\n            activeFlow: function(cb) {\n                createFlow(dummyUser, flowBody, cb)\n            },\n            inactiveFlow: function(cb) {\n                flowBody.active = false\n                createFlow(dummyUser, flowBody, cb)\n            }\n        }, function(err, result) {\n            cbk(err, result)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err);\n    } else {\n        liveFlow = result.activeFlow.body.output;\n        userFlow = result.inactiveFlow.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9ea0afaa-4070-4349-b915-a8b2e4ce9576&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: [userFlow.uid, liveFlow.uid] } }, function(err, deletedFlow) {\n            cb(err, deletedFlow);\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14a62312-9160-49a2-9cef-d48a3ecefeae&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/toggle&#x27;)\n    .send(active)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5eef0041-ba73-41d1-8081-d8bad7ee2f93&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/dummyFlow/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(active)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51be285d-975e-42ef-bd92-911b4950900b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;data\&quot; key is missing OR empty.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should get error, if \&quot;data\&quot; key is missing OR empty.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send()\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;839cfbbb-9ad5-43ff-856b-7a9abf88edff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should \&quot;active\&quot; flow, if user sends {data: true}.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should \&quot;active\&quot; flow, if user sends {data: true}.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(active)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.active).to.be.equal(true);\n            //expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f7d5da3-a2d5-4b9a-b743-45dc8818984b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user sends {data: true} and flow is in active state&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should get error, if user sends {data: true} and flow is in active state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(active)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.FLOW_ALREADY_IN_ACTIVE_STATE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a283f820-19d1-4046-9d3e-1cb66eb02bad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should \&quot;de-active\&quot; flow, if user sends {data: false} and config data must have \&quot;trigger\&quot; key&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should \&quot;de-active\&quot; flow, if user sends {data: false} and config data must have \&quot;trigger\&quot; key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;unset\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nactive.data = false;\napi.put(flowURL + &#x27;/&#x27; + liveFlow.uid + &#x27;/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(active)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.active).to.be.equal(false)\n                //expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            var query = _models.ConfigData.findOne({ flow_uid: res.body.output.uid, activity_id: &#x27;start&#x27; })\n            query.lean().exec(function(err, configData) {\n                expect(configData).have.any.keys([&#x27;trigger&#x27;])\n                done();\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df081c70-f7b5-4ff3-9f28-b920a9c5af7a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should \&quot;de-active\&quot; flow, if user sends {data: false}.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should \&quot;de-active\&quot; flow, if user sends {data: false}.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;unset\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nactive.data = false;\napi.put(flowURL + &#x27;/&#x27; + liveFlow.uid + &#x27;/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(active)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.FLOW_ALREADY_IN_INACTIVE_STATE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60d3aaa8-ba2d-4eeb-a494-389a06e11187&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nthis.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;unset\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nactive.data = false;\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.put(flowURL + &#x27;/&#x27; + liveFlow.uid + &#x27;/toggle&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(active)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13aaabf9-042b-44c6-b464-2c8db7e583ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5eef0041-ba73-41d1-8081-d8bad7ee2f93&quot;,&quot;51be285d-975e-42ef-bd92-911b4950900b&quot;,&quot;839cfbbb-9ad5-43ff-856b-7a9abf88edff&quot;,&quot;7f7d5da3-a2d5-4b9a-b743-45dc8818984b&quot;,&quot;a283f820-19d1-4046-9d3e-1cb66eb02bad&quot;,&quot;df081c70-f7b5-4ff3-9f28-b920a9c5af7a&quot;,&quot;60d3aaa8-ba2d-4eeb-a494-389a06e11187&quot;,&quot;13aaabf9-042b-44c6-b464-2c8db7e583ea&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:346,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0be5d130-bc8c-49ca-b204-819f7ec92d9e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\updateUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5374c453-58cb-473b-b13a-12d3d3db1a1a&quot;,&quot;title&quot;:&quot;Flow.UpdateUserFlow&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\updateUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:465,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger.toJSON()\n                    //flowWithAllData.trigger.handlers[0] = userTriggerObj\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowWithAllData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            },\n            function(res, cbk) {\n                userFlow = res.body.output;\n                //flowWithAllData.trigger.handlers[0] = userTriggerObj\n                api.post(flowURL)\n                    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n                    .send(flowWithAllData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                orgFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d49a27da-af35-4a91-bba9-c539ccf2094a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n            cb(err, deletedFlow);\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;165db854-4929-462e-b2cd-b3c2b3f7bc0f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .send(userFlow)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82bc216e-1f3e-4a34-8fd6-2d4db7556297&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/dummyFlow&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;43945677-d433-45a4-aaca-9547708aa008&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidFlowData = _.omit(flowData, &#x27;name&#x27;)\napi.post(flowURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidFlowData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80cc1be5-e7d3-4950-9616-472ce26c2eb3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow activity has no end point.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow activity has no end point.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = flowData.activities;\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_CONNECTION_ERROR)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36dd9f71-924e-429c-be1c-522800228d0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow activities has circular connection.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow activities has circular connection.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nvar invalidFlowActivities = _.clone(testData.invalidFlowActivities)\n_.set(_.first(invalidFlowActivities), &#x27;next&#x27;, [&#x27;start&#x27;])\nuserFlow.activities = JSON.stringify(invalidFlowActivities);\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_LOOP_ERROR)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e31d93a-2181-4ae7-a1d7-3ea06a8854d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow activity has no id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow activity has no id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nvar invalidFlowActivities = _.clone(testData.invalidFlowActivities)\n_.set(_.first(invalidFlowActivities), &#x27;id&#x27;, null)\nuserFlow.activities = JSON.stringify(invalidFlowActivities);\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_CHAIN_BREAK)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97c7b560-ee36-4931-964d-a87fc1b88356&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow has group activities with no end point.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow has group activities with no end point.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = JSON.stringify(testData.invalidGroupActivities);\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_GROUP_CONNECTION_ERROR)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02be3d32-9ac0-4d71-aa11-632ba7653bb8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow has group has no activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow has group has no activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = JSON.stringify(testData.blankGroupActivities);\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_GROUP_BLANK_ERROR)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f0a3976-3483-47db-a65c-29554259de40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow has group circular connection.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow has group circular connection.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = JSON.stringify(testData.GroupActivitiesWithLoopConnection);\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_LOOP_ERROR)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2caf19e3-e6b0-4bdb-a624-61c0033a8117&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update flow, if user sends a valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should update flow, if user sends a valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:98,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = testData.newAcitivities;\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output\n            var flowEnv = _.first(JSON.parse(flow.environment))\n            expect(flow.name).to.equal(testFlowName)\n            expect(flow.flow_version).to.equal(2)\n            expect(flow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            expect(flowEnv).to.have.any.keys([&#x27;auth&#x27;, &#x27;connection&#x27;, &#x27;enterpriseagent&#x27;, \&quot;id\&quot;, \&quot;params\&quot;]);\n            expect(flow.trigger.handlers).to.have.length.of.at.least(1)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4579bf09-50ba-40ba-a304-6c14dfabe20b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update flow in org, if user sends a valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should update flow in org, if user sends a valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:138,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = testData.newAcitivities;\nuserFlow.configurations = flowData.environment;\nuserFlow.preserve_version = true\napi.put(flowURL + &#x27;/&#x27; + orgFlow.uid)\n    .set({ &#x27;authtoken&#x27;: orgData.developer.authtoken, org_uid: orgData.organization.uid })\n    .send(userFlow)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output\n            var flowEnv = _.first(JSON.parse(flow.environment))\n            expect(flow.name).to.equal(testFlowName)\n            expect(flow.updated_by).to.equal(orgData.developer.uid)\n            expect(flow.flow_version).to.equal(1)\n            expect(flow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            expect(flowEnv).to.have.any.keys([&#x27;auth&#x27;, &#x27;connection&#x27;, &#x27;enterpriseagent&#x27;, \&quot;id\&quot;, \&quot;params\&quot;]);\n            expect(flow.trigger.handlers).to.have.length.of.at.least(1)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9ae9e43a-2f09-4803-b023-9a80880e7b73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update flow, if user sends a valid data with error activity.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should update flow, if user sends a valid data with error activity.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nflowWithErrorAct.uid = userFlow.uid\nflowWithErrorAct.owner_uid = userFlow.owner_uid\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(flowWithErrorAct)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output\n            expect(flow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7bf6d46e-b032-4d7d-b074-9a7110d8fc1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4892526b-69f1-45e3-ad48-39b20f3243a8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;82bc216e-1f3e-4a34-8fd6-2d4db7556297&quot;,&quot;43945677-d433-45a4-aaca-9547708aa008&quot;,&quot;80cc1be5-e7d3-4950-9616-472ce26c2eb3&quot;,&quot;36dd9f71-924e-429c-be1c-522800228d0a&quot;,&quot;4e31d93a-2181-4ae7-a1d7-3ea06a8854d4&quot;,&quot;97c7b560-ee36-4931-964d-a87fc1b88356&quot;,&quot;02be3d32-9ac0-4d71-aa11-632ba7653bb8&quot;,&quot;2f0a3976-3483-47db-a65c-29554259de40&quot;,&quot;2caf19e3-e6b0-4bdb-a624-61c0033a8117&quot;,&quot;4579bf09-50ba-40ba-a304-6c14dfabe20b&quot;,&quot;9ae9e43a-2f09-4803-b023-9a80880e7b73&quot;,&quot;7bf6d46e-b032-4d7d-b074-9a7110d8fc1d&quot;,&quot;4892526b-69f1-45e3-ad48-39b20f3243a8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:755,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a41308cc-e088-4270-ad90-dfd402f86b7b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\updateUserFlowInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlowInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;df4ca360-a890-4b45-a544-612ba6d93bbe&quot;,&quot;title&quot;:&quot;Flow.UpdateUserFlowInfo&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\updateUserFlowInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlowInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2759,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;784be934-6ab6-45a4-8f36-afd31e3936fa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;22ded664-4152-48bd-906b-052f5ef87e33&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + +&#x27;/info&#x27;)\n    .send(userFlow)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b0dc3ea-acdb-4998-91f1-e0b95ca42e25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/dummyFlow/info&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0aac9c96-0f35-49d9-bc50-290e9c8100e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidFlowData = _.pick(userFlow, [&#x27;uid&#x27;, &#x27;description&#x27;, &#x27;tags&#x27;])\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/info&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidFlowData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd0a434e-2ae8-4a9f-939b-05d2d469de00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update flow, if user sends a valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo Should update flow, if user sends a valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar validFlowData = _.pick(userFlow, [&#x27;name&#x27;, &#x27;uid&#x27;, &#x27;description&#x27;, &#x27;tags&#x27;])\nvalidFlowData.name = testFlowName\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/info&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(validFlowData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.name).to.equal(testFlowName)\n            expect(res.body.output.flow_version).to.equal(1)\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a5e7b69-cf2f-4fc1-a16d-f1533230c51d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8b0dc3ea-acdb-4998-91f1-e0b95ca42e25&quot;,&quot;0aac9c96-0f35-49d9-bc50-290e9c8100e5&quot;,&quot;dd0a434e-2ae8-4a9f-939b-05d2d469de00&quot;,&quot;8a5e7b69-cf2f-4fc1-a16d-f1533230c51d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:153,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;44e86ca4-9f54-44f6-bf3c-63429aafe80e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\updateUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d181ecf9-1891-4c8f-8e8b-14436ef87450&quot;,&quot;title&quot;:&quot;Flow.UpdateUserFlowVersion&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\updateUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:254,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger.toJSON()\n                    //flowWithAllData.trigger.handlers[0] = userTriggerObj\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowWithAllData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dc3793b1-99ff-44b1-8001-aa97312e23dc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n            cb(err, deletedFlow);\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c607ab2f-f44d-47b7-b65a-37b48ff69f4a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/version/&#x27; + userFlow.flow_version)\n    .send(body)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;836da97a-2c96-4e5c-ba18-6a0b6d6b153e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/dummyFlow&#x27; + &#x27;/version/&#x27; + userFlow.flow_version)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55544651-e97a-446a-83d0-2ff6367e9bd0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow version not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion Should get error, if flow version not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:210,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/version/3&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_VERSION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f572474b-b255-469f-adc0-2a0aa17ad1fa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update flow version, if user sends a valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion Should update flow version, if user sends a valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/version/&#x27; + userFlow.flow_version)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var result = res.body.output\n            expect(_.first(result).flow_version_tag).to.equal(body.flow_version_tag)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bf334fe8-a550-4b66-ba0d-83edec53a65d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;836da97a-2c96-4e5c-ba18-6a0b6d6b153e&quot;,&quot;55544651-e97a-446a-83d0-2ff6367e9bd0&quot;,&quot;f572474b-b255-469f-adc0-2a0aa17ad1fa&quot;,&quot;bf334fe8-a550-4b66-ba0d-83edec53a65d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:327,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;04a4129b-e3a5-415f-9895-8a7306facfc9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\updateWebhook.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateWebhook.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e5d5590e-00e1-456e-8c7c-d17141c31cf0&quot;,&quot;title&quot;:&quot;Flow.UpdateWebHook&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\updateWebhook.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateWebhook.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:341,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                var userTriggerObj = userTrigger;\n                var flowData = _.cloneDeep(testData.flowBody);\n                flowData.isExpress = false;\n                flowData.trigger.handlers = [userTriggerObj]\n                async.parallel({\n                    triggerFlow: function(cb) {\n                        createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    webHookFlow: function(cb) {\n                        var WHFlow = _.cloneDeep(flowData);\n                        WHFlow.trigger = testData.defaultTriggerObj;\n                        WHFlow.settings = testData.webHookSetting;\n                        WHFlow.active = true;\n                        WHFlow.settings = testData.webHookSetting;\n                        createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    }\n                }, function(err, result) {\n                    cbk(err, result)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userTriggerFlow = res.triggerFlow.body.output;\n                userWebHookFlow = res.webHookFlow.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ada25ed-6c77-4594-84d7-953aa9ac6d29&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nvar flowUIDS = [userWebHookFlow.uid];\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: flowUIDS } }, function(err, deletedFlows) {\n            cb(err, deletedFlows)\n        });\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83365064-5484-4a8e-ac5e-638aa90e83c9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userWebHookFlow.uid + &#x27;/updatewebhook&#x27;)\n    .send(updateBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4a07add-865f-4725-a4e0-45b3e67839cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give flow not found error, if user sends an invalid floe uid&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook Should give flow not found error, if user sends an invalid floe uid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/dummyFlow/updatewebhook&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(updateBody)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef253926-9d9c-4d89-be4e-d56f68a39cdb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update webhook flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook Should update webhook flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userWebHookFlow.uid + &#x27;/updatewebhook&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(updateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.settings.url_execution).to.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f69618cf-11ae-4ec8-8b59-838766736265&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update webhook of trigger attched flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook Should update webhook of trigger attched flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flow_uid = userTriggerFlow.uid\nvar trigger_path = &#x27;/trigger/&#x27; + userTriggerFlow.trigger.handlers[0] + &#x27;/handlers&#x27;;\nvar trigger_body = {\n    \&quot;unset\&quot;: [flow_uid]\n}\nvar opt = { path: trigger_path, body: trigger_body };\ncommonMock.triggerPullSuccess(opt);\napi.post(flowURL + &#x27;/&#x27; + userTriggerFlow.uid + &#x27;/updatewebhook&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(updateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.settings.url_execution).to.be.equal(true);\n            expect(res.body.output.settings).not.to.have.all.keys([&#x27;authtoken&#x27;]);\n            expect(_.isEmpty(res.body.output.trigger.handlers)).to.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e13bb21e-8728-437f-8126-0eb4e1916512&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d4a07add-865f-4725-a4e0-45b3e67839cf&quot;,&quot;ef253926-9d9c-4d89-be4e-d56f68a39cdb&quot;,&quot;f69618cf-11ae-4ec8-8b59-838766736265&quot;,&quot;e13bb21e-8728-437f-8126-0eb4e1916512&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:209,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;23064452-137f-460d-adaf-2aef4a1c70b1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\userFlowExists.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\userFlowExists.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;67603f35-c89e-4157-9018-76f43610cd59&quot;,&quot;title&quot;:&quot;Flow.UserFlowExists&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flow\\userFlowExists.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\userFlowExists.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UserFlowExists \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2610,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.enterpriseFlowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5129350c-217b-4df3-92b1-4330b3d6472c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UserFlowExists \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e5e75dd-3b07-4212-a912-5973de71ee68&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UserFlowExists Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/exists&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;375e32c3-3e95-439b-877c-7e1a1bf6ba3b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get \&quot;count\&quot; is equal to 0, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UserFlowExists Should get \&quot;count\&quot; is equal to 0, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/exists&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.count).to.be.equal(0);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e05dec6-2ddc-48ee-b537-8d0451244802&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get \&quot;count\&quot; is equal to 1, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UserFlowExists Should get \&quot;count\&quot; is equal to 1, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/exists&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.count).to.be.equal(1);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72342c78-9677-4f77-b095-7c4fc694c50a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;375e32c3-3e95-439b-877c-7e1a1bf6ba3b&quot;,&quot;7e05dec6-2ddc-48ee-b537-8d0451244802&quot;,&quot;72342c78-9677-4f77-b095-7c4fc694c50a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:113,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d2e4ee04-918b-4fb2-850f-61dc039dbebb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cefbe455-dd25-435f-bf22-48e1baf8b3b7&quot;,&quot;title&quot;:&quot;flowOauth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5b76c504-5a16-4351-9010-c38ca07fbbc0&quot;,&quot;title&quot;:&quot;flowOauth.createClient&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2572,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1171c99-9578-46d4-93b8-c14eb0b1ae2d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8d46f3b2-384f-4fdb-b9ba-a2a3f16565a3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create oauth client.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient Should create oauth client.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a8682dc2-98de-4ec5-9da1-47f38e05bb0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create oauth client without redirect_uri.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient Should create oauth client without redirect_uri.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec3d088e-1ff4-41c1-90f0-4e77ac0f9bcc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to create second oauth client.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient Should not allowed to create second oauth client.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:79,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(apiURL)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .send({\n                    \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n                })\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.FLOW_ACCESS_CLIENT_TOKEN_ALREADY_EXISTS);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;045980c2-8110-43ab-b694-5879db8510e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;50f4ce03-a492-4bfa-88a8-cfb8c938d4dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a8682dc2-98de-4ec5-9da1-47f38e05bb0c&quot;,&quot;ec3d088e-1ff4-41c1-90f0-4e77ac0f9bcc&quot;,&quot;045980c2-8110-43ab-b694-5879db8510e3&quot;,&quot;50f4ce03-a492-4bfa-88a8-cfb8c938d4dc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:186,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;74b2b3d5-6832-4fa2-8813-2585a8e3cb1a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;32f60212-9733-4535-9280-70783c24cfdd&quot;,&quot;title&quot;:&quot;flowOauth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0bfeb06f-76f2-4cd4-a67c-3a30808f948f&quot;,&quot;title&quot;:&quot;flowOauth.deleteClient&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.deleteClient \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2619,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    api.post(apiURL)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .send({\n                            \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n                        })\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _flowAuthUID = res.body.output.uid;\n                                done();\n                            }\n                        });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78401344-9f42-422f-951d-bb40edab5736&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.deleteClient \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;26600488-27ca-4b35-b8f4-3dde6179d6c6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update oauth client.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.deleteClient Should update oauth client.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.FLOW_ACCESS_CLIENT_DELETED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52f755d2-375f-48b1-8735-b11fca420367&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give client not register for already un-register client.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.deleteClient Should give client not register for already un-register client.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.delete(apiURL)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.FLOW_ACCESS_CLIENT_NOT_REGISTER);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a44f9f6e-753f-4644-a967-0bc5597cbe82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.deleteClient Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f30f3d6-2f32-4d2d-97b1-eab1a6812add&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;52f755d2-375f-48b1-8735-b11fca420367&quot;,&quot;a44f9f6e-753f-4644-a967-0bc5597cbe82&quot;,&quot;3f30f3d6-2f32-4d2d-97b1-eab1a6812add&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:124,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;acf91d37-0af1-4f8b-b4af-66eb7e5ceb46&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d675575e-c727-4716-b269-291d36e0d998&quot;,&quot;title&quot;:&quot;flowOauth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b3d673d9-17ee-433e-9ead-b39a41911454&quot;,&quot;title&quot;:&quot;flowOauth.grantToken&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5188,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid)\n                    registrationBody1 = global.getImmutable(registrationBody);\n                    registrationBody1.email = \&quot;test.user+1@raweng.com\&quot;;\n                    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                        email: registrationBody1.email\n                    });\n                    api.post(\&quot;/enterprise/v1/signup\&quot;)\n                        .send(registrationBody1)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                authToken2 = res.body.output.authtoken;\n                                done();\n                            }\n                        });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81d5277d-4673-40a6-9316-aa077db8ddb9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4b387940-71f8-4ed5-8ca7-a769b4a354c0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should allowed to login with oauth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken Should allowed to login with oauth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:411,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/client\&quot;)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            loginWithOauth({\n                client: res.body.output,\n                registrationBody: registrationBody\n            }, done, function(loginUserUid, uid) {\n                loginUserUid.should.equal(uid);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe95f548-6237-41c5-b1ff-3dfbef12248f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login other user with oauth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken Should allowed to login other user with oauth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:456,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/client\&quot;)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            loginWithOauth({\n                client: res.body.output,\n                registrationBody: registrationBody1\n            }, done, function(loginUserUid, uid) {\n                loginUserUid.should.equal(uid);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41636bf7-955a-42d3-b176-22dfa4ec9c3b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login with different client, if multiple clients are available.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken Should allowed to login with different client, if multiple clients are available.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:717,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/client\&quot;)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            loginWithOauth({\n                client: res.body.output,\n                registrationBody: registrationBody1\n            }, done, function(loginUserUid, uid) {\n                if (loginUserUid == uid) {\n                    api.post(\&quot;/enterprise/v1/user/client\&quot;)\n                        .set(&#x27;authtoken&#x27;, authToken2)\n                        .send({\n                            \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n                        })\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                loginWithOauth({\n                                    client: res.body.output,\n                                    registrationBody: registrationBody1\n                                }, done, function(loginUserUid, uid) {\n                                    loginUserUid.should.equal(uid);\n                                    done();\n                                });\n                            }\n                        });\n                } else {\n                    loginUserUid.should.equal(uid);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;351e76b2-d771-4ed0-b7e2-f9742e6b0258&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b878e99c-dec5-4714-a355-f01d7ff9b24d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fe95f548-6237-41c5-b1ff-3dfbef12248f&quot;,&quot;41636bf7-955a-42d3-b176-22dfa4ec9c3b&quot;,&quot;351e76b2-d771-4ed0-b7e2-f9742e6b0258&quot;,&quot;b878e99c-dec5-4714-a355-f01d7ff9b24d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1594,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7e8369c7-7e5c-4ee5-800e-2488be552160&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3f5d7ee2-7ebf-4053-b12c-9fa5f94ece93&quot;,&quot;title&quot;:&quot;flowOauth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;588d5424-6005-48ba-be4c-c686c3ac7799&quot;,&quot;title&quot;:&quot;flowOauth.loginWithFlowOAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.loginWithFlowOAuth \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5234,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid)\n                    registrationBody1 = global.getImmutable(registrationBody);\n                    registrationBody1.email = \&quot;test.user+1@raweng.com\&quot;;\n                    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                        email: registrationBody1.email\n                    });\n                    api.post(\&quot;/enterprise/v1/signup\&quot;)\n                        .send(registrationBody1)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                authToken2 = res.body.output.authtoken;\n                                done();\n                            }\n                        });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9095f5ea-63f1-41c1-8d62-a663dc8cfa07&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.loginWithFlowOAuth \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;660d84b3-db25-4ccb-8f76-ed7a573c0072&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should allowed to login with access token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.loginWithFlowOAuth Should allowed to login with access token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar accessToken = \&quot;40399f8be4bd5e6df8b1b3a5e8a8dcf61dba4dc6\&quot;;\n_models.OAuthAccessToken.create({\n    \&quot;access_token\&quot;: accessToken,\n    \&quot;client_id\&quot;: \&quot;rp84OfO7CpRrPKaD\&quot;,\n    \&quot;refresh_token\&quot;: \&quot;ea720a80-4b4c-c476-faf5-873b4cfb28df\&quot;,\n    \&quot;user_uid\&quot;: _userUID\n}, function(error, access_token) {\n    if (error) {\n        done(error);\n    } else {\n        api.post(\&quot;/enterprise/v1/oauth/user\&quot;)\n            .send({\n                access_token: accessToken\n            })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.uid.should.not.equal(\&quot;\&quot;);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80d927ac-dd8c-4ccf-9f93-17323f1e5877&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.loginWithFlowOAuth Should give error as unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar accessToken = \&quot;40399f8be4bd5e6df8b1b3a5e8a8dcf61dba4dc6\&quot;;\n_models.OAuthAccessToken.create({\n    \&quot;access_token\&quot;: accessToken + \&quot;DUNPLICATE\&quot;,\n    \&quot;client_id\&quot;: \&quot;rp84OfO7CpRrPKaD\&quot;,\n    \&quot;refresh_token\&quot;: \&quot;ea720a80-4b4c-c476-faf5-873b4cfb28df\&quot;,\n    \&quot;user_uid\&quot;: _userUID\n}, function(error, access_token) {\n    if (error) {\n        done(error);\n    } else {\n        api.post(\&quot;/enterprise/v1/oauth/user\&quot;)\n            .send({\n                access_token: accessToken\n            })\n            .expect(httpStatus.UNAUTHORIZED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.INVALID_FLOW_AUTH_TOKEN);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;61dcd820-a37d-459b-a379-7c1136e4af66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.loginWithFlowOAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a764e6ce-54d7-4f0b-9f6f-9ae34033e00f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;80d927ac-dd8c-4ccf-9f93-17323f1e5877&quot;,&quot;61dcd820-a37d-459b-a379-7c1136e4af66&quot;,&quot;a764e6ce-54d7-4f0b-9f6f-9ae34033e00f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:75,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;748f2733-d0e4-4689-82b6-06307e4711fc&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;82226c85-9e84-41d6-b705-bd19a731eda7&quot;,&quot;title&quot;:&quot;flowOauth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;83b29b49-9771-49e4-996f-be8f8e10a1b1&quot;,&quot;title&quot;:&quot;flowOauth.updateClient&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.updateClient \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2812,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    api.post(apiURL)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .send({\n                            \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n                        })\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _flowAuthUID = res.body.output.uid;\n                                done();\n                            }\n                        });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57504b03-282f-480c-a24f-032847058a4a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.updateClient \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5fc0dba-f525-434b-a273-79dd6a030f30&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update oauth client.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.updateClient Should update oauth client.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar newUrl = \&quot;http://example.com/callback\&quot;;\napi.put(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: newUrl\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid == _flowAuthUID &amp;&amp;\n                res.body.output.redirect_uri == newUrl).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10c22d34-8701-44a6-879a-f450c470a2f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update oauth client without redirect_uri.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.updateClient Should update oauth client without redirect_uri.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid == _flowAuthUID &amp;&amp;\n                res.body.output.redirect_uri == \&quot;\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc0fb947-b04e-4e11-8c12-174b39e69f11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.updateClient Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2df07b6-a0fc-4c91-849d-6a439bde64b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;10c22d34-8701-44a6-879a-f450c470a2f3&quot;,&quot;cc0fb947-b04e-4e11-8c12-174b39e69f11&quot;,&quot;a2df07b6-a0fc-4c91-849d-6a439bde64b4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:113,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0eff521f-1913-47cc-86c1-04b571d79f1b&quot;,&quot;title&quot;:&quot;Activity Analytics&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\helpers\\index.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\helpers\\index.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// var p1 = Promise.all([\n//     _models.ActionUsages.remove({})\n//     _models.User.collection.remove({})\n// ]);\n// var p2 = _models.User.collection.insert(mock_users.express.user_one);\n// var p3 = _models.User.collection.insert(mock_users.enterprise.user_one);\n// return Promise.all([p1, p2, p3]);\nreturn _models.ActionUsages.remove({})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d236cc1-a62c-40e8-a7aa-44f0616893ce&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a29a4f0e-7745-48c1-a047-3e6e53ccc5c5&quot;,&quot;title&quot;:&quot;Common Validation&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\helpers\\index.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\helpers\\index.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should throw error for invalid params&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Common Validation Should throw error for invalid params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(10000);\nreturn activityAnalytics.set().then(function(data) {\n    return data.should.be.undefined;\n}, function(err) {\n    return err.should.be.deep.equal({\n        message: &#x27;Invalid arguments.&#x27;,\n        errors: [\n            &#x27;\&quot;user\&quot; param is mandatory&#x27;,\n            &#x27;\&quot;new_flow\&quot; param is mandatory&#x27;\n        ]\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38860a59-42b6-4501-8f96-8bee690896ae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;38860a59-42b6-4501-8f96-8bee690896ae&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7d22581a-6b49-4b6c-97fe-38b386be9578&quot;,&quot;title&quot;:&quot;Express&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\helpers\\index.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\helpers\\index.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create new analytic event for \&quot;new flow\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Express Should create new analytic event for \&quot;new flow\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.express.user_one, mock_new_flow.express.new_flow).then(function(data) {\n    data.should.be.deep.equal({ isNew: true, isChanged: true });\n    return _models.ActionUsages.findOne()\n        .lean()\n        .then(function(act) {\n            act.created_at = act.created_at.toISOString()\n            act.updated_at = act.updated_at.toISOString()\n            delete act.triggers[0]._id\n            delete act.activities[0]._id\n            delete act._id\n            delete act.uid\n            act.should.be.deep.equal(mock_new_flow.express.new_flow_analytics)\n        })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d9a53c2-79fd-463f-9e33-8ad04118e7d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update analytic event for \&quot;existing flow\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Express Should update analytic event for \&quot;existing flow\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.express.user_one, mock_new_flow.express.new_flow)\n    .then(function() {\n        return activityAnalytics.set(mock_users.express.user_one, mock_new_flow.express.existing_flow).then(function(data) {\n            data.should.be.deep.equal({ isNew: false, isChanged: true });\n            return _models.ActionUsages.findOne()\n                .lean()\n                .then(function(act) {\n                    act.created_at = act.created_at.toISOString()\n                    act.updated_at = act.updated_at.toISOString()\n                    act.triggers = remove_id(act.triggers)\n                    act.activities = remove_id(act.activities)\n                    delete act._id\n                    delete act.uid\n                    act.should.be.deep.equal(mock_new_flow.express.existing_flow_analytics)\n                })\n        })\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;255068f8-16a2-4221-9e95-4fbd61f50d50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should be same analytic event for \&quot;existing unchanged\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Express Should be same analytic event for \&quot;existing unchanged\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.express.user_one, mock_new_flow.express.new_flow)\n    .then(function() {\n        return activityAnalytics.set(mock_users.express.user_one, mock_new_flow.express.new_flow).then(function(data) {\n            data.should.be.deep.equal({ isNew: false, isChanged: false });\n            return _models.ActionUsages.findOne()\n                .lean()\n                .then(function(act) {\n                    act.created_at = act.created_at.toISOString()\n                    act.updated_at = act.updated_at.toISOString()\n                    delete act.triggers[0]._id\n                    delete act.activities[0]._id\n                    delete act._id\n                    delete act.uid\n                    act.should.be.deep.equal(mock_new_flow.express.new_flow_analytics)\n                })\n        })\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c56a92cc-971e-4618-86f1-fb1a631ade40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1d9a53c2-79fd-463f-9e33-8ad04118e7d1&quot;,&quot;255068f8-16a2-4221-9e95-4fbd61f50d50&quot;,&quot;c56a92cc-971e-4618-86f1-fb1a631ade40&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:31,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;636d44d0-8884-4e2a-924e-ef1c37f1f0c8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\helpers\\index.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\helpers\\index.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create new analytic event for \&quot;new flow\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Enterprise Should create new analytic event for \&quot;new flow\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.new_flow).then(function(data) {\n    data.should.be.deep.equal({ isNew: true, isChanged: true });\n    return _models.ActionUsages.findOne()\n        .lean()\n        .then(function(act) {\n            act.created_at = act.created_at.toISOString()\n            act.updated_at = act.updated_at.toISOString()\n            delete act.triggers[0]._id\n            delete act.activities[0]._id\n            delete act._id\n            delete act.uid\n            act.should.be.deep.equal(mock_new_flow.enterprise.new_flow_analytics)\n        })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dad731cb-bb6c-4d9a-8d6f-f97bf585f8f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update analytic event for \&quot;existing flow\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Enterprise Should update analytic event for \&quot;existing flow\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.new_flow).then(function() {\n    return activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.existing_flow).then(function(data) {\n        data.should.be.deep.equal({ isNew: false, isChanged: true });\n        return _models.ActionUsages.findOne()\n            .lean()\n            .then(function(act) {\n                act.created_at = act.created_at.toISOString()\n                act.updated_at = act.updated_at.toISOString()\n                act.triggers = remove_id(act.triggers)\n                act.activities = remove_id(act.activities)\n                delete act._id\n                delete act.uid\n                act.should.be.deep.equal(mock_new_flow.enterprise.existing_flow_analytics)\n            })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f8db3682-945a-47da-b658-fafcade0fce1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should be same analytic event for \&quot;existing unchanged\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Enterprise Should be same analytic event for \&quot;existing unchanged\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.new_flow)\n    .then(function() {\n        return activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.new_flow).then(function(data) {\n            data.should.be.deep.equal({ isNew: false, isChanged: false });\n            return _models.ActionUsages.findOne()\n                .lean()\n                .then(function(act) {\n                    act.created_at = act.created_at.toISOString()\n                    act.updated_at = act.updated_at.toISOString()\n                    delete act.triggers[0]._id\n                    delete act.activities[0]._id\n                    delete act._id\n                    delete act.uid\n                    act.should.be.deep.equal(mock_new_flow.enterprise.new_flow_analytics)\n                })\n        })\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d755b4e2-4cb5-493f-9245-ed3bf5be8526&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update analytic event for \&quot;existing flow\&quot; with \&quot;url_execution\&quot; set to \&quot;false\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Enterprise Should update analytic event for \&quot;existing flow\&quot; with \&quot;url_execution\&quot; set to \&quot;false\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.existing_flow).then(function() {\n    return activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.flow_without_trigger_webhook).then(function(data) {\n        data.should.be.deep.equal({ isNew: false, isChanged: true });\n        return _models.ActionUsages.findOne()\n            .lean()\n            .then(function(act) {\n                act.created_at = act.created_at.toISOString()\n                act.updated_at = act.updated_at.toISOString()\n                act.triggers = remove_id(act.triggers)\n                act.activities = remove_id(act.activities)\n                delete act._id\n                delete act.uid\n                act.should.be.deep.equal(mock_new_flow.enterprise.flow_without_trigger_webhook_analytics)\n            })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c89daf71-a446-4961-bbdc-992f30cfda67&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dad731cb-bb6c-4d9a-8d6f-f97bf585f8f8&quot;,&quot;f8db3682-945a-47da-b658-fafcade0fce1&quot;,&quot;d755b4e2-4cb5-493f-9245-ed3bf5be8526&quot;,&quot;c89daf71-a446-4961-bbdc-992f30cfda67&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bb89f875-892c-424a-a976-9efe6260bb90&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;847772c2-9586-4dba-9fff-0b0e8deadeca&quot;,&quot;title&quot;:&quot;Invoices&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7a458bcc-7319-4ffc-ab96-a1d245864499&quot;,&quot;title&quot;:&quot;invoice.downloadInvoice&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:192,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2bb7f76d-3372-471c-87fa-7ba5966429e3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf8d8653-052a-4a5b-946d-b770a6a33349&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get invoice by uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Should get invoice by uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5715,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.owner.braintree_customerId || \&quot;\&quot;,\n    uid: _data.owner.uid || \&quot;\&quot;\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            true.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6a3e79c-4df4-4344-8b89-2d4aca33629f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Admin should get organization invoice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Admin should get organization invoice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2640,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            true.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bf24abc6-f402-44f7-b3d7-6f6a88579ab1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Billing manager should get organization invoice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Billing manager should get organization invoice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2526,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            true.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7668b87-13de-4357-982b-85811345802a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Developer should not get organization invoice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Developer should not get organization invoice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:301,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.ORG_NO_ACCESS_TO_CHANGE_PLAN);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48024f90-31be-4700-a6b5-9fa48022ba2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get invoice by uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Should not get invoice by uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n//var paramURL = apiURL.replace(\&quot;:uid\&quot;, \&quot;ABC\&quot;);\nvar paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, \&quot;ABC\&quot;);\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.DOWNLOAD_INVOICE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e463af4-f00f-493d-8e2d-5f6047c03478&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, \&quot;ABC\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6ced2cba-ff41-4a9d-82ce-92709a7b99fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e6a3e79c-4df4-4344-8b89-2d4aca33629f&quot;,&quot;bf24abc6-f402-44f7-b3d7-6f6a88579ab1&quot;,&quot;c7668b87-13de-4357-982b-85811345802a&quot;,&quot;48024f90-31be-4700-a6b5-9fa48022ba2a&quot;,&quot;0e463af4-f00f-493d-8e2d-5f6047c03478&quot;,&quot;6ced2cba-ff41-4a9d-82ce-92709a7b99fc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:11228,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;05eea55a-3d1c-4d10-89fa-d952c634eac4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8dfadbda-901e-41ad-8fed-5940963d5b92&quot;,&quot;title&quot;:&quot;Invoices&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0e4407b7-c9a1-43c5-87f9-515d1298d945&quot;,&quot;title&quot;:&quot;invoice.list&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:175,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;abb76b53-7114-4c30-a7d3-764ef2fd2748&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33373b53-e06e-4e4e-847d-fa96b97aac50&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;db565bcc-30ee-41e6-b71b-350b2b17c494&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of invoices.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list Should get list of invoices.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:187,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.owner.braintree_customerId || \&quot;\&quot;,\n    uid: _data.owner.uid || \&quot;\&quot;\n}, function() {\n    api.get(apiURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = Array.isArray(res.body.output);\n                if (isValid) {\n                    _.each(res.body.output, function(item) {\n                        isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(item.__v) == \&quot;undefined\&quot;;\n                    });\n                }\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;373209f1-0fe2-4c0e-81a8-524d35d5b550&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of organization invoices by Admin.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list Should get list of organization invoices by Admin.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:249,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.get(apiURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = Array.isArray(res.body.output);\n                            if (isValid) {\n                                _.each(res.body.output, function(item) {\n                                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(item.__v) == \&quot;undefined\&quot;;\n                                });\n                            }\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4fd2b50a-abf4-492b-a8c1-345c41b6dda2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Billing manager should get organization invoice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list Billing manager should get organization invoice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:271,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.get(apiURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = Array.isArray(res.body.output);\n                            if (isValid) {\n                                _.each(res.body.output, function(item) {\n                                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(item.__v) == \&quot;undefined\&quot;;\n                                });\n                            }\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04f17ee5-9f47-49ad-acea-8b8304aa0db3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Developer should not get organization invoice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list Developer should not get organization invoice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:228,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.get(apiURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.ORG_NO_ACCESS_TO_CHANGE_PLAN);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6784b113-0d9f-4914-aa8d-d8257d9e9fee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7540bdae-8a52-45f0-b363-724448a585a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;373209f1-0fe2-4c0e-81a8-524d35d5b550&quot;,&quot;4fd2b50a-abf4-492b-a8c1-345c41b6dda2&quot;,&quot;04f17ee5-9f47-49ad-acea-8b8304aa0db3&quot;,&quot;6784b113-0d9f-4914-aa8d-d8257d9e9fee&quot;,&quot;7540bdae-8a52-45f0-b363-724448a585a6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:943,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9f5a8cc1-56e4-4d2a-973e-7eff44ad6f46&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c35eed0a-c358-4028-b060-9eb4354dd2d0&quot;,&quot;title&quot;:&quot;Invoices&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f6240cab-3322-47b4-8769-163f2c2beb32&quot;,&quot;title&quot;:&quot;invoice.searchByUid&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:171,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9ebd5e6-4c78-4b20-a714-c03306a0bd9f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;660a36a1-3768-4c7a-9cec-26de274b9a6c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get invoice by uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should get invoice by uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:215,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.owner.braintree_customerId || \&quot;\&quot;,\n    uid: _data.owner.uid || \&quot;\&quot;\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid == invoices[0].uid &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e3461f3-d669-43a3-a65b-bf1605f18c92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get invoice of organization by Admin.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should get invoice of organization by Admin.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:253,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid == invoices[0].uid &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b947f10-3145-42e3-89a9-2beea51844a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get invoice of organization by Billing Manager.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should get invoice of organization by Billing Manager.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:276,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid == invoices[0].uid &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;01b4d82d-8ce2-4660-8b2a-5bfb182e89a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get invoice of organization by Developer.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should get invoice of organization by Developer.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:238,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.ORG_NO_ACCESS_TO_CHANGE_PLAN);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82208aa6-fad6-4b1f-b88e-a7e6b6e8458d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get invoice by uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should not get invoice by uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n//var paramURL = apiURL.replace(\&quot;:uid\&quot;, \&quot;ABC\&quot;);\nvar paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, \&quot;ABC\&quot;);\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.INVOICE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b4e8672-47c5-49e4-9750-d42782739b21&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, \&quot;ABC\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2434d640-f6b9-4355-970e-6f5c325dff7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5e3461f3-d669-43a3-a65b-bf1605f18c92&quot;,&quot;0b947f10-3145-42e3-89a9-2beea51844a2&quot;,&quot;01b4d82d-8ce2-4660-8b2a-5bfb182e89a7&quot;,&quot;82208aa6-fad6-4b1f-b88e-a7e6b6e8458d&quot;,&quot;6b4e8672-47c5-49e4-9750-d42782739b21&quot;,&quot;2434d640-f6b9-4355-970e-6f5c325dff7f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1016,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2037982f-edbb-4370-b2db-405a8307ea72&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;428fa40b-c1b7-4910-ae8a-cb04451dbe42&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7896060d-683a-44c1-97ba-799ac1e468e6&quot;,&quot;title&quot;:&quot;logs.getOldLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs logs.getOldLogs \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5157,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            saveUserLogs({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                },\n                function(error, userLogs) {\n                    savedUserLogs = userLogs;\n                    done();\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;314a7f0b-430a-49f7-929a-e69fe2e34a81&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs logs.getOldLogs \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Log.remove({ flow_name: new RegExp(&#x27;^utest_cases_&#x27;, \&quot;i\&quot;) }, function(error, user) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;faefcce3-aa1a-40c0-9f02-d4a352335aa6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs logs.getOldLogs Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.objects.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b139b84d-1549-44b2-afae-e11674ffb44f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs logs.getOldLogs Should get limited list of user logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar skipLimitURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(skipLimitURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var validOutput = false;\n            if (res.body.output.count == 5) {\n                validOutput = res.body.output.objects[0].uid == savedUserLogs[2].body.output.uid &amp;&amp;\n                    res.body.output.objects[1].uid == savedUserLogs[1].body.output.uid;\n            }\n            if (validOutput == false) {\n                console.log({\n                    objects: res.body.output.objects,\n                    savedUserLogs: savedUserLogs\n                });\n                logger.error({\n                    objects: res.body.output.objects,\n                    savedUserLogs: savedUserLogs\n                });\n            }\n            validOutput.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e286c610-f2fb-4f1e-b947-b8c8ae4d9615&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs logs.getOldLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ed6b967-678b-457d-9c15-cd242bf400ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b139b84d-1549-44b2-afae-e11674ffb44f&quot;,&quot;e286c610-f2fb-4f1e-b947-b8c8ae4d9615&quot;,&quot;5ed6b967-678b-457d-9c15-cd242bf400ee&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:62,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e9cc3994-0f72-426e-9b3b-8561777a80f1&quot;,&quot;title&quot;:&quot;Express&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;82fb52ac-5878-4adf-8004-9c0cbdba68e9&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;debd4d03-26ab-44b1-9fc7-0d2939b1fb16&quot;,&quot;title&quot;:&quot;logs.getOldLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Express UserLogs logs.getOldLogs \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5153,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({\n        express: true\n    }, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            saveUserLogs({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                },\n                function(error, userLogs) {\n                    savedUserLogs = userLogs;\n                    done();\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b79786fd-03ba-4000-a098-2c233296eeb0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Express UserLogs logs.getOldLogs \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Log.remove({ flow_name: new RegExp(&#x27;^utest_cases_&#x27;, \&quot;i\&quot;) }, function(error, user) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79d7cdf5-2ae1-47b4-bc89-5f97dd200269&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Express UserLogs logs.getOldLogs Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.objects.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;950dc931-2a72-4932-b3df-453c41752e7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Express UserLogs logs.getOldLogs Should get limited list of user logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar skipLimitURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(skipLimitURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var validOutput = false;\n            if (res.body.output.count == 5) {\n                validOutput = res.body.output.objects[0].uid == savedUserLogs[2].body.output.uid &amp;&amp;\n                    res.body.output.objects[1].uid == savedUserLogs[1].body.output.uid;\n            }\n            if (validOutput == false) {\n                console.log({\n                    objects: res.body.output.objects,\n                    savedUserLogs: savedUserLogs\n                });\n                logger.error({\n                    objects: res.body.output.objects,\n                    savedUserLogs: savedUserLogs\n                });\n            }\n            validOutput.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b237d1ac-baf9-4eea-aab1-8c9475274884&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Express UserLogs logs.getOldLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f32df4d0-dfa2-416c-8a68-60333fef0cce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;950dc931-2a72-4932-b3df-453c41752e7f&quot;,&quot;b237d1ac-baf9-4eea-aab1-8c9475274884&quot;,&quot;f32df4d0-dfa2-416c-8a68-60333fef0cce&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:69,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d78038ba-8eae-483a-bbbf-0c0d66ddc56b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getCreditsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getCreditsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2ae9dee6-f0c4-465d-ae27-4ac56ba5319d&quot;,&quot;title&quot;:&quot;Metrics.GetCreditsMetrics&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getCreditsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getCreditsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:282,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.createFlowUser({}, function(error, user) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        cbk(null, user);\n                    }\n                });\n            });\n        },\n        function(user, cbk) {\n            dummyUser = user;\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: dummyUser.authtoken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b891e139-761e-4fb6-8360-c5c0b3f8dc25&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7c1c898-b644-4e79-a89b-6a18a48b5592&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c3a475c-4141-4662-b195-56c194666c7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of credit metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should get list of credit metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_credits&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5dd4f486-45c9-4d95-b55d-e3b7a3e8d07a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of credit metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should get list of credit metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_credits&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ba67013-7fd7-4409-8719-6d414c9812e8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0c3a475c-4141-4662-b195-56c194666c7e&quot;,&quot;5dd4f486-45c9-4d95-b55d-e3b7a3e8d07a&quot;,&quot;3ba67013-7fd7-4409-8719-6d414c9812e8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:77,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bdbe7f53-4972-4b55-8906-4fe9185d43b9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getCreditsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getCreditsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b8e5dc36-1734-4319-82c4-646dd03141dd&quot;,&quot;title&quot;:&quot;Metrics.GetCreditsMetrics&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getCreditsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getCreditsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:729,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.organizationRecordsEntry({}, function(data) {\n                    authToken = data.owner.authtoken;\n                    org_uid = data.organization.uid;\n                    cbk(null, data);\n                });\n            });\n        },\n        function(res, cbk) {\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: authToken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;094f50eb-a3ee-421b-bab8-52f432733616&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1489ef2a-49a6-4b5e-9763-7880d0fc857d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aeee4193-dea3-4051-835b-2d4ae8525159&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of credit metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should get list of credit metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_credits&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;671b741c-167e-4ca7-9818-eb2014b99cb0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of credit metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should get list of credit metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_credits&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84fe593e-a47d-418d-8f58-3b8f86f16533&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;aeee4193-dea3-4051-835b-2d4ae8525159&quot;,&quot;671b741c-167e-4ca7-9818-eb2014b99cb0&quot;,&quot;84fe593e-a47d-418d-8f58-3b8f86f16533&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:115,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;de50594b-242f-42ae-be6c-c7a6eb065082&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getFlowDetailsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowDetailsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0a1e8697-41c7-46e6-a5b7-970fc5e3e997&quot;,&quot;title&quot;:&quot;Metrics.GetFlowDetailsMetrics&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getFlowDetailsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowDetailsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetrics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:289,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.createFlowUser({}, function(error, user) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        authToken = user.authtoken;\n                        token = user.activation_token;\n                        _id = user._id;\n                        uid = user.uid;\n                        cbk(null, user);\n                    }\n                });\n            });\n        },\n        function(user, cbk) {\n            dummyUser = user;\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: dummyUser.authtoken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e5ad91c2-47f0-4106-b547-7210e4ab6ffb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetrics \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de4b9597-ae8c-4359-be6d-b57c49ec4e5e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetrics Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + flowUid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a794ca3c-6893-42b4-bb40-2b208ab5220f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow details metrics if valid flow uid provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetrics Should get list of flow details metrics if valid flow uid provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + flowUid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(_.keys(billBody));\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eacd0355-7ccf-47cc-90a8-3e68f224e101&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a794ca3c-6893-42b4-bb40-2b208ab5220f&quot;,&quot;eacd0355-7ccf-47cc-90a8-3e68f224e101&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:53,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1eac1a89-4acd-4179-a611-889e5d8df61c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getFlowDetailsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowDetailsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b46da2d7-913e-462c-ac09-637e1d6b2eff&quot;,&quot;title&quot;:&quot;Metrics.GetFlowDetailsMetricsOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getFlowDetailsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowDetailsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetricsOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:497,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.organizationRecordsEntry({}, function(data) {\n                    authToken = data.owner.authtoken;\n                    org_uid = data.organization.uid;\n                    cbk(null, data);\n                });\n            });\n        },\n        function(res, cbk) {\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: authToken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;681734e2-f51f-457a-b966-ddb1d5df7cb5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetricsOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3689395-1df5-4c9b-87e6-bf71da27c42e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetricsOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + flowUid)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b878f0f6-09c2-46cc-b8b5-1e60c1f7c044&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow details metrics if valid flow uid provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetricsOrg Should get list of flow details metrics if valid flow uid provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + flowUid)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(_.keys(billBody));\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;779425e6-7153-4589-b426-b9c0091dbeee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b878f0f6-09c2-46cc-b8b5-1e60c1f7c044&quot;,&quot;779425e6-7153-4589-b426-b9c0091dbeee&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;574bb989-cc6d-4295-ba7d-59e9f49ec0b5&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getFlowsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ca7b09e0-5568-4dac-80f7-f202acb5e923&quot;,&quot;title&quot;:&quot;Metrics.GetFlowsMetrics&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getFlowsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetrics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:296,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.createFlowUser({\n                    email: testData.testRegistrationBody.email\n                }, function(error, user) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        authToken = user.authtoken;\n                        token = user.activation_token;\n                        _id = user._id;\n                        uid = user.uid;\n                        cbk(null, user);\n                    }\n                });\n            });\n        },\n        function(user, cbk) {\n            authToken = user.authtoken;\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: authToken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf02116e-d347-405d-9ba0-60ee44d3d564&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetrics \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Bill.remove({}, function(err) {\n    done(err);\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18b01551-edea-44c1-86b1-1a037c9b8858&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetrics Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc0d667e-7d4b-48ed-95d5-8cfd70af059e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetrics Should get list of flow metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(keySet);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;68f7fe80-35fa-4cd0-9063-c53d91d3ee30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetrics Should get list of flow metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(keySet);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ddf05d56-41ad-4d95-9aa0-7bbafe198512&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bc0d667e-7d4b-48ed-95d5-8cfd70af059e&quot;,&quot;68f7fe80-35fa-4cd0-9063-c53d91d3ee30&quot;,&quot;ddf05d56-41ad-4d95-9aa0-7bbafe198512&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:72,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;63cdc618-3d8f-4fc2-8b8d-3cdfa0d277a3&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getFlowsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5d20d40e-cf2a-48d9-93a2-c6c6b3d9b0dc&quot;,&quot;title&quot;:&quot;Metrics.GetFlowsMetricsOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getFlowsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetricsOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:454,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        testCollection.organizationRemoveRecords({}, function() {\n            testCollection.organizationRecordsEntry({}, function(data) {\n                authToken = data.owner.authtoken;\n                org_uid = data.organization.uid;\n                cbk(null, data);\n            });\n        });\n    },\n    function(res, cbk) {\n        saveBillEntries(\n            _.extend(getImmutable(billBody), {\n                authtoken: authToken\n            }),\n            function(error, bills) {\n                savedBills = bills;\n                cbk(null, savedBills);\n            });\n    }\n], function(err, results) {\n    if (err) {\n        done(err);\n    } else {\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;263e5694-2d75-48f7-bc9c-abe39a0bd983&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetricsOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Bill.remove({}, function(err) {\n    done(err);\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a820b50f-0f82-48ea-a557-a0b03350ea06&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetricsOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7cadb640-fa94-46d0-a122-7e6b6e9df877&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetricsOrg Should get list of flow metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(keySet);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f08c4e01-97e6-4270-bd34-98f1dcb21a30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetricsOrg Should get list of flow metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(keySet);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f25ee4b-5eaa-481e-bf92-1e0d5d363399&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7cadb640-fa94-46d0-a122-7e6b6e9df877&quot;,&quot;f08c4e01-97e6-4270-bd34-98f1dcb21a30&quot;,&quot;2f25ee4b-5eaa-481e-bf92-1e0d5d363399&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:113,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1a599ac3-3bb0-40da-b66b-efb8086b79de&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getGraphData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getGraphData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2a541dbb-0159-4ec6-a229-c6723ba1fed0&quot;,&quot;title&quot;:&quot;Metrics.getGraphData&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getGraphData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getGraphData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4609,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            _models.User.remove({}, function(error, user) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(testData.testRegistrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        authToken = res.body.output.authtoken;\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                env_uid = res.body.output.env_uid;\n                                user_uid = res.body.output.uid;\n                                cbk(err, res);\n                            });\n                    });\n            });\n        },\n        function(res, cbk) {\n            saveBillEntries({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserTriggers({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserFlows({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, userFlows) {\n                    cbk(null, userFlows);\n                });\n        }\n    ], function(err, results) {\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8df16c4-66bb-4282-bc4f-1aefadd9da22&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;377136c3-ce10-41e2-bfed-d44ddc216c25&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd6278e8-9919-454f-a692-a970d503a18a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get type bill data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type bill data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill\&quot;;\napi.get(billURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6171e4a-bbad-444f-878f-f76ba4b6a8b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type bill data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=daily\&quot;;\napi.get(billURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36a4d6e2-ca19-45f7-98a9-31c9a3e8f549&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type bill data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=monthly\&quot;;\napi.get(billURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1b9e686-3082-46e2-9fd3-2bdaa3e861e8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on yearly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type bill data based on yearly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=weekly\&quot;;\napi.get(billURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d0c2b55-8179-4163-af0d-df9bb190f65d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type trigger data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger\&quot;;\napi.get(triggerURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d1e3e9f8-159c-4ea3-a3d4-5ccf95da4ba8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type trigger data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=daily\&quot;;\napi.get(triggerURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;307d7b0d-bfbd-4f9b-8209-f57be79018f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type trigger data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=monthly\&quot;;\napi.get(triggerURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;db3e280a-2fef-4180-9ce9-3c586304fad7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type trigger data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=weekly\&quot;;\napi.get(triggerURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e1982fea-8b0f-42be-b062-49c312011e1f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type flowscreated data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated\&quot;;\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a02ab756-7c9c-4741-8069-82c9ad9e8621&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type flowscreated data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=daily\&quot;;\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44468723-78b6-4362-b38c-a056a937165c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type flowscreated data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=monthly\&quot;;\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3046af02-1d7b-4db5-8ec4-16da1e7ad251&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type flowscreated data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=weekly\&quot;;\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7394eb51-65fc-4f28-9ca1-6da2d6b5da58&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type credits data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits\&quot;;\napi.get(creditURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate;\n            (res.body.output[0][0]).should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;639aae11-cee9-4683-9320-f957efd1bd0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type credits data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=daily\&quot;;\napi.get(creditURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate;\n            (res.body.output[0][0]).should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83472c42-f7d0-4a9c-b410-e663f5869d0d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type credits based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=monthly\&quot;;\napi.get(creditURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output[0][0] == currentMonthFormat;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a4a4aa95-6095-491d-abcd-2d984a2e1b8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type credits data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=weekly\&quot;;\napi.get(creditURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output[0][0].indexOf(\&quot;week\&quot;) == 0;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38f64166-bdaf-428d-ba4b-5fca167c77e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid type error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should give invalid type error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar fakeURL = apiURL + \&quot;?type=FAKE\&quot;;\napi.get(fakeURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.GRAPH_TYPE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88eb97e4-1c78-415c-836e-ba6f60650422&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32f70064-0528-4406-b7ca-37c927c2a72d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d6171e4a-bbad-444f-878f-f76ba4b6a8b3&quot;,&quot;36a4d6e2-ca19-45f7-98a9-31c9a3e8f549&quot;,&quot;c1b9e686-3082-46e2-9fd3-2bdaa3e861e8&quot;,&quot;5d0c2b55-8179-4163-af0d-df9bb190f65d&quot;,&quot;d1e3e9f8-159c-4ea3-a3d4-5ccf95da4ba8&quot;,&quot;307d7b0d-bfbd-4f9b-8209-f57be79018f1&quot;,&quot;db3e280a-2fef-4180-9ce9-3c586304fad7&quot;,&quot;e1982fea-8b0f-42be-b062-49c312011e1f&quot;,&quot;a02ab756-7c9c-4741-8069-82c9ad9e8621&quot;,&quot;44468723-78b6-4362-b38c-a056a937165c&quot;,&quot;3046af02-1d7b-4db5-8ec4-16da1e7ad251&quot;,&quot;7394eb51-65fc-4f28-9ca1-6da2d6b5da58&quot;,&quot;639aae11-cee9-4683-9320-f957efd1bd0c&quot;,&quot;83472c42-f7d0-4a9c-b410-e663f5869d0d&quot;,&quot;a4a4aa95-6095-491d-abcd-2d984a2e1b8f&quot;,&quot;38f64166-bdaf-428d-ba4b-5fca167c77e1&quot;,&quot;88eb97e4-1c78-415c-836e-ba6f60650422&quot;,&quot;32f70064-0528-4406-b7ca-37c927c2a72d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:791,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4dff3c19-7712-4cb0-80d3-d8a577748576&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getGraphDataOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getGraphDataOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;37ff8123-7bc5-4ad4-824d-61229dd43c69&quot;,&quot;title&quot;:&quot;Metrics.getGraphDataOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getGraphDataOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getGraphDataOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2783,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.organizationRecordsEntry({}, function(data) {\n                    authToken = data.owner.authtoken;\n                    org_uid = data.organization.uid;\n                    org_account_uid = data.organization_account.uid;\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(&#x27;org_uid&#x27;, org_uid)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            env_uid = res.body.output.env_uid;\n                            cbk(null, data);\n                        });\n                });\n            });\n        },\n        function(res, cbk) {\n            api.get(\&quot;/enterprise/v1/user\&quot;)\n                .set(&#x27;org_uid&#x27;, org_uid)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    env_uid = res.body.output.env_uid;\n                    cbk(err, res);\n                });\n        },\n        function(res, cbk) {\n            saveBillEntries({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserTriggers({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserFlows({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, userFlows) {\n                    cbk(null, userFlows);\n                });\n        }\n    ], function(err, results) {\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2276b013-003e-4d02-a939-658fb7400974&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38a6266c-af38-41ea-8165-fec996213e5f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;babea697-e8fc-4f13-a005-39ed33f58949&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get type bill data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type bill data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill\&quot;;\napi.get(billURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2aeaca8-4633-4edc-8b7c-3a095faa8c23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type bill data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=daily\&quot;;\napi.get(billURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d429bec7-fc9d-4489-a9d3-ef68665b860c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type bill data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=monthly\&quot;;\napi.get(billURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;15d0910a-41ad-4ec2-a0fd-bf3dc30603b6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on yearly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type bill data based on yearly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=weekly\&quot;;\napi.get(billURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;af0f06fa-7daf-4628-a623-bb7700a8e61d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type trigger data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger\&quot;;\napi.get(triggerURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab5f90c2-5078-4a77-bc1f-1d866ab153a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type trigger data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=daily\&quot;;\napi.get(triggerURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2805c551-1db9-4e31-b448-5b284bdb1114&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type trigger data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=monthly\&quot;;\napi.get(triggerURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38d8df16-5bc7-4a29-87e1-84ec94ffc520&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type trigger data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=weekly\&quot;;\napi.get(triggerURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3d50829-4f23-4f8e-a34c-af5be06e728a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type flowscreated data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated\&quot;;\napi.get(flowURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5a7765c-30fe-4efa-b6ef-89717e7a741b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type flowscreated data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=daily\&quot;;\napi.get(flowURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;171d3c8d-0399-45af-919e-a91c0fdeabbb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type flowscreated data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=monthly\&quot;;\napi.get(flowURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8ae24cd-f9c0-4d9e-9799-d560f7358750&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type flowscreated data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=weekly\&quot;;\napi.get(flowURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2620653a-62d0-4fae-8ad7-9f9ac1b2ee72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type credits data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits\&quot;;\napi.get(creditURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate;\n            (res.body.output[0][0]).should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;907f6da4-b9c4-407d-96d2-69ed40716f4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type credits data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=daily\&quot;;\napi.get(creditURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate;\n            (res.body.output[0][0]).should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e25b9fe-e47d-4c58-a86f-53f6554249b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type credits based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=monthly\&quot;;\napi.get(creditURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output[0][0] == currentMonthFormat;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6c12cbd-30ba-4acf-ac5f-42908c4298d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type credits data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=weekly\&quot;;\napi.get(creditURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output[0][0].indexOf(\&quot;week\&quot;) == 0;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e0e0142-d2a9-4348-8ae1-61ecc394c4a9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid type error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should give invalid type error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar fakeURL = apiURL + \&quot;?type=FAKE\&quot;;\napi.get(fakeURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.GRAPH_TYPE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e916a0e6-8e81-4368-b7f7-0f09a3cc024a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ac9c90c-213a-45d1-a6db-ac45f0143c4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a2aeaca8-4633-4edc-8b7c-3a095faa8c23&quot;,&quot;d429bec7-fc9d-4489-a9d3-ef68665b860c&quot;,&quot;15d0910a-41ad-4ec2-a0fd-bf3dc30603b6&quot;,&quot;af0f06fa-7daf-4628-a623-bb7700a8e61d&quot;,&quot;ab5f90c2-5078-4a77-bc1f-1d866ab153a5&quot;,&quot;2805c551-1db9-4e31-b448-5b284bdb1114&quot;,&quot;38d8df16-5bc7-4a29-87e1-84ec94ffc520&quot;,&quot;d3d50829-4f23-4f8e-a34c-af5be06e728a&quot;,&quot;a5a7765c-30fe-4efa-b6ef-89717e7a741b&quot;,&quot;171d3c8d-0399-45af-919e-a91c0fdeabbb&quot;,&quot;d8ae24cd-f9c0-4d9e-9799-d560f7358750&quot;,&quot;2620653a-62d0-4fae-8ad7-9f9ac1b2ee72&quot;,&quot;907f6da4-b9c4-407d-96d2-69ed40716f4d&quot;,&quot;4e25b9fe-e47d-4c58-a86f-53f6554249b7&quot;,&quot;e6c12cbd-30ba-4acf-ac5f-42908c4298d8&quot;,&quot;8e0e0142-d2a9-4348-8ae1-61ecc394c4a9&quot;,&quot;e916a0e6-8e81-4368-b7f7-0f09a3cc024a&quot;,&quot;4ac9c90c-213a-45d1-a6db-ac45f0143c4f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:920,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ee309c23-dde3-4483-aef9-942ee2b00260&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getTransactionMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getTransactionMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;da55d4b1-76b4-4bdc-938d-dd5b5543c7fb&quot;,&quot;title&quot;:&quot;Metrics.getTransactionMetrics&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getTransactionMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getTransactionMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetrics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:279,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.createFlowUser({\n                plan: \&quot;light_transaction\&quot;\n            }, function(error, user) {\n                if (error) {\n                    done(error);\n                } else {\n                    cbk(null, user);\n                }\n            });\n        },\n        function(user, cbk) {\n            dummyUser = user;\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: dummyUser.authToken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c28c27cb-77be-41ae-980b-1683225e3f93&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetrics \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b4ed6f0-9895-4a3f-b5e4-8168b02bcb70&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetrics Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac4fd2dd-255a-44e6-afd2-5ff6dca600f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of transactions metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetrics Should get list of transactions metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flag = Array.isArray(res.body.output);\n            var item = (_.first(res.body.output) || {});\n            (typeof(item[&#x27;total_transactions&#x27;]) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(item[&#x27;date&#x27;]) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0497d15d-4a72-4577-8317-d6ce9d5108c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of transactions metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetrics Should get list of transactions metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flag = Array.isArray(res.body.output);\n            var item = (_.first(res.body.output) || {});\n            (typeof(item[&#x27;total_transactions&#x27;]) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(item[&#x27;date&#x27;]) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23d2c1c3-22fa-4cd0-bb1c-c93be51d84bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ac4fd2dd-255a-44e6-afd2-5ff6dca600f7&quot;,&quot;0497d15d-4a72-4577-8317-d6ce9d5108c3&quot;,&quot;23d2c1c3-22fa-4cd0-bb1c-c93be51d84bb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:61,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;effc210c-7811-418a-8d28-4a2a982de9aa&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getTransactionMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getTransactionMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9b2097e5-2a2f-4c21-a9ec-80f9c9aff980&quot;,&quot;title&quot;:&quot;Metrics.getTransactionMetricsOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\metrics\\getTransactionMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getTransactionMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetricsOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:447,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.organizationRecordsEntry({}, function(data) {\n                    authToken = data.owner.authtoken;\n                    org_uid = data.organization.uid;\n                    cbk(null, data);\n                });\n            });\n        },\n        function(res, cbk) {\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: authToken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d65fe981-67bd-4f09-b3d6-f82bef394f1e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetricsOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0d49203d-0189-4afb-90e3-b8f2d7ec7eba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetricsOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ad6bd45-fef9-405c-b4f9-b58ab6e0a888&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of transactions metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetricsOrg Should get list of transactions metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_transactions&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;243c9c19-c70c-4cc1-8141-ab1db5f6ab56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of transactions metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetricsOrg Should get list of transactions metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_transactions&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29803977-4bd2-4dde-a64f-e2e309ef0239&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8ad6bd45-fef9-405c-b4f9-b58ab6e0a888&quot;,&quot;243c9c19-c70c-4cc1-8141-ab1db5f6ab56&quot;,&quot;29803977-4bd2-4dde-a64f-e2e309ef0239&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:104,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d937abc3-c0bf-4d24-9689-101a5dd1b1a8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;56f7abef-e354-4210-964f-a609d0f1f8a7&quot;,&quot;title&quot;:&quot;Oauth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;28e3fa79-63dd-4f92-b515-f385c15b6891&quot;,&quot;title&quot;:&quot;oauth.getList&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Oauth oauth.getList \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2996,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                    saveOAuth({\n                        authToken: authToken,\n                        userUid: _userUID\n                    }, function() {\n                        done();\n                    });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6a3d6bc-fae7-4cb2-a94a-234c13380f58&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Oauth oauth.getList \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bafc02e5-291b-46f5-b584-826c3a8a9bc2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Oauth oauth.getList \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb7bf3be-bcf9-4005-8d2c-e049a7779cc7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Oauth oauth.getList Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;402d48e5-46fa-4b01-a9ae-7be8fd5a1fdd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;402d48e5-46fa-4b01-a9ae-7be8fd5a1fdd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7fd84acd-7b78-4b2b-8a1c-0470150ac388&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fc271acc-cf72-4700-98d9-0019b7c219dd&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2d705ee0-4afa-4a7a-9d78-96ff8f6c26db&quot;,&quot;title&quot;:&quot;Organization.changePlan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:171,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a38b4c81-580c-4cf3-bb60-94a4ba19d3be&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aa694ebf-0635-4ec5-9ce4-b39d2b5c9493&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56c1537f-8d5c-4ffd-aa52-fa884026043e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should allowed to change organization plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should allowed to change organization plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:131,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_standard_paid\&quot;;\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(org_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c0560e8-c261-4688-8d83-b65afb6a8ec5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to change organization plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should not allowed to change organization plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_standard_paid\&quot;;\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23e17f49-2a54-4180-bcfe-fdc89338ccf3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to change organization plan to another paid plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should allowed to change organization plan to another paid plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:117,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_standard_paid\&quot;;\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(org_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b5119bcb-a0c4-436c-8d5c-af29019c15df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate organization change plan body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should validate organization change plan body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.plan.message == messageList.ORG_PLAN_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.ORG_NONCE_REQUIRED &amp;&amp;\n                res.body.error.billing_address1.message == messageList.ORG_BILLING_ADDR_REQUIRED &amp;&amp;\n                res.body.error.cardholderName.message == messageList.ORG_CARDHOLDER_NAME_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b660ec1a-ed84-481a-b47b-136f41191f17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to change organization plan by owner.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should allowed to change organization plan by owner.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:105,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_annual_standard\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(org_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;397878d3-d0bd-4d15-afd4-cd564471ed3d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to change organization plan by admin role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should allowed to change organization plan by admin role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:105,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_annual_standard\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(org_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06cba764-d052-4546-9bcf-898529be1f73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to change organization plan by Billing Manager role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should allowed to change organization plan by Billing Manager role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:113,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_annual_standard\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(org_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;724c4752-0a28-4548-ad87-2aa2bd2bf8cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to change organization plan by other role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should not allowed to change organization plan by other role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_annual_standard\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NO_ACCESS_TO_CHANGE_PLAN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea62f4d4-0c87-4ba7-ad33-96780e71ddcf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_annual_standard\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9dfd80e4-369f-4f13-bf09-bee774e87c30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1c0560e8-c261-4688-8d83-b65afb6a8ec5&quot;,&quot;23e17f49-2a54-4180-bcfe-fdc89338ccf3&quot;,&quot;b5119bcb-a0c4-436c-8d5c-af29019c15df&quot;,&quot;b660ec1a-ed84-481a-b47b-136f41191f17&quot;,&quot;397878d3-d0bd-4d15-afd4-cd564471ed3d&quot;,&quot;06cba764-d052-4546-9bcf-898529be1f73&quot;,&quot;724c4752-0a28-4548-ad87-2aa2bd2bf8cb&quot;,&quot;ea62f4d4-0c87-4ba7-ad33-96780e71ddcf&quot;,&quot;9dfd80e4-369f-4f13-bf09-bee774e87c30&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:660,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9aa18bd7-1964-4aef-a2f5-c513f0044afb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e86193de-2398-485d-8110-ba353266ba28&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9bbcb73b-cf37-461d-ac91-06e606e05b7f&quot;,&quot;title&quot;:&quot;Organization.checkOrgName&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0456239f-0a25-4947-b4a3-cf7ce691f528&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5d03c5f-9931-4725-9123-9a471ed6ed8e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;867d5983-2015-42ba-9b72-ea782746d4f1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should check org name is available or not.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should check org name is available or not.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;org_uid&#x27;: org_uid\n};\napi.post(apiURL)\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.allowed.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a4cd864b-a634-4af4-93c5-e4a9768d3834&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should check org name is available or not without passing org_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should check org name is available or not without passing org_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;\n};\napi.post(apiURL)\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.allowed.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5381f787-761d-4457-a605-92bc815bc3c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate organization details body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should validate organization details body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.name.message == messageList.ORG_NAME_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5347d8a3-4154-407b-a167-413cfa3ce585&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update same name in organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should update same name in organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org1&#x27;,\n    &#x27;org_uid&#x27;: org_uid\n};\napi.post(apiURL)\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.allowed.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd28f8a3-7969-4ae2-a4c1-eba8195c02bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give false for duplicate name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should give false for duplicate name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org2&#x27;,\n    &#x27;org_uid&#x27;: org_uid\n};\napi.post(apiURL)\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.allowed.should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1224cb7-be46-427e-8989-43c0c4b01027&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give false for same name if org_uid not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should give false for same name if org_uid not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org1&#x27;\n};\napi.post(apiURL)\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.allowed.should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2cbed2cd-bc45-46e5-bf98-de0957d18630&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;org_uid&#x27;: org_uid\n};\napi.post(apiURL)\n    .send(body)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3ae3441-bebb-484a-be46-4fb02bd3d7ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a4cd864b-a634-4af4-93c5-e4a9768d3834&quot;,&quot;5381f787-761d-4457-a605-92bc815bc3c4&quot;,&quot;5347d8a3-4154-407b-a167-413cfa3ce585&quot;,&quot;cd28f8a3-7969-4ae2-a4c1-eba8195c02bf&quot;,&quot;c1224cb7-be46-427e-8989-43c0c4b01027&quot;,&quot;2cbed2cd-bc45-46e5-bf98-de0957d18630&quot;,&quot;f3ae3441-bebb-484a-be46-4fb02bd3d7ca&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:159,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bbd43dd0-57a4-4aff-b736-c59a1b9c3fb9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;742392dd-cf2f-46f2-b829-b953bd550002&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;48477503-f5e5-48e4-8d8a-44a2f1097095&quot;,&quot;title&quot;:&quot;Organization.create&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2869,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nclearRecords(function() {\n    createOrgPlans(function() {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;572a3406-de69-46c3-b3be-3a8827ba61fe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;clearRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3390c30b-035c-45c6-b96b-fb5c35ec2e3f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32943b9e-d3e7-4df2-9601-92ce3fafdd1c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should create organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2646,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: res.body.output.org_account.uid\n            }).lean().exec(function(err, user) {\n                if (user) {\n                    var org_uid = res.body.output.uid;\n                    api.get(\&quot;/enterprise/v1/organizations/\&quot; + org_uid)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            res.body.output.uid.should.equal(org_uid);\n                            done();\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;111ca259-2be6-4c59-b628-249bbe26baf3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create organization with trial plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should create organization with trial plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2697,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_trial\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: res.body.output.org_account.uid\n            }).lean().exec(function(err, user) {\n                if (user) {\n                    var org_uid = res.body.output.uid;\n                    api.get(\&quot;/enterprise/v1/organizations/\&quot; + org_uid)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            (res.body.output.org_account.subscription.days == 30 &amp;&amp; typeof(res.body.output.org_account.subscription.start_date) != \&quot;undefined\&quot;).should.equal(true);\n                            done();\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9bb0f596-393b-40a1-90d3-5aa54a83e76b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create multiple organization with trial plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should create multiple organization with trial plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8626,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar createOrg = function(name, callback) {\n    var tempOrgBody = getImmutable(orgBody);\n    tempOrgBody.plan = \&quot;org_trial\&quot;;\n    tempOrgBody.name = name;\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(apiURL)\n        .send(tempOrgBody)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                _models.User.findOne({\n                    uid: res.body.output.org_account.uid\n                }).lean().exec(function(err, user) {\n                    if (user) {\n                        var org_uid = res.body.output.uid;\n                        api.get(\&quot;/enterprise/v1/organizations/\&quot; + org_uid)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                callback(err, res);\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                });\n            }\n        });\n};\ncreateOrg(\&quot;org1\&quot;, function(err, res) {\n    if (res.body.output.org_account.subscription.days == 30 &amp;&amp;\n        typeof(res.body.output.org_account.subscription.start_date) != \&quot;undefined\&quot;) {\n        createOrg(\&quot;org2\&quot;, function(err, res) {\n            if (res.body.output.org_account.subscription.days == 30 &amp;&amp;\n                typeof(res.body.output.org_account.subscription.start_date) != \&quot;undefined\&quot;) {\n                createOrg(\&quot;org3\&quot;, function(err, res) {\n                    if (res.body.output.org_account.subscription.days == 30 &amp;&amp;\n                        typeof(res.body.output.org_account.subscription.start_date) != \&quot;undefined\&quot;) {\n                        true.should.equal(true);\n                    } else {\n                        true.should.equal(false);\n                    }\n                    done();\n                })\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        })\n    } else {\n        true.should.equal(false);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45a8b055-6d8d-4a89-a2b5-645383694786&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not create duplicate entries.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should not create duplicate entries.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7143,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email\n});\nvar tempLoginBody = global.getImmutable(loginBody);\ntempLoginBody.email = tempRegistrationBody.email;\nvar newSignupUid = \&quot;\&quot;,\n    newUserAuthtoken = \&quot;\&quot;;\nvar doLogin = function(callback) {\n    commonMock.setSignUpMocks(httpmock, \&quot;express\&quot;);\n    commonMock.flowLogin(httpmock, \&quot;express\&quot;);\n    api.post(\&quot;/express/v1/login\&quot;)\n        .send(tempLoginBody)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/login\&quot;)\n                    .send(tempLoginBody)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            callback();\n                        }\n                    });\n            }\n        });\n};\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            newSignupUid = res.body.output.uid;\n            _models.User.findOneAndUpdate({\n                uid: newSignupUid\n            }, {\n                active: true\n            }, { new: true }, function(error, user) {\n                var tempLoginBody = global.getImmutable(loginBody);\n                tempLoginBody.email = tempRegistrationBody.email;\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/login\&quot;)\n                    .send(tempLoginBody)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            newUserAuthtoken = res.body.output.authtoken;\n                            doLogin(function() {\n                                doLogin(function() {\n                                    doLogin(function() {\n                                        doLogin(function() {\n                                            _models.User.find({\n                                                email: tempRegistrationBody.email\n                                            }, function(error, users) {\n                                                users.length.should.equal(2);\n                                                done();\n                                            });\n                                        });\n                                    });\n                                });\n                            });\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe143469-56a5-4ec1-b722-ae0733b9f263&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Default role should not be null.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Default role should not be null.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2810,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.default_project) {\n                _models.User.findOne({\n                    uid: res.body.output.org_account.uid\n                }).lean().exec(function(err, user) {\n                    if (user) {\n                        api.get(\&quot;/enterprise/v1/organizations/\&quot; + res.body.output.uid)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                true.should.equal(true);\n                                done();\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6105d491-9157-46d1-89ee-cabad1ce53ef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user record for owner.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should get user record for owner.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2828,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send({\n                    email: \&quot;test.user@raweng.com\&quot;,\n                    password: \&quot;Raw@1234\&quot;\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _models.User.findOne({\n                            uid: res.body.output.uid\n                        }).lean().exec(function(err, user) {\n                            (res.body.output.uid != \&quot;\&quot;).should.equal(true);\n                            done();\n                        });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e53bd3a-cb6a-4652-a241-96e13f1f1a61&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate organization body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should validate organization body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.name.message == messageList.ORG_NAME_REQUIRED &amp;&amp;\n                res.body.error.plan.message == messageList.ORG_PLAN_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.ORG_NONCE_REQUIRED &amp;&amp;\n                res.body.error.billing_address1.message == messageList.ORG_BILLING_ADDR_REQUIRED &amp;&amp;\n                res.body.error.cardholderName.message == messageList.ORG_CARDHOLDER_NAME_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;044775bb-1f04-437f-8ebe-71f0e79b4d04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create organization for paid plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should create organization for paid plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2737,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_standard_paid\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var company = res.body.output.org_account.company || \&quot;\&quot;;\n            if (company == tempOrgBody.company) {\n                _models.User.findOne({\n                    uid: res.body.output.org_account.uid\n                }).lean().exec(function(err, user) {\n                    (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                        user.plan[0].toString() == paidPlan._id.toString()).should.equal(true);\n                    done();\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57217390-c397-4dd7-b84c-0e38be245e20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;972a436e-6b23-486a-9028-bca3606ae763&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;111ca259-2be6-4c59-b628-249bbe26baf3&quot;,&quot;9bb0f596-393b-40a1-90d3-5aa54a83e76b&quot;,&quot;45a8b055-6d8d-4a89-a2b5-645383694786&quot;,&quot;fe143469-56a5-4ec1-b722-ae0733b9f263&quot;,&quot;6105d491-9157-46d1-89ee-cabad1ce53ef&quot;,&quot;3e53bd3a-cb6a-4652-a241-96e13f1f1a61&quot;,&quot;044775bb-1f04-437f-8ebe-71f0e79b4d04&quot;,&quot;57217390-c397-4dd7-b84c-0e38be245e20&quot;,&quot;972a436e-6b23-486a-9028-bca3606ae763&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29530,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3a1a5d62-fbb4-4902-925d-08cfe4005812&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;471c8437-7c78-46ab-9d19-43e099695820&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c3777154-7691-4931-b73e-5038ce44ee2d&quot;,&quot;title&quot;:&quot;Organization.disableSSO&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:169,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;726a657c-969a-425a-ab24-09f9f6f1bf72&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a34209fa-1e8a-4b3c-90f5-f16e6a062ad4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80324ee8-5824-4456-94c5-7b48cb4f127b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should enable SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO Should enable SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.public_cert == config.public_cert &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .send({})\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.enable_sso.should.equal(false);\n                            done();\n                        }\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8e94112-1034-4fad-975a-b0272da2abe8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should enable SSO by admin user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO Should enable SSO by admin user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.public_cert == config.public_cert &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .send({})\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.enable_sso.should.equal(false);\n                            done();\n                        }\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0f34298-273e-4119-970a-07c487f090be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not enable SSO by developer user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO Should not enable SSO by developer user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.public_cert == config.public_cert &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .send({})\n                    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n                            done();\n                        }\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8fea3c0a-a2ff-470c-a128-5ca72c8f49e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid config error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO Should give invalid config error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_SSO_CONFIG_INVALID);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3286fe9-8b94-4f99-a9c7-b2a347bc57a9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8bd66046-f965-455e-9a5f-19411eef0912&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e8e94112-1034-4fad-975a-b0272da2abe8&quot;,&quot;b0f34298-273e-4119-970a-07c487f090be&quot;,&quot;8fea3c0a-a2ff-470c-a128-5ca72c8f49e4&quot;,&quot;d3286fe9-8b94-4f99-a9c7-b2a347bc57a9&quot;,&quot;8bd66046-f965-455e-9a5f-19411eef0912&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:215,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;676d18cf-067e-4956-8e64-c16317c1fc63&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cbd0aa01-eb6e-4a91-b305-ca8e83cd8f00&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a6b290ff-1464-4417-9adc-057f1e103bfa&quot;,&quot;title&quot;:&quot;Organization.enableSSO&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:191,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b310ef8-b108-4c33-857d-1a0b423b5f4a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1323d0a4-8b6a-44e8-b0b0-9108b150f16a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5782680-7819-4174-a8d2-1458a6ca63ba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should enable SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO Should enable SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:242,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({})\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.enable_sso.should.equal(true);\n                                    done();\n                                }\n                            });\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e302c34-ce21-43f3-b166-277ac4ca5f5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should enable SSO by admin user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO Should enable SSO by admin user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:208,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({})\n                            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.enable_sso.should.equal(true);\n                                    done();\n                                }\n                            });\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6a4150cf-36e1-403c-8f92-12d3330e2cdc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not enable SSO by developer user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO Should not enable SSO by developer user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.public_cert == config.public_cert &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({})\n                            .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n                                    done();\n                                }\n                            });\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95035504-ee12-457a-8edc-01ccdac6aa1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid config error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO Should give invalid config error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_SSO_CONFIG_INVALID);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5dddbb81-f677-48d4-986b-61d1da3ab0b2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1145d761-cd46-42fe-809e-cbab6e488b2f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8e302c34-ce21-43f3-b166-277ac4ca5f5d&quot;,&quot;6a4150cf-36e1-403c-8f92-12d3330e2cdc&quot;,&quot;95035504-ee12-457a-8edc-01ccdac6aa1d&quot;,&quot;5dddbb81-f677-48d4-986b-61d1da3ab0b2&quot;,&quot;1145d761-cd46-42fe-809e-cbab6e488b2f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:542,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;fe50de3e-6f60-4a35-9a8b-65e926c447c2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9328278d-bfe1-47c8-bba0-bfb8519ceb29&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9fda16a7-065f-4470-ab26-726c43b088ac&quot;,&quot;title&quot;:&quot;Organization.getCerts&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:175,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6fca0d02-2066-4e12-b01f-d67758d98e9a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4d1828e-4255-4dc5-af8c-8c8d5b9cfeda&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc6aa0cd-387e-4c59-b53f-bf4d8f8cf3af&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get public SSO cert.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts Should get public SSO cert.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:139,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid) + \&quot;?authtoken=\&quot; + authToken)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            if (isValid) {\n                api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;) + \&quot;?authtoken=\&quot; + authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;92160c50-c9a5-4ec1-8158-e12204388238&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get private SSO cert.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts Should get private SSO cert.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:129,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            if (isValid) {\n                api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;private\&quot;) + \&quot;?authtoken=\&quot; + authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a822bbde-6a80-4d98-a9a8-ce011a7f63df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get SSO certs by Developer.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts Should not get SSO certs by Developer.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;))\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20b45dab-4a83-45ec-9fcd-9d1063e438cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives invalid file type errors for both files.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts Should gives invalid file type errors for both files.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public1\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.message == messageList.ORG_INVALID_CERT_TYPE;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc2fd357-3137-4af4-bf29-bf4e78522005&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a379ba3-8d10-452e-a951-8d84c19e23e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;92160c50-c9a5-4ec1-8158-e12204388238&quot;,&quot;a822bbde-6a80-4d98-a9a8-ce011a7f63df&quot;,&quot;20b45dab-4a83-45ec-9fcd-9d1063e438cb&quot;,&quot;fc2fd357-3137-4af4-bf29-bf4e78522005&quot;,&quot;8a379ba3-8d10-452e-a951-8d84c19e23e1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:334,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;50d82423-316a-46f3-baee-488428a097f6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5365f500-5942-499a-9e24-df49f1d65af8&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c38a49d5-091f-496f-bfcd-83d2d1ab28b4&quot;,&quot;title&quot;:&quot;Organization.getDetails&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:169,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        org_user_uid = data.organization.user_uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2e254da-5a86-4079-94d5-9356ef5d2889&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b2d91a9-63ae-4a00-88b8-0e08ad066563&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1da6e1fc-8998-4da8-a98b-16b6553fabc1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails Should get organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.uid) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.name) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.avatar) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.enable_sso) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.org_account) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.default_env) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.default_project) != \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a41e055-5497-4665-a758-a9b9423d5ebe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails Should not get organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ uid: org_user_uid }, function() {\n    api.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.NOT_FOUND)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_USER_NOT_FOUND);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f07936b5-295d-43c4-be6d-5a00607189f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8c37347-8c5c-4e77-80d3-2d777420ccf9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7be84c1-2d3a-445d-a34e-c184f954262f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3a41e055-5497-4665-a758-a9b9423d5ebe&quot;,&quot;f07936b5-295d-43c4-be6d-5a00607189f7&quot;,&quot;b8c37347-8c5c-4e77-80d3-2d777420ccf9&quot;,&quot;e7be84c1-2d3a-445d-a34e-c184f954262f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:104,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8d3a3419-ffe3-4bfd-bdba-64d6e61a2eda&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;baa46e75-ba01-4774-ad34-146f31719f47&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ba4742ae-f3b5-47f7-adec-09a89ad70161&quot;,&quot;title&quot;:&quot;Organization.getOrgMetadata&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getOrgMetadata \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:183,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        org_name = data.organization.name;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2fd13815-c0d9-4936-ae33-38dbb42206c3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getOrgMetadata \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b465878-4594-4dc3-82c0-be8fdaeaebd2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getOrgMetadata \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f082956-95f3-4e88-80f6-9577c5d679fd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get org metadata.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getOrgMetadata Should get org metadata.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:415,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({})\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    api.get(apiURL.replace(\&quot;:org_name\&quot;, org_name))\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (res.text.indexOf(&#x27;&lt;?xml version=\&quot;1.0\&quot;?&gt;&#x27;) == 0).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86ea9108-777a-45dd-8068-b0fede137eb6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;86ea9108-777a-45dd-8068-b0fede137eb6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:415,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d3ffb0b5-03a0-4bbe-a792-cf3c7abc3dee&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6533bd2b-5b4a-4a55-b470-280fab653473&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a2f406ab-ba4c-4f0f-8f48-b359ed2a1e38&quot;,&quot;title&quot;:&quot;OrganizationUser.getOrgSSOInfo&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.getOrgSSOInfo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:204,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78f5e59b-7f5c-42b1-81e3-bda34206fcbb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.getOrgSSOInfo \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39fd1ff0-7686-4989-a9e5-3c64eff23ef9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should redirect user to SSO login page.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.getOrgSSOInfo Should redirect user to SSO login page.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:252,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var url = \&quot;https://dev-528399.oktapreview.com/app/builtiodev528399_oktasp1_1/exkbbi8vwj2OsHjbE0h7/sso/saml?SAMLRequest=\&quot;;\n                                    (res.headers.location.indexOf(ssoConfig.entry_point) == 0).should.equal(true);\n                                    done();\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9af39aa-aaca-4b5f-a173-29ce59654dd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c9af39aa-aaca-4b5f-a173-29ce59654dd3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:252,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dedfdcb9-7d94-4f90-bfdc-f6e08004086d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1eb46c04-eb3c-429e-b410-048eb0219f32&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;39ca889f-cdcc-468d-a756-abf9539c1ffb&quot;,&quot;title&quot;:&quot;Organization.invitationAccept&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:168,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81ca343d-14db-4659-856b-edf27ba9f1f9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17d6d3c7-05c1-46d1-a6fc-85e3741facb0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f0eeb9f-b905-4388-ad9f-95e2c3eb6dfd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should accept invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept Should accept invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2978,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    var newUserAuthtoken = res.body.output.authtoken;\n                    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                        .send({})\n                        .set(&#x27;authtoken&#x27;, newUserAuthtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_ACCEPTED) {\n                                api.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                    .set(&#x27;authtoken&#x27;, newUserAuthtoken)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        res.body.output.org_account.email.should.equal(email);\n                                        done();\n                                    });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f7e3403a-1cea-4157-83ec-e56636e0392f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invitation not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept Should give error as invitation not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2717,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    var userAuthtoken = res.body.output.authtoken;\n                    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                        .send({})\n                        .set(&#x27;authtoken&#x27;, userAuthtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_ACCEPTED) {\n                                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                    .send({})\n                                    .set(&#x27;authtoken&#x27;, userAuthtoken)\n                                    .expect(httpStatus.BAD_REQUEST)\n                                    .end(function(err, res) {\n                                        res.body.error.message.should.equal(messageList.ORG_OWNERSHIP_INVITATION_NOT_FOUND);\n                                        done();\n                                    });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;410ace6b-8481-4ebb-bde6-663f7cef4411&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should accept invitation by new SSO user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept Should accept invitation by new SSO user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7093,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;amber.more@raweng.com\&quot;;\nvar _ssoConfig = getImmutable(ssoConfig);\nvar firstOwnerAuthtoken = _.first(_data.owner.authtoken);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({\n                                \&quot;email\&quot;: email\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                                        api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                            .expect(httpStatus.MOVED_TEMPORARILY)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                                        var data = usersData.SMALRespWithoutAuthtoken;\n                                                        api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                                                            .send(data)\n                                                            .expect(httpStatus.MOVED_TEMPORARILY)\n                                                            .end(function(err, res) {\n                                                                if (err) {\n                                                                    done(err);\n                                                                } else {\n                                                                    var qs = querystring.parse(res.headers.location);\n                                                                    var newUserAuthToken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                                    api.get(\&quot;/enterprise/v1/organizations/\&quot; + _data.organization.uid)\n                                                                        .set(&#x27;authtoken&#x27;, newUserAuthToken)\n                                                                        .expect(httpStatus.OK)\n                                                                        .end(function(err, res) {\n                                                                            if (err) {\n                                                                                done(err);\n                                                                            } else {\n                                                                                var isValid = typeof(res.body.output.owner_invitation) != \&quot;undefined\&quot;;\n                                                                                if (isValid) {\n                                                                                    _.each(res.body.output.organizations, function(orgItem) {\n                                                                                        isValid = isValid &amp;&amp;\n                                                                                            typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                            typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                            typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                            typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                            typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                                    });\n                                                                                    if (isValid) {\n                                                                                        api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                                                                            .send({})\n                                                                                            .set(&#x27;authtoken&#x27;, newUserAuthToken)\n                                                                                            .expect(httpStatus.OK)\n                                                                                            .end(function(err, res) {\n                                                                                                if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_ACCEPTED) {\n                                                                                                    api.get(\&quot;/enterprise/v1/organizations/\&quot; + _data.organization.uid)\n                                                                                                        .set(&#x27;authtoken&#x27;, newUserAuthToken)\n                                                                                                        .expect(httpStatus.OK)\n                                                                                                        .end(function(err, res) {\n                                                                                                            if (err) {\n                                                                                                                done(err);\n                                                                                                            } else {\n                                                                                                                if (typeof(res.body.output.owner_invitation) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                                                    res.body.output.is_owner &amp;&amp; res.body.output.is_admin &amp;&amp;\n                                                                                                                    res.body.output.is_developer) {\n                                                                                                                    true.should.equal(true);\n                                                                                                                    done();\n                                                                                                                } else {\n                                                                                                                    false.should.equal(true);\n                                                                                                                    done();\n                                                                                                                }\n                                                                                                            }\n                                                                                                        });\n                                                                                                } else {\n                                                                                                    false.should.equal(true);\n                                                                                                    done();\n                                                                                                }\n                                                                                            });\n                                                                                    } else {\n                                                                                        false.should.equal(true);\n                                                                                        done();\n                                                                                    }\n                                                                                } else {\n                                                                                    false.should.equal(true);\n                                                                                    done();\n                                                                                }\n                                                                            }\n                                                                        });\n                                                                }\n                                                            });\n                                                    } else {\n                                                        true.should.equal(false);\n                                                        done();\n                                                    }\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                        done();\n                                    }\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0ab2942e-404f-4b9d-87a9-466ae322b810&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as organization not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept Should give error as organization not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6e90c2b-8448-47b0-9418-ea4a9087f271&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6163797c-18b8-4e5b-bdc0-f52781645905&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f7e3403a-1cea-4157-83ec-e56636e0392f&quot;,&quot;410ace6b-8481-4ebb-bde6-663f7cef4411&quot;,&quot;0ab2942e-404f-4b9d-87a9-466ae322b810&quot;,&quot;d6e90c2b-8448-47b0-9418-ea4a9087f271&quot;,&quot;6163797c-18b8-4e5b-bdc0-f52781645905&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:12816,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;56e969c7-d8f5-4b0b-81a6-48c5ce4f8266&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f1cfa758-0201-4cdb-9de9-d7f0318c1132&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c38ea846-144e-42cf-902e-e31d23914ca0&quot;,&quot;title&quot;:&quot;Organization.invitationReject&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:178,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6826cc6d-6655-483f-9828-0888eb5b46fe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c4ceaaea-3ace-4a97-a5f1-3377614fc1f8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7214cb42-c1db-4893-acbe-882ac583d339&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should accept invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject Should accept invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2845,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                        .send({})\n                        .set(&#x27;authtoken&#x27;, res.body.output.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            res.body.output.message.should.equal(messageList.ORG_OWNERSHIP_INVITATION_REJECTED);\n                            done();\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;499d5d4a-1645-406d-a6c9-561a9ca750e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invitation not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject Should give error as invitation not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2741,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    var userAuthtoken = res.body.output.authtoken;\n                    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                        .send({})\n                        .set(&#x27;authtoken&#x27;, userAuthtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_REJECTED) {\n                                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                    .send({})\n                                    .set(&#x27;authtoken&#x27;, userAuthtoken)\n                                    .expect(httpStatus.BAD_REQUEST)\n                                    .end(function(err, res) {\n                                        res.body.error.message.should.equal(messageList.ORG_OWNERSHIP_INVITATION_NOT_FOUND);\n                                        done();\n                                    });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c6032840-313d-426f-9d49-23c64829debb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as organization not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject Should give error as organization not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;446d6c19-e5c4-4fd0-b8ed-d5494bd85c2d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8094592a-d9d0-46b6-adf6-f27d76308453&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;499d5d4a-1645-406d-a6c9-561a9ca750e1&quot;,&quot;c6032840-313d-426f-9d49-23c64829debb&quot;,&quot;446d6c19-e5c4-4fd0-b8ed-d5494bd85c2d&quot;,&quot;8094592a-d9d0-46b6-adf6-f27d76308453&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5612,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5a658339-2f67-400c-bf8f-c66f373586b8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;195ef3be-c15a-43c5-846b-38aa5ebde0cf&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4d2fddfd-b8a7-4af2-87eb-bea9efd6187c&quot;,&quot;title&quot;:&quot;Organization.invite&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:181,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ebac556c-df81-48f8-9a2b-52a30641263c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84b79086-f3ca-48fb-a469-aa4decca3823&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;638cd074-faff-4038-9fba-df9f03fe8fab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should send invitation to existing flow user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to existing flow user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2746,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nsignUpUser({\n    done: done,\n    email: email\n}, function(res) {\n    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles[\&quot;Developer\&quot;].uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    _models.OrganizationUser.findOne({\n                        email: email,\n                        org_uid: org_uid,\n                        deleted_at: null\n                    }, function(err, orgUser) {\n                        (typeof(orgUser) != \&quot;undefined\&quot;).should.equal(true);\n                        done();\n                    });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb73f850-d0c8-4d4f-8ee7-d474fa4c9233&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should only invite allowed count users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should only invite allowed count users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2967,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nsignUpUser({\n    done: done,\n    email: email\n}, function(res) {\n    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles[\&quot;Developer\&quot;].uid],\n            \&quot;emails\&quot;: [email, \&quot;test.user+1@raweng.com\&quot;, \&quot;test.user+1@rawenG.com\&quot;, \&quot;test.user+2@raweng.com\&quot;,\n                \&quot;test.user+3@raweng.com\&quot;, \&quot;test.user+4@raweng.com\&quot;, \&quot;test.user+5@raweng.com\&quot;,\n                \&quot;test.user+6@raweng.com\&quot;, \&quot;test.user+7@raweng.com\&quot;\n            ]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var error_message = messageList.ORG_USER_MAX_LIMIT_REACHED;\n                error_message = error_message.replace(\&quot;%%USER_COUNT%%\&quot;, 10);\n                res.body.error.message.should.equal(error_message);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;63c99b8a-e2d0-425d-8733-c0a7912d9b36&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list projects of current organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should list projects of current organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2814,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.name = \&quot;Org3\&quot;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/organizations\&quot;)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var org3 = res.body.output;\n            var new_org_uid = org3.uid;\n            var admin_authtoken = _data.admin.authtoken;\n            var role = getImmutable(roleBody);\n            role.name = \&quot;role5\&quot;;\n            role.projects = [];\n            api.post(\&quot;/enterprise/v1/organizations/:org_uid/role\&quot;.replace(\&quot;:org_uid\&quot;, new_org_uid))\n                .send(role)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var orgRole = res.body.output;\n                        api.post(apiURL.replace(\&quot;:org_uid\&quot;, new_org_uid))\n                            .send({\n                                \&quot;org_roles\&quot;: [orgRole.uid],\n                                \&quot;emails\&quot;: [_data.admin.email]\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    api.get(\&quot;/enterprise/v1/projects\&quot;)\n                                        .set(&#x27;org_uid&#x27;, new_org_uid)\n                                        .set(&#x27;authtoken&#x27;, admin_authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = true;\n                                                _.each(res.body.output.projects, function(proj) {\n                                                    if (proj.org_uid != new_org_uid) {\n                                                        isValid = false;\n                                                    }\n                                                });\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f256790f-58b2-4cbd-9ee1-0cfb899fd13b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not send invitation to existing organization user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should not send invitation to existing organization user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = _data.developer.email;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.roles[\&quot;Developer\&quot;].uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                _models.OrganizationUser.find({\n                    email: email,\n                    org_uid: org_uid,\n                    deleted_at: null\n                }, function(err, orgUsers) {\n                    (orgUsers.length == 1).should.equal(true);\n                    done();\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0bed8c75-5b69-45c0-b410-6078f94f44b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send invitation to delete user from organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to delete user from organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2809,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar user_uid = \&quot;\&quot;;\nvar email = _data.developer.email;\nvar inviteUser = function(callback) {\n    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles.Developer.uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    var tempLoginBody = getImmutable(loginBody);\n                    tempLoginBody.email = email;\n                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                        .send(tempLoginBody)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var userAuthToken = res.body.output.authtoken;\n                                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, userAuthToken)\n                                    .set(&#x27;org_uid&#x27;, org_uid)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            user_uid = res.body.output.uid;\n                                            _models.OrganizationUser.findOne({\n                                                user_uid: user_uid,\n                                                org_uid: org_uid,\n                                                deleted_at: null\n                                            }).lean().exec(function(err, orgUser) {\n                                                callback(err, orgUser);\n                                            });\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\n\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid\&quot;\n            .replace(\&quot;:org_uid\&quot;, org_uid)\n            .replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_USER_DELETED_SUCCESS) {\n                    inviteUser(function(error, orgUser) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            (orgUser.uid != \&quot;\&quot; &amp;&amp;\n                                orgUser.user_uid == user_uid &amp;&amp;\n                                orgUser.invitation == null &amp;&amp;\n                                orgUser.org_uid == org_uid\n                            ).should.equal(true);\n                            done();\n                        }\n                    });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d003b27f-45e1-468f-81ea-cd18dddd4924&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b7ccde7-a80c-4578-a421-0e2cab626ce5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send invitation to existing multiple flow users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to existing multiple flow users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5275,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nsignUpUser({\n    done: done,\n    email: email\n}, function(res) {\n    var email = \&quot;test.user+2@raweng.com\&quot;;\n    signUpUser({\n        done: done,\n        email: email\n    }, function(res) {\n        api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n            .send({\n                \&quot;org_roles\&quot;: [_data.developer.uid],\n                \&quot;emails\&quot;: [\&quot;test.user+1@raweng.com\&quot;, \&quot;test.user+2@raweng.com\&quot;]\n            })\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.message.should.equal(messageList.ORG_INVITATION_SEND);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c25c1f5d-4864-4893-9de1-21d705a09db9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate invitation body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should validate invitation body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.emails.message == messageList.ORG_INVITEE_EMAIL_SET_REQUIRED &amp;&amp;\n                res.body.error.org_roles.message == messageList.ORG_ROLE_SET_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79d34cee-31d8-44e8-a057-3919a3caf57a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate email set.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should validate email set.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [\&quot;test.user+1@raweng.com\&quot;, \&quot;\&quot;]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.emails.message == messageList.ORG_INVITEE_EMAIL_SET_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;70480fac-ba16-49ad-ac3c-ade40c2212f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send invitation to new flow user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to new flow user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2638,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    var userAuthToken = res.body.output.authtoken;\n                    commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(&#x27;authtoken&#x27;, userAuthToken)\n                        .set(&#x27;org_uid&#x27;, org_uid)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                    res.body.output.org_uid == org_uid;\n                                isValid.should.equal(true);\n                                done();\n                            }\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d6adb22-43ab-4e33-8539-7a701421b63e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give admin role required error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should give admin role required error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [\&quot;test.user+2@raweng.com\&quot;]\n    })\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e1359e7a-106e-4058-9894-b86acbc7ba73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send invitation to existing google user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to existing google user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2835,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1000@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: email,\n    access_token: plus1000User.access_token\n});\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n    email: email\n});\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(plus1000User)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                .send({\n                    \&quot;org_roles\&quot;: [_data.developer.uid],\n                    \&quot;emails\&quot;: [email]\n                })\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n                                email: email\n                            });\n                            api.post(\&quot;/enterprise/v1/login/google\&quot;)\n                                .send(plus1000User)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                        if (isValid) {\n                                            var userAuthToken = res.body.output.authtoken;\n                                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                                            api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                .set(&#x27;authtoken&#x27;, userAuthToken)\n                                                .set(&#x27;org_uid&#x27;, org_uid)\n                                                .expect(httpStatus.OK)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                            res.body.output.org_uid == org_uid;\n                                                        isValid.should.equal(true);\n                                                        done();\n                                                    }\n                                                });\n                                        } else {\n                                            true.should.equal(false);\n                                            done();\n                                        }\n                                    }\n                                });\n                        } else {\n                            true.should.equal(false);\n                            done();\n                        }\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83f4d0ff-de0b-4e2c-9087-77e2ca94f316&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send invitation to new google user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to new google user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2947,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1000@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                    email: email,\n                    access_token: plus1000User.access_token\n                });\n                commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n                    email: email\n                });\n                api.post(\&quot;/enterprise/v1/login/google\&quot;)\n                    .send(plus1000User)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                            if (isValid) {\n                                var userAuthToken = res.body.output.authtoken;\n                                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, userAuthToken)\n                                    .set(&#x27;org_uid&#x27;, org_uid)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                res.body.output.org_uid == org_uid;\n                                            isValid.should.equal(true);\n                                            done();\n                                        }\n                                    });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e14d816c-72a4-4430-a5c3-f08f744f71dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization plan for login user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should get organization plan for login user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2822,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+03@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                var tempLoginBody = getImmutable(loginBody);\n                tempLoginBody.email = email;\n                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/login\&quot;)\n                    .send(tempLoginBody)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var userAuthToken = res.body.output.authtoken;\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(\&quot;/enterprise/v1/user\&quot;)\n                                .set(&#x27;authtoken&#x27;, userAuthToken)\n                                .set(&#x27;org_uid&#x27;, org_uid)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                            typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                            typeof(res.body.output.user_plan) != \&quot;undefined\&quot; &amp;&amp;\n                                            res.body.output.org_uid == org_uid;\n                                        isValid.should.equal(true);\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;121e1a61-ddf1-4cf7-a8b4-8137d4d57940&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df34c128-1349-45fa-ba4b-b502508ca459&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fb73f850-d0c8-4d4f-8ee7-d474fa4c9233&quot;,&quot;63c99b8a-e2d0-425d-8733-c0a7912d9b36&quot;,&quot;f256790f-58b2-4cbd-9ee1-0cfb899fd13b&quot;,&quot;0bed8c75-5b69-45c0-b410-6078f94f44b4&quot;,&quot;d003b27f-45e1-468f-81ea-cd18dddd4924&quot;,&quot;9b7ccde7-a80c-4578-a421-0e2cab626ce5&quot;,&quot;c25c1f5d-4864-4893-9de1-21d705a09db9&quot;,&quot;79d34cee-31d8-44e8-a057-3919a3caf57a&quot;,&quot;70480fac-ba16-49ad-ac3c-ade40c2212f4&quot;,&quot;1d6adb22-43ab-4e33-8539-7a701421b63e&quot;,&quot;e1359e7a-106e-4058-9894-b86acbc7ba73&quot;,&quot;83f4d0ff-de0b-4e2c-9087-77e2ca94f316&quot;,&quot;e14d816c-72a4-4430-a5c3-f08f744f71dc&quot;,&quot;121e1a61-ddf1-4cf7-a8b4-8137d4d57940&quot;,&quot;df34c128-1349-45fa-ba4b-b502508ca459&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28016,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6a9889ef-39ec-4a22-9f98-5d394bbe094d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0377e3be-b337-4ce3-99b2-b6d128e1edef&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7cd6635a-b6df-473d-94f6-3129b620ab15&quot;,&quot;title&quot;:&quot;OrganizationUser.processSSOLogin&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:367,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        _data = data;\n        org_uid = _data.organization.uid;\n        authToken = data.owner.authtoken;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed01b328-b9ad-41d9-b92d-99301f96a3ca&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;07e9aeff-ab61-4915-81b4-fc2b0cc1ba51&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should allowed owner without SSO login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should allowed owner without SSO login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:159,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                            if (isValid) {\n                                _.each(res.body.output.organizations, function(orgItem) {\n                                    isValid = isValid &amp;&amp;\n                                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                });\n                                isValid.should.equal(true);\n                                done();\n                            } else {\n                                false.should.equal(true);\n                                done();\n                            }\n                        }\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;edd70dd2-8a6a-423e-8192-9da68f2ebb7b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should works without relaystate.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should works without relaystate.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:511,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                            var data = getImmutable(usersData.SMALRespWithoutAuthtoken);\n                                            delete data.RelayState;\n                                            api.post(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                                .send(data)\n                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        var qs = querystring.parse(res.headers.location);\n                                                        var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                        var _config = config;\n                                                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                            .set({ &#x27;authtoken&#x27;: authtoken, org_uid: _data.organization.uid })\n                                                            .expect(httpStatus.OK)\n                                                            .end(function(err, res) {\n                                                                if (err) {\n                                                                    done(err);\n                                                                } else {\n                                                                    var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                        typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                        typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                                    if (isValid) {\n                                                                        _.each(res.body.output.organizations, function(orgItem) {\n                                                                            isValid = isValid &amp;&amp;\n                                                                                typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                        });\n                                                                        isValid.should.equal(true);\n                                                                        done();\n                                                                    } else {\n                                                                        false.should.equal(true);\n                                                                        done();\n                                                                    }\n                                                                }\n                                                            });\n                                                    }\n                                                });\n                                        } else {\n                                            true.should.equal(false);\n                                            done();\n                                        }\n                                    }\n                                });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;298e2ab9-018c-4bc1-b8e2-ac69a6ca2f98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login admin user with SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should login admin user with SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:563,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                            var data = usersData.SMALRespWithoutAuthtoken;\n                                            api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                                                .send(data)\n                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        var qs = querystring.parse(res.headers.location);\n                                                        var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                            .set(&#x27;authtoken&#x27;, authtoken)\n                                                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                                            .expect(httpStatus.OK)\n                                                            .end(function(err, res) {\n                                                                if (err) {\n                                                                    done(err);\n                                                                } else {\n                                                                    var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                        typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                        typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                                    if (isValid) {\n                                                                        _.each(res.body.output.organizations, function(orgItem) {\n                                                                            isValid = isValid &amp;&amp;\n                                                                                typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                        });\n                                                                        isValid.should.equal(true);\n                                                                        done();\n                                                                    } else {\n                                                                        false.should.equal(true);\n                                                                        done();\n                                                                    }\n                                                                }\n                                                            });\n                                                    }\n                                                });\n                                        } else {\n                                            true.should.equal(false);\n                                            done();\n                                        }\n                                    }\n                                });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;633c1fd3-e971-4547-9068-df88d88f5624&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should overwrite user session management timeout.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should overwrite user session management timeout.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:505,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\n_ssoConfig.session_time_out_hours = 5;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                            var data = usersData.SMALRespWithoutAuthtoken;\n                                            api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                                                .send(data)\n                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        var qs = querystring.parse(res.headers.location);\n                                                        var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                        var date = moment(new Date());\n                                                        date.subtract({ hours: 4, minutes: 5 });\n                                                        _models.UserToken.findOneAndUpdate({\n                                                            authtoken: authtoken\n                                                        }, {\n                                                            idle_valid_till: date\n                                                        }, {\n                                                            new: true\n                                                        }, function(error, user) {\n                                                            api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                                .set(&#x27;authtoken&#x27;, authtoken)\n                                                                .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                                                .expect(httpStatus.OK)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                            typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                            typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                                        if (isValid) {\n                                                                            _.each(res.body.output.organizations, function(orgItem) {\n                                                                                isValid = isValid &amp;&amp;\n                                                                                    typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                    typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                    typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                    typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                    typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                            });\n                                                                            isValid.should.equal(true);\n                                                                            done();\n                                                                        } else {\n                                                                            false.should.equal(true);\n                                                                            done();\n                                                                        }\n                                                                    }\n                                                                });\n                                                        });\n                                                    }\n                                                });\n                                        } else {\n                                            true.should.equal(false);\n                                            done();\n                                        }\n                                    }\n                                });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;89a51d00-82e1-4032-ae6b-bcbeb76d7aad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should do test login without enabling SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should do test login without enabling SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3095,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar email = \&quot;amber.more@raweng.com\&quot;;\nsignUpUser({\n    email: email\n}, function(res) {\n    var newUserAuthtoken = res.body.output.authtoken;\n    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles[\&quot;Admin\&quot;].uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    api.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                        .send(_ssoConfig)\n                        .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                            var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                            api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                                .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    /*api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                        .send({})\n                                        .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {*/\n                                    api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name + \&quot;&amp;test=true\&quot;)\n                                        .expect(httpStatus.MOVED_TEMPORARILY)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                                    var data = usersData.SMALRespWithoutAuthtoken;\n                                                    api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                                                        .send(data)\n                                                        .expect(httpStatus.MOVED_TEMPORARILY)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var qs = querystring.parse(res.headers.location);\n                                                                var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessTestURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                                    .set(&#x27;authtoken&#x27;, authtoken)\n                                                                    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                                                    .expect(httpStatus.OK)\n                                                                    .end(function(err, res) {\n                                                                        if (err) {\n                                                                            done(err);\n                                                                        } else {\n                                                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                                            if (isValid) {\n                                                                                _.each(res.body.output.organizations, function(orgItem) {\n                                                                                    isValid = isValid &amp;&amp;\n                                                                                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                                });\n                                                                                isValid.should.equal(true);\n                                                                                done();\n                                                                            } else {\n                                                                                false.should.equal(true);\n                                                                                done();\n                                                                            }\n                                                                        }\n                                                                    });\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                    done();\n                                                }\n                                            }\n                                        });\n\n\n                                    //});\n                                });\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;58c7abec-84ac-4bae-85ac-249004943a96&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should do other user SSO login without accepting invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should do other user SSO login without accepting invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2751,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar email = \&quot;amber.more@raweng.com\&quot;;\nsignUpUser({\n    email: email\n}, function(res) {\n    var newUserAuthtoken = res.body.output.authtoken;\n    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles[\&quot;Admin\&quot;].uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    api.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                        .send(_ssoConfig)\n                        .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                            var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                            api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                                .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                        .send({})\n                                        .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                                            var data = usersData.SMALRespWithoutAuthtoken;\n                                                            api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                                                                .send(data)\n                                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        var qs = querystring.parse(res.headers.location);\n                                                                        var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                                            .set(&#x27;authtoken&#x27;, authtoken)\n                                                                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                                                            .expect(httpStatus.OK)\n                                                                            .end(function(err, res) {\n                                                                                if (err) {\n                                                                                    done(err);\n                                                                                } else {\n                                                                                    var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                                                    if (isValid) {\n                                                                                        _.each(res.body.output.organizations, function(orgItem) {\n                                                                                            isValid = isValid &amp;&amp;\n                                                                                                typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                                typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                                typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                                typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                                typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                                        });\n                                                                                        isValid.should.equal(true);\n                                                                                        done();\n                                                                                    } else {\n                                                                                        false.should.equal(true);\n                                                                                        done();\n                                                                                    }\n                                                                                }\n                                                                            });\n                                                                    }\n                                                                });\n                                                        } else {\n                                                            true.should.equal(false);\n                                                            done();\n                                                        }\n                                                    }\n                                                });\n                                        });\n                                });\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3308aa6d-2af2-4f9c-b9f9-d37beb3e4221&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should use same token for secondtime login if validtill satisfies.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should use same token for secondtime login if validtill satisfies.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:659,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar SSOLogin = function(sso_data, cb) {\n    var authtoken = \&quot;\&quot;;\n    var ssoLogin = \&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name;\n    if (sso_data.RelayState) {\n        authtoken = sso_data.authtoken || \&quot;\&quot;;\n        ssoLogin += \&quot;&amp;sid=\&quot; + authtoken\n    }\n    api.get(ssoLogin)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var qs = querystring.parse(res.headers.location);\n                    var rs = utils.getRelayState({\n                        body: {\n                            RelayState: qs.RelayState\n                        }\n                    });\n                    if ((rs.authtoken || \&quot;\&quot;) == authtoken) {\n                        api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                            .send(sso_data)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var qs = querystring.parse(res.headers.location);\n                                    var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                if (isValid) {\n                                                    _.each(res.body.output.organizations, function(orgItem) {\n                                                        isValid = isValid &amp;&amp;\n                                                            typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                    });\n                                                    if (isValid) {\n                                                        cb(isValid, authtoken);\n                                                    } else {\n                                                        false.should.equal(true);\n                                                        done();\n                                                    }\n                                                } else {\n                                                    false.should.equal(true);\n                                                    done();\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            var data = usersData.SMALRespWithoutAuthtoken;\n                            SSOLogin(data, function(isValid, authtoken) {\n                                data.RelayState = encryption.encryptSync(JSON.stringify({\n                                    o: _data.organization.uid,\n                                    a: authtoken\n                                }), encryption.encryptSync());\n                                data.authtoken = authtoken;\n                                SSOLogin(data, function(isValid, authtoken) {\n                                    _models.OrganizationToken.find({}, function(error, tokens) {\n                                        (tokens.length == 1).should.equal(true);\n                                        done();\n                                    });\n                                });\n                            });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da603f75-6728-42a3-8976-76cc422e1d91&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create another token for secondtime login if validtill not satisfies.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should create another token for secondtime login if validtill not satisfies.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:695,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar last_authtoken = \&quot;\&quot;;\nvar SSOLogin = function(sso_data, cb) {\n    api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                        .send(sso_data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, authtoken)\n                                    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                            if (isValid) {\n                                                _.each(res.body.output.organizations, function(orgItem) {\n                                                    isValid = isValid &amp;&amp;\n                                                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                });\n                                                if (isValid) {\n                                                    cb(isValid, authtoken);\n                                                } else {\n                                                    false.should.equal(true);\n                                                    done();\n                                                }\n                                            } else {\n                                                false.should.equal(true);\n                                                done();\n                                            }\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            var data = usersData.SMALRespWithoutAuthtoken;\n                            SSOLogin(data, function(isValid, authtoken) {\n                                data.RelayState = encryption.encryptSync(JSON.stringify({\n                                    o: _data.organization.uid,\n                                    a: authtoken\n                                }), encryption.encryptSync());\n                                _models.OrganizationToken.findOneAndUpdate({\n                                    org_uid: _data.organization.uid\n                                }, {\n                                    valid_till: new Date(2001, 12, 1)\n                                }, { new: true }, function(error, tokens) {\n                                    SSOLogin(data, function(isValid, authtoken) {\n                                        _models.OrganizationToken.find({}, function(error, tokens) {\n                                            (tokens.length == 2).should.equal(true);\n                                            done();\n                                        });\n                                    });\n                                });\n                            });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6955590-3de4-4700-b653-774570e9049e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not do SSO login if SSO is disabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should not do SSO login if SSO is disabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2958,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar email = \&quot;amber.more@raweng.com\&quot;;\nvar loginWithSSO = function(status, callback) {\n    api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(\&quot;error\&quot;) &gt; -1) {\n                    var qs = querystring.parse(res.headers.location);\n                    var error = qs[\&quot;error\&quot;] || qs[config.enterprise.sso.loginErrorURL + \&quot;?error\&quot;] || \&quot;\&quot;;\n                    callback(error, null);\n                } else {\n                    if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                        var data = usersData.SMALRespWithoutAuthtoken;\n                        api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                            .send(data)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var qs = querystring.parse(res.headers.location);\n                                    var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                        .expect(status)\n                                        .end(callback);\n                                }\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                }\n            }\n        });\n};\nsignUpUser({\n    email: email\n}, function(res) {\n    var newUserAuthtoken = res.body.output.authtoken;\n    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles[\&quot;Admin\&quot;].uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    api.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                        .send(_ssoConfig)\n                        .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                            var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                            api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                                .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                        .send({})\n                                        .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            loginWithSSO(httpStatus.OK, function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                    if (isValid) {\n                                                        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/disable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                                            .send({})\n                                                            .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                                                            .expect(httpStatus.OK)\n                                                            .end(function(err, res) {\n                                                                loginWithSSO(httpStatus.BAD_REQUEST, function(err, res) {\n                                                                    err.should.equal(messageList.ORG_SSO_DISABLE);\n                                                                    done();\n                                                                });\n                                                            });\n                                                    } else {\n                                                        false.should.equal(true);\n                                                        done();\n                                                    }\n                                                }\n                                            });\n                                        });\n                                });\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;584bbd98-411a-40e3-90cf-49b67e73d08a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should logout all tokens.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should logout all tokens.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:737,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar last_authtoken = \&quot;\&quot;;\nvar SSOLogin = function(cb) {\n    api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var data = usersData.SMALRespWithoutAuthtoken;\n                    api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                        .send(data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, authtoken)\n                                    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                            if (isValid) {\n                                                _.each(res.body.output.organizations, function(orgItem) {\n                                                    isValid = isValid &amp;&amp;\n                                                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                });\n                                                if (isValid) {\n                                                    last_authtoken = authtoken;\n                                                    cb(isValid);\n                                                } else {\n                                                    false.should.equal(true);\n                                                    done();\n                                                }\n                                            } else {\n                                                false.should.equal(true);\n                                                done();\n                                            }\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            SSOLogin(function() {\n                                _models.OrganizationToken.findOneAndUpdate({\n                                    org_uid: _data.organization.uid\n                                }, {\n                                    valid_till: new Date(2001, 12, 1)\n                                }, { new: true }, function(error, tokens) {\n                                    SSOLogin(function() {\n                                        api.post(\&quot;/enterprise/v1/logout\&quot;)\n                                            .set(&#x27;authtoken&#x27;, last_authtoken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                _models.OrganizationToken.find({ authtoken: last_authtoken }, function(error, tokens) {\n                                                    var is_valid = true;\n                                                    _.each(tokens, function(item) {\n                                                        is_valid = is_valid &amp;&amp; item.deleted_at != null;\n                                                    });\n                                                    is_valid.should.equal(true);\n                                                    done();\n                                                });\n                                            });\n                                    });\n                                });\n                            });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c81b471-31f0-4572-b60c-ec042ee572c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;edd70dd2-8a6a-423e-8192-9da68f2ebb7b&quot;,&quot;298e2ab9-018c-4bc1-b8e2-ac69a6ca2f98&quot;,&quot;633c1fd3-e971-4547-9068-df88d88f5624&quot;,&quot;89a51d00-82e1-4032-ae6b-bcbeb76d7aad&quot;,&quot;58c7abec-84ac-4bae-85ac-249004943a96&quot;,&quot;3308aa6d-2af2-4f9c-b9f9-d37beb3e4221&quot;,&quot;da603f75-6728-42a3-8976-76cc422e1d91&quot;,&quot;a6955590-3de4-4700-b653-774570e9049e&quot;,&quot;584bbd98-411a-40e3-90cf-49b67e73d08a&quot;,&quot;7c81b471-31f0-4572-b60c-ec042ee572c6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:12633,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4b965a4f-00ce-40ec-b7cc-ead9ca720d59&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;77d58c49-4f0d-47d9-b950-b59d3143c74a&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7a7f80c7-57a3-49aa-8c94-b11649e499ae&quot;,&quot;title&quot;:&quot;Organization.removeCerts&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:190,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c844d9a-8b30-436c-84c0-bf2cfb249fbb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;457048af-1349-4dcd-be03-e13f7bacabfb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f959d9c-92a7-40ae-9369-456ddfd11402&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete public SSO cert.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts Should delete public SSO cert.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:137,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            if (isValid) {\n                api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.message.should.equal(messageList.ORG_CERT_PUBLIC_DELETED_SUCCESS);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8705861d-f577-4197-aac5-1592696a178f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete private SSO cert.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts Should delete private SSO cert.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:110,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            if (isValid) {\n                api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;private\&quot;))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.message.should.equal(messageList.ORG_CERT_PRIVATE_DELETED_SUCCESS);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf3e3a64-acff-403c-8a77-c8b8be31760f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get SSO certs by Developer.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts Should not get SSO certs by Developer.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;))\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;331aa391-f92e-43bb-b898-e65a1b0d41c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives invalid file type errors for both files.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts Should gives invalid file type errors for both files.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public1\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.message == messageList.ORG_INVALID_CERT_TYPE;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e86af56-dc3c-45f5-979b-b6c531b03409&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c432b68-8915-45d0-868a-bd62d416cf55&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8705861d-f577-4197-aac5-1592696a178f&quot;,&quot;cf3e3a64-acff-403c-8a77-c8b8be31760f&quot;,&quot;331aa391-f92e-43bb-b898-e65a1b0d41c1&quot;,&quot;3e86af56-dc3c-45f5-979b-b6c531b03409&quot;,&quot;0c432b68-8915-45d0-868a-bd62d416cf55&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:308,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6fd9fc14-f2b3-45b2-a381-de6ba93f1676&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9e27cefe-7fc7-4912-a7cf-ae3c4d06d807&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bbabb386-a847-4108-bc36-0e84aa98f03f&quot;,&quot;title&quot;:&quot;Organization.transfer&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:362,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c955b892-0576-4bfd-9510-6bdd2644eec6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4201f9ba-1714-435b-b49e-9649af7d1408&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f51a2701-97e8-42aa-bf06-5a1048bc20a8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should send ownership invitation to existing flow user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should send ownership invitation to existing flow user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.other_user.email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                _models.OrganizationOwnerInvitation.findOne({ org_uid: org_uid, email: _data.other_user.email }, function(error, orgInvitation) {\n                    if (error || !orgInvitation) {\n                        false.should.equal(true);\n                        done();\n                    } else {\n                        true.should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e908abfd-c88f-4f79-949e-6305fa209635&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get ownership invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should get ownership invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:104,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.other_user.email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                api.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.other_user.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.owner_invitation.should.not.equal(undefined);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a80792e-d0c8-44c9-be32-45ef66f37bed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should limit ownership invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should limit ownership invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:103,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.roles[\&quot;Developer\&quot;].uid],\n        \&quot;emails\&quot;: [\&quot;test.user+1@raweng.com\&quot;, \&quot;test.user+1@rawenG.com\&quot;, \&quot;test.user+2@raweng.com\&quot;,\n            \&quot;test.user+3@raweng.com\&quot;, \&quot;test.user+4@raweng.com\&quot;, \&quot;test.user+5@raweng.com\&quot;\n        ]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                .send({\n                    \&quot;email\&quot;: \&quot;test.user+6@raweng.com\&quot;\n                })\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var error_message = messageList.ORG_USER_MAX_LIMIT_REACHED;\n                        error_message = error_message.replace(\&quot;%%USER_COUNT%%\&quot;, 10);\n                        res.body.error.message.should.equal(error_message);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;988bd713-4970-4dae-a918-a7872f3eb6f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({\n        \&quot;email\&quot;: _data.other_user.email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8907b363-b29f-4f0f-8f4c-5b0f7bd335fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate ownership invitation body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should validate ownership invitation body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.email.message == messageList.ORG_EMAIL_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0d87ebd-cbef-46b5-8ea3-7400238b825a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send ownership invitation to existing organization flow user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should send ownership invitation to existing organization flow user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.developer.email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                _models.OrganizationOwnerInvitation.findOne({ org_uid: org_uid, email: _data.developer.email }, function(error, orgInvitation) {\n                    if (error || !orgInvitation) {\n                        false.should.equal(true);\n                        done();\n                    } else {\n                        true.should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fa7c38d6-4e02-44b5-b4f5-52f62f44db92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send ownership invitation to new flow user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should send ownership invitation to new flow user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1000@raweng.com\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                _models.OrganizationOwnerInvitation.findOne({ org_uid: org_uid, email: email }, function(error, orgInvitation) {\n                    if (error || !orgInvitation) {\n                        false.should.equal(true);\n                        done();\n                    } else {\n                        true.should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4f7e8f3-1eda-49fd-9a0d-980c1e980606&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send ownership invitation to existing google user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should send ownership invitation to existing google user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2720,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1000@raweng.com\&quot;;\nsignUpGoogleUser({\n    done: done,\n    email: email\n}, function(res) {\n    var new_user_uid = res.body.output.uid;\n    api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;email\&quot;: email\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                    _models.OrganizationOwnerInvitation.findOne({ org_uid: org_uid, email: email }, function(error, orgInvitation) {\n                        if (error || !orgInvitation) {\n                            false.should.equal(true);\n                            done();\n                        } else {\n                            true.should.equal(true);\n                            done();\n                        }\n                    });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18d3715c-5ac3-470d-a787-dd7fa2f4d797&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send ownership invitation to new google user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should send ownership invitation to new google user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1000@raweng.com\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                _models.OrganizationOwnerInvitation.findOne({ org_uid: org_uid, email: email }, function(error, orgInvitation) {\n                    if (error || !orgInvitation) {\n                        false.should.equal(true);\n                        done();\n                    } else {\n                        true.should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e08ea7a-7745-420e-b1ed-bdf2a1ba47b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give owner required error for admin role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should give owner required error for admin role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.developer.email\n    })\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_OWNER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5bb165e-a837-4447-85f4-525a2ccd9e5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give owner required error for developer role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should give owner required error for developer role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.developer.email\n    })\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_OWNER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;65444ced-db5c-475f-8882-b1fd2364dc95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.developer.email\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1295d3d1-e15e-4157-abdb-651d585ceddc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e908abfd-c88f-4f79-949e-6305fa209635&quot;,&quot;7a80792e-d0c8-44c9-be32-45ef66f37bed&quot;,&quot;988bd713-4970-4dae-a918-a7872f3eb6f1&quot;,&quot;8907b363-b29f-4f0f-8f4c-5b0f7bd335fe&quot;,&quot;b0d87ebd-cbef-46b5-8ea3-7400238b825a&quot;,&quot;fa7c38d6-4e02-44b5-b4f5-52f62f44db92&quot;,&quot;f4f7e8f3-1eda-49fd-9a0d-980c1e980606&quot;,&quot;18d3715c-5ac3-470d-a787-dd7fa2f4d797&quot;,&quot;3e08ea7a-7745-420e-b1ed-bdf2a1ba47b0&quot;,&quot;f5bb165e-a837-4447-85f4-525a2ccd9e5c&quot;,&quot;65444ced-db5c-475f-8882-b1fd2364dc95&quot;,&quot;1295d3d1-e15e-4157-abdb-651d585ceddc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3257,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;32b8873f-ae55-4723-ab2c-f77a71e02bfd&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8aff9756-cad3-42fa-9147-4b1ec692c8bf&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d41e7769-e0dc-4ced-880f-3ab1b92157a9&quot;,&quot;title&quot;:&quot;Organization.update&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:182,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3216d4b3-2bf8-4ea6-8a9f-d539e5c901db&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;819b0aad-cd9d-42f9-aca8-0dc708f0f696&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d5c113c-392b-45cc-b11d-f68a316485bf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should update organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.name == body.name &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c11bf6cb-f674-407a-92bc-13b49d12ed04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;791eb9aa-ce45-400e-9876-1c0bb9a4e74e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update same name in organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should update same name in organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org1&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.name == body.name &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bda1a985-b8dd-4995-b9ef-424343117f26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update organization details without name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should update organization details without name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.name != \&quot;\&quot; &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7bc654c4-8f53-481f-95cd-06291a5c2767&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give duplicate organization name error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should give duplicate organization name error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org2&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DUPLICATE_NAME_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f7895b2-3918-46d0-b8f2-727b95a14c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should only allowed to update org details by owner and admin role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should only allowed to update org details by owner and admin role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9351f4b-0174-4bd5-849e-867fd9954da0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d765c7d3-e852-432d-b7e4-6e30ac4cc7cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c11bf6cb-f674-407a-92bc-13b49d12ed04&quot;,&quot;791eb9aa-ce45-400e-9876-1c0bb9a4e74e&quot;,&quot;bda1a985-b8dd-4995-b9ef-424343117f26&quot;,&quot;7bc654c4-8f53-481f-95cd-06291a5c2767&quot;,&quot;5f7895b2-3918-46d0-b8f2-727b95a14c5a&quot;,&quot;c9351f4b-0174-4bd5-849e-867fd9954da0&quot;,&quot;d765c7d3-e852-432d-b7e4-6e30ac4cc7cb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:257,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f904f9f8-69a9-4e15-8909-775853a6da55&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b9272532-ebfb-46ce-bc6b-ff3f19d96d63&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;86f8000b-33e6-42ff-b2d3-4a36f3a75662&quot;,&quot;title&quot;:&quot;Organization.updateAvatar&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:168,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        _data = data;\n        org_uid = data.organization.uid;\n        user_uid = data.organization.user_uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a0d4229-d025-413d-8fd6-799084fbee0a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;590758be-50db-486d-8298-259a8c60ce2b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c93185c3-7eea-43cc-904a-6846b7d917bb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Owner should update organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar Owner should update organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17f992e2-3b0f-4424-b0dd-5c6b34caae5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Owner should able to remove organization image.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar Owner should able to remove organization image.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;avatar&#x27;: null\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ad40f71-e7ae-4b06-bb3c-9d0c10a5bf85&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Admin should update organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar Admin should update organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;774d4c50-15e1-4e9f-b5e9-a20029a02d11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Other roles should not update avatar.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar Other roles should not update avatar.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f939606-2167-4447-8785-252a522a9d0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64971373-535a-4a18-9282-1714d194057f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;17f992e2-3b0f-4424-b0dd-5c6b34caae5c&quot;,&quot;1ad40f71-e7ae-4b06-bb3c-9d0c10a5bf85&quot;,&quot;774d4c50-15e1-4e9f-b5e9-a20029a02d11&quot;,&quot;3f939606-2167-4447-8785-252a522a9d0c&quot;,&quot;64971373-535a-4a18-9282-1714d194057f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:212,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4941ce01-3f38-4f48-bb82-b4ab2ef11d22&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;68ac615a-846a-44b1-97f0-7a8024f61857&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;05aa10a3-96a0-4e07-8239-7891c8319603&quot;,&quot;title&quot;:&quot;Organization.updateSSODetails&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:173,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a07d922-5926-46e4-acc7-9d05ac3f4f95&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37ce2f41-7076-473a-a378-faea5a5acdc4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0be63fb3-8c71-4eb3-80e9-4bb198c68621&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update SSO Config details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should update SSO Config details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours &amp;&amp;\n                res.body.output.sso_details.issuer == config.issuer\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9fac0992-7ed4-49f5-a649-5f89c3b3e23c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate SSO Config details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should validate SSO Config details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.entry_point.message == messageList.ORG_SSO_ENTRY_POINT_REQUIRED &amp;&amp;\n                res.body.error.algo_type.message == messageList.ORG_SSO_ALGO_TYPE_REQUIRED &amp;&amp;\n                res.body.error.session_time_out_hours.message == messageList.ORG_SSO_SESSION_TIMEOUT_POSITIVE_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c74b61b-58ec-47d3-ae31-f744ee94e8d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update SSO Config details by admin.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should update SSO Config details by admin.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef96cda3-2b0f-4673-81bb-28501bb38e82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not update SSO Config details by developer.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should not update SSO Config details by developer.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80f4b7f5-2c48-461c-a314-f1f88818425f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({})\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce4af660-a716-445c-8b09-8e29a6806cf2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46a71d89-7d5f-4bc0-8f0b-cca066896516&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9fac0992-7ed4-49f5-a649-5f89c3b3e23c&quot;,&quot;4c74b61b-58ec-47d3-ae31-f744ee94e8d1&quot;,&quot;ef96cda3-2b0f-4673-81bb-28501bb38e82&quot;,&quot;80f4b7f5-2c48-461c-a314-f1f88818425f&quot;,&quot;ce4af660-a716-445c-8b09-8e29a6806cf2&quot;,&quot;46a71d89-7d5f-4bc0-8f0b-cca066896516&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:209,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;56dfe0d9-0494-4489-a06a-3d730ddb196f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;85a8488f-895a-42c5-9525-7d35e0ed0fa9&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;15393969-de31-4a4a-982f-eb38c7c4da0c&quot;,&quot;title&quot;:&quot;Organization.uploadCerts&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:175,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32ffa082-f9f8-42bb-acba-d743f6cd9147&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5c00c5e-131d-4089-98aa-90fa63770a8a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6439eb12-fe52-4c79-b566-cdef648a5e05&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should upload SSO certs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should upload SSO certs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2221ec5e-5c3b-47f8-9fb9-58465da8ec73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should upload SSO certs by Admin.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should upload SSO certs by Admin.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84815152-86da-4922-8bfc-b9a70aef60f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not upload SSO certs by Billing Manager.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should not upload SSO certs by Billing Manager.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f8c718d-46a2-4976-8ae7-e95263307eff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not upload SSO certs by Developer.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should not upload SSO certs by Developer.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;649cbb26-c87d-480d-b09f-8947b10e53a9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should upload only public key.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should upload only public key.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3cd8d87-816f-4366-9f86-11380870d0fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should upload only private certificate.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should upload only private certificate.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab871f71-6d75-4e63-8ed5-bc5d2e6bbe96&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives invalid public key file type error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should gives invalid public key file type error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, privateKeyFile)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.signed_public_key.message == messageList.ORG_SSO_PUBLIC_CERT_FILE_TYPE_ERROR;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;85a1496e-c22e-4259-9d1e-7d47fc86cb05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives invalid private cert file type error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should gives invalid private cert file type error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;enc_private_key&#x27;, publicKeyFile)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.enc_private_key.message == messageList.ORG_SSO_PRIVATE_KEY_FILE_TYPE_ERROR;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c913677a-cfd6-44a0-9727-fe15c83e1c72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives invalid file type errors for both files.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should gives invalid file type errors for both files.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, privateKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, publicKeyFile)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.signed_public_key.message == messageList.ORG_SSO_PUBLIC_CERT_FILE_TYPE_ERROR &amp;&amp;\n                res.body.error.enc_private_key.message == messageList.ORG_SSO_PRIVATE_KEY_FILE_TYPE_ERROR;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a41b0a9-3366-4b80-9f0b-58063b51305b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a63d56ed-01de-4cfa-8da0-56c70cf2cd52&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2221ec5e-5c3b-47f8-9fb9-58465da8ec73&quot;,&quot;84815152-86da-4922-8bfc-b9a70aef60f4&quot;,&quot;0f8c718d-46a2-4976-8ae7-e95263307eff&quot;,&quot;649cbb26-c87d-480d-b09f-8947b10e53a9&quot;,&quot;c3cd8d87-816f-4366-9f86-11380870d0fe&quot;,&quot;ab871f71-6d75-4e63-8ed5-bc5d2e6bbe96&quot;,&quot;85a1496e-c22e-4259-9d1e-7d47fc86cb05&quot;,&quot;c913677a-cfd6-44a0-9727-fe15c83e1c72&quot;,&quot;7a41b0a9-3366-4b80-9f0b-58063b51305b&quot;,&quot;a63d56ed-01de-4cfa-8da0-56c70cf2cd52&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:420,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;86bd24c7-8913-418d-b27e-6b35e4fc9018&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;70578556-dbf2-445e-8c8e-a4d7285360c2&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dfd10043-0e64-4b63-836e-0bd98ee73811&quot;,&quot;title&quot;:&quot;OrganizationRole.create&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:181,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da2384af-d086-4f21-a4e6-53a287dedcd6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ad335df9-8e6c-47fd-9065-37064da9dd19&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create organization role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should create organization role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role5\&quot;;\nrole.projects = [_data.org_projects[0].uid, _data.org_projects[1].uid];\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1711318d-b439-48c8-a786-7685e15ff654&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role5\&quot;;\nrole.projects = [_data.org_projects[0].uid, _data.org_projects[1].uid];\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73165b34-f31c-48ae-b7d1-bab6198f44b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate organization role body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should validate organization role body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.name.message == messageList.ORG_ROLE_NAME_REQUIRED &amp;&amp;\n                res.body.error.projects.message == messageList.ORG_PROJECT_SET_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3a5ed64-8767-490f-aa5d-b781900b14ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allow to create organization role with duplicate name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should not allow to create organization role with duplicate name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role5\&quot;;\nrole.projects = [_data.org_projects[0].uid, _data.org_projects[1].uid];\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                .send(role)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.ORG_DUPLICATE_ROLE_NAME);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bba7b707-7416-4c45-9ea0-15f0750c194d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allow to create organization role to user of other role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should not allow to create organization role to user of other role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role3\&quot;;\nrole.projects = [_data.org_projects[0].uid];\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f48b532-d49f-4565-b97e-debc2fd1b5a9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role3\&quot;;\napi.post(apiURL)\n    .send(role)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3ebe9c1-1c8c-42cb-aaab-d314b0d8410e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1711318d-b439-48c8-a786-7685e15ff654&quot;,&quot;73165b34-f31c-48ae-b7d1-bab6198f44b3&quot;,&quot;d3a5ed64-8767-490f-aa5d-b781900b14ff&quot;,&quot;bba7b707-7416-4c45-9ea0-15f0750c194d&quot;,&quot;4f48b532-d49f-4565-b97e-debc2fd1b5a9&quot;,&quot;a3ebe9c1-1c8c-42cb-aaab-d314b0d8410e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:214,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;493f867e-52ad-48b2-8f95-894fd1751e31&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;29552209-072c-4db3-b347-1227a660bde9&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0c89521f-3bfd-4b35-ad7d-434d56258f09&quot;,&quot;title&quot;:&quot;OrganizationRole.deleteRole&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:176,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a4569462-173d-4026-a9e1-64d6d8dbed02&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d72afc6-991e-4e05-a091-910ec73b0e60&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete organization role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should delete organization role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;role3\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.ORG_ROLE_DELETED_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;680b85de-5755-4224-afab-ddcf713c84b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;role1\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fea4c3fe-b096-4e5e-9dd5-d1410d6506a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete Admin role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should not delete Admin role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;Admin\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_DELETE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ba0ade6-2279-4a3e-b4ee-af82a1b1c62d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete Billing Manager role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should not delete Billing Manager role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;Billing Manager\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_DELETE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fba0b022-3a33-4669-be10-703342d3098c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete Developer role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should not delete Developer role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;Developer\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_DELETE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b3ed49a-658b-42ec-a522-414d257982b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete role if it is used.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should not delete role if it is used.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid/roles\&quot;.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role3\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, _data.roles[\&quot;role3\&quot;].uid))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.BAD_REQUEST)\n                    .end(function(err, res) {\n                        res.body.error.message.should.equal(messageList.ORG_ASSIGNED_ROLE_DELETE_ERROR);\n                        done();\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7db858fb-9760-4a85-b849-af294081869c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete role if it is unused.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should delete role if it is unused.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:178,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid/roles\&quot;.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role3\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, _data.roles[\&quot;role3\&quot;].uid))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.BAD_REQUEST)\n                    .end(function(err, res) {\n                        if (res.body.error.message == messageList.ORG_ASSIGNED_ROLE_DELETE_ERROR) {\n                            api.put(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid/roles\&quot;.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n                                .send({\n                                    org_roles: []\n                                })\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, _data.roles[\&quot;role3\&quot;].uid))\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    res.body.output.message.should.equal(messageList.ORG_ROLE_DELETED_SUCCESS);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                        } else {\n                            true.should.equal(false);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e032041-f3dc-43d2-bcfb-8f996b155ee5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete role if used user is removed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should delete role if used user is removed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:178,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid/roles\&quot;.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role3\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, _data.roles[\&quot;role3\&quot;].uid))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.BAD_REQUEST)\n                    .end(function(err, res) {\n                        if (res.body.error.message == messageList.ORG_ASSIGNED_ROLE_DELETE_ERROR) {\n                            api.delete(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid\&quot;.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n                                .send({})\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, _data.roles[\&quot;role3\&quot;].uid))\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    res.body.output.message.should.equal(messageList.ORG_ROLE_DELETED_SUCCESS);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                        } else {\n                            true.should.equal(false);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc2e1702-15c4-4be7-9b93-c2c6e83abd16&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allow to delete organization role to user of other role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should not allow to delete organization role to user of other role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;role1\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2245cc0e-04c3-45a9-a4a2-21016303b2ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;role1\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2391942d-5c22-4762-aea1-50e395b7ba09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;680b85de-5755-4224-afab-ddcf713c84b7&quot;,&quot;fea4c3fe-b096-4e5e-9dd5-d1410d6506a2&quot;,&quot;4ba0ade6-2279-4a3e-b4ee-af82a1b1c62d&quot;,&quot;fba0b022-3a33-4669-be10-703342d3098c&quot;,&quot;9b3ed49a-658b-42ec-a522-414d257982b1&quot;,&quot;7db858fb-9760-4a85-b849-af294081869c&quot;,&quot;7e032041-f3dc-43d2-bcfb-8f996b155ee5&quot;,&quot;bc2e1702-15c4-4be7-9b93-c2c6e83abd16&quot;,&quot;2245cc0e-04c3-45a9-a4a2-21016303b2ea&quot;,&quot;2391942d-5c22-4762-aea1-50e395b7ba09&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:615,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;caeab19c-a716-4764-9699-f2639252a9d6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;99bd569d-8b9f-4bc7-bdcd-d6bbef2ef812&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;771e61c7-9c25-4c2d-81c0-e70433529c8a&quot;,&quot;title&quot;:&quot;OrganizationRole.list&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4434e8ea-6853-4ee8-b4d9-1b2f25adbcb4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3dcdd4de-3c64-482a-875b-a3feb21ed217&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should list organization roles.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should list organization roles.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.count != 0 &amp;&amp;\n                    res.body.output.objects.length &gt; 0;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d544b86-2759-4672-935f-f81604fff069&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e2fae89-bb3c-44b7-b81c-c13b17659d9c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should sort organization roles.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should sort organization roles.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n    \&quot;?skip=2&amp;limit=2&amp;field=name&amp;direction=desc\&quot;;\napi.get(orgGetUrl)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.count != 0 &amp;&amp;\n                    res.body.output.objects.length == 2;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ee9fc35-98b0-4122-b61d-a45a5588dc1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list of two organization roles.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should list of two organization roles.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;var orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n    \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(orgGetUrl)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.count != 0 &amp;&amp;\n                    res.body.output.objects.length == 2;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;35d34060-c43d-4b1f-86fd-e86d4c3d48ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list of filter roles.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should list of filter roles.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n    \&quot;?query=role1\&quot;;\napi.get(orgGetUrl)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.count != 0 &amp;&amp;\n                    res.body.output.objects.length == 1;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd01779c-eac4-485a-b49a-afe89c445f12&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give admin role required error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should give admin role required error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9f4d4fe-0481-4fb4-8735-dbd25af26ca8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;265308eb-711f-40a0-b8eb-c43925221438&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6d544b86-2759-4672-935f-f81604fff069&quot;,&quot;2e2fae89-bb3c-44b7-b81c-c13b17659d9c&quot;,&quot;5ee9fc35-98b0-4122-b61d-a45a5588dc1c&quot;,&quot;35d34060-c43d-4b1f-86fd-e86d4c3d48ca&quot;,&quot;cd01779c-eac4-485a-b49a-afe89c445f12&quot;,&quot;a9f4d4fe-0481-4fb4-8735-dbd25af26ca8&quot;,&quot;265308eb-711f-40a0-b8eb-c43925221438&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:180,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c61d87cf-cd0a-4014-8275-354b24e2426a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;59b5fa56-a3f7-4c9c-bc2f-6f805c7a9e15&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9f594085-2b28-42b9-b6bb-b49b8114105b&quot;,&quot;title&quot;:&quot;OrganizationRole.update&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:168,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de288188-1ebe-4f58-bd1c-a40da79b6874&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6a25f7b4-8d01-4b3b-86b4-2c5efe249fbb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update organization role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should update organization role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;role2\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                res.body.output.name == role.name &amp;&amp;\n                res.body.output.projects.length == 1 &amp;&amp;\n                res.body.output.projects[0] == _data.org_projects[0].uid).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da5ff329-1587-4ffe-a9f5-908780e80485&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give role not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should give role not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;role2\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, \&quot;FAKE_ROLE\&quot;))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_ROLE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d90c3ba5-1174-4484-a52a-8ed895d5c428&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not update Admin role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should not update Admin role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;Admin\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_MODIFY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;141a8753-4262-4bae-a5e6-d129644df23b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not update Billing Manager role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should not update Billing Manager role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;Billing Manager\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_MODIFY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;692a7508-d85b-4609-ab05-b0d0bc068b00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not update Developer role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should not update Developer role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;Developer\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_MODIFY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aaa63281-c329-4fe1-800d-67a4c4164ed1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;role2\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acd7868e-51ed-488f-99ce-71cd9b63bbda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate organization role body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should validate organization role body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;role2\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.name.message == messageList.ORG_ROLE_NAME_REQUIRED &amp;&amp;\n                res.body.error.projects.message == messageList.ORG_PROJECT_SET_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c427baf8-2e5d-4e5c-a9f5-0cadff2070ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update organization projects.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should update organization projects.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;role2\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                res.body.output.name == role.name &amp;&amp;\n                res.body.output.projects.length == 1 &amp;&amp;\n                res.body.output.projects[0] == _data.org_projects[0].uid).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb538c93-a92d-4bb9-ab35-b6aa0e93b8ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allow to update organization role to user of other role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should not allow to update organization role to user of other role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nvar org_role_uid = _data.roles[\&quot;role1\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1e45186-f66c-46f2-a965-573859e30c0e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nvar org_role_uid = _data.roles[\&quot;role1\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98bdd3c2-75da-4a98-b1b3-a80b6282ff6d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;da5ff329-1587-4ffe-a9f5-908780e80485&quot;,&quot;d90c3ba5-1174-4484-a52a-8ed895d5c428&quot;,&quot;141a8753-4262-4bae-a5e6-d129644df23b&quot;,&quot;692a7508-d85b-4609-ab05-b0d0bc068b00&quot;,&quot;aaa63281-c329-4fe1-800d-67a4c4164ed1&quot;,&quot;acd7868e-51ed-488f-99ce-71cd9b63bbda&quot;,&quot;c427baf8-2e5d-4e5c-a9f5-0cadff2070ce&quot;,&quot;bb538c93-a92d-4bb9-ab35-b6aa0e93b8ff&quot;,&quot;c1e45186-f66c-46f2-a965-573859e30c0e&quot;,&quot;98bdd3c2-75da-4a98-b1b3-a80b6282ff6d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:308,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;44631729-944b-499c-918c-b68da50cd375&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2a43ad45-c7fd-4d99-b00d-71d961e92bd5&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5844b746-f5ba-42a1-bc65-98decdd7c580&quot;,&quot;title&quot;:&quot;OrganizationUser.assignedRoles&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:197,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;abb49c75-adf9-47cc-ad1a-fa583621a4cd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;beb43bc2-fe2d-46d5-b380-361dc23976b0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should assigned default project while assigning billing manger role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles Should assigned default project while assigning billing manger role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;Billing Manager\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                (res.body.output.roles[0].name == \&quot;Billing Manager\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51d64c2c-1aac-484f-945a-34fcca17d5de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should assigned new role to organization user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles Should assigned new role to organization user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role1\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.roles[0].name.should.equal(\&quot;role1\&quot;);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0e725a1-cc5d-46f1-bb07-4bf970c03691&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update allowed project list of user, if assigned roles changed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles Should update allowed project list of user, if assigned roles changed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role3\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.get(\&quot;/enterprise/v1/projects\&quot;)\n                    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        (res.body.output.projects || res.body.output.objects).length.should.equal(2);\n                        done();\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e585e55f-4dd2-4fc7-afe3-abaaead94251&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role3\&quot;].uid]\n        })\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d2d8268-7283-4781-8101-712d0e2f0814&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;51d64c2c-1aac-484f-945a-34fcca17d5de&quot;,&quot;c0e725a1-cc5d-46f1-bb07-4bf970c03691&quot;,&quot;e585e55f-4dd2-4fc7-afe3-abaaead94251&quot;,&quot;9d2d8268-7283-4781-8101-712d0e2f0814&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:179,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;23b636a3-aec6-42f9-94ef-0c77a2e2ff4a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6fef6a2b-9464-40d9-839f-5633a8066008&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;208bee40-ccb4-4099-80e3-2b7086e164da&quot;,&quot;title&quot;:&quot;OrganizationUser.currentUser&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:226,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d26e329b-2f6e-48d3-b35b-a49d77ab7578&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8477354-6444-4647-b12b-a4e2f7ba538e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get owner information in currentuser call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get owner information in currentuser call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5679d324-5d4d-4013-9395-239ac99384bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get access for owner if SSO is enabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get access for owner if SSO is enabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:264,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                            .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6757dea1-b42f-4ab5-b24f-2006f11f2f36&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get access for admin if SSO is enabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should not get access for admin if SSO is enabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:242,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.ACCESS_DENIED);\n                                    done();\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7504cb34-1544-4bb9-bf8e-1e054e6dc173&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get access for developer if SSO is enabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should not get access for developer if SSO is enabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:234,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                            .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.ACCESS_DENIED);\n                                    done();\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a02dc55-8853-4843-bbf4-7d0cf31da370&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get access for role1 if SSO is enabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should not get access for role1 if SSO is enabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:339,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                            .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.ACCESS_DENIED);\n                                    done();\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f01ce869-8c9e-45ce-ab10-8a51c8b2efad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization owner information in currentuser call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization owner information in currentuser call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;92cfaac3-3a23-4014-b7e2-f18762cee2ed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization owner and sso information in currentuser call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization owner and sso information in currentuser call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf2fd388-ea2e-4453-b6ba-df62572a14da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization information in currentuser call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization information in currentuser call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n            if (isValid) {\n                _.each(res.body.output.organizations, function(orgItem) {\n                    isValid = isValid &amp;&amp;\n                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                });\n                isValid.should.equal(true);\n                done();\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7f44e9d-494e-43fc-8a5f-8ec22d6fe10f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization information in login call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization information in login call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:213,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: _data.developer.email,\n        \&quot;password\&quot;: \&quot;Raw@1234\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n            if (isValid) {\n                _.each(res.body.output.organizations, function(orgItem) {\n                    isValid = isValid &amp;&amp;\n                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                });\n                isValid.should.equal(true);\n                done();\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;361695ab-cd36-479b-8589-340501f66cc1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization information in gmail login call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization information in gmail login call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n    \&quot;email\&quot;: _data.developer.email\n});\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send({\n        \&quot;access_token\&quot;: \&quot;ya29.CjaXA59GmnRCMOCYxSm8kPuqY1H4k10wipfcQF6gFxAyAZXaokdxwQTW0ViQ1fG9m7-JVBkaUsM\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n            if (isValid) {\n                _.each(res.body.output.organizations, function(orgItem) {\n                    isValid = isValid &amp;&amp;\n                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                });\n                isValid.should.equal(true);\n                done();\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87f1fc9a-ad23-4a1e-8af0-192d4c0215a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization information in currentuser call of organization for Admin.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization information in currentuser call of organization for Admin.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n            if (isValid) {\n                _.each(res.body.output.organizations, function(orgItem) {\n                    isValid = isValid &amp;&amp;\n                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                });\n                isValid.should.equal(true);\n                done();\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2fbb93a0-78b2-49cd-ad8a-dfa990d66ea4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization information in currentuser call of organization for Billing Manager.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization information in currentuser call of organization for Billing Manager.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n            if (isValid) {\n                _.each(res.body.output.organizations, function(orgItem) {\n                    isValid = isValid &amp;&amp;\n                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                });\n                isValid.should.equal(true);\n                done();\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;982ccafe-1037-4217-93a6-28928f619d17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5679d324-5d4d-4013-9395-239ac99384bf&quot;,&quot;6757dea1-b42f-4ab5-b24f-2006f11f2f36&quot;,&quot;7504cb34-1544-4bb9-bf8e-1e054e6dc173&quot;,&quot;8a02dc55-8853-4843-bbf4-7d0cf31da370&quot;,&quot;f01ce869-8c9e-45ce-ab10-8a51c8b2efad&quot;,&quot;92cfaac3-3a23-4014-b7e2-f18762cee2ed&quot;,&quot;cf2fd388-ea2e-4453-b6ba-df62572a14da&quot;,&quot;a7f44e9d-494e-43fc-8a5f-8ec22d6fe10f&quot;,&quot;361695ab-cd36-479b-8589-340501f66cc1&quot;,&quot;87f1fc9a-ad23-4a1e-8af0-192d4c0215a0&quot;,&quot;2fbb93a0-78b2-49cd-ad8a-dfa990d66ea4&quot;,&quot;982ccafe-1037-4217-93a6-28928f619d17&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1603,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;77778d3f-d86b-4189-8865-f35602ef84c1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e4b115aa-b452-428f-a971-fc67f01d3f95&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ea4255bc-0957-4312-87df-258a657448e3&quot;,&quot;title&quot;:&quot;OrganizationUser.deleteOrgUser&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:160,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;365b46c4-746d-417a-911e-073f328a2827&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19623e99-68ba-4ef9-9c10-e2036537d544&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete organization user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should delete organization user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.role1.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.ORG_USER_DELETED_SUCCESS);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29232dc7-5416-4ea0-97c9-22bda4225f62&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete organization admin user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should delete organization admin user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.admin.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.ORG_USER_DELETED_SUCCESS);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d55b183-2e39-4730-92c8-7facef238af3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.role1.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.NOT_FOUND)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75846eff-886c-4487-a6a0-617ee7ce2609&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete Admin user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should delete Admin user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.admin.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.ORG_USER_DELETED_SUCCESS);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b131141c-fc17-4f79-927f-ed256dc9d7b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete Billing Manager user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should delete Billing Manager user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.billing_manager.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.ORG_USER_DELETED_SUCCESS);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f568c0e-bdbd-4930-a0ed-6f3accdaacaf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete owner.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should not delete owner.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.owner.uid\n}, function(err, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_OWNER_CANNOT_BE_DELETED);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4c5e334-afbc-4aea-8cd8-487af7cd67dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give user not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should give user not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, \&quot;ABC\&quot;))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_USER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57f6024b-f72b-418d-8266-6d3ece7b98ae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to delete user to Developer user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should not allowed to delete user to Developer user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.role1.uid\n}, function(err, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d756c809-c87b-40d3-8141-bfc5ec3773e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to delete user to Billing Manager user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should not allowed to delete user to Billing Manager user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.role1.uid\n}, function(err, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;350ece42-5dd7-49a1-828b-bd1cbff37d88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete owner.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should not delete owner.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.owner.uid\n}, function(err, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_OWNER_CANNOT_BE_DELETED);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;713d2ede-f49d-4e53-9329-b3c8a902bbde&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.owner.uid\n}, function(err, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d73dc826-65ad-4f1c-995f-6c4b12267f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;29232dc7-5416-4ea0-97c9-22bda4225f62&quot;,&quot;1d55b183-2e39-4730-92c8-7facef238af3&quot;,&quot;75846eff-886c-4487-a6a0-617ee7ce2609&quot;,&quot;b131141c-fc17-4f79-927f-ed256dc9d7b3&quot;,&quot;8f568c0e-bdbd-4930-a0ed-6f3accdaacaf&quot;,&quot;d4c5e334-afbc-4aea-8cd8-487af7cd67dc&quot;,&quot;57f6024b-f72b-418d-8266-6d3ece7b98ae&quot;,&quot;d756c809-c87b-40d3-8141-bfc5ec3773e1&quot;,&quot;350ece42-5dd7-49a1-828b-bd1cbff37d88&quot;,&quot;713d2ede-f49d-4e53-9329-b3c8a902bbde&quot;,&quot;d73dc826-65ad-4f1c-995f-6c4b12267f38&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:318,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;544e3676-e53c-463c-8b16-5c0aa733709b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fb97b04c-b6b3-4ffb-9822-0858a442f573&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;35496bef-c010-4273-8d44-1aea7203aab4&quot;,&quot;title&quot;:&quot;OrganizationUser.list&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:182,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2fadb5d9-6e5b-45cc-b3ae-eb10178446e2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cdf45082-35b5-4340-8b3d-e255ef47e14b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should list organization users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should list organization users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.count &gt; 0;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d08b9aeb-6489-45a8-9ddd-d7411d5d6dac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:442,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nfetchRoles({\n    done: done,\n    org_uid: org_uid\n}, function(res) {\n    inviteUsers({\n        roles: res.body.output.objects,\n        user_uid: user_uid,\n        org_uid: org_uid\n    }, function() {\n        api.get(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.NOT_FOUND)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b7cce969-ffab-4ca6-bedf-29099a06eb69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should sort organization users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should sort organization users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:412,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nfetchRoles({\n    done: done,\n    org_uid: org_uid\n}, function(res) {\n    inviteUsers({\n        roles: res.body.output.objects,\n        user_uid: user_uid,\n        org_uid: org_uid\n    }, function() {\n        var orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n            \&quot;?skip=2&amp;limit=2&amp;field=email&amp;direction=desc\&quot;;\n        api.get(orgGetUrl)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var isValid = false;\n                    if (Array.isArray(res.body.output.objects)) {\n                        isValid = res.body.output.count != 0 &amp;&amp;\n                            res.body.output.objects.length == 2;\n                        _.each(res.body.output.objects, function(item) {\n                            isValid = isValid &amp;&amp;\n                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(item.__v) == \&quot;undefined\&quot;;\n                        });\n                    }\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8893f24d-9936-4b79-85da-e9a509f9337d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list two items of organization users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should list two items of organization users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:418,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nfetchRoles({\n    done: done,\n    org_uid: org_uid\n}, function(res) {\n    inviteUsers({\n        roles: res.body.output.objects,\n        user_uid: user_uid,\n        org_uid: org_uid\n    }, function() {\n        var orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n            \&quot;?skip=2&amp;limit=2\&quot;;\n        api.get(orgGetUrl)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var isValid = false;\n                    if (Array.isArray(res.body.output.objects)) {\n                        isValid = res.body.output.count != 0 &amp;&amp;\n                            res.body.output.objects.length == 2;\n                        _.each(res.body.output.objects, function(item) {\n                            isValid = isValid &amp;&amp;\n                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(item.__v) == \&quot;undefined\&quot;;\n                        });\n                    }\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f49fed41-1a3f-42b0-918a-c33c22d6dd51&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list of filter users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should list of filter users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:420,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nfetchRoles({\n    done: done,\n    org_uid: org_uid\n}, function(res) {\n    inviteUsers({\n        roles: res.body.output.objects,\n        user_uid: user_uid,\n        org_uid: org_uid\n    }, function() {\n        var orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n            \&quot;?query=test.user+1\&quot;;\n        api.get(orgGetUrl)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var isValid = false;\n                    if (Array.isArray(res.body.output.objects)) {\n                        isValid = res.body.output.count != 0 &amp;&amp;\n                            res.body.output.objects.length &gt; 0;\n                        _.each(res.body.output.objects, function(item) {\n                            isValid = isValid &amp;&amp;\n                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(item.__v) == \&quot;undefined\&quot;;\n                        });\n                    }\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;209b357d-875b-4011-a216-5c5bc5c37a83&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get invitation object null after accepting invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should get invitation object null after accepting invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:354,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.roles[\&quot;Developer\&quot;].uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invitation/accept\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                        .send({})\n                        .set(&#x27;authtoken&#x27;, res.body.output.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = false;\n                                        if (Array.isArray(res.body.output.objects)) {\n                                            isValid = res.body.output.count &gt; 0;\n                                            _.each(res.body.output.objects, function(item) {\n                                                isValid = isValid &amp;&amp;\n                                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                    item.invitation == null;\n                                            });\n                                        }\n                                        isValid.should.equal(true);\n                                        done();\n                                    }\n                                });\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39296817-d80f-4622-a3f0-f5bef1a5e574&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list re-invited organization user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should list re-invited organization user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:700,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar user_uid = \&quot;\&quot;;\nvar email = _data.developer.email;\nvar inviteUser = function(callback) {\n    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles.Developer.uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    var tempLoginBody = getImmutable(loginBody);\n                    tempLoginBody.email = email;\n                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                        .send(tempLoginBody)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var userAuthToken = res.body.output.authtoken;\n                                api.post(\&quot;/enterprise/v1/organizations/:org_uid/invitation/accept\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                    .send({})\n                                    .set(&#x27;authtoken&#x27;, userAuthToken)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                                            .set(&#x27;authtoken&#x27;, userAuthToken)\n                                            .set(&#x27;org_uid&#x27;, org_uid)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    user_uid = res.body.output.uid;\n                                                    _models.OrganizationUser.findOne({\n                                                        user_uid: user_uid,\n                                                        org_uid: org_uid,\n                                                        deleted_at: null\n                                                    }).lean().exec(function(err, orgUser) {\n                                                        callback(err, orgUser);\n                                                    });\n                                                }\n                                            });\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\n\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.delete(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid\&quot;\n                        .replace(\&quot;:org_uid\&quot;, org_uid)\n                        .replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n                    .send({})\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            if (res.body.output.message == messageList.ORG_USER_DELETED_SUCCESS) {\n                                inviteUser(function(error, orgUser) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = false;\n                                                    if (Array.isArray(res.body.output.objects)) {\n                                                        isValid = res.body.output.count &gt; 0;\n                                                        _.each(res.body.output.objects, function(item) {\n                                                            isValid = isValid &amp;&amp;\n                                                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                typeof(item.__v) == \&quot;undefined\&quot;;\n                                                        });\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6801975-2b33-4a36-a47f-7c5980de08d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list re-invited organization user before accepting second invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should list re-invited organization user before accepting second invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:142,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar user_uid = \&quot;\&quot;;\nvar email = _data.developer.email;\nvar inviteUser = function(callback) {\n    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles.Developer.uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    callback(err, res);\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\n\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid\&quot;\n            .replace(\&quot;:org_uid\&quot;, org_uid)\n            .replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_USER_DELETED_SUCCESS) {\n                    inviteUser(function(error, orgUser) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = false;\n                                        if (Array.isArray(res.body.output.objects)) {\n                                            isValid = res.body.output.count &gt; 0;\n                                            _.each(res.body.output.objects, function(item) {\n                                                isValid = isValid &amp;&amp;\n                                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                                            });\n                                        }\n                                        isValid.should.equal(true);\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aeb8f2d2-e0b0-4d7a-979e-65d76edf540c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:419,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nfetchRoles({\n    done: done,\n    org_uid: org_uid\n}, function(res) {\n    inviteUsers({\n        roles: res.body.output.objects,\n        user_uid: user_uid,\n        org_uid: org_uid\n    }, function() {\n        api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n            .expect(httpStatus.UNAUTHORIZED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f985803f-5739-458a-9442-8d7f72103cc5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d08b9aeb-6489-45a8-9ddd-d7411d5d6dac&quot;,&quot;b7cce969-ffab-4ca6-bedf-29099a06eb69&quot;,&quot;8893f24d-9936-4b79-85da-e9a509f9337d&quot;,&quot;f49fed41-1a3f-42b0-918a-c33c22d6dd51&quot;,&quot;209b357d-875b-4011-a216-5c5bc5c37a83&quot;,&quot;39296817-d80f-4622-a3f0-f5bef1a5e574&quot;,&quot;f6801975-2b33-4a36-a47f-7c5980de08d7&quot;,&quot;aeb8f2d2-e0b0-4d7a-979e-65d76edf540c&quot;,&quot;f985803f-5739-458a-9442-8d7f72103cc5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3341,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8802f6b4-cd95-42d6-9db3-292c6a0ffe39&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ed03acd9-c713-4fa7-975d-d13bc403a444&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bd2cfb2e-bb96-4762-86d9-5bffee1b1942&quot;,&quot;title&quot;:&quot;OrganizationUser.removeSelf&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:166,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b53d735c-4cc2-4d22-a78d-0223f4ceb815&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3121261b-9e40-49ef-b5c0-7d7b92d11b47&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should left organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf Should left organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.ORG_USER_LEFT_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f89a91ff-2bac-43da-82f3-f502575b16c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should left organization if SSO is enable.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf Should left organization if SSO is enable.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:275,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({})\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.output.enable_sso) {\n                                        api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    res.body.output.message.should.equal(messageList.ORG_USER_LEFT_SUCCESS);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                        done();\n                                    }\n                                }\n                            });\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef9f948e-d088-461e-bda2-45b18e2a91d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({})\n    .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84e6bb76-ebbd-4ca1-b08f-89c99c4794e9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Owner sholud not leave organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf Owner sholud not leave organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_OWNER_LEAVE_NOT_ALLOWED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6fed946-8c5a-4d0e-9bfa-f75f13c8b7c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a99db410-543d-4928-b7e5-77031bc4f2f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f89a91ff-2bac-43da-82f3-f502575b16c3&quot;,&quot;ef9f948e-d088-461e-bda2-45b18e2a91d5&quot;,&quot;84e6bb76-ebbd-4ca1-b08f-89c99c4794e9&quot;,&quot;b6fed946-8c5a-4d0e-9bfa-f75f13c8b7c0&quot;,&quot;a99db410-543d-4928-b7e5-77031bc4f2f5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:368,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;950686dd-a04c-4ca9-b90a-e4d703894df9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a07dcf2f-0d77-44cd-af1f-55857daac007&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d24f56df-b7ea-4dfb-bcde-09f21e6dc219&quot;,&quot;title&quot;:&quot;Payment.cancelBraintreeSubscription&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.cancelBraintreeSubscription \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:402,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                _braintreeCustId = res.body.output.braintree_customerId;\n                _userUid = res.body.output.uid;\n                subscribedPayload.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                subscribedCanceledPayload.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                //commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                    .send(saveCardBody)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\n                            api.post(\&quot;/v1/webhook/subscription/start\&quot;)\n                                .send(subscribedPayload)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47965b10-ecfa-47e5-b960-71f8e76ce81a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.cancelBraintreeSubscription \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d1d2d225-8460-4d08-8a84-67be908bb2cf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should cancel subscription.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.cancelBraintreeSubscription Should cancel subscription.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:186,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscribedCanceledPayload)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            api.get(\&quot;/enterprise/v1/user\&quot;)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    // After cancelation of subcription default plans get set.\n                    commonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\n                    commonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\n                    api.get(\&quot;/enterprise/v1/user/account/subscription\&quot;)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                (res.body.output.billingDetails.firstName ==\n                                    registrationBody.first_name + \&quot; \&quot; + registrationBody.last_name).should.equal(true);\n                                done();\n                            }\n                        });\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32d71d29-b37a-49af-8fe8-d0ba43cca031&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should cancel subscription org user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.cancelBraintreeSubscription Should cancel subscription org user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:247,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n    var temp_subscribedCanceledPayload = getImmutable(subscribedCanceledPayload);\n    temp_subscribedCanceledPayload.options.braintree_customerId = data.organization_account.braintree_customerId;\n    api.post(apiURL)\n        .send(temp_subscribedCanceledPayload)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var org_uid = data.organization.uid;\n                var org_owner_authtoken = data.organization.uid;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52724d06-5750-4e6c-a053-e0e5505921df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;32d71d29-b37a-49af-8fe8-d0ba43cca031&quot;,&quot;52724d06-5750-4e6c-a053-e0e5505921df&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:433,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3b21a7f6-31a1-4b76-bf6d-ed65742680c9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fbe7bc55-d778-4d27-a6db-7f99b4ab3314&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2bb2d840-0748-4ab0-bf94-49517bc1de8c&quot;,&quot;title&quot;:&quot;Payment.createBraintreeSubscription&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.createBraintreeSubscription \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:349,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                _braintreeCustId = res.body.output.braintree_customerId;\n                _userUid = res.body.output.uid;\n                subscribedPayload.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                    .send(saveCardBody)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a28f61f3-af54-4b1e-8a6f-3542b55747c0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.createBraintreeSubscription \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;59750174-256d-402b-9e42-5f367af454c3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should subscribed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.createBraintreeSubscription Should subscribed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscribedPayload)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            api.get(\&quot;/enterprise/v1/user\&quot;)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    var _userUid = res.body.output.uid;\n                    var braintree_subscriptionId = res.body.output.braintree_subscriptionId;\n                    var isValid = _userUid != \&quot;\&quot; &amp;&amp;\n                        braintree_subscriptionId != \&quot;\&quot;;\n                    isValid.should.equal(true);\n                    done();\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;237bf6a1-b38d-4a77-9511-f4eaeefaf0ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should subscribed for org user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.createBraintreeSubscription Should subscribed for org user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:222,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n    commonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\n    var temp_subscribedPayload = getImmutable(subscribedPayload);\n    temp_subscribedPayload.options.braintree_customerId = data.organization_account.braintree_customerId;\n    api.post(apiURL)\n        .send(temp_subscribedPayload)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                _models.User.findOne({\n                    braintree_customerId: data.organization_account.braintree_customerId\n                }, function(error, user) {\n                    var braintree_subscriptionId = user.braintree_subscriptionId;\n                    var isValid = braintree_subscriptionId != \&quot;\&quot;;\n                    isValid.should.equal(true);\n                    done();\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9891dcd-ea17-45cc-9af3-cafdc4381879&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should reset credit limit email flag.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.createBraintreeSubscription Should reset credit limit email flag.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:96,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User._findOneAndUpdate({ \&quot;uid\&quot;: _userUid }, { credit_limit_email: true }, function(err, feature) {\n    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n    commonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\n    api.post(apiURL)\n        .send(subscribedPayload)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        var _userUid = res.body.output.uid;\n                        var braintree_subscriptionId = res.body.output.braintree_subscriptionId;\n                        var credit_limit_email = res.body.output.credit_limit_email;\n                        var isValid = _userUid != \&quot;\&quot; &amp;&amp;\n                            braintree_subscriptionId != \&quot;\&quot; &amp;&amp;\n                            credit_limit_email == false;\n                        isValid.should.equal(true);\n                        done();\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;865395ca-c69b-4a64-b697-e9e88398e063&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;237bf6a1-b38d-4a77-9511-f4eaeefaf0ba&quot;,&quot;e9891dcd-ea17-45cc-9af3-cafdc4381879&quot;,&quot;865395ca-c69b-4a64-b697-e9e88398e063&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:410,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;efd5020f-e65c-4b67-a184-4c1cac3de381&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;77726d31-a2b0-47dd-9ad5-b9a2c04fdc59&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;99cf1696-d110-452a-ae63-b3396b7e8ed9&quot;,&quot;title&quot;:&quot;Payment.disableAccount&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.disableAccount \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:334,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                    commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                    api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                        .send(saveCardBody)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                done();\n                            }\n                        });\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56e89522-4ce1-4a44-a039-4a096bbb4ad3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.disableAccount \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f6eaa7d-37be-4932-a3b8-9c433fb71d57&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should disable register user plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.disableAccount Should disable register user plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:263,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.force_suspend == false &amp;&amp;\n                res.body.output.set_disable_status &amp;&amp;\n                typeof(res.body.output.authtoken) == \&quot;string\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b6d0da1-3b4a-425c-b3bb-070f33ea4d0f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.disableAccount Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac67ec8e-81c6-48b4-a0ec-c0eca6ecedeb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9b6d0da1-3b4a-425c-b3bb-070f33ea4d0f&quot;,&quot;ac67ec8e-81c6-48b4-a0ec-c0eca6ecedeb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:276,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;90d81fc3-cbe5-4d5d-92f2-abd1c375b045&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cc6560c2-2dd4-4fd5-8693-ca5363eb261c&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d9b024b5-15ee-4590-aacc-04d58f0a1693&quot;,&quot;title&quot;:&quot;Payment.errorWhileBraintreeSubscription&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:349,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                _braintreeCustId = res.body.output.braintree_customerId;\n                _userUid = res.body.output.uid;\n                subscriptionError.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                    .send(saveCardBody)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;183cf174-ce56-449b-b7fa-2fcf527f3405&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0003853a-f74c-4d0e-9d23-4871403ddabb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should increment subscription failure count&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription Should increment subscription failure count&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscriptionError)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            api.get(\&quot;/enterprise/v1/user\&quot;)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    res.body.output.subscription_failure_count.should.equal(1);\n                    done();\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9dded505-0710-4e17-bbe1-70e754259aa4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should increment subscription failure count for org user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription Should increment subscription failure count for org user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:203,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n    var temp_subscriptionError = getImmutable(subscriptionError);\n    temp_subscriptionError.options.braintree_customerId = data.organization_account.braintree_customerId;\n    api.post(apiURL)\n        .send(temp_subscriptionError)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                _models.User.findOne({\n                    uid: data.organization.user_uid\n                }, function(error, user) {\n                    user.subscription_failure_count.should.equal(1);\n                    done();\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;99207eb9-3192-46f5-a166-1d307e6f035f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should suspend user, if subscription failure count is greater than two.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription Should suspend user, if subscription failure count is greater than two.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscriptionError)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(subscriptionError)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(subscriptionError)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    _models.User.findOne({\n                                        uid: _userUid\n                                    }, function(error, user) {\n                                        user.force_suspend.should.equal(true);\n                                        done();\n                                    });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b3957622-cb3b-496d-a66d-845545727181&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should suspend user, if subscription failure count is greater than two for org user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription Should suspend user, if subscription failure count is greater than two for org user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:199,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    var temp_subscriptionError = getImmutable(subscriptionError);\n    temp_subscriptionError.options.braintree_customerId = data.organization_account.braintree_customerId;\n    _models.User.findOneAndUpdate({\n        braintree_customerId: temp_subscriptionError.options.braintree_customerId\n    }, {\n        subscription_failure_count: 5\n    }, { new: true }, function(error, user) {\n        commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n        api.post(apiURL)\n            .send(temp_subscriptionError)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    _models.User.findOne({\n                        uid: data.organization_account.uid\n                    }, function(error, user) {\n                        user.force_suspend.should.equal(true);\n                        done();\n                    });\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;077c7eb3-5172-4a02-9efa-5805371c2bb0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9dded505-0710-4e17-bbe1-70e754259aa4&quot;,&quot;99207eb9-3192-46f5-a166-1d307e6f035f&quot;,&quot;b3957622-cb3b-496d-a66d-845545727181&quot;,&quot;077c7eb3-5172-4a02-9efa-5805371c2bb0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:526,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5e9bb35a-36f3-42bf-9383-82505f3b40bf&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f99b45b3-ffa0-49cb-ac69-9b261b8cfeae&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;08627312-9537-4706-98e4-3f1aae4d62a1&quot;,&quot;title&quot;:&quot;Payment.expiredInBraintreeSubscription&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.expiredInBraintreeSubscription \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:389,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                _braintreeCustId = res.body.output.braintree_customerId;\n                _userUid = res.body.output.uid;\n                subscribedPayload.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                subscriptionExpire.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                    .send(saveCardBody)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\n                            api.post(\&quot;/v1/webhook/subscription/start\&quot;)\n                                .send(subscribedPayload)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81529f64-a356-49c2-af99-f7484f7d7444&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.expiredInBraintreeSubscription \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e4243ca-bfc3-4662-a8d4-91561575c94b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should expired subscription.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.expiredInBraintreeSubscription Should expired subscription.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscriptionExpire)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            api.get(\&quot;/enterprise/v1/user\&quot;)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.force_suspend &amp;&amp;\n                            res.body.output.uid == _userUid;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;afac4620-5ab6-4091-bd25-8e0ecfbdaa3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should expired subscription for org user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.expiredInBraintreeSubscription Should expired subscription for org user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:226,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n    var temp_subscriptionExpire = getImmutable(subscriptionExpire);\n    temp_subscriptionExpire.options.braintree_customerId = data.organization_account.braintree_customerId;\n    api.post(apiURL)\n        .send(temp_subscriptionExpire)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                _models.User.findOne({\n                    uid: data.organization.user_uid\n                }, function(error, user) {\n                    user.force_suspend.should.equal(true);\n                    done();\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88913d78-eccb-464a-bb6c-4dc1edb80c51&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;afac4620-5ab6-4091-bd25-8e0ecfbdaa3a&quot;,&quot;88913d78-eccb-464a-bb6c-4dc1edb80c51&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:308,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;34ae1871-40ef-440d-9c39-6f61bd614da1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;338886dc-7ca4-4879-9d59-7e292b4bcae3&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3072360b-9a3c-4b07-b006-0bc60da0961b&quot;,&quot;title&quot;:&quot;Payment.getBillByUIDOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillByUIDOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1613,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/projects\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                project_uid = _.first(res.body.output.projects).uid\n                saveBillEntries(\n                    _.extend(getImmutable(billBody), {\n                        authtoken: authToken\n                    }),\n                    function(error, bills) {\n                        savedBills = bills;\n                        done();\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0063eb1-76f3-4bc8-b224-3a7d094fd7af&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillByUIDOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54bf6ae3-348c-451c-be0f-4ab2e9a1f626&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should gives bill on providing bill uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillByUIDOrg Should gives bill on providing bill uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:bill_uid\&quot;, savedBills[0].body.output.uid);\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(savedBills[0].body.output.uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84d71ae6-5a7d-4493-a7e6-2a528f8a1c2d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bill on providing wrong bill uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillByUIDOrg Should not gives bill on providing wrong bill uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:bill_uid\&quot;, \&quot;flabc\&quot;);\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea8e5d01-ce5d-4cc8-a936-12fc90c53a29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillByUIDOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;71aa2c4a-8db2-4f10-ac91-6a7f40afdffd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;84d71ae6-5a7d-4493-a7e6-2a528f8a1c2d&quot;,&quot;ea8e5d01-ce5d-4cc8-a936-12fc90c53a29&quot;,&quot;71aa2c4a-8db2-4f10-ac91-6a7f40afdffd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:103,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8e3f8d25-2f0e-481a-8a29-4224650dc725&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6b37576d-981f-4179-9814-3e347a44234b&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c1513f8b-128b-4b03-8fc8-212694937c47&quot;,&quot;title&quot;:&quot;Payment.getBillLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1578,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Bill.remove({ flow_name: new RegExp(&#x27;^utest_cases_&#x27;, \&quot;i\&quot;) }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, uid);\n                        saveBillEntries(\n                            _.extend(getImmutable(billBody), {\n                                authtoken: authToken\n                            }),\n                            function(error, bills) {\n                                savedBills = bills;\n                                done();\n                            });\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb0b3564-078a-494b-b65a-86deb566c336&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0dff32e-079a-4725-9266-b7cfc6d28369&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should get list of bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) == \&quot;number\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bbe23f6c-d769-4fe4-a346-0a2c2e25e41e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bill on filteration.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should gives bill on filteration.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?filter=utest_cases_1\&quot;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 1 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54881fae-bd52-4316-ae59-9aeae9cd9cdc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bill on filteration.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should not gives bill on filteration.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?filter=utest_cases_122\&quot;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73d87f1a-fa28-45bf-9a61-b09de6fb710f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bills on respective flow ids selections.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should gives bills on respective flow ids selections.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=fld5aaeb1211f273e3c41f01,fld5aaeb1211f273e3c41f02\&quot;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 2 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62986405-5add-45bd-ae2c-ba8ef43488be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bills on wrong flow ids selections.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should not gives bills on wrong flow ids selections.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=fld5aaeb1211f273e3c41f15,fld5aaeb1211f273e3c41f99\&quot;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9224f754-28d4-48e3-9ec6-2e4d45b204e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bill on providing bill id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should gives bill on providing bill id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?bill_uid=\&quot; + savedBills[0].body.output.uid;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 1 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7768acf-3379-495e-b20c-1075a2e7aa15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bill on providing wrong bill id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should not gives bill on providing wrong bill id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?bill_uid=flabc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88d55fb7-17ae-42a0-b210-3517040f270f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives 2 bills after skiping 2 bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should gives 2 bills after skiping 2 bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.Bill.find({\n                deleted_at: null,\n                user_uid: uid\n            }).sort({ \&quot;created_at\&quot;: 1 }).lean().exec(function(error, bills) {\n                if (error) {\n                    done(error);\n                } else {\n                    //bills = bills;\n                    //bills = utils.sortBy(bills, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                    var validOutput = false;\n                    if (res.body.output.count == 10) {\n                        validOutput = res.body.output.objects[0].uid == bills[2].uid &amp;&amp;\n                            res.body.output.objects[1].uid == bills[3].uid;\n                        if (validOutput) {\n                            _.each(res.body.output.objects, function(item) {\n                                validOutput = validOutput &amp;&amp;\n                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                    }\n                    validOutput.should.equal(true);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0699cec-79d8-4fd5-8028-f966d489c2fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bills in ascending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should gives bills in ascending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?field=created_at&amp;order=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.Bill.find({\n                deleted_at: null,\n                user_uid: uid\n            }).sort({ \&quot;created_at\&quot;: 1 }).lean().exec(function(error, bills) {\n                if (error) {\n                    done(error);\n                } else {\n                    //bills = convert.getJSON(bills);\n                    //bills = utils.sortBy(bills, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                    var validOutput = false;\n                    if (res.body.output.count == 10) {\n                        validOutput = res.body.output.objects[0].uid == bills[0].uid &amp;&amp;\n                            res.body.output.objects[9].uid == bills[9].uid;\n                        if (validOutput) {\n                            _.each(res.body.output.objects, function(item) {\n                                validOutput = validOutput &amp;&amp;\n                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                    }\n                    validOutput.should.equal(true);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3842675-03e5-45ef-b0a6-025594a5b4bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de04854f-cfc9-477a-9165-d1b8856ed036&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bbe23f6c-d769-4fe4-a346-0a2c2e25e41e&quot;,&quot;54881fae-bd52-4316-ae59-9aeae9cd9cdc&quot;,&quot;73d87f1a-fa28-45bf-9a61-b09de6fb710f&quot;,&quot;62986405-5add-45bd-ae2c-ba8ef43488be&quot;,&quot;9224f754-28d4-48e3-9ec6-2e4d45b204e0&quot;,&quot;a7768acf-3379-495e-b20c-1075a2e7aa15&quot;,&quot;88d55fb7-17ae-42a0-b210-3517040f270f&quot;,&quot;f0699cec-79d8-4fd5-8028-f966d489c2fc&quot;,&quot;a3842675-03e5-45ef-b0a6-025594a5b4bc&quot;,&quot;de04854f-cfc9-477a-9165-d1b8856ed036&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:384,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;15893cdf-c9a4-4dce-b0f8-e1a360b6cabf&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cab73618-3d3f-4c81-8957-36e03f74e5b7&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9cda2c22-d3a1-4f26-9741-97c8f4f7eb6c&quot;,&quot;title&quot;:&quot;Payment.getBillLogsOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1786,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        saveBillEntries(\n            _.extend(getImmutable(billBody), {\n                authtoken: authToken\n            }),\n            function(error, bills) {\n                savedBills = bills;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dbfc16f2-891c-4a31-b2e5-ac12bd2516d3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef413995-224f-45d7-8cea-74a59f4ab58d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should get list of bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) == \&quot;number\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7470c31c-df21-4b5d-9ac3-3785e787b53f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bill on filteration.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should gives bill on filteration.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?filter=utest_cases_1\&quot;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 1 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e86e17d-7b11-47fb-86f7-52496854ff14&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bill on filteration.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should not gives bill on filteration.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?filter=utest_cases_122\&quot;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;24f6dfc9-22f3-4dca-bea6-337c46e31cf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bills on respective flow ids selections.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should gives bills on respective flow ids selections.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=fld5aaeb1211f273e3c41f01,fld5aaeb1211f273e3c41f02\&quot;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 2 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72e8bac8-6d22-41b9-8106-381f74313c66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bills on wrong flow ids selections.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should not gives bills on wrong flow ids selections.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=fld5aaeb1211f273e3c41f15,fld5aaeb1211f273e3c41f99\&quot;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97dddf02-0141-4ee1-987e-d097e1de9801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bill on providing bill id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should gives bill on providing bill id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?bill_uid=\&quot; + savedBills[0].body.output.uid;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 1 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5303f0e0-3908-4ddb-9b7a-0879a6e01197&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bill on providing wrong bill id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should not gives bill on providing wrong bill id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?bill_uid=flabc\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a0e1e2d-44ce-4e25-b052-28d36dc4c3c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives 2 bills after skiping 2 bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should gives 2 bills after skiping 2 bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.Bill.find({\n                deleted_at: null,\n                user_uid: org_account_uid\n            }).sort({ \&quot;created_at\&quot;: 1 }).lean().exec(function(error, bills) {\n                if (error) {\n                    done(error);\n                } else {\n                    //bills = bills;\n                    //bills = utils.sortBy(bills, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                    var validOutput = false;\n                    if (res.body.output.count == 10) {\n                        validOutput = res.body.output.objects[0].uid == bills[2].uid &amp;&amp;\n                            res.body.output.objects[1].uid == bills[3].uid;\n                        if (validOutput) {\n                            _.each(res.body.output.objects, function(item) {\n                                validOutput = validOutput &amp;&amp;\n                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                    }\n                    validOutput.should.equal(true);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b63a7e8-cf50-4c79-be24-50a6563aa4df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bills in ascending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should gives bills in ascending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?field=created_at&amp;order=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.Bill.find({\n                deleted_at: null,\n                user_uid: org_account_uid\n            }).sort({ \&quot;created_at\&quot;: 1 }).lean().exec(function(error, bills) {\n                if (error) {\n                    done(error);\n                } else {\n                    //bills = convert.getJSON(bills);\n                    //bills = utils.sortBy(bills, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                    var validOutput = false;\n                    if (res.body.output.count == 10) {\n                        validOutput = res.body.output.objects[0].uid == bills[0].uid &amp;&amp;\n                            res.body.output.objects[9].uid == bills[9].uid;\n                        if (validOutput) {\n                            _.each(res.body.output.objects, function(item) {\n                                validOutput = validOutput &amp;&amp;\n                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                    }\n                    validOutput.should.equal(true);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;531a0091-9fe5-4e51-b2b6-24f6e91d3588&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a58c4e3c-7101-4ccf-af07-c95dd46f95f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7470c31c-df21-4b5d-9ac3-3785e787b53f&quot;,&quot;6e86e17d-7b11-47fb-86f7-52496854ff14&quot;,&quot;24f6dfc9-22f3-4dca-bea6-337c46e31cf5&quot;,&quot;72e8bac8-6d22-41b9-8106-381f74313c66&quot;,&quot;97dddf02-0141-4ee1-987e-d097e1de9801&quot;,&quot;5303f0e0-3908-4ddb-9b7a-0879a6e01197&quot;,&quot;9a0e1e2d-44ce-4e25-b052-28d36dc4c3c2&quot;,&quot;8b63a7e8-cf50-4c79-be24-50a6563aa4df&quot;,&quot;531a0091-9fe5-4e51-b2b6-24f6e91d3588&quot;,&quot;a58c4e3c-7101-4ccf-af07-c95dd46f95f1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:437,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e5e4df0f-1493-4ba5-a5a9-1a87944c5ddf&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;da904153-8449-4b3a-82c9-2036100cf792&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6aff717e-9e2e-4284-9355-ccba4046a892&quot;,&quot;title&quot;:&quot;Payment.getBraintreeToken&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:247,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    user_uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;15ae80f4-db99-4fca-9bc7-6bb47b767471&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ebe6eada-4225-41ad-9e48-6b0c97472d4f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get client braintree token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken Should get client braintree token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.token.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9659ed42-5931-4e55-a574-83a7e335a0ab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have braintree id is blank.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken Should get client braintree token, if user have braintree id is blank.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: user_uid\n            }).lean().exec(function(err, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: user_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;\&quot;\n                    }).lean().exec(function(err, user) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: user_uid\n                                        }).lean().exec(function(err, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;895e85be-de19-488c-a828-606df5b7fe1e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have invalid braintree id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken Should get client braintree token, if user have invalid braintree id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: user_uid\n            }).lean().exec(function(error, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: user_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;00000005620\&quot;\n                    }).lean().exec(function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: user_uid\n                                        }).lean().exec(function(error, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5cc77175-d179-4397-a1b6-43b781f757ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have default invalid braintree id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken Should get client braintree token, if user have default invalid braintree id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:99,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: user_uid\n            }).lean().exec(function(error, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: user_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;210934322\&quot;\n                    }).lean().exec(function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: user_uid\n                                        }).lean().exec(function(error, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;40d245cc-b220-408e-a73a-7b78753bc4dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea59e753-b981-4bf6-a51d-0acd105bba44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9659ed42-5931-4e55-a574-83a7e335a0ab&quot;,&quot;895e85be-de19-488c-a828-606df5b7fe1e&quot;,&quot;5cc77175-d179-4397-a1b6-43b781f757ca&quot;,&quot;40d245cc-b220-408e-a73a-7b78753bc4dd&quot;,&quot;ea59e753-b981-4bf6-a51d-0acd105bba44&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:354,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0f744b99-2c2b-4d4f-91cd-6aaca9b727c6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ca48f91e-0e5f-43ce-bc38-64de56d32ecb&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;aeb23b28-7dc9-44a2-823a-fc4c3cbc0bb8&quot;,&quot;title&quot;:&quot;Payment.getBraintreeTokenOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:200,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5bf65d2-39ee-448a-b7a1-c338e8fa9b7f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60c0fa48-77d4-4e2c-8e16-d58a533a5e63&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get client braintree token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg Should get client braintree token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.token.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f3b1325-1bc5-4c13-ae7e-30b96146cdf2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have braintree id is blank.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg Should get client braintree token, if user have braintree id is blank.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:103,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: org_account_uid\n            }).lean().exec(function(err, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: org_account_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;\&quot;\n                    }).lean().exec(function(err, user) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;org_uid&#x27;, org_uid)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: org_account_uid\n                                        }).lean().exec(function(err, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13b90311-076f-4a4a-bfb4-3c0e10b26043&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have invalid braintree id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg Should get client braintree token, if user have invalid braintree id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: org_account_uid\n            }).lean().exec(function(error, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: org_account_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;00000005620\&quot;\n                    }).lean().exec(function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;org_uid&#x27;, org_uid)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: org_account_uid\n                                        }).lean().exec(function(error, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37c12128-efde-4d90-b68c-ec1222245b9e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have default invalid braintree id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg Should get client braintree token, if user have default invalid braintree id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:99,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: org_account_uid\n            }).lean().exec(function(error, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: org_account_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;210934322\&quot;\n                    }).lean().exec(function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;org_uid&#x27;, org_uid)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: org_account_uid\n                                        }).lean().exec(function(error, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4265c449-5de1-46e9-89cf-395ce29fda2b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46708148-ad47-401c-9916-8a88b8a454a9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7f3b1325-1bc5-4c13-ae7e-30b96146cdf2&quot;,&quot;13b90311-076f-4a4a-bfb4-3c0e10b26043&quot;,&quot;37c12128-efde-4d90-b68c-ec1222245b9e&quot;,&quot;4265c449-5de1-46e9-89cf-395ce29fda2b&quot;,&quot;46708148-ad47-401c-9916-8a88b8a454a9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:366,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1d25f2b5-5a04-4e00-ad97-b3fc2d75db4a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2100ddbd-f8f9-48e0-b78a-44b0bff1c747&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f541e7e1-d042-4846-8405-1fa7bee9e8b0&quot;,&quot;title&quot;:&quot;Payment.getCardDetail&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetail \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:209,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d809f93-602b-4375-90cc-d8dbf7433356&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetail \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60f1952d-d973-42cf-a787-27d85f396e96&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get card details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetail Should get card details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.token.should.not.empty;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee427be6-9a87-4666-8813-200adab4078b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetail Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81b7d344-56e8-4757-bd0e-ace7c3bae017&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ee427be6-9a87-4666-8813-200adab4078b&quot;,&quot;81b7d344-56e8-4757-bd0e-ace7c3bae017&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b7bd3575-2da6-417b-805e-51101a459f0f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5fb8a26e-82c7-4f81-8264-3a4f06161d8c&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1333df3e-1b97-434c-8438-b32faa59b4aa&quot;,&quot;title&quot;:&quot;Payment.getCardDetailOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetailOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:169,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9c43232-a81e-46fe-b129-a82a01ced6c7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetailOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e1e1f5c-a6f1-460b-9960-b643c8171679&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get card details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetailOrg Should get card details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.token.should.not.empty;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d27015c8-800e-49b1-80b5-4f6d05002c97&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetailOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e833308b-0b04-48c2-9e3c-36f3435395c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d27015c8-800e-49b1-80b5-4f6d05002c97&quot;,&quot;e833308b-0b04-48c2-9e3c-36f3435395c5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:62,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c3a47a07-e20f-41e0-be93-af01d9755362&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a1e5034b-ba51-4b70-acbd-3c7381db2c91&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0565188b-7696-4778-b328-8bfa8150e681&quot;,&quot;title&quot;:&quot;Payment.getClientTokenOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getClientTokenOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:172,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33f3bf6e-69ca-488e-b305-cd39c8ad4b91&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getClientTokenOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ffd7d67d-2167-42aa-83c0-f1723fa81735&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getClientTokenOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2efb7757-7a7e-4d9e-8438-434da8ce530e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get current user payment logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getClientTokenOrg Should get current user payment logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                if (res.body.output.length &gt; 0) {\n                    isValid = (_.first(res.body.output) || {}).user_uid == userUid;\n                }\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2855232a-9906-4baf-b001-89ca12b9e05d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getClientTokenOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;802b77d4-23b8-4d48-a375-4b1b40ddfad6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2855232a-9906-4baf-b001-89ca12b9e05d&quot;,&quot;802b77d4-23b8-4d48-a375-4b1b40ddfad6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;748c72d9-ebc2-4c66-b9e2-cf84d5861af2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a4a4744f-58cd-4e0c-bbe9-6dd03430ff90&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;094a6fa8-97ab-450e-9af1-eba99fa8f83e&quot;,&quot;title&quot;:&quot;Payment.getCreditDetails&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:575,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    saveInvoices({\n                        authToken: authToken,\n                        braintree_customerId: res.body.output.braintree_customerId || \&quot;\&quot;,\n                        uid: res.body.output.uid || \&quot;\&quot;\n                    }, function() {\n                        var obj = {\n                            title: \&quot;test1\&quot;,\n                            body_detail: \&quot;test1\&quot;,\n                            email_body: \&quot;test1\&quot;,\n                            agreement_link: \&quot;http://example.com\&quot;,\n                            schedule_link: \&quot;http://example.com\&quot;,\n                            attachment_link: \&quot;http://example.com\&quot;,\n                            message: \&quot;test msg\&quot;,\n                            email: \&quot;test@example.com\&quot;,\n                            subject: \&quot;test\&quot;\n                        }\n                        _models.CreditDetail.create(obj, function(err, detail) {\n                            credit_details_uid = detail.uid;\n                            done();\n                        });\n                    });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a442205f-cff8-4821-83cc-81e4add6e29e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;deleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e42e4957-9576-4743-a3ca-c8f843cd1f8d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5903b5d6-8c9e-42e0-9a23-7e13ccc740ec&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get credit details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails Should get credit details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:uid\&quot;, credit_details_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;433de096-44fb-4d12-85ff-916a2555c287&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give credit details not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails Should give credit details not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:uid\&quot;, \&quot;FAKE_UID\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CARD_DETAIL_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;923e7308-df59-4457-be92-2c279af0eaf7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdateCustomerPaymentDetail(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d47cf222-70b7-4897-8d4e-dc27b4b64435&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;433de096-44fb-4d12-85ff-916a2555c287&quot;,&quot;923e7308-df59-4457-be92-2c279af0eaf7&quot;,&quot;d47cf222-70b7-4897-8d4e-dc27b4b64435&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:89,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2c930cb6-f279-42de-9db8-817bca269127&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;de598acf-00a5-4bef-b4c6-00c590f189f4&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9ecee76e-bdad-497b-87db-3260e69f09d4&quot;,&quot;title&quot;:&quot;Payment.getPaymentLog&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLog \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:381,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    userUid = res.body.output.uid;\n                    savePaymentLogs({\n                        authToken: authToken,\n                        braintree_customerId: res.body.output.braintree_customerId || \&quot;\&quot;,\n                        uid: res.body.output.uid || \&quot;\&quot;\n                    }, function() {\n                        done();\n                    });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9066df32-6cc1-41ec-850f-1f16400e3e8c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLog \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;deleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48b0fc99-f8bc-46f7-a520-20b4be0fc3b2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLog \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1729ce94-eda5-4cb2-a3d9-c3c8093b2c2e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get current user payment logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLog Should get current user payment logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                if (res.body.output.length &gt; 0) {\n                    isValid = (_.first(res.body.output) || {}).user_uid == userUid;\n                }\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e75d587c-5694-44c3-b1bd-873cf3ac09bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLog Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55fd0ca1-d89f-4109-938a-b9da490ee68d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e75d587c-5694-44c3-b1bd-873cf3ac09bc&quot;,&quot;55fd0ca1-d89f-4109-938a-b9da490ee68d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:52,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;edde63a8-06bb-4024-810a-238da31eacf4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d9e55f49-fe1b-4b9d-a476-a5615c570fb7&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f7ce57d5-77a2-4ca3-90b4-64596909be98&quot;,&quot;title&quot;:&quot;Payment.getPaymentLogOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLogOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:174,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0cf35377-ac3b-449c-9bd0-54c939e28072&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLogOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;215c3705-d975-4ac1-9954-91828b3e7541&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLogOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7f818cd-d89c-4efe-82df-643426685cd8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get current user payment logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLogOrg Should get current user payment logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                if (res.body.output.length &gt; 0) {\n                    isValid = (_.first(res.body.output) || {}).user_uid == userUid;\n                }\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1edc7abe-b243-4cf5-aeae-9a0b34db1bd8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLogOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc1e87ae-8de5-462c-a490-ac229c2f380a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1edc7abe-b243-4cf5-aeae-9a0b34db1bd8&quot;,&quot;fc1e87ae-8de5-462c-a490-ac229c2f380a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ac4048d1-494b-4dda-b08c-4a4827088616&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;412a7c96-9e3c-4e26-9dd0-16ea587908b9&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6280b10c-5d02-422b-8103-bdcd35f08ba8&quot;,&quot;title&quot;:&quot;Payment.getPaymentSet&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSet \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:248,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    var data = res.body.output;\n                    authToken = data.authtoken;\n                    _id = data._id;\n                    payment_set = data.payment_set;\n                    if (error) {\n                        done(error);\n                    } else {\n                        done();\n                    }\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f79cda9-f34c-42e8-a3fa-b76c9d967a88&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSet \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f2d62308-987a-4b16-ad37-8f09bb8a3fe6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get payment_set for user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSet Should get payment_set for user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (res.body.output.payment_set != \&quot;\&quot; &amp;&amp;\n                res.body.output.payment_set != payment_set)\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6942bc5b-fa5e-4367-b485-6141b1b5cecb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSet Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;627dc048-ba22-4432-b3c6-15a08f70025b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6942bc5b-fa5e-4367-b485-6141b1b5cecb&quot;,&quot;627dc048-ba22-4432-b3c6-15a08f70025b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;34d6746a-7f83-4100-b6fd-fc0801a1d6ba&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6ad530e8-1baf-4229-83e0-aa2856c212ce&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8d1e3385-95ff-4781-9ddf-02a922d4923b&quot;,&quot;title&quot;:&quot;Payment.getPaymentSetOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSetOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:178,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;edbec387-875b-46e2-93ef-cfc578ae579e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSetOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc6c5e81-de58-4e1d-8c8a-35905b9ddcb6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get payment_set for user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSetOrg Should get payment_set for user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (res.body.output.payment_set != \&quot;\&quot; &amp;&amp;\n                res.body.output.payment_set != payment_set)\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;373c2c85-8636-4d87-a42e-c0d721ed4b88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSetOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;071bb5a0-0ca9-4dca-b183-82dcfde403f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;373c2c85-8636-4d87-a42e-c0d721ed4b88&quot;,&quot;071bb5a0-0ca9-4dca-b183-82dcfde403f8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;13be28a9-62ad-4c73-948f-091a9d5bab06&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8094ab55-e6a9-43dc-8486-df9838d73daf&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;04caafa8-f600-4ea3-bb33-9ee8935b042a&quot;,&quot;title&quot;:&quot;Payment.getStatistic&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:279,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function(error, output) {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                user_uid = res.body.output.uid;\n                email = res.body.output.email;\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(\&quot;authtoken\&quot;, authToken)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        done();\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec86bb26-fe8e-4832-9fa8-d8d355c94d5a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;removeRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;943a5f85-ad91-497b-9db6-8241c3f2286c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66a47846-df7c-4d59-a5f6-3672ce8fab11&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get list of bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cef94a63-c34f-4791-804d-7755cbff5133&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of triggers of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of triggers of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserTriggers(function(error, triggers) {\n    var filterURL = apiURL + \&quot;?get=triggercount\&quot;;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) == 10).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee4ed316-6b72-40b7-ae7d-443dc8492a34&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of triggers of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of triggers of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserTriggers(function(error, triggers) {\n    var frange = triggers[2].toJSON().created_at.toISOString();\n    var srange = triggers[8].toJSON().created_at.toISOString();\n    var filterURL = apiURL + \&quot;?get=triggercount&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt; 0).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b693f931-645a-445f-bdb9-7d26247d197b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of flows of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1041,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserFlows(done, function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flowcount\&quot;;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 10).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1a713aa-4db1-4b4c-8840-5c1f0c6e84f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of flows of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1099,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserFlows(done, function(error, flows) {\n    var frange = new Date((new Date(flows[1].created_at)) - 300000).toISOString();\n    var srange = (new Date(flows[8].created_at)).toISOString();\n    var filterURL = apiURL + \&quot;?get=flowcount&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 9).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3edc587d-d47e-45b1-b530-549a1185172c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of present flows of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of present flows of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:132,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flowspresent\&quot;;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                parseInt(res.body.output.objects).should.not.equal(NaN);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b3247f0b-a220-4527-bee6-4ecfcc4cb2a8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of present flows of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of present flows of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:126,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var frange = new Date((new Date(flows[1].created_at.toISOString())) - 300000).toISOString();\n    var srange = flows[8].created_at.toISOString();\n    var filterURL = apiURL + \&quot;?get=flowspresent&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                parseInt(res.body.output.objects).should.not.equal(NaN);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1770918f-c3b1-42dd-897a-0195b2e0f6d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count zero credits.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count zero credits.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:294,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1000@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var filterURL = apiURL + \&quot;?get=credits\&quot;;\n            api.get(filterURL)\n                .set(&#x27;authtoken&#x27;, res.body.output.authtoken)\n                .expect(httpStatus.OK)\n                .end(function(error, res) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        (parseInt(res.body.output.objects) == 0).should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06d7423c-048c-433c-ba60-2d511d71d5e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows and triggers of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of flows and triggers of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:151,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flow_trigger\&quot;;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (typeof(res.body.output.trigger) == \&quot;number\&quot; &amp;&amp;\n                    typeof(res.body.output.flows) == \&quot;number\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff7a90c6-f046-460f-8c34-0ba9f69f431b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get userstream count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get userstream count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:336,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n    user_uid: user_uid\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n        user_uid: user_uid\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=librarydownload\&quot;;\n        api.get(filterURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44752a41-8e70-448e-ad20-4980fd7c1331&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get library download count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get library download count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:346,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=librarydownload\&quot;;\n        api.get(filterURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a28d091-9a05-4d89-9287-88cd80ab2a0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow shared count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get flow shared count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:337,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=flowshared\&quot;;\n        api.get(filterURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d87706f6-4b70-4de3-8bf1-b8f027c2ca2f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow total run count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get flow total run count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:347,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=totalrun\&quot;;\n        api.get(filterURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b1e3ed9d-ed56-4e91-8f4c-2389c284e01f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c1d4bf9-7bc4-47c7-b5b2-22d0d5b424ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cef94a63-c34f-4791-804d-7755cbff5133&quot;,&quot;ee4ed316-6b72-40b7-ae7d-443dc8492a34&quot;,&quot;b693f931-645a-445f-bdb9-7d26247d197b&quot;,&quot;c1a713aa-4db1-4b4c-8840-5c1f0c6e84f8&quot;,&quot;3edc587d-d47e-45b1-b530-549a1185172c&quot;,&quot;b3247f0b-a220-4527-bee6-4ecfcc4cb2a8&quot;,&quot;1770918f-c3b1-42dd-897a-0195b2e0f6d7&quot;,&quot;06d7423c-048c-433c-ba60-2d511d71d5e1&quot;,&quot;ff7a90c6-f046-460f-8c34-0ba9f69f431b&quot;,&quot;44752a41-8e70-448e-ad20-4980fd7c1331&quot;,&quot;8a28d091-9a05-4d89-9287-88cd80ab2a0c&quot;,&quot;d87706f6-4b70-4de3-8bf1-b8f027c2ca2f&quot;,&quot;b1e3ed9d-ed56-4e91-8f4c-2389c284e01f&quot;,&quot;1c1d4bf9-7bc4-47c7-b5b2-22d0d5b424ad&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4392,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;02512cee-346a-4248-bbf8-369f5a533364&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3a70cc02-2fd6-4384-9478-d4ba4a9fae25&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;eb1fe881-6d32-4a82-9b62-6975a3c0e00e&quot;,&quot;title&quot;:&quot;Payment.getStatisticMonthWise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWise \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:598,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nremoveRecords(function() {\n    async.waterfall([\n        function(cbk) {\n            _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n                cbk(err, user);\n            })\n        },\n        function(userTrigger, cbk) {\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(testData.testRegistrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    user_uid = res.body.output.uid;\n                    email = res.body.output.email;\n                    cbk(err, res);\n                })\n        },\n        function(result, cbk) {\n            dummyUser = result.body.output;\n            testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n            _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                cbk(err, userTrigger);\n            })\n        },\n        function(userTrigger, cbk) {\n            var userTriggerObj = userTrigger;\n            var flowData = _.cloneDeep(testData.flowBody);\n            flowData.isExpress = false;\n            flowData.trigger.handlers = [userTriggerObj.uid]\n            async.parallel({\n                triggerFlow: function(cb) {\n                    createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                inactiveFlow: function(cb) {\n                    var inactiveFlow = _.cloneDeep(flowData);\n                    inactiveFlow.active = false;\n                    createFlow(flowURL, inactiveFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                draftFlow: function(cb) {\n                    var draftFlow = _.cloneDeep(flowData);\n                    draftFlow.is_draft = true;\n                    createFlow(flowURL, draftFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                webHookFlow: function(cb) {\n                    var WHFlow = _.cloneDeep(flowData);\n                    WHFlow.trigger = testData.defaultTriggerObj;\n                    WHFlow.settings = testData.webHookSetting;\n                    WHFlow.active = true;\n                    WHFlow.settings = testData.webHookSetting;\n                    createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                invalidEnvFlow: function(cb) {\n                    var IVWHFlow = _.cloneDeep(flowData);\n                    IVWHFlow.trigger = testData.defaultTriggerObj;\n                    IVWHFlow.settings = testData.webHookSetting;\n                    IVWHFlow.environment[0].params.push({ key: \&quot;body\&quot;, required: true });\n                    createFlow(flowURL, IVWHFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                }\n            }, function(err, result) {\n                cbk(err, result)\n            })\n        }\n    ], function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userTriggerFlow = res.triggerFlow.body.output;\n            userDraftFlow = res.draftFlow.body.output;\n            userWebHookFlow = res.webHookFlow.body.output;\n            invalidEnvFlow = res.invalidEnvFlow.body.output;\n            inactiveFlow = res.inactiveFlow.body.output;\n            _models.newFlow.findOneAndUpdate({ uid: userWebHookFlow.uid }, {\n                current_month_run_time: 5,\n                total_run_count: 20\n            }, function(err, deletedFlows) {\n                done();\n            });\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ca62010-e89a-4966-8bf4-ecc32a28d852&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWise \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0492802-39d6-41b0-8f41-c9a1920d0b97&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWise \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bf026dd6-573d-4975-8f18-38b7f9565218&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get month wise flow statistic of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWise Should get month wise flow statistic of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (isNaN(parseInt(res.body.output.current_month_run)) == false &amp;&amp;\n                isNaN(parseInt(res.body.output.total_run)) == false) {\n                isValid = parseInt(res.body.output.current_month_run) &gt; 0 &amp;&amp;\n                    parseInt(res.body.output.total_run) &gt; 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1166293b-d206-41d6-a868-b94caf0529c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWise Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7627f6ea-06a4-49b8-bb6a-5f4c3fdecd96&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1166293b-d206-41d6-a868-b94caf0529c8&quot;,&quot;7627f6ea-06a4-49b8-bb6a-5f4c3fdecd96&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:48,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b28e6a5b-8ad0-48be-97a8-90cb99cda439&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;845f2681-f308-4e3b-bb6a-6f0ed4367605&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;54b10207-f4c9-413f-be17-f8572b89d705&quot;,&quot;title&quot;:&quot;Payment.getStatisticMonthWiseOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWiseOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1322,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nremoveRecords(function() {\n    async.waterfall([\n        function(cbk) {\n            _models.User.remove({}, function(err, user) {\n                cbk(err, user);\n            })\n        },\n        function(userTrigger, cbk) {\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(testData.testRegistrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    user_uid = res.body.output.uid;\n                    email = res.body.output.email;\n                    createOrgEntries({\n                        done: done\n                    }, function() {\n                        cbk(err, res);\n                    });\n                })\n        },\n        function(result, cbk) {\n            dummyUser = result.body.output;\n            testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n            _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                cbk(err, userTrigger);\n            })\n        },\n        function(userTrigger, cbk) {\n            var userTriggerObj = userTrigger;\n            var flowData = _.cloneDeep(testData.flowBody);\n            flowData.isExpress = false;\n            flowData.trigger.handlers = [userTriggerObj.uid]\n            async.parallel({\n                triggerFlow: function(cb) {\n                    createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                inactiveFlow: function(cb) {\n                    var inactiveFlow = _.cloneDeep(flowData);\n                    inactiveFlow.active = false;\n                    createFlow(flowURL, inactiveFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                draftFlow: function(cb) {\n                    var draftFlow = _.cloneDeep(flowData);\n                    draftFlow.is_draft = true;\n                    createFlow(flowURL, draftFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                webHookFlow: function(cb) {\n                    var WHFlow = _.cloneDeep(flowData);\n                    WHFlow.trigger = testData.defaultTriggerObj;\n                    WHFlow.settings = testData.webHookSetting;\n                    WHFlow.active = true;\n                    WHFlow.settings = testData.webHookSetting;\n                    createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                invalidEnvFlow: function(cb) {\n                    var IVWHFlow = _.cloneDeep(flowData);\n                    IVWHFlow.trigger = testData.defaultTriggerObj;\n                    IVWHFlow.settings = testData.webHookSetting;\n                    IVWHFlow.environment[0].params.push({ key: \&quot;body\&quot;, required: true });\n                    createFlow(flowURL, IVWHFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                }\n            }, function(err, result) {\n                cbk(err, result)\n            })\n        }\n    ], function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userTriggerFlow = res.triggerFlow.body.output;\n            userDraftFlow = res.draftFlow.body.output;\n            userWebHookFlow = res.webHookFlow.body.output;\n            invalidEnvFlow = res.invalidEnvFlow.body.output;\n            inactiveFlow = res.inactiveFlow.body.output;\n            _models.newFlow.findOneAndUpdate({ uid: userWebHookFlow.uid }, {\n                current_month_run_time: 5,\n                total_run_count: 20\n            }, function(err, deletedFlows) {\n                done();\n            });\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8347ee1b-659d-4e97-9233-0e982324ad6d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWiseOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b5c273ee-25eb-4f08-9722-b20d2c81f80f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWiseOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5b3509c5-a80b-4120-853d-383bd56778b8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get month wise flow statistic of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWiseOrg Should get month wise flow statistic of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (isNaN(parseInt(res.body.output.current_month_run)) == false &amp;&amp;\n                isNaN(parseInt(res.body.output.total_run)) == false) {\n                isValid = parseInt(res.body.output.current_month_run) &gt; 0 &amp;&amp;\n                    parseInt(res.body.output.total_run) &gt; 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2700336c-58f7-493d-bec6-8e7bebd18ebf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWiseOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;749da5da-3d4f-49ca-a146-a1e194e7094e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2700336c-58f7-493d-bec6-8e7bebd18ebf&quot;,&quot;749da5da-3d4f-49ca-a146-a1e194e7094e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:65,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b2ca5566-ec2e-4363-ae85-57e73357d50f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cd9add10-7c22-46fa-b092-469f27aa946d&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;01e369eb-850e-4d25-8b78-88b590beaf8e&quot;,&quot;title&quot;:&quot;Payment.getStatisticOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:259,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                env_uid = res.body.output.env_uid;\n                api.get(\&quot;/enterprise/v1/projects\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(error, res) {\n                        project_uid = _.first(res.body.output.projects).uid\n                        done();\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f18c783-8aaf-4f18-a294-d05029753b2a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;535b340d-9f51-4c1f-9309-4c6fa7ca09c3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get list of bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8199bfe5-1ccf-4175-b3cd-ff395e98c512&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of triggers of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of triggers of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:103,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserTriggers({\n    user_uid: org_account_uid,\n    project_uid: project_uid,\n    org_uid: org_uid\n}, function(error, triggers) {\n    var filterURL = apiURL + \&quot;?get=triggercount\&quot;;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) == 10).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84d80084-7497-4809-8412-80dd17e8d12a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of triggers of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of triggers of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:74,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserTriggers({\n    user_uid: org_account_uid,\n    project_uid: project_uid,\n    org_uid: org_uid\n}, function(error, triggers) {\n    var frange = triggers[2].toJSON().created_at.toISOString();\n    var srange = triggers[8].toJSON().created_at.toISOString();\n    var filterURL = apiURL + \&quot;?get=triggercount&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) == 6).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a8b9dad-f23d-4da0-9c09-e30df7c188f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of flows of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1106,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserFlows(done, function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flowcount\&quot;;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 10).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d02c47d2-1e23-4eef-bbeb-c0922d6e7afd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of flows of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1087,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserFlows(done, function(error, flows) {\n    var frange = new Date((new Date(flows[1].created_at)) - 300000).toISOString();\n    var srange = (new Date(flows[8].created_at)).toISOString();\n    var filterURL = apiURL + \&quot;?get=flowcount&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 10).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a1e9549-ed2c-494a-8be7-a6534e288da0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of present flows of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of present flows of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1055,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flowspresent\&quot;;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 9).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da01eab9-02b0-4582-a5af-f07d12e05a2d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of present flows of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of present flows of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1056,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var frange = new Date((new Date(flows[1].created_at)) - 300000).toISOString();\n    var srange = flows[8].created_at;\n    var filterURL = apiURL + \&quot;?get=flowspresent&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 9).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3222ce8d-fce9-43c4-818b-30013822b9c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count zero credits.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count zero credits.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1244,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=credits\&quot;;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (typeof(res.body.output.objects) == \&quot;number\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a164ed4-953b-446f-9f37-ff4242c20b28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows and triggers of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of flows and triggers of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flow_trigger\&quot;;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (typeof(res.body.output.trigger) == \&quot;number\&quot; &amp;&amp;\n                    typeof(res.body.output.flows) == \&quot;number\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b797076-3c20-4cb3-b209-119635ff8ac2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get userstream count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get userstream count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:308,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n    user_uid: user_uid\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n        user_uid: user_uid\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=librarydownload\&quot;;\n        api.get(filterURL)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44deed48-fdd9-48f2-ab31-80d8275e993f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get library download count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get library download count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:314,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=librarydownload\&quot;;\n        api.get(filterURL)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46076154-cc8e-48bc-b62c-10252d2fa130&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow shared count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get flow shared count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:310,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=flowshared\&quot;;\n        api.get(filterURL)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d5ececa3-77dd-4939-9d7f-168114e93a96&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow total run count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get flow total run count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:306,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=totalrun\&quot;;\n        api.get(filterURL)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9656612-ae13-4586-a725-4cc0e0f6d5f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cafa9cf4-7ecd-4e1a-8edb-2e8d10209aa3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8199bfe5-1ccf-4175-b3cd-ff395e98c512&quot;,&quot;84d80084-7497-4809-8412-80dd17e8d12a&quot;,&quot;2a8b9dad-f23d-4da0-9c09-e30df7c188f0&quot;,&quot;d02c47d2-1e23-4eef-bbeb-c0922d6e7afd&quot;,&quot;2a1e9549-ed2c-494a-8be7-a6534e288da0&quot;,&quot;da01eab9-02b0-4582-a5af-f07d12e05a2d&quot;,&quot;3222ce8d-fce9-43c4-818b-30013822b9c2&quot;,&quot;9a164ed4-953b-446f-9f37-ff4242c20b28&quot;,&quot;8b797076-3c20-4cb3-b209-119635ff8ac2&quot;,&quot;44deed48-fdd9-48f2-ab31-80d8275e993f&quot;,&quot;46076154-cc8e-48bc-b62c-10252d2fa130&quot;,&quot;d5ececa3-77dd-4939-9d7f-168114e93a96&quot;,&quot;c9656612-ae13-4586-a725-4cc0e0f6d5f7&quot;,&quot;cafa9cf4-7ecd-4e1a-8edb-2e8d10209aa3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8189,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;58356888-a462-471a-866e-414229b2fa4e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;88edfa3b-724e-4f93-a198-db7ad552a7c6&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f2a9bb28-3319-4482-ba09-06e7886e9636&quot;,&quot;title&quot;:&quot;Payment.getSubscriptionDetailFromBraintree&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintree \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:245,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    token = res.body.output.activation_token;\n                    _id = res.body.output._id;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;349f8451-3a23-46d6-a6b8-2c24b2e95985&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintree \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df8dddcf-7b23-4ed8-a263-12e6dc18cac4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should suspend user account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintree Should suspend user account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: uid }, {\n    braintree_subscriptionId: \&quot;FAKE_SUBSCRIPTION_ID\&quot;,\n    braintree_customerId: \&quot;FAKE_ID\&quot;,\n    merchantid: \&quot;FAKE_MERCHANT_ID\&quot;\n}, function(error, user) {\n    commonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\n    commonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\n    api.get(apiURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                (res.body.output.cardDetails.cardholderName == res.body.output.billingDetails.firstName &amp;&amp; res.body.output.billingDetails.firstName == \&quot;Amber More\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76f28e4b-8d29-49dd-823a-d5bc72ab5c45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give card detail not fount error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintree Should give card detail not fount error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CARD_DETAIL_CC_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9fe3e98-4c1f-490d-b944-87344731fc75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintree Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2221e060-0c65-44e6-bf6a-6f5581b67e60&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;76f28e4b-8d29-49dd-823a-d5bc72ab5c45&quot;,&quot;e9fe3e98-4c1f-490d-b944-87344731fc75&quot;,&quot;2221e060-0c65-44e6-bf6a-6f5581b67e60&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:125,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1d826231-43c6-4d14-a32e-70f5c825e42f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ba900fcd-8a8d-4631-b791-f6c2b7ef725a&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;86f28244-a9f5-4ae7-a459-ea77daa10907&quot;,&quot;title&quot;:&quot;Payment.getSubscriptionDetailFromBraintreeOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintreeOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:176,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b543932-37c8-4515-8b00-b24fe662c128&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintreeOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;961a668b-6876-46f3-a626-0e31d08937ab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should suspend user account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintreeOrg Should suspend user account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: org_account_uid }, {\n    braintree_subscriptionId: \&quot;FAKE_SUBSCRIPTION_ID\&quot;,\n    braintree_customerId: \&quot;FAKE_ID\&quot;,\n    merchantid: \&quot;FAKE_MERCHANT_ID\&quot;\n}, function(error, user) {\n    commonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\n    commonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\n    api.get(apiURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                (res.body.output.cardDetails.cardholderName == res.body.output.billingDetails.firstName &amp;&amp; res.body.output.billingDetails.firstName == \&quot;Amber More\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b3624938-0307-49ff-83f1-505fc6b34a80&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give card detail not fount error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintreeOrg Should give card detail not fount error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1743,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CARD_DETAIL_CC_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55057521-1baa-47cd-8b79-0a15023f5bb3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintreeOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5981f895-e386-4ea2-9258-48d851147985&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b3624938-0307-49ff-83f1-505fc6b34a80&quot;,&quot;55057521-1baa-47cd-8b79-0a15023f5bb3&quot;,&quot;5981f895-e386-4ea2-9258-48d851147985&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1819,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;537d2045-40ef-4681-910e-5fa86df4c169&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b95a09b5-b3d9-442b-9b5b-12f8a9cf4049&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ea1c2c6f-32c0-47f9-968b-93d699e1c3c2&quot;,&quot;title&quot;:&quot;Payment.pastDueInBraintreeSubscription&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.pastDueInBraintreeSubscription \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:418,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\ntestCollection.organizationRemoveRecords({}, function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                _braintreeCustId = res.body.output.braintree_customerId;\n                _userUid = res.body.output.uid;\n                subscribedPayload.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                subscriptionPastdue.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                    .send(saveCardBody)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\n                            api.post(\&quot;/v1/webhook/subscription/start\&quot;)\n                                .send(subscribedPayload)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c7d6563-b639-45e8-b713-e9388128a005&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.pastDueInBraintreeSubscription \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f7b120bc-d70b-44aa-9fbc-287e41b31f45&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should subscription pastdue.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.pastDueInBraintreeSubscription Should subscription pastdue.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscriptionPastdue)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.BRAINTREE_WEBHOOK_NOTED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31704086-67c7-4a14-8579-aba9baa48380&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should subscription pastdue.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.pastDueInBraintreeSubscription Should subscription pastdue.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:199,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n    var temp_subscriptionPastdue = getImmutable(subscriptionPastdue);\n    temp_subscriptionPastdue.options.braintree_customerId = data.organization_account.braintree_customerId;\n    api.post(apiURL)\n        .send(temp_subscriptionPastdue)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.BRAINTREE_WEBHOOK_NOTED);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f475937-1cb0-4b6a-beb8-d7ee504fe0da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;31704086-67c7-4a14-8579-aba9baa48380&quot;,&quot;6f475937-1cb0-4b6a-beb8-d7ee504fe0da&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:237,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;16a57a1d-b4e5-40d4-bf4c-a3404467d6f4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b2c93f1c-a604-43c0-b074-2d9b63ce2c0e&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5ea5b3d3-9df7-473a-86e6-d47074393a20&quot;,&quot;title&quot;:&quot;Payment.SaveCardInBrainTree&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:279,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    signupUser({}, done, function(res) {\n        authToken = res.body.output.authtoken;\n        _id = res.body.output._id;\n        uid = res.body.output.uid;\n        plan_uid = res.body.output.plan[0].uid;\n        savePlanEntries({\n            count: 5\n        }, function(error, planEntries) {\n            _planEntries = planEntries;\n            done();\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c0d0e7b-ec90-4941-83d8-1f242023917b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bba2b6ee-7f7b-4825-ade7-26654a739ad5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should save credit card.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should save credit card.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flag = (((res.body.output.plan || [{\n                braintree_plan: \&quot;\&quot;\n            }])[0].braintree_plan || \&quot;\&quot;) == saveCardBody.data.selectedPlan.braintree_plan);\n            (flag &amp;&amp; res.body.output.metadata.test_flag).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e18c89c-1da0-44b1-95ac-282d232890bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Apply promocode while saving card in braintree.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Apply promocode while saving card in braintree.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:169,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPromoCode({}, done, function(res) {\n    if (((res.body.output.plan[0] || { \&quot;plan_price\&quot;: \&quot;\&quot; }).plan_price || \&quot;\&quot;) == \&quot;\&quot;) {\n        true.should.equal(false);\n        done();\n    } else {\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var user = res.body.output;\n                    var isValid = typeof(user._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(user.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        user.user_plan.reimburse.credits == 100005 &amp;&amp;\n                        user.user_plan.reimburse.period == 30 &amp;&amp;\n                        user.user_plan.trigger.count == 22;\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b2b36fe-e853-4f05-b099-075fce4532ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid parameters error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should give invalid parameters error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempSaveCardBody = getImmutable(saveCardBody);\ndelete tempSaveCardBody.data.cardholderName;\ndelete tempSaveCardBody.data.selectedPlan;\ndelete tempSaveCardBody.data.nonce;\ndelete tempSaveCardBody.data.company;\ndelete tempSaveCardBody.data.billing_address1;\napi.post(apiURL)\n    .send(tempSaveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.name.message == messageList.SAVE_CARD_CUSTOMER_NAME_RQUIRED &amp;&amp;\n                res.body.error[\&quot;selectedPlan.braintree_plan\&quot;].message == messageList.SAVE_CARD_BRAINTREE_PLAN_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.SAVE_CARD_NONCE_RQUIRED &amp;&amp;\n                res.body.error.company.message == messageList.SAVE_CARD_COMPANY_RQUIRED &amp;&amp;\n                res.body.error.billing_address1.message == messageList.SAVE_CARD_STREET_ADDRESS_RQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8751c6cd-06ae-4c50-914d-7cb14582cbce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid parameters error for empty parameters.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should give invalid parameters error for empty parameters.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempSaveCardBody = getImmutable(saveCardBody);\ntempSaveCardBody.data.cardholderName = \&quot; \&quot;;\ntempSaveCardBody.data.selectedPlan.braintree_plan = \&quot; \&quot;;\ntempSaveCardBody.data.nonce = \&quot; \&quot;;\ntempSaveCardBody.data.company = \&quot; \&quot;;\ntempSaveCardBody.data.billing_address1 = \&quot; \&quot;;\napi.post(apiURL)\n    .send(tempSaveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.name.message == messageList.SAVE_CARD_CUSTOMER_NAME_RQUIRED &amp;&amp;\n                res.body.error[\&quot;selectedPlan.braintree_plan\&quot;].message == messageList.SAVE_CARD_BRAINTREE_PLAN_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.SAVE_CARD_NONCE_RQUIRED &amp;&amp;\n                res.body.error.company.message == messageList.SAVE_CARD_COMPANY_RQUIRED &amp;&amp;\n                res.body.error.billing_address1.message == messageList.SAVE_CARD_STREET_ADDRESS_RQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a317947-d1a4-4d2d-bf5b-143b423629eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid parameters error for empty name parameter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should give invalid parameters error for empty name parameter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempSaveCardBody = getImmutable(saveCardBody);\ndelete tempSaveCardBody.data.cardholderName;\ntempSaveCardBody.data.name = \&quot; \&quot;;\ntempSaveCardBody.data.selectedPlan.braintree_plan = \&quot; \&quot;;\ntempSaveCardBody.data.nonce = \&quot; \&quot;;\ntempSaveCardBody.data.company = \&quot; \&quot;;\ntempSaveCardBody.data.billing_address1 = \&quot; \&quot;;\napi.post(apiURL)\n    .send(tempSaveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.name.message == messageList.SAVE_CARD_CUSTOMER_NAME_RQUIRED &amp;&amp;\n                res.body.error[\&quot;selectedPlan.braintree_plan\&quot;].message == messageList.SAVE_CARD_BRAINTREE_PLAN_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.SAVE_CARD_NONCE_RQUIRED &amp;&amp;\n                res.body.error.company.message == messageList.SAVE_CARD_COMPANY_RQUIRED &amp;&amp;\n                res.body.error.billing_address1.message == messageList.SAVE_CARD_STREET_ADDRESS_RQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b632de4a-c467-435e-b576-c8726eab12b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error if wrong promocode is provide.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should give error if wrong promocode is provide.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPromoCode({\n    promo_code: \&quot;FAKE_PROMOCODE\&quot;,\n    status: httpStatus.BAD_REQUEST\n}, done, function(res) {\n    res.body.error.message.should.equal(messageList.PROMOCODE_INVALID);\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ecaf2f7-e3d7-4295-87ae-8a55c0f13d09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Apply another promocode while saving card in braintree.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Apply another promocode while saving card in braintree.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:265,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPromoCodeToAlreadyApplyPromocode({}, done, function(user) {\n    var isValid = typeof(user._id) == \&quot;undefined\&quot; &amp;&amp;\n        typeof(user.__v) == \&quot;undefined\&quot; &amp;&amp;\n        user.user_plan.reimburse.credits == 100005 &amp;&amp;\n        user.user_plan.reimburse.period == 30 &amp;&amp;\n        user.user_plan.trigger.count == 22;\n    isValid.should.equal(true);\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79fa0334-8ac3-49d8-b678-7ed5d3b4f58f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to apply promocode if second time subscribe plan is not allowed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should not allowed to apply promocode if second time subscribe plan is not allowed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:144,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Plan.findOne({\n    uid: plan_uid\n}, function(error, plan) {\n    addPromcode({\n        count: 2,\n        promo_code: \&quot;PROMO_CODE\&quot;,\n        domain: \&quot;raweng.com\&quot;,\n        redemption_count: 1,\n        redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n        redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n        allowed_plans: [plan],\n        default_plan: null,\n        addon_credits: 5,\n        addon_flows: 2,\n        addon_triggers: 2,\n        addon_trial_days: 10,\n        braintree_discount_id: \&quot;PROMO_CODE\&quot;,\n        promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n    }, function(error, promoCodes) {\n        addPromcodeToUser({\n            promo_code: promoCodes[0].promo_code\n        }, function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var userPromoCode = res.body.output;\n                if (userPromoCode.user_uid == uid &amp;&amp;\n                    userPromoCode.uid != \&quot;\&quot;) {\n                    commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var isValid = res.body.output.uid == uid &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                    res.body.output.subscription.days == 40;\n                                var firstPrommoCode = res.body.output.user_promocode.promo_code;\n                                if (isValid) {\n                                    commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                                    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                                    var tempSaveCardBody = getImmutable(saveCardBody);\n                                    tempSaveCardBody.data.promo_code = promoCodes[1].promo_code;\n                                    api.post(apiURL)\n                                        .send(tempSaveCardBody)\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.BAD_REQUEST)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.error.message.should.equal(messageList.PROMOCODE_NOT_ALLOWED_PLAN);\n                                                done();\n                                            }\n                                        });\n                                } else {\n                                    true.should.equal(false);\n                                    done();\n                                }\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fe0c1b4-cc3f-4317-9289-6ce6c1cb4c6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to apply promocode if second time subscribe plan is not allowed and revoked_promo is set to true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should not allowed to apply promocode if second time subscribe plan is not allowed and revoked_promo is set to true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:137,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Plan.findOne({\n    uid: plan_uid\n}, function(error, plan) {\n    addPromcode({\n        count: 2,\n        promo_code: \&quot;PROMO_CODE\&quot;,\n        domain: \&quot;raweng.com\&quot;,\n        redemption_count: 1,\n        redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n        redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n        allowed_plans: [plan],\n        default_plan: null,\n        addon_credits: 5,\n        addon_flows: 2,\n        addon_triggers: 2,\n        addon_trial_days: 10,\n        braintree_discount_id: \&quot;PROMO_CODE\&quot;,\n        promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n    }, function(error, promoCodes) {\n        addPromcodeToUser({\n            promo_code: promoCodes[0].promo_code\n        }, function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var userPromoCode = res.body.output;\n                if (userPromoCode.user_uid == uid &amp;&amp;\n                    userPromoCode.uid != \&quot;\&quot;) {\n                    commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var isValid = res.body.output.uid == uid &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                    res.body.output.subscription.days == 40;\n                                var firstPrommoCode = res.body.output.user_promocode.promo_code;\n                                if (isValid) {\n                                    commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                                    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                                    var tempSaveCardBody = getImmutable(saveCardBody);\n                                    tempSaveCardBody.data.promo_code = promoCodes[0].promo_code;\n                                    tempSaveCardBody.data.revoked_promo = true;\n                                    api.post(apiURL)\n                                        .send(tempSaveCardBody)\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.BAD_REQUEST)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.error.message.should.equal(messageList.PROMOCODE_NOT_ALLOWED_PLAN);\n                                                done();\n                                            }\n                                        });\n                                } else {\n                                    true.should.equal(false);\n                                    done();\n                                }\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32ffa09b-2fcf-4cf8-84a8-c3d47091a3a3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not show empty plan_price on save credit card.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should not show empty plan_price on save credit card.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            ((res.body.output.plan[0] || { \&quot;plan_price\&quot;: \&quot;\&quot; }).plan_price || \&quot;\&quot;)\n            .should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b2179c5-2f8c-4611-8967-531241c93e86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should save credit card and cancel earlier subscription.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should save credit card and cancel earlier subscription.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:224,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n            commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(saveCardBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        ((res.body.output.plan || [{\n                            braintree_plan: \&quot;\&quot;\n                        }])[0].braintree_plan || \&quot;\&quot;).should.equal(saveCardBody.data.selectedPlan.braintree_plan);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82a8454a-0952-48a9-88e4-fcddf8ac0b8b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should save credit card and ignore already subscription cancellation error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should save credit card and ignore already subscription cancellation error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:211,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.braintreeAlreadyCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n            commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(saveCardBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        ((res.body.output.plan || [{\n                            braintree_plan: \&quot;\&quot;\n                        }])[0].braintree_plan || \&quot;\&quot;).should.equal(saveCardBody.data.selectedPlan.braintree_plan);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a41e0f3-b3c9-4eec-9188-695dc7370272&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da952ea6-e858-41d4-89b8-aefb237fd817&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5e18c89c-1da0-44b1-95ac-282d232890bb&quot;,&quot;1b2b36fe-e853-4f05-b099-075fce4532ca&quot;,&quot;8751c6cd-06ae-4c50-914d-7cb14582cbce&quot;,&quot;4a317947-d1a4-4d2d-bf5b-143b423629eb&quot;,&quot;b632de4a-c467-435e-b576-c8726eab12b5&quot;,&quot;3ecaf2f7-e3d7-4295-87ae-8a55c0f13d09&quot;,&quot;79fa0334-8ac3-49d8-b678-7ed5d3b4f58f&quot;,&quot;0fe0c1b4-cc3f-4317-9289-6ce6c1cb4c6f&quot;,&quot;32ffa09b-2fcf-4cf8-84a8-c3d47091a3a3&quot;,&quot;2b2179c5-2f8c-4611-8967-531241c93e86&quot;,&quot;82a8454a-0952-48a9-88e4-fcddf8ac0b8b&quot;,&quot;3a41e0f3-b3c9-4eec-9188-695dc7370272&quot;,&quot;da952ea6-e858-41d4-89b8-aefb237fd817&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1506,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;cc908f63-23c9-4b78-8856-d067b83b7681&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fa1e8a8a-b438-4f05-a5a5-6070942960ee&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;35ca76cd-7ba5-441c-91f5-23c926bddc45&quot;,&quot;title&quot;:&quot;Payment.updatePaymentDetails&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:392,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var data = res.body.output;\n                    authToken = data.authtoken;\n                    _id = data._id;\n                    //braintreeToken = data.payment_set;\n                    //updatePaymentBody.data.token = braintreeToken;\n                    //done();\n                    commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                    var userUid = res.body.output.uid;\n                    api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                        .send(saveCardBody)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                //updatePaymentBody.data.token = res.body.output.token;\n                                done();\n                            }\n                        });\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;212f5080-2baa-4d19-87bf-1efd96c3300c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25585a69-3df1-437a-bf78-a8222fa13f3b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update payment method.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails Should update payment method.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentDetail(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(updatePaymentBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output || {}).cardholderName.should.equal(updatePaymentBody.data.billing.cardholderName);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ebc48203-7760-4412-968f-51e06c0bfdbc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update payment method with firstName field.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails Should update payment method with firstName field.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentDetail(httpmock, \&quot;enterprise\&quot;);\nvar userDetails = getImmutable(updatePaymentBody);\nuserDetails.data.billing.firstName = userDetails.data.billing.cardholderName;\ndelete userDetails.data.billing.cardholderName;\napi.put(apiURL)\n    .send(updatePaymentBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output || {}).cardholderName.should.equal(updatePaymentBody.data.billing.cardholderName);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c15fbac6-f591-4451-a36b-79f6f9d39fe6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid parameters error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails Should give invalid parameters error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempSaveCardBody = getImmutable(saveCardBody);\ndelete tempSaveCardBody.data.cardholderName;\ndelete tempSaveCardBody.data.nonce;\ndelete tempSaveCardBody.data.token;\ndelete tempSaveCardBody.data.company;\ndelete tempSaveCardBody.data.streetAddress;\napi.put(apiURL)\n    .send(tempSaveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;billing.name\&quot;].message == messageList.UPDATE_PAYMENT_BILLING_NAME_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.UPDATE_PAYMENT_NONCE_REQUIRED &amp;&amp;\n                res.body.error.token.message == messageList.UPDATE_PAYMENT_TOKEN_REQUIRED &amp;&amp;\n                res.body.error[\&quot;billing.company\&quot;].message == messageList.UPDATE_PAYMENT_COMPANY_REQUIRED &amp;&amp;\n                res.body.error[\&quot;billing.streetAddress\&quot;].message == messageList.UPDATE_PAYMENT_STREET_ADDRESS_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc10dab5-928f-445d-a0eb-4811e62b29cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid parameters error for empty parameters.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails Should give invalid parameters error for empty parameters.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempSaveCardBody = getImmutable(saveCardBody);\ntempSaveCardBody.data.cardholderName = \&quot; \&quot;;\ntempSaveCardBody.data.nonce = \&quot; \&quot;;\ntempSaveCardBody.data.token = \&quot; \&quot;;\ntempSaveCardBody.data.company = \&quot; \&quot;;\ntempSaveCardBody.data.streetAddress = \&quot; \&quot;;\napi.put(apiURL)\n    .send(tempSaveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;billing.name\&quot;].message == messageList.UPDATE_PAYMENT_BILLING_NAME_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.UPDATE_PAYMENT_NONCE_REQUIRED &amp;&amp;\n                res.body.error.token.message == messageList.UPDATE_PAYMENT_TOKEN_REQUIRED &amp;&amp;\n                res.body.error[\&quot;billing.company\&quot;].message == messageList.UPDATE_PAYMENT_COMPANY_REQUIRED &amp;&amp;\n                res.body.error[\&quot;billing.streetAddress\&quot;].message == messageList.UPDATE_PAYMENT_STREET_ADDRESS_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6dd6ccf-710a-4938-9d7f-509c802c45f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentDetail(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(updatePaymentBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76dba142-54bf-4282-9565-5ba0abcce9d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ebc48203-7760-4412-968f-51e06c0bfdbc&quot;,&quot;c15fbac6-f591-4451-a36b-79f6f9d39fe6&quot;,&quot;cc10dab5-928f-445d-a0eb-4811e62b29cf&quot;,&quot;b6dd6ccf-710a-4938-9d7f-509c802c45f9&quot;,&quot;76dba142-54bf-4282-9565-5ba0abcce9d7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:211,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f63a3de6-ba1a-4ed6-a92b-082271aa681f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;419ac299-f41a-47ff-8ffe-9b24d6408b1b&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c2d44d3a-c586-438e-a730-0f01c1d3cbe7&quot;,&quot;title&quot;:&quot;Payment.UpdatePaymentSet&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.UpdatePaymentSet \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:276,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    var data = res.body.output;\n                    authToken = data.authtoken;\n                    _id = data._id;\n                    payment_set = data.payment_set;\n                    if (error) {\n                        done(error);\n                    } else {\n                        done();\n                    }\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ab2a90d-1335-42c2-b705-d987c250eb7c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.UpdatePaymentSet \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a30a2f5c-a572-4ee8-811a-3e9660172ef8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update payment_set for user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.UpdatePaymentSet Should update payment_set for user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.payment_set.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f17fa52c-b6b3-483b-8239-65c3713b7fd0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.UpdatePaymentSet Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d8e1de5-cd50-4d9a-9d18-9914dc958531&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f17fa52c-b6b3-483b-8239-65c3713b7fd0&quot;,&quot;5d8e1de5-cd50-4d9a-9d18-9914dc958531&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:88,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f33d2163-98a8-46b7-9260-506253c7282d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2b8a9e31-84ec-4c88-81f0-e47df2b734ec&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8451b561-0b41-4624-84eb-5d9c48129666&quot;,&quot;title&quot;:&quot;Payment.upgradeAccount&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.upgradeAccount \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:420,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    saveInvoices({\n                        authToken: authToken,\n                        braintree_customerId: res.body.output.braintree_customerId || \&quot;\&quot;,\n                        uid: res.body.output.uid || \&quot;\&quot;\n                    }, function() {\n                        done();\n                    });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c0c7407-7a66-4407-9708-ba5efb6ee996&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.upgradeAccount \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;deleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7271067-cd99-4711-a805-032003a30164&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.upgradeAccount \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;451b2b4e-8983-4172-8215-8277e6c77c52&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update payment method.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.upgradeAccount Should update payment method.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdateCustomerPaymentDetail(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(upgradeAccountBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75edcec2-d981-432f-9f6a-a873ff76f324&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.upgradeAccount Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdateCustomerPaymentDetail(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(upgradeAccountBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;715d7232-5d62-40f8-bbfa-662b535854a3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;75edcec2-d981-432f-9f6a-a873ff76f324&quot;,&quot;715d7232-5d62-40f8-bbfa-662b535854a3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:68,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bc8f5f25-3ba4-4fc3-9c16-2b6e4870b080&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cf63f36b-4f13-462d-b7d4-211ce2c3349f&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2f5f1397-7903-40eb-92cd-f088802959ab&quot;,&quot;title&quot;:&quot;Plan.getAllPlanFaq&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getAllPlanFaq \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bcd442db-7a97-42c7-8d26-4fa73fc9c06f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getAllPlanFaq \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nthis.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eb9390e2-cbaf-4e40-b8b1-a1a8cc72461f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plans faqs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getAllPlanFaq Should get list of plans faqs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;40e27a48-6e5f-4234-82d2-af13dd25e4ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;40e27a48-6e5f-4234-82d2-af13dd25e4ce&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7c93a2e7-0c9c-4dbd-873c-8f35f893a376&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1b9d8668-8674-4249-a2c7-12977eaee0ea&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1077a6f7-2497-452b-960a-94fc2c2649cd&quot;,&quot;title&quot;:&quot;plans.getFeatures&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan plans.getFeatures \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c961178-2d87-43cd-b0e5-f0c14bee5f5f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan plans.getFeatures \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nthis.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a36ad2c5-f710-42cd-94ae-5a2b6d2ee4a3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of features.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan plans.getFeatures Should get list of features.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7fbe030-7e52-4171-a955-e174af1183ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of features in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan plans.getFeatures Should get list of features in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(paramURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef88b2ed-0128-46f3-9751-66b820b9f6f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of features with query by feature name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan plans.getFeatures Should get list of features with query by feature name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var featureName = ((res.body.output || [])[0] || {}).feature_name || \&quot;\&quot;;\n            var paramURL = apiURL + \&quot;?query=\&quot; + featureName;\n            api.get(paramURL)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = false;\n                        if (Array.isArray(res.body.output)) {\n                            isValid = res.body.output.length &gt;= 1;\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;68af79ba-b4de-4680-8b47-6c342497b72f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e7fbe030-7e52-4171-a955-e174af1183ea&quot;,&quot;ef88b2ed-0128-46f3-9751-66b820b9f6f2&quot;,&quot;68af79ba-b4de-4680-8b47-6c342497b72f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:122,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;db0a165b-ae08-4478-9f5e-062abc9b44b4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;55466bf4-4ba2-4b1a-855b-78f4859da74b&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5b31335b-be6f-458e-89be-5415c820a2b6&quot;,&quot;title&quot;:&quot;Plan.getFeaturesCount&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getFeaturesCount \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3aa1444-8919-484d-b3a2-295b022fa242&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getFeaturesCount \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6ca96a61-2777-4b63-b1ee-a6e0e6699a28&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get count of features.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getFeaturesCount Should get count of features.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (isNaN(parseInt(res.body.output.count)) == false) {\n                isValid = parseInt(res.body.output.count) &gt; 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;42f84974-4421-44cc-817f-fcf57e9635b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;42f84974-4421-44cc-817f-fcf57e9635b9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;97fdeeac-8f44-4ed6-8838-4c840bca7f0d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;312c1eb1-9354-45af-821e-17253fb29c5c&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3ce9b60f-929e-4d4d-a844-faa75f67d1d5&quot;,&quot;title&quot;:&quot;Plan.getOrgPlansData&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:316,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                savePlanEntries({\n                    authtoken: authToken\n                }, function(error, tempPlanEntries) {\n                    savePlanEntries({\n                        authtoken: authToken,\n                        plan_type: \&quot;enterprise_organization\&quot;\n                    }, function(error, planEntries) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            _planEntries = planEntries;\n                            done();\n                        }\n                    });\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;973f0571-96f2-4733-b48d-fcacdd6de5a3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b71e535-ae53-4e78-8e4a-b9981b1e92e8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78ab06b5-ee85-4f54-a5d8-6af9fc13c754&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get list of plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5b812a8-bbc3-492e-9543-1b2858e77c2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of organization required plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get list of organization required plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?get=require\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1e1e44da-ddf3-43ed-8e48-848f7ce719ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of plans based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get limited list of plans based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9c12df8-54ab-4d70-8f41-3cb5fba28c70&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of plans based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get limited list of plans based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4def9a40-f049-42a2-acf6-e104281e6c37&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter list of plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get filter list of plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?query=utest_cases_\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 10;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4974a22-3337-4852-8fda-be9eae90140f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter limited list of plans based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get filter limited list of plans based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;query=utest_cases_\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b57d2659-fbec-479b-8155-5e9cb318b512&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter limited list of plans based on skip/limit and name in descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get filter limited list of plans based on skip/limit and name in descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;query=utest_cases_&amp;field=name&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output[0].uid == _planEntries[7].uid &amp;&amp;\n                    res.body.output[1].uid == _planEntries[6].uid;\n\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d672647-6c60-45ad-a783-7290711158f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c5b812a8-bbc3-492e-9543-1b2858e77c2e&quot;,&quot;1e1e44da-ddf3-43ed-8e48-848f7ce719ce&quot;,&quot;b9c12df8-54ab-4d70-8f41-3cb5fba28c70&quot;,&quot;4def9a40-f049-42a2-acf6-e104281e6c37&quot;,&quot;d4974a22-3337-4852-8fda-be9eae90140f&quot;,&quot;b57d2659-fbec-479b-8155-5e9cb318b512&quot;,&quot;3d672647-6c60-45ad-a783-7290711158f0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:120,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8eb6c9fb-b91b-4622-98a2-410d001a741a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;305eae68-8e9b-4d6b-9b36-4efac033bb53&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ee2f1563-f1bf-4cdf-a2e4-ed157b653570&quot;,&quot;title&quot;:&quot;Plan.getPlanById&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlanById \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:291,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                //apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                savePlanEntries({\n                    authtoken: authToken\n                }, function(error, planEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _planEntries = planEntries;\n                        done();\n                    }\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55b6713c-a9f2-4235-8b13-f54d2746ddef&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlanById \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ed29ec0-3aaa-4aad-a5d1-54074356b327&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlanById \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;494949b5-80ba-4def-9dfb-ab9ad72738a3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get plan by id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlanById Should get plan by id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:plan_uid\&quot;, _planUid)\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(_planUid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d7ffd99-abbb-497a-b7e2-0c1d74adbf73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlanById Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:plan_uid\&quot;, _planUid)\napi.get(paramURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b2db1878-4a65-4b45-889b-25c3c2e8d20e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4d7ffd99-abbb-497a-b7e2-0c1d74adbf73&quot;,&quot;b2db1878-4a65-4b45-889b-25c3c2e8d20e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:48,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;606eb650-5a9f-42a1-863e-1723ab8afb6d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;15f466d6-20fb-4c7a-b8dd-837d78155617&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cf66c523-6fe9-467b-a2fd-7201831a8c96&quot;,&quot;title&quot;:&quot;Plan.getPlansCount&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansCount \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:300,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                savePlanEntries({\n                    authtoken: authToken\n                }, function(error, planEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _planEntries = planEntries;\n                        done();\n                    }\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f17381c4-f2b6-4ad2-b2d5-00f0b9620e6a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansCount \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;61868f12-7d4b-4ca9-8c7a-8a8728e65fc7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansCount \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e76a0af-a1c2-4bb9-98f4-33f1c47479db&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get count of plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansCount Should get count of plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            isNaN(parseInt(res.body.output.count)).should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb577f65-a8e8-411d-9064-07f83191752e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cb577f65-a8e8-411d-9064-07f83191752e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4938dc32-45ff-4b13-96f7-e97aa5ac5353&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;300d15a6-772b-4335-9f27-f0b6d67c193a&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;90a50327-0d8a-4537-aef0-263a7521dde1&quot;,&quot;title&quot;:&quot;Plan.getPlansData&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:310,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                savePlanEntries({\n                    authtoken: authToken\n                }, function(error, planEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _planEntries = planEntries;\n                        done();\n                    }\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;feda41f6-58a5-42e3-b4c7-680d1726eeea&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;74ca59b4-c0db-4647-ac18-1584b2bbd6ce&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb8d16f4-c266-4977-99b0-619f3041e0b6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData Should get list of plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;395fd25c-9458-417d-9912-8ef92b4a92be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of plans based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData Should get limited list of plans based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1469cf82-2edd-4d4e-b54b-1c146c86617f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter list of plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData Should get filter list of plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?query=utest_cases_\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 10;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a70fa8f2-6376-4e18-a2e5-749438208d67&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter limited list of plans based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData Should get filter limited list of plans based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;query=utest_cases_\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3fad4e4-2615-410e-b3f3-756f4cb5782e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter limited list of plans based on skip/limit and name in descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData Should get filter limited list of plans based on skip/limit and name in descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;query=utest_cases_&amp;field=name&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output[0].uid == _planEntries[7].uid &amp;&amp;\n                    res.body.output[1].uid == _planEntries[6].uid;\n\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd06b1c2-0006-4553-9a64-081db690f4cc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;395fd25c-9458-417d-9912-8ef92b4a92be&quot;,&quot;1469cf82-2edd-4d4e-b54b-1c146c86617f&quot;,&quot;a70fa8f2-6376-4e18-a2e5-749438208d67&quot;,&quot;f3fad4e4-2615-410e-b3f3-756f4cb5782e&quot;,&quot;fd06b1c2-0006-4553-9a64-081db690f4cc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:105,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b40591f4-adfc-47db-a881-40741290ba0d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0cb4e880-b8a2-40bd-8fe6-62e857c928bc&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;028b4a73-77eb-4a3f-bc20-bc3ee2aa933b&quot;,&quot;title&quot;:&quot;Plan.getRequiredPlans&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getRequiredPlans \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11f19a42-1e48-4479-b309-3e24f97e4146&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getRequiredPlans \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6857d26-005d-433d-b421-fed9194693d8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of required plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getRequiredPlans Should get list of required plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:457,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a88a3eb6-58a7-4a46-a157-6a08b92891ae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a88a3eb6-58a7-4a46-a157-6a08b92891ae&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:457,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;36d911c4-9177-4459-a730-b8aa9e226cc6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;07fe3990-12de-49e3-a33b-a1f436491c2d&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4b6b6024-5a4f-4332-a8cd-c04a26e49cfd&quot;,&quot;title&quot;:&quot;Plan.getViewPlans&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getViewPlans \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ce887a0-4fd8-4ec1-b933-7b5be2503fd9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getViewPlans \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3781aca-bc06-4ca0-95b3-858e8f1e9979&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of viewed plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getViewPlans Should get list of viewed plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:254,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;63397c5c-6282-4837-90f7-be8025c174cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;63397c5c-6282-4837-90f7-be8025c174cf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:254,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;96d15d1d-93a2-4fb3-a7f3-f87f0d50db57&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;12398fa6-05ba-4e44-bf7d-2c651581d2c9&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;eabb20ca-cde3-4406-aa35-698045db6846&quot;,&quot;title&quot;:&quot;Plan.planSendMail&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.planSendMail \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:179,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;70349ec5-95af-4cf2-b767-92de5e038066&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.planSendMail \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;93655254-6a85-4125-a865-877f1a38a039&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plans faqs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.planSendMail Should get list of plans faqs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.sendMailFlowExecution(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(planSendBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(\&quot;Mail send successfully.\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fde60b80-c3d0-492a-b300-3542b67bd75f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.planSendMail Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(planSendBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b59334f-5c01-4d36-baab-3dfc3b7afdc0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fde60b80-c3d0-492a-b300-3542b67bd75f&quot;,&quot;3b59334f-5c01-4d36-baab-3dfc3b7afdc0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f790108b-ac98-4bb3-82f2-13081fdbafcd&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\createProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\createProject.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cc61b26e-5d3e-447c-bd81-391ae902555a&quot;,&quot;title&quot;:&quot;Project.Create&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\createProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\createProject.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:182,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken;\n        done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02e1fcb9-2213-4a0f-b2f5-5873d5fb8f6a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Project.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [project.uid, adminOwnProject.uid, developerOwnProject.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef1f1d44-f5bb-4023-bdf1-20eb35486ae0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df096ff5-e142-4b06-8837-efe349201b1e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should create project, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\nprojectData.created_by = dummyUser.uid\nprojectData.updated_by = dummyUser.uid\nprojectData.env_uid = &#x27;flc9f0bbfd3393a79903fda5&#x27;\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            project = res.body.output\n            expect(project.name).equal(projectData.name);\n            expect(project).to.have.any.keys([&#x27;name&#x27;, &#x27;created_by&#x27;, &#x27;flow_count&#x27;, &#x27;icons&#x27;, &#x27;updated_by&#x27;, &#x27;locked_by&#x27;, &#x27;owner_uid&#x27;]);\n            _models.UserConfig.findOne({ project_uid: project.uid, name: &#x27;default&#x27; }, function(err, result) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(result.name).equal(&#x27;default&#x27;);\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;09bf085c-d24f-4937-913a-622ecdd45511&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project, if developer tried to create a project in an valid org.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should create project, if developer tried to create a project in an valid org.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar developerProject = _.cloneDeep(projectData)\ndeveloperProject.name = &#x27;developerProject&#x27;\ndeveloperProject.owner_uid = orgData.developer.uid\ndeveloperProject.created_by = orgData.developer.uid\ndeveloperProject.updated_by = orgData.developer.uid\ndeveloperProject.env_uid = &#x27;flc9f0bbfd3393a79903fda5&#x27;\napi.post(apiURL)\n    .set({ authtoken: orgData.developer.authtoken, org_uid: orgData.organization.uid })\n    .send(developerProject)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            developerOwnProject = res.body.output\n            expect(developerOwnProject.name).equal(developerProject.name);\n            expect(developerOwnProject).to.have.any.keys([&#x27;name&#x27;, &#x27;created_by&#x27;, &#x27;flow_count&#x27;, &#x27;icons&#x27;, &#x27;updated_by&#x27;, &#x27;locked_by&#x27;, &#x27;owner_uid&#x27;]);\n            _models.UserConfig.findOne({ project_uid: developerOwnProject.uid, name: config.default_project }, function(err, result) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(result.name).equal(config.default_project);\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5de12859-d151-44bc-bd39-bc62075638bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project, if admin tried to create a project in an valid org.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should create project, if admin tried to create a project in an valid org.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:79,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar adminProject = _.cloneDeep(projectData)\nadminProject.name = &#x27;adminProject&#x27;\nadminProject.owner_uid = dummyUser.uid\nadminProject.created_by = dummyUser.uid\nadminProject.updated_by = dummyUser.uid\nadminProject.env_uid = dummyUser.default_env\napi.post(apiURL)\n    .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n    .send(adminProject)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            adminOwnProject = res.body.output\n            expect(adminOwnProject.name).equal(adminProject.name);\n            expect(adminOwnProject).to.have.all.keys([&#x27;uid&#x27;, &#x27;name&#x27;, &#x27;created_by&#x27;, &#x27;updated_by&#x27;,\n                &#x27;owner_uid&#x27;, &#x27;updated_at&#x27;, &#x27;created_at&#x27;, &#x27;flow_count&#x27;, &#x27;icons&#x27;, &#x27;env_uid&#x27;, &#x27;org_uid&#x27;, &#x27;deleted_at&#x27;\n            ]);\n            _models.UserConfig.findOne({ project_uid: adminOwnProject.uid, name: config.default_project }, function(err, result) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(result.name).equal(config.default_project);\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;199577ae-1bd3-4833-be33-607248895cc7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error,  if billing manger tied to create a project in an org.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should get error,  if billing manger tied to create a project in an org.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\nprojectData.created_by = dummyUser.uid\nprojectData.updated_by = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.post(apiURL)\n    .set({ authtoken: orgData.billing_manager.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ee23932-3091-408a-80b8-1a914ad58d35&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error,  if normal tied to create a project in an org.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should get error,  if normal tied to create a project in an org.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\nprojectData.created_by = dummyUser.uid\nprojectData.updated_by = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.post(apiURL)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6c2b98c-9e93-4108-849e-d5b10bd65323&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user tried to create project with name already exists in an environment.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should get error if user tried to create project with name already exists in an environment.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.user_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NAME_UNIQUE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1027285a-3194-4b76-b5bb-c8dac164adf4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if  project name is blank.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should get error if  project name is blank.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;&#x27;\nprojectData.user_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            expect(res.body.error.name.message).equal(messageList.PROJECT_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fa675064-788d-463f-aa04-761e65b4bc86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;df096ff5-e142-4b06-8837-efe349201b1e&quot;,&quot;09bf085c-d24f-4937-913a-622ecdd45511&quot;,&quot;5de12859-d151-44bc-bd39-bc62075638bb&quot;,&quot;199577ae-1bd3-4833-be33-607248895cc7&quot;,&quot;1ee23932-3091-408a-80b8-1a914ad58d35&quot;,&quot;a6c2b98c-9e93-4108-849e-d5b10bd65323&quot;,&quot;1027285a-3194-4b76-b5bb-c8dac164adf4&quot;,&quot;fa675064-788d-463f-aa04-761e65b4bc86&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:423,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d0f7c279-d518-4a68-99c6-c318a02521ce&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\createProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\createProjectParam.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;96f6dcf8-4257-4fc3-8857-85ab857fc570&quot;,&quot;title&quot;:&quot;ProjectParam.Create&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\createProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\createProjectParam.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:199,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(projectURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                project = res.body.output\n                done()\n            }\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31256fc4-af6b-493c-96ac-a63949efa7f1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ uid: configSchema.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acf03495-c5f0-41fa-bee8-31412062b42f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(paramData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e966eaf-d39d-4a42-93de-827399b5a609&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project param, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create Should create project param, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .send(paramData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).equal(2);\n            _models.ConfigSchema.find({ user_uid: dummyUser.uid, type: &#x27;param&#x27; }, function(err, results) {\n                expect(results).length.gt(0);\n                done();\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3ea07fd-05d0-452b-82be-368d8dd307ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give empty array in response, if user send data which is not in same project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create Should give empty array in response, if user send data which is not in same project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .send([{\n        uid: \&quot;dummy\&quot;,\n        key: \&quot;key\&quot;,\n        value: \&quot;value\&quot;,\n        \&quot;required\&quot;: false,\n        \&quot;isPassword\&quot;: true,\n        \&quot;hasError\&quot;: false\n    }])\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).equal(0);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e787de01-f9d7-44cf-b8be-a47757674f74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project param within an org, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create Should create project param within an org, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n    .send(paramData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).equal(2);\n            _models.ConfigSchema.find({ org_uid: orgData.organization.uid, type: &#x27;param&#x27; }, function(err, results) {\n                expect(results).length.gt(0);\n                done();\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f80d3a9e-9605-4fa7-bc71-5bdfd393af3e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if project not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create Should get error, if project not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken, project_uid: &#x27;ABC&#x27; })\n    .send({})\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9507b2b6-bca5-46e5-a53b-9d35833aff8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5e966eaf-d39d-4a42-93de-827399b5a609&quot;,&quot;c3ea07fd-05d0-452b-82be-368d8dd307ad&quot;,&quot;e787de01-f9d7-44cf-b8be-a47757674f74&quot;,&quot;f80d3a9e-9605-4fa7-bc71-5bdfd393af3e&quot;,&quot;9507b2b6-bca5-46e5-a53b-9d35833aff8c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:198,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0c83bea5-85c9-4ae9-98fc-c36df3c051d2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\deleteProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\deleteProject.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e1aa383f-07ff-477f-ae3a-3d5900ae3bf1&quot;,&quot;title&quot;:&quot;Project.Delete&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\deleteProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\deleteProject.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:222,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(apiURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                project = res.body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a02f1e7a-1b5a-4bde-9dc4-b3249640e501&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f140c519-8ff6-4fa0-b3d9-40d996e4fe1a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + project.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e2bc027-2a41-477d-9545-27ac874796fa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user tried to delete project which is not exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should get error if user tried to delete project which is not exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.user_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.delete(apiURL + &#x27;project.uid&#x27;)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f2b5811-c3e3-4cf1-a825-440691c31230&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user tried to delete project which is default.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should get error if user tried to delete project which is default.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.user_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.delete(apiURL + dummyUser.default_project)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.DEFAULT_PROJECT_DELETE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;71a33f36-2a9f-4514-85dc-4999eb5e0c4c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete project, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should delete project, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;updated project&#x27;\napi.delete(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.message).to.be.equal(messageList.PROJECT_DELETE_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6aac54a3-2482-45e0-959f-d2a1637fc7e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if normal user tried to delete Project which is allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should get error, if normal user tried to delete Project which is allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.delete(apiURL + proj1.uid)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f38deff-7d9d-47be-ae0d-02699d64db32&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if normal user tried to delete Project which allocated to him but org_uid not passed in header.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should get error, if normal user tried to delete Project which allocated to him but org_uid not passed in header.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.delete(apiURL + proj1.uid)\n    .set({ authtoken: orgData.role1.authtoken })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98c8eb3e-805f-42c6-a53d-b7744abf331d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete project, if normal user tried to delete Project which is not allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should not delete project, if normal user tried to delete Project which is not allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj3 = _.find(orgData.org_projects, { name: &#x27;proj3&#x27; })\napi.delete(apiURL + proj3.uid)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3640f0d0-ed3b-4cf8-b1b2-cdb5c07c1ee0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if billing manager tried to delete Project which is not allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should get error, if billing manager tried to delete Project which is not allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.delete(apiURL + proj1.uid)\n    .set({ authtoken: orgData.billing_manager.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f09622b-b0f7-407a-9822-9c64c1b6987f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete project, if admin of org tried to delete Project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should delete project, if admin of org tried to delete Project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:72,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj2 = _.find(orgData.org_projects, { name: &#x27;proj2&#x27; })\ntestData.mongoUserTriggerObj.user_uid = dummyUser.uid;\ntestData.mongoUserTriggerObj.project_uid = proj2.uid\n_models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n    api.delete(apiURL + proj2.uid)\n        .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n        .send(projectData)\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                expect(res.body.error.message).to.be.equal(messageList.PROJECT_HAS_TRIGGER);\n                _models.UserTrigger.remove({uid: userTrigger.uid}, function(err){\n                    done(err);\n                })\n            }\n        });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41ec2fb8-b4ff-43f1-8da6-056b727c82ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete project, if admin of org tried to delete Project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should delete project, if admin of org tried to delete Project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj2 = _.find(orgData.org_projects, { name: &#x27;proj2&#x27; })\napi.delete(apiURL + proj2.uid)\n    .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.message).to.be.equal(messageList.PROJECT_DELETE_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;accc8df8-4f93-4d89-995f-520a6ca1baaf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete project, if developer of org tried to delete Project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should delete project, if developer of org tried to delete Project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:70,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.delete(apiURL + proj1.uid)\n    .set({ authtoken: orgData.developer.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.message).to.be.equal(messageList.PROJECT_DELETE_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81870ae5-bf59-4fc4-9232-896bead5666c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6e2bc027-2a41-477d-9545-27ac874796fa&quot;,&quot;9f2b5811-c3e3-4cf1-a825-440691c31230&quot;,&quot;71a33f36-2a9f-4514-85dc-4999eb5e0c4c&quot;,&quot;6aac54a3-2482-45e0-959f-d2a1637fc7e6&quot;,&quot;3f38deff-7d9d-47be-ae0d-02699d64db32&quot;,&quot;98c8eb3e-805f-42c6-a53d-b7744abf331d&quot;,&quot;3640f0d0-ed3b-4cf8-b1b2-cdb5c07c1ee0&quot;,&quot;7f09622b-b0f7-407a-9822-9c64c1b6987f&quot;,&quot;41ec2fb8-b4ff-43f1-8da6-056b727c82ca&quot;,&quot;accc8df8-4f93-4d89-995f-520a6ca1baaf&quot;,&quot;81870ae5-bf59-4fc4-9232-896bead5666c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:564,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4fd1f14b-1af7-4d0a-8a69-1934e2f096f8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\deleteProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\deleteProjectParam.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c9310d97-03cc-4a15-87a6-e24ea4008429&quot;,&quot;title&quot;:&quot;ProjectParam.Delete&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\deleteProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\deleteProjectParam.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:361,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        projectData.owner_uid = dummyUser.uid\n        projectData.env_uid = dummyUser.default_env\n        api.post(projectURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        project = res.body.output\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n            .send(paramData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        configSchema = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;168cfbd7-d538-44a1-a3a7-b9189eb39bfe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ uid: configSchema.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37ba4fbd-3b45-41c9-95c6-6c120e0a1a7e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + configSchema.uid)\n    .send(paramData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f57a8f34-696c-4955-aaa1-7e082230c238&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete project param, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete Should delete project param, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + configSchema.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.message).equal(messageList.PARAMS_DELETE_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a31cbe6-0737-4306-8d4b-ed2d5d73dc35&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if project not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete Should get error, if project not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: &#x27;ABC&#x27; })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54756dc5-b11b-4e3c-aca1-61b6498456b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if configSchema not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete Should get error, if configSchema not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.NO_DATA_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f50b051-754c-4062-a7c6-4ffb461cd567&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f57a8f34-696c-4955-aaa1-7e082230c238&quot;,&quot;4a31cbe6-0737-4306-8d4b-ed2d5d73dc35&quot;,&quot;54756dc5-b11b-4e3c-aca1-61b6498456b8&quot;,&quot;4f50b051-754c-4062-a7c6-4ffb461cd567&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:151,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a4a7154e-27f4-42e5-b125-500fc3a33e6e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\getProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\getProject.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6576b46c-b89a-44ce-9da9-b66bcceca0ee&quot;,&quot;title&quot;:&quot;Project.Get&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\getProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\getProject.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:296,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner\n                dummyUser.authtoken = dummyUser.authtoken\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(apiURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            },\n            function(res, cbk) {\n                project = res.body.output\n                flowData.created_by = dummyUser.uid\n                flowData.updated_by = dummyUser.uid\n                flowData.project_uid = project.uid\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output\n                done()\n            }\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3afb36a-6f58-419d-8f50-1215ec3c07e6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c1a8e67-059e-411b-a3ab-8b7206433b4e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + project.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e79209e-3a25-44fd-95ef-8e96ed307805&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tried to get project which not exists in an environment.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get error, if user tried to get project which not exists in an environment.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.get(apiURL + &#x27;project.uid&#x27;)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;098d89bb-e64e-4922-b776-43ec09edb26d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get project, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.name).equal(projectData.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2bad551e-26ba-4a8d-b0df-c5cce6390868&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project, if normal user tried to get Project which is allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get project, if normal user tried to get Project which is allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.get(apiURL + proj1.uid)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.name).equal(proj1.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9eb2075-e387-4431-ab3a-5a5ffdf401f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if normal user tried to get Project which is not allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get error, if normal user tried to get Project which is not allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj3 = _.find(orgData.org_projects, { name: &#x27;proj3&#x27; })\napi.get(apiURL + proj3.uid)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3001bad0-490c-44c5-9535-07b1ef702602&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if billing manager tried to get Project which is not allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get error, if billing manager tried to get Project which is not allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.get(apiURL + proj1.uid)\n    .set({ authtoken: orgData.billing_manager.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;482ed909-4cd4-49d8-93c7-4c4dc3885528&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project, if admin of org tried to get Project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get project, if admin of org tried to get Project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.get(apiURL + proj1.uid)\n    .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.name).equal(proj1.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;373c987c-a55b-4c88-9eac-8c6a82854e8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project, if developer of org tried to get Project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get project, if developer of org tried to get Project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.get(apiURL + proj1.uid)\n    .set({ authtoken: orgData.developer.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.name).equal(proj1.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e09c1859-113e-4b4a-a762-9d6114c91165&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3e79209e-3a25-44fd-95ef-8e96ed307805&quot;,&quot;098d89bb-e64e-4922-b776-43ec09edb26d&quot;,&quot;2bad551e-26ba-4a8d-b0df-c5cce6390868&quot;,&quot;e9eb2075-e387-4431-ab3a-5a5ffdf401f8&quot;,&quot;3001bad0-490c-44c5-9535-07b1ef702602&quot;,&quot;482ed909-4cd4-49d8-93c7-4c4dc3885528&quot;,&quot;373c987c-a55b-4c88-9eac-8c6a82854e8f&quot;,&quot;e09c1859-113e-4b4a-a762-9d6114c91165&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:334,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6ecc061c-e4f6-4add-8cdd-916606081ab6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\getProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\getProjectParam.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;779ec274-e4fd-47ef-9c51-6017bc0c0602&quot;,&quot;title&quot;:&quot;ProjectParam.Get&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\getProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\getProjectParam.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:359,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        projectData.owner_uid = dummyUser.uid\n        projectData.env_uid = dummyUser.default_env\n        api.post(projectURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        project = res.body.output\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n            .send(paramData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        configSchema = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f628215-e51c-427d-b837-181f7120b6ee&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ uid: configSchema.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3a0ba1a-490a-41ef-aac3-4c6250bbb7db&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + configSchema.uid)\n    .send(paramData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fbaa9c58-e452-47d0-a07d-4b77320d7564&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project param, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get Should get project param, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + configSchema.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.key).equal(paramData.key);\n            expect(res.body.output.value).equal(paramData.value);\n            expect(res.body.output).not.have.all.keys([&#x27;param&#x27;])\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;58ce168c-5520-4542-96a4-4a7bf6331435&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if project not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get Should get error, if project not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: &#x27;ABC&#x27; })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9f60cac-8d62-451d-b1c0-2f42e3cdddd2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if configSchema not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get Should get error, if configSchema not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.NO_DATA_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dffcf072-8e29-4c63-8ea5-98a2decbe38c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fbaa9c58-e452-47d0-a07d-4b77320d7564&quot;,&quot;58ce168c-5520-4542-96a4-4a7bf6331435&quot;,&quot;a9f60cac-8d62-451d-b1c0-2f42e3cdddd2&quot;,&quot;dffcf072-8e29-4c63-8ea5-98a2decbe38c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:179,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;013f81f5-06f0-4c1c-9c16-54c5e6708f96&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\listProjectParams.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\listProjectParams.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9774754a-80e0-4e88-b5a5-70f196d8cd65&quot;,&quot;title&quot;:&quot;ProjectParam.List&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\listProjectParams.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\listProjectParams.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.List \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:401,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        projectData.owner_uid = dummyUser.uid\n        projectData.env_uid = dummyUser.default_env\n        api.post(projectURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        project = res.body.output\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n            .send(paramData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        configSchema = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6fa8461d-f601-441e-8709-e35ca39bfeac&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.List \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ uid: configSchema.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;989ef149-d206-48be-baec-502e6f9c5713&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.List Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .send(paramData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;109a7633-2b2a-4867-a97d-8ab62e26740c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project params, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.List Should get project params, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).equal(1)\n            expect(_.first(res.body.output)).not.have.all.keys([&#x27;param&#x27;])\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a56c92b5-2096-496c-89ff-565657ebda5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;109a7633-2b2a-4867-a97d-8ab62e26740c&quot;,&quot;a56c92b5-2096-496c-89ff-565657ebda5e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:68,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a825f4ed-6e94-46aa-9760-51039bd15004&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\listProjects.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\listProjects.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;10661473-2ad9-4211-b73f-4ee4b2f2448f&quot;,&quot;title&quot;:&quot;Project.List&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\listProjects.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\listProjects.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:226,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(apiURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                project = res.body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca2d543d-ac5e-4a4b-ba5b-bf65b2f9a4b5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a48aea3b-5fe0-4289-b1b8-c53283848584&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3494fac-6206-4dbb-9862-391f0fa8e7ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project list.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List Should get project list.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.projects.length).equal(2);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ffe3f5b3-5649-49ff-b38c-7316326c0e2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project list.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List Should get project list.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\napi.get(apiURL + &#x27;?q=&#x27; + projectData.name)\n    .set({ authtoken: dummyUser.authtoken })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.projects).name).equal(projectData.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f98f606a-0841-4580-8ba9-a8bd9a296479&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;billing manager should get defualt project only in list call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List billing manager should get defualt project only in list call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: orgData.billing_manager.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.count).to.be.equal(1)\n            expect(_.first(res.body.output.projects).name).to.be.equal(config.default_project)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe9df50c-4662-4494-ac05-b5de0f66df43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;admin should get all projects of an org in list call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List admin should get all projects of an org in list call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.count).to.be.equal(5)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;451ede0a-b9de-4c39-b55a-ff78e54da5f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;custom role user should get projects assigned to him in list call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List custom role user should get projects assigned to him in list call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.count).to.be.equal(3)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eca0cb63-53c8-4ba2-9b17-747857733f9a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;owner of org should get all projects of org.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List owner of org should get all projects of org.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: dummyUser.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.projects.length).equal(5);\n            expect(res.body.output.projects[0].org_uid).equal(orgData.organization.uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f915c85c-a60b-405a-924e-c0cf6a7e74e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d3494fac-6206-4dbb-9862-391f0fa8e7ee&quot;,&quot;ffe3f5b3-5649-49ff-b38c-7316326c0e2e&quot;,&quot;f98f606a-0841-4580-8ba9-a8bd9a296479&quot;,&quot;fe9df50c-4662-4494-ac05-b5de0f66df43&quot;,&quot;451ede0a-b9de-4c39-b55a-ff78e54da5f1&quot;,&quot;eca0cb63-53c8-4ba2-9b17-747857733f9a&quot;,&quot;f915c85c-a60b-405a-924e-c0cf6a7e74e1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:293,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;46f56bf7-2bb4-431c-bb32-f182a72c4883&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\updateProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\updateProject.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b13950dc-9c6c-4d6b-982d-2d25f7d71cda&quot;,&quot;title&quot;:&quot;Project.Update&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\updateProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\updateProject.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:299,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        projectData.user_uid = dummyUser.uid\n        projectData.env_uid = dummyUser.default_env\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        project = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;343c0e7e-69d3-4599-a821-f4190cdd4148&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;082d6f9f-fce7-40c1-9ff6-73ad6629192b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + project.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b6179b8-42e3-4b66-9982-b9d8cc576a56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tried to update project which not exists in an environment.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should get error, if user tried to update project which not exists in an environment.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.put(apiURL + &#x27;project.uid&#x27;)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91985226-6cd7-4e7a-9345-c186baf1ae53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user tried to update project with name already exists in an environment.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should get error if user tried to update project with name already exists in an environment.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar project1 = _.cloneDeep(projectData)\nproject1.owner_uid = dummyUser.uid\nproject1.env_uid = dummyUser.default_env\napi.put(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .send(project1)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NAME_UNIQUE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33b6533c-03d5-4f89-bf67-ca8d1d630726&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user tried to update project which is default.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should get error if user tried to update project which is default.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar project1 = _.cloneDeep(projectData)\nproject1.owner_uid = dummyUser.uid\nproject1.env_uid = dummyUser.default_env\napi.put(apiURL + dummyUser.default_project)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .send(project1)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.DEFAULT_PROJECT_DELETE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;081f81f2-4340-44f6-8ecc-758cbd56563c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update project, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should update project, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;updated project&#x27;\napi.put(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.name).equal(projectData.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc9a6810-e7d5-4262-abf4-c6653158fc93&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if  project name is blank.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should get error if  project name is blank.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;&#x27;\nprojectData.owner_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.put(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            expect(res.body.error.name.message).equal(messageList.PROJECT_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6cf3e5f-9b76-4c5a-bd07-41604c7d1168&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9b6179b8-42e3-4b66-9982-b9d8cc576a56&quot;,&quot;91985226-6cd7-4e7a-9345-c186baf1ae53&quot;,&quot;33b6533c-03d5-4f89-bf67-ca8d1d630726&quot;,&quot;081f81f2-4340-44f6-8ecc-758cbd56563c&quot;,&quot;bc9a6810-e7d5-4262-abf4-c6653158fc93&quot;,&quot;d6cf3e5f-9b76-4c5a-bd07-41604c7d1168&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:242,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dd3b4e22-ee1c-48a8-8490-1919d2bde52b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\updateProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\updateProjectParam.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;516e4e8e-e709-484e-a60a-f07902fd5115&quot;,&quot;title&quot;:&quot;ProjectParam.Update&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\project\\updateProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\updateProjectParam.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:255,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(projectURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            },\n            function(res, cbk) {\n                project = res.body.output\n                api.post(apiURL)\n                    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n                    .send(paramData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                configSchema = res.body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e9a0543-043e-4dc5-98af-d0ab52395877&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ uid: configSchema.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b87e2a93-a3a3-45e2-bad5-44270132d234&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + configSchema.uid)\n    .send(paramData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f230191a-601c-4c6b-8105-ba2cabd135c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update project param, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update Should update project param, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramData2 = {\n    key: \&quot;key2\&quot;,\n    value: \&quot;value2\&quot;,\n    required: false,\n    isPassword: true,\n    hasError: false\n}\nparamData2.key = &#x27;key2&#x27;\napi.put(apiURL + configSchema.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .send(paramData2)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.param.key).equal(paramData2.key);\n            expect(res.body.output.param.value).equal(paramData2.value);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c5e70b6-0359-4c50-ac88-2500af2defb5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if unauthorised user tried to update data of other user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update Should get error, if unauthorised user tried to update data of other user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + project.uid)\n    .set({ authtoken: orgData.role1.authtoken })\n    .send({})\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.NO_DATA_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c50ebc6-c120-4ee8-be8a-e87bb0167b51&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if project not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update Should get error, if project not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: &#x27;ABC&#x27; })\n    .send({})\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f1d80de-ee0b-41ac-b635-510afd97091d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if configSchema not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update Should get error, if configSchema not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramData3 = {\n    key: \&quot;key2\&quot;,\n    value: \&quot;value2\&quot;,\n    required: false,\n    isPassword: true,\n    hasError: false\n}\nparamData3.key = &#x27;key2&#x27;\napi.put(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .send(paramData3)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.NO_DATA_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5b50f1dd-0a98-49bf-89da-c8e4d0d820b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f230191a-601c-4c6b-8105-ba2cabd135c8&quot;,&quot;7c5e70b6-0359-4c50-ac88-2500af2defb5&quot;,&quot;7c50ebc6-c120-4ee8-be8a-e87bb0167b51&quot;,&quot;7f1d80de-ee0b-41ac-b635-510afd97091d&quot;,&quot;5b50f1dd-0a98-49bf-89da-c8e4d0d820b9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:171,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;58541463-98ce-47f1-a2e9-e195aeb7599e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;27af1537-b14b-473b-963e-f14481742330&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f8de38de-5965-4b9c-b940-3646c9116117&quot;,&quot;title&quot;:&quot;PromoCode.Create&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Plan.remove({ $or: [{ name: new RegExp(&#x27;^RANDOM_PLAN+&#x27;, \&quot;i\&quot;) }, { name: new RegExp(&#x27;^utest_cases_Standard+&#x27;, \&quot;i\&quot;) }] }, function(error, plan) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            _models.Promocode.remove({}, function(error, promo) {\n                _models.UserPromocode.remove({}, function(error, userPromos) {\n                    savePlanEntries({\n                        count: 5\n                    }, function(error, planEntries) {\n                        _planEntries = planEntries;\n                        done();\n                    });\n                });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;08c9ba22-45ea-4dd9-b860-d6812817a4be&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5cc2f249-2539-4eee-b3ac-c3e0572f551e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should add only promocode to user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should add only promocode to user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:251,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid != \&quot;\&quot;).should.equal(true);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a238be47-82d1-4582-9479-e0957f838842&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promocode is not allowed for trial plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should give error as promocode is not allowed for trial plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_NOT_ALLOWED_FOR_DEFAULT);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f534a4d-37f6-4c27-bf84-7f677363d7b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode and its default plan to user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should add promocode and its default plan to user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:261,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                res.body.output.plan[0].uid == _planEntries[0].uid).should.equal(true);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c14affe-b551-4a3c-9383-f4eced01cbce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode to user and return proper user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should add promocode to user and return proper user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:289,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var user = res.body.output;\n            var isValid = typeof(user._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(user.__v) == \&quot;undefined\&quot; &amp;&amp;\n                user.user_plan.reimburse.credits == 2505 &amp;&amp;\n                user.user_plan.reimburse.period == 30 &amp;&amp;\n                user.user_plan.trigger.count == 7;\n            isValid.should.equal(true);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9faf653-988a-4aec-861f-20420121d860&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promocode invalid domain.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should give error as promocode invalid domain.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code,\n        email: \&quot;test.user+1@built.io\&quot;,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_DOMAIN_NOT_ALLOWED);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;565582cd-cbd7-498d-945b-07cad44c3031&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should give error as invalid promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: \&quot;FAKE_PROMO_CODE\&quot;,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;084c2259-46c8-4b64-a1e2-fa41618098d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid promocode error for future promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should give invalid promocode error for future promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).add(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(3, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bfbe32c5-9de5-4926-a512-c404b54d30bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give promocode expire error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should give promocode expire error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_EXPIRED);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;28c96be7-fc60-4d02-9898-65bd7e21f421&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allocate promocode to only two users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should allocate promocode to only two users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:571,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 2,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                res.body.output.plan[0].uid == _planEntries[0].uid) {\n                signUpUser({\n                    email: \&quot;test.user+2@raweng.com\&quot;,\n                    promo_code: promoCodes[0].promo_code\n                }, function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                            res.body.output.plan[0].uid == _planEntries[0].uid) {\n                            signUpUser({\n                                email: \&quot;test.user+3@raweng.com\&quot;,\n                                promo_code: promoCodes[0].promo_code,\n                                status: httpStatus.BAD_REQUEST\n                            }, function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    (res.body.error.message).should.equal(messageList.PROMOCODE_OVER_REDEMPT);\n                                    done();\n                                }\n                            });\n                        } else {\n                            true.should.equal(false);\n                            done();\n                        }\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;356dec6b-b696-4081-98c1-57078e787718&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode add signup.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should add promocode add signup.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:262,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;gmail.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    var tempRegistrationBody = getImmutable(registrationBody);\n    tempRegistrationBody.promo_code = promoCodes[0].promo_code;\n    tempRegistrationBody.email = \&quot;test.user@gmail.com\&quot;;\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(tempRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.subscription.days.should.equal(40);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac08a6d6-c011-4a7f-afad-0caac6f73a15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a238be47-82d1-4582-9479-e0957f838842&quot;,&quot;8f534a4d-37f6-4c27-bf84-7f677363d7b1&quot;,&quot;0c14affe-b551-4a3c-9383-f4eced01cbce&quot;,&quot;b9faf653-988a-4aec-861f-20420121d860&quot;,&quot;565582cd-cbd7-498d-945b-07cad44c3031&quot;,&quot;084c2259-46c8-4b64-a1e2-fa41618098d5&quot;,&quot;bfbe32c5-9de5-4926-a512-c404b54d30bd&quot;,&quot;28c96be7-fc60-4d02-9898-65bd7e21f421&quot;,&quot;356dec6b-b696-4081-98c1-57078e787718&quot;,&quot;ac08a6d6-c011-4a7f-afad-0caac6f73a15&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1829,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6c1b10fe-a59d-4621-aa6f-459ed8224694&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e7aa7fbf-eb1f-4b8d-9d3b-0f03f91fbcc1&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8c0376f2-f9b9-46e0-aa07-3772f049d0c2&quot;,&quot;title&quot;:&quot;PromoCode.getUserList&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7876,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    savePlanEntries({\n        count: 5\n    }, function(error, planEntries) {\n        _planEntries = planEntries;\n        addPromcode({\n            count: 1,\n            promo_code: \&quot;PROMO_CODE\&quot;,\n            domain: \&quot;raweng.com\&quot;,\n            redemption_count: 30,\n            redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n            redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n            allowed_plans: [],\n            default_plan: _planEntries[0],\n            addon_credits: 5,\n            addon_flows: 2,\n            addon_active_flows: 2,\n            addon_triggers: 2,\n            addon_trial_days: 10,\n            braintree_discount_id: \&quot;\&quot;,\n            promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n        }, function(error, promoCodes) {\n            addUsersWithPromocode({\n                count: 30,\n                promo_code: promoCodes[0].promo_code\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    done();\n                }\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1dfc2610-3f24-4a17-9f66-e2a457d0d26e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a44ce3a-7ded-4452-974d-70adf309e7bf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList Should get list users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:273,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isArray = Array.isArray(res.body.output.objects);\n            isArray.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0f4dd47-5085-47c2-8882-bf34f57c4523&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode to user and return proper user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList Should add promocode to user and return proper user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:320,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isArray = Array.isArray(res.body.output.objects);\n            if (isArray) {\n                var isValid = true;\n                _.forEach(res.body.output.objects, function(user) {\n                    if (user.plan[0].uid == _planEntries[0].uid) {\n                        isValid = isValid &amp;&amp; user.uid != \&quot;\&quot; &amp;&amp;\n                            typeof(user._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(user.__v) == \&quot;undefined\&quot; &amp;&amp;\n                            user.user_plan.reimburse.credits == 1005 &amp;&amp;\n                            user.user_plan.reimburse.period == 30 &amp;&amp;\n                            user.user_plan.trigger.count == 42 &amp;&amp;\n                            user.user_plan.flow.count == 102;\n                    }\n                });\n                isValid.should.equal(true);\n            } else {\n                true.should.equal(false);\n            }\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab9fe50b-9cae-401c-809c-184bb63c061c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of users by considering skip.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList Should get list of users by considering skip.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:322,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=5\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 25 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e39006c-5960-47c6-be3e-49482e36d5d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of users by considering limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList Should get list of users by considering limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=5\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 5 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c56b39d1-2b3f-4e5a-9294-eaa379cdec95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode applied users by considering skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList Should get list of promocode applied users by considering skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:139,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=5&amp;limit=10\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 10 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ae94cb46-5a9f-439e-ab3b-c32e0b389a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f0f4dd47-5085-47c2-8882-bf34f57c4523&quot;,&quot;ab9fe50b-9cae-401c-809c-184bb63c061c&quot;,&quot;4e39006c-5960-47c6-be3e-49482e36d5d0&quot;,&quot;c56b39d1-2b3f-4e5a-9294-eaa379cdec95&quot;,&quot;ae94cb46-5a9f-439e-ab3b-c32e0b389a73&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1125,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;45e8d9d9-bfde-40dc-aca5-940e4388952e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4d57b043-5c47-4c23-bd87-2e832425d21b&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3955ebd6-f7b1-401e-a51e-64a775eb2445&quot;,&quot;title&quot;:&quot;PromoCode.userPromocodeAdd&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:275,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({}, function(error, user) {\n    _models.Plan.remove({ $or: [{ name: new RegExp(&#x27;^RANDOM_PLAN+&#x27;, \&quot;i\&quot;) }, { name: new RegExp(&#x27;^utest_cases_Standard+&#x27;, \&quot;i\&quot;) }] }, function(error, plan) {\n        _models.Mail.remove({}, function(error, user) {\n            _models.Promocode.remove({}, function(error, promo) {\n                _models.UserPromocode.remove({}, function(error, userPromos) {\n                    signUpUser({}, function(err, res) {\n                        authToken = res.body.output.authtoken;\n                        token = res.body.output.activation_token;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        savePlanEntries({\n                            count: 5\n                        }, function(error, planEntries) {\n                            _planEntries = planEntries;\n                            done();\n                        });\n                    });\n                });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e58a984c-3f7d-4112-849f-5568a0964a6d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0188ef12-bfa1-4dec-80f3-2e6cfefe95b6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should add promocode to user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should add promocode to user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp;\n                userPromoCode.uid != \&quot;\&quot;) {\n                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid == uid &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                res.body.output.subscription.days == 40;\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e1f349c3-1124-46e4-97c8-8a9626e897e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode to user and return proper user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should add promocode to user and return proper user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:314,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authtoken = res.body.output.authtoken;\n            var user_uid = res.body.output.uid;\n            addPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                user_uid: user_uid,\n                status: httpStatus.OK\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(&#x27;authtoken&#x27;, authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var user = res.body.output;\n                                var isValid = user.uid == user_uid &amp;&amp;\n                                    typeof(user._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(user.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                    user.user_plan.reimburse.credits == 1005 &amp;&amp;\n                                    user.user_plan.reimburse.period == 30 &amp;&amp;\n                                    user.user_plan.trigger.count == 42 &amp;&amp;\n                                    user.user_plan.flow.count == 102;\n                                isValid.should.equal(true);\n                                done();\n                            }\n                        });\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31d2d31c-1f93-42ae-b81d-c9597cd2e55a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should re-again redempt another promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should re-again redempt another promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:70,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 2,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                var promocode_uid = userPromoCode.promocode_uid[0];\n                addPromcodeToUser({\n                    promo_code: promoCodes[1].promo_code\n                }, function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var userPromoCode = res.body.output;\n                        (userPromoCode.user_uid == uid &amp;&amp;\n                            userPromoCode.uid != \&quot;\&quot; &amp;&amp;\n                            userPromoCode.promocode_uid[0] != promocode_uid).should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5b4daca-cf3b-4c41-ae3d-6d749eda96a3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allocate promocode to only two users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should allocate promocode to only two users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:558,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 2,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                signUpUser({\n                    email: \&quot;test.user+1@raweng.com\&quot;\n                }, function(err, res) {\n                    var userUID1 = res.body.output.uid;\n                    addPromcodeToUser({\n                        promo_code: promoCodes[0].promo_code,\n                        user_uid: userUID1\n                    }, function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var userPromoCode = res.body.output;\n                            if (userPromoCode.user_uid == userUID1 &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                                signUpUser({\n                                    email: \&quot;test.user+2@raweng.com\&quot;\n                                }, function(err, res) {\n                                    var userUID2 = res.body.output.uid;\n                                    addPromcodeToUser({\n                                        promo_code: promoCodes[0].promo_code,\n                                        status: httpStatus.BAD_REQUEST\n                                    }, function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            (res.body.error.message).should.equal(messageList.PROMOCODE_OVER_REDEMPT);\n                                            done();\n                                        }\n                                    });\n                                });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e4f935f7-fcfa-439a-86cd-71264ca6fc92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allocate promocode if user plan is included in allowed_plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should allocate promocode if user plan is included in allowed_plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:269,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    var promocode_uid = promoCodes[0].uid;\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            addPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                status: httpStatus.OK,\n                user_uid: res.body.output.uid\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.uid.should.not.equal(\&quot;\&quot;);\n                    done();\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d68ffc27-df55-4438-aca6-af987122de0d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as user is not allowed to redempt promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give error as user is not allowed to redempt promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:276,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[1]],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    var promocode_uid = promoCodes[0].uid;\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            addPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                user_uid: res.body.output.uid,\n                status: httpStatus.BAD_REQUEST\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    (res.body.error.message).should.equal(messageList.PROMOCODE_NOT_ALLOWED_PLAN);\n                    done();\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bfbcdd57-476b-4d5a-860d-7edae8eba907&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error if promocode is already reverted.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give error if promocode is already reverted.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:274,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var user_uid = res.body.output.uid;\n            addPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                user_uid: user_uid,\n                status: httpStatus.OK\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    _models.UserPromocode.findOneAndUpdate({\n                        uid: res.body.output.uid\n                    }, {\n                        deleted_at: new Date()\n                    }, function(error, userPromo) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            addPromcodeToUser({\n                                promo_code: promoCodes[0].promo_code,\n                                user_uid: user_uid,\n                                status: httpStatus.BAD_REQUEST\n                            }, function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    (res.body.error.message).should.equal(messageList.PROMOCODE_IS_ALREADY_ALLOCATED);\n                                    done();\n                                }\n                            });\n                        }\n                    })\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb7631c9-61eb-4878-8374-a5f3f2bbd40d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give promocode expire error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give promocode expire error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_EXPIRED);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5043479c-e505-414f-a040-56614b73292a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid promocode error for future promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give invalid promocode error for future promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).add(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(3, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5261a397-8e83-4a49-83c2-747755f3be2b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promo code already redempt.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give error as promo code already redempt.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 2,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                addPromcodeToUser({\n                    promo_code: promoCodes[0].promo_code,\n                    status: httpStatus.BAD_REQUEST\n                }, function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        (res.body.error.message).should.equal(messageList.PROMOCODE_IS_ALREADY_ALLOCATED);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c1687fd-230a-4419-a8fb-b1928f6925b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give error as invalid promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: \&quot;FAKE_PROMO_CODE\&quot;,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;61eee816-2bea-4a00-adff-1c11bfb7286f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promocode invalid domain.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give error as promocode invalid domain.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:252,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        email: \&quot;test.user@built.io\&quot;\n    }, function(err, res) {\n        addPromcodeToUser({\n            promo_code: promoCodes[0].promo_code,\n            status: httpStatus.BAD_REQUEST,\n            user_uid: res.body.output.uid\n        }, function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                (res.body.error.message).should.equal(messageList.PROMOCODE_DOMAIN_NOT_ALLOWED);\n                done();\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b2d952d0-e43f-4721-a082-ec5cab7a6835&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e1f349c3-1124-46e4-97c8-8a9626e897e5&quot;,&quot;31d2d31c-1f93-42ae-b81d-c9597cd2e55a&quot;,&quot;a5b4daca-cf3b-4c41-ae3d-6d749eda96a3&quot;,&quot;e4f935f7-fcfa-439a-86cd-71264ca6fc92&quot;,&quot;d68ffc27-df55-4438-aca6-af987122de0d&quot;,&quot;bfbcdd57-476b-4d5a-860d-7edae8eba907&quot;,&quot;bb7631c9-61eb-4878-8374-a5f3f2bbd40d&quot;,&quot;5043479c-e505-414f-a040-56614b73292a&quot;,&quot;5261a397-8e83-4a49-83c2-747755f3be2b&quot;,&quot;4c1687fd-230a-4419-a8fb-b1928f6925b5&quot;,&quot;61eee816-2bea-4a00-adff-1c11bfb7286f&quot;,&quot;b2d952d0-e43f-4721-a082-ec5cab7a6835&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2208,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;753d657a-de45-45df-821c-3650f7b6a847&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9c615d9d-1108-41d5-a802-21aca720bfa4&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ba8d9272-79c5-40f1-b836-b261cc7825d8&quot;,&quot;title&quot;:&quot;PromoCode.userPromocodeDelete&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeDelete \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:263,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Plan.remove({ $or: [{ name: new RegExp(&#x27;^RANDOM_PLAN+&#x27;, \&quot;i\&quot;) }, { name: new RegExp(&#x27;^utest_cases_Standard+&#x27;, \&quot;i\&quot;) }] }, function(error, plan) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            _models.Promocode.remove({}, function(error, promo) {\n                _models.UserPromocode.remove({}, function(error, userPromos) {\n                    signUpUser({}, function(err, res) {\n                        authToken = res.body.output.authtoken;\n                        token = res.body.output.activation_token;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        savePlanEntries({\n                            count: 5\n                        }, function(error, planEntries) {\n                            _planEntries = planEntries;\n                            done();\n                        });\n                    });\n                });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2ec1b1d8-85ce-49bc-af15-3be10e7e8e9e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeDelete \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;85e6b9c7-db75-405e-8b62-b0223a973ed7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete user promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeDelete Should delete user promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            var user_promo_uid = userPromoCode.uid || \&quot;\&quot;;\n            api.delete(apiURL)\n                .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n                .send({\n                    user_promo_uid: user_promo_uid\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        (res.body.output.message).should.equal(messageList.PROMOCODE_REVOKED_SUCCESSFULLY);\n                        done();\n                    }\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec7d9800-9235-4c07-b64d-233e585ebaaf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give promocode already revoked error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeDelete Should give promocode already revoked error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            var user_promo_uid = userPromoCode.uid || \&quot;\&quot;;\n            _models.UserPromocode.findOneAndUpdate({\n                uid: user_promo_uid\n            }, {\n                deleted_at: new Date()\n            }, function(error, userPromoCode) {\n                if (error) {\n                    done(err);\n                } else {\n                    api.delete(apiURL)\n                        .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n                        .send({\n                            user_promo_uid: user_promo_uid\n                        })\n                        .expect(httpStatus.BAD_REQUEST)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                (res.body.error.message).should.equal(messageList.PROMOCODE_ALREADY_REVOKED);\n                                done();\n                            }\n                        });\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60f45601-4c17-4417-aebc-ac642550f6bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ec7d9800-9235-4c07-b64d-233e585ebaaf&quot;,&quot;60f45601-4c17-4417-aebc-ac642550f6bd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:98,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;80d6a1bf-7465-4bbd-818c-eff72c14fa94&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;67a90133-9f81-4b7d-823e-93d363902d7f&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6ff45c0d-1d07-4dda-bc3a-8b3a897a76d1&quot;,&quot;title&quot;:&quot;PromoCode.userPromocodeList&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8614,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    savePlanEntries({\n        count: 5\n    }, function(error, planEntries) {\n        _planEntries = planEntries;\n        addPromcode({\n            count: 1,\n            promo_code: \&quot;PROMO_CODE\&quot;,\n            domain: \&quot;raweng.com\&quot;,\n            redemption_count: 30,\n            redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n            redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n            allowed_plans: [],\n            default_plan: null,\n            addon_credits: 5,\n            addon_flows: 2,\n            addon_triggers: 2,\n            addon_trial_days: 10,\n            braintree_discount_id: \&quot;\&quot;,\n            promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n        }, function(error, promoCodes) {\n            addUsersWithPromocode({\n                count: 30,\n                promo_code: promoCodes[0].promo_code\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    done();\n                }\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9ee43d7-ddfc-4930-86ee-110c3ec10a0d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;216c3e1c-26de-468c-bcc8-20ba69b543bf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list promocode applied users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list promocode applied users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.objects).to.be.a(&#x27;array&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73dffa9f-7288-4b12-829b-38c3e032f10e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode applied users by considering skip.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list of promocode applied users by considering skip.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=5\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 25 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b480fea-1441-466c-b64e-62c821dd8500&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode applied users by considering limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list of promocode applied users by considering limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=5\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 5 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;35a34fca-dc36-43d8-95a6-1a9b3cdaf735&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode by applying email filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list of promocode by applying email filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=5&amp;email=test.user+1\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 5 &amp;&amp;\n                res.body.output.count == 11) {\n                isValid = true;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp; item.user.email.indexOf(\&quot;test.user+1\&quot;) == 0;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7bab87ac-a193-42ea-b049-8dd9ea48141f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode by applying uid filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list of promocode by applying uid filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=5&amp;uid=\&quot; + user_uid;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 1 &amp;&amp;\n                res.body.output.count == 1) {\n                isValid = true;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp; item.user.uid == user_uid;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f33a2104-cd2e-439e-8a3f-c70be8fd9775&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give first preference to email filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should give first preference to email filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=5&amp;uid=\&quot; + user_uid + \&quot;&amp;email=test.user+1\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 5 &amp;&amp;\n                res.body.output.count == 11) {\n                isValid = true;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp; item.user.email.indexOf(\&quot;test.user+1\&quot;) == 0;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0466d56-be96-4f19-8720-b8e33672cc18&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode applied users by considering skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list of promocode applied users by considering skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=5&amp;limit=10\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 10 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;40f5f513-7220-4ec1-9dfd-88af14ded80a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;73dffa9f-7288-4b12-829b-38c3e032f10e&quot;,&quot;2b480fea-1441-466c-b64e-62c821dd8500&quot;,&quot;35a34fca-dc36-43d8-95a6-1a9b3cdaf735&quot;,&quot;7bab87ac-a193-42ea-b049-8dd9ea48141f&quot;,&quot;f33a2104-cd2e-439e-8a3f-c70be8fd9775&quot;,&quot;c0466d56-be96-4f19-8720-b8e33672cc18&quot;,&quot;40f5f513-7220-4ec1-9dfd-88af14ded80a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:199,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bc06bd66-1719-4eb8-bb4c-3f10138de414&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;da10d6ce-b725-46e4-997c-405a67948710&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d01324da-1c42-49cc-8c22-f70daea82154&quot;,&quot;title&quot;:&quot;PromoCode.userPromocodeRedempt&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:291,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Plan.remove({ $or: [{ name: new RegExp(&#x27;^RANDOM_PLAN+&#x27;, \&quot;i\&quot;) }, { name: new RegExp(&#x27;^utest_cases_Standard+&#x27;, \&quot;i\&quot;) }] }, function(error, plan) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            _models.Promocode.remove({}, function(error, promo) {\n                _models.UserPromocode.remove({}, function(error, userPromos) {\n                    signUpUser({}, function(err, res) {\n                        authToken = res.body.output.authtoken;\n                        token = res.body.output.activation_token;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        savePlanEntries({\n                            count: 5\n                        }, function(error, planEntries) {\n                            _planEntries = planEntries;\n                            done();\n                        });\n                    });\n                });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a845982b-2610-4f78-b3a2-5be83665a935&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a32b654-b7f5-454e-9b18-bd406e54561a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should add promocode to user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should add promocode to user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:114,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp;\n                userPromoCode.uid != \&quot;\&quot;) {\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(\&quot;authtoken\&quot;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.subscription.days.should.equal(40);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f7fc75d7-a975-4fb1-9ef6-54a54fa946f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should properly add promocode fatures to standard plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should properly add promocode fatures to standard plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:362,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsignUpUser({\n    \&quot;email\&quot;: \&quot;test.user+1@raweng.com\&quot;,\n    \&quot;plan\&quot;: \&quot;Standard Plan (Annual)\&quot;\n}, function(err, res) {\n    var userFeatures = {};\n    userFeatures.flow_count = res.body.output.user_plan.flow.count;\n    userFeatures.flow_active = res.body.output.user_plan.flow.active;\n    userFeatures.trigger_count = res.body.output.user_plan.trigger.count;\n    userFeatures.days = (res.body.output.user_plan.reimburse || {}).period || 0;\n    userFeatures.credits = (res.body.output.user_plan.reimburse || {}).credits || 0;\n    authToken = res.body.output.authtoken || \&quot;\&quot;;\n    uid = res.body.output.uid || \&quot;\&quot;;\n    addPromcode({\n        count: 1,\n        promo_code: \&quot;PROMO_CODE\&quot;,\n        domain: \&quot;raweng.com\&quot;,\n        redemption_count: 1,\n        redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n        redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n        allowed_plans: [],\n        default_plan: null,\n        addon_credits: 5,\n        addon_flows: 2,\n        addon_triggers: 2,\n        addon_trial_days: 10,\n        braintree_discount_id: \&quot;\&quot;,\n        promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n    }, function(error, promoCodes) {\n        redemptPromcodeToUser({\n            promo_code: promoCodes[0].promo_code\n        }, function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var userPromoCode = res.body.output;\n                if (userPromoCode.user_uid == uid &amp;&amp;\n                    userPromoCode.uid != \&quot;\&quot;) {\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(\&quot;authtoken\&quot;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            var userNewFeatures = {};\n                            userNewFeatures.flow_count = res.body.output.user_plan.flow.count;\n                            userNewFeatures.flow_active = res.body.output.user_plan.flow.active;\n                            userNewFeatures.trigger_count = res.body.output.user_plan.trigger.count;\n                            userNewFeatures.days = (res.body.output.user_plan.reimburse || {}).period || 0;\n                            userNewFeatures.credits = (res.body.output.user_plan.reimburse || {}).credits || 0;\n                            (userFeatures.flow_count == userNewFeatures.flow_count &amp;&amp;\n                                userFeatures.flow_active == userNewFeatures.flow_active &amp;&amp;\n                                (userFeatures.trigger_count + 2) == userNewFeatures.trigger_count &amp;&amp;\n                                userFeatures.days == userNewFeatures.days &amp;&amp;\n                                (userFeatures.credits + 5) == userNewFeatures.credits).should.equal(true);\n                            done();\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;404e6c60-6735-49d6-b196-711cca9e0181&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should re-again redempt another promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should re-again redempt another promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:123,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 2,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                var promocode_uid = userPromoCode.promocode_uid[0];\n                redemptPromcodeToUser({\n                    promo_code: promoCodes[1].promo_code\n                }, function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var userPromoCode = res.body.output;\n                        (userPromoCode.user_uid == uid &amp;&amp;\n                            userPromoCode.uid != \&quot;\&quot; &amp;&amp;\n                            userPromoCode.promocode_uid[0] != promocode_uid).should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8412cc78-47ee-47b0-8ec4-d739b2951bc0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allocate promocode to only two users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should allocate promocode to only two users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:645,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 2,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                signUpUser({\n                    email: \&quot;test.user+1@raweng.com\&quot;\n                }, function(err, res) {\n                    var userUID1 = res.body.output.uid;\n                    var authtoken1 = res.body.output.authtoken;\n                    redemptPromcodeToUser({\n                        promo_code: promoCodes[0].promo_code,\n                        authtoken: authtoken1\n                    }, function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var userPromoCode = res.body.output;\n                            if (userPromoCode.user_uid == userUID1 &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                                signUpUser({\n                                    email: \&quot;test.user+2@raweng.com\&quot;\n                                }, function(err, res) {\n                                    var userUID2 = res.body.output.uid;\n                                    var authtoken2 = res.body.output.authtoken;\n                                    redemptPromcodeToUser({\n                                        promo_code: promoCodes[0].promo_code,\n                                        status: httpStatus.BAD_REQUEST,\n                                        authtoken: authtoken2\n                                    }, function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            (res.body.error.message).should.equal(messageList.PROMOCODE_OVER_REDEMPT);\n                                            done();\n                                        }\n                                    });\n                                });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36cb624e-8e76-4b56-92c5-a444534dd233&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allocate promocode if user plan is included in allowed_plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should allocate promocode if user plan is included in allowed_plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:286,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    var promocode_uid = promoCodes[0].uid;\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authtoken1 = res.body.output.authtoken;\n            redemptPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                status: httpStatus.OK,\n                user_uid: res.body.output.uid,\n                authtoken: authtoken1\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.uid.should.not.equal(\&quot;\&quot;);\n                    done();\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce7d240d-6a22-45fb-8bbe-a59caf47dfa9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as user is not allowed to redempt promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give error as user is not allowed to redempt promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:333,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[1]],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    var promocode_uid = promoCodes[0].uid;\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            redemptPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                user_uid: res.body.output.uid,\n                status: httpStatus.BAD_REQUEST\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    (res.body.error.message).should.equal(messageList.PROMOCODE_NOT_ALLOWED_PLAN);\n                    done();\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b8e9a48-da31-4ac8-8137-2afe89155046&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give promocode expire error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give promocode expire error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_EXPIRED);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c356315c-d286-45d4-8a14-e96ee30e75a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid promocode error for future promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give invalid promocode error for future promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).add(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(3, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0f18e79-f69e-40a6-a98f-2b0cf0431d64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promo code already redempt.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give error as promo code already redempt.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:159,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 2,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                redemptPromcodeToUser({\n                    promo_code: promoCodes[0].promo_code,\n                    status: httpStatus.BAD_REQUEST\n                }, function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        (res.body.error.message).should.equal(messageList.PROMOCODE_IS_ALREADY_ALLOCATED);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd6ced8a-c17d-42a8-a47f-7e469b4c51c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give error as invalid promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: \&quot;FAKE_PROMO_CODE\&quot;,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4018625-e3d3-4393-b474-09c111feafa8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promocode invalid domain.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give error as promocode invalid domain.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:318,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        email: \&quot;test.user@built.io\&quot;\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authtoken1 = res.body.output.authtoken;\n            redemptPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                status: httpStatus.BAD_REQUEST,\n                user_uid: res.body.output.uid,\n                authtoken: authtoken1\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    (res.body.error.message).should.equal(messageList.PROMOCODE_DOMAIN_NOT_ALLOWED);\n                    done();\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e12af754-1ade-4f29-ac48-7127f0b617e9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f7fc75d7-a975-4fb1-9ef6-54a54fa946f9&quot;,&quot;404e6c60-6735-49d6-b196-711cca9e0181&quot;,&quot;8412cc78-47ee-47b0-8ec4-d739b2951bc0&quot;,&quot;36cb624e-8e76-4b56-92c5-a444534dd233&quot;,&quot;ce7d240d-6a22-45fb-8bbe-a59caf47dfa9&quot;,&quot;2b8e9a48-da31-4ac8-8137-2afe89155046&quot;,&quot;c356315c-d286-45d4-8a14-e96ee30e75a5&quot;,&quot;e0f18e79-f69e-40a6-a98f-2b0cf0431d64&quot;,&quot;fd6ced8a-c17d-42a8-a47f-7e469b4c51c5&quot;,&quot;b4018625-e3d3-4393-b474-09c111feafa8&quot;,&quot;e12af754-1ade-4f29-ac48-7127f0b617e9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2503,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;68ed60e7-fb0f-4aaa-bb4b-713f2a8107d1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\getTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\getTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0a06d719-b9ad-40d7-96ff-886f005b4283&quot;,&quot;title&quot;:&quot;Templates.getTemplate&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\getTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\getTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.getTemplate \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:268,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            });\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        var templateBody = testData.templateBody;\n        templateBody.author = dummyUser._id\n        _models.Template.create(templateBody, function(err, res) {\n            cbk(err, res);\n        })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userTemplate = res.toJSON();\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6db9515-28d9-408e-ad7a-2c4d0e28d4d6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.getTemplate \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.User.remove({ uid: dummyUser.uid }, function(err) {\n            cb(err)\n        });\n    },\n    function(cb) {\n        _models.Template.remove({ uid: userTemplate.uid }, function(err) {\n            cb(err)\n        });\n    },\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e6bea3c-9b83-45b0-93df-2d82165f6f43&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.getTemplate Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + userTemplate.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95c24a18-4d13-43fa-add3-7976b0c3e280&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if template not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.getTemplate Should get error, if template not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;dummyTemplate&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TEMPLATE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c511e028-753f-446a-86a5-45fd1158a011&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.getTemplate Should get template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:79,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + userTemplate.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.name).to.be.equal(testData.templateBody.name);\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;350acb05-e6c0-4e99-b246-d94387820efd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;95c24a18-4d13-43fa-add3-7976b0c3e280&quot;,&quot;c511e028-753f-446a-86a5-45fd1158a011&quot;,&quot;350acb05-e6c0-4e99-b246-d94387820efd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:174,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7771f5b0-9eff-434e-af25-8b7b6befde30&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\importTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\importTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6f854739-37d2-4860-af33-604c11d8bc0a&quot;,&quot;title&quot;:&quot;Templates.importTemplate&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\importTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\importTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:267,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken\n                var templateBody = _.cloneDeep(testData.templateBody);\n                templateBody.author = dummyUser._id\n                _models.Template.create(templateBody, function(err, res) {\n                    cbk(err, res);\n                })\n            },\n            function(result, cbk) {\n                userTemplate = result.toJSON();\n                var templateBodyWithFlowData = _.cloneDeep(testData.templateBodyWithFlowData);\n                var encrypt = encryption.encryptMultipleSync([templateBodyWithFlowData.environment, templateBodyWithFlowData.activities], encryption.getKeySync())\n                templateBodyWithFlowData.author = dummyUser._id\n                templateBodyWithFlowData.environment = encrypt[0]\n                templateBodyWithFlowData.activities = encrypt[1]\n                _models.Template.create(templateBodyWithFlowData, function(err, res) {\n                    cbk(err, res);\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userTemplateWithFlowData = res.toJSON();\n                tempWithFlowData.data.template_uid = userTemplateWithFlowData.uid;\n                done();\n            }\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;450893d9-f2dd-4b13-b880-3591292f347a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.User.remove({ uid: dummyUser.uid }, function(err) {\n            cb(err)\n        });\n    },\n    function(cb) {\n        _models.Template.remove({ uid: { $in: [userTemplate.uid, userTemplateWithFlowData.uid] } }, function(err) {\n            cb(err)\n        });\n    },\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3b69b21-e5d0-44b9-af4e-c192fa3cc6da&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .send(data)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32db99b5-a8a4-412a-8eed-721e37a2c2c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should import template with flow_data, if template data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate Should import template with flow_data, if template data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:126,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(tempWithFlowData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output\n            expect(flow).to.be.any.keys([&#x27;uid&#x27;]);\n            expect(flow.flow_version).to.be.equal(1);\n            done();\n            //_models.ConfigSchema.find({ type: &#x27;param&#x27;, project_uid: flow.project_uid }, function(err, result) {\n            //    if (err) {\n            //        done(err)\n            //    } else {\n            //        expect(_.first(result).uid).equal(_.first(tempWithFlowData.data.project_params).uid)\n            //        done();\n            //    }\n            //})\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1c94b39-68d0-40ce-85dc-a041ca7446af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should import template in org with flow_data, if template data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate Should import template in org with flow_data, if template data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:335,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n    .send(tempWithFlowData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.any.keys([&#x27;uid&#x27;]);\n            expect(res.body.output.org_uid).to.be.equal(orgData.organization.uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;110c1223-a485-48fa-8c1f-fe06c3e9e9d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should import template without flow_data, if template data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate Should import template without flow_data, if template data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(&#x27;/enterprise/v1/templates/import&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ uid: userTemplate.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.any.keys([&#x27;uid&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8d1dbb46-3950-45d8-86c2-ad6c9f176037&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if template not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate Should get error, if template not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntempWithFlowData.data.template_uid = &#x27;dummyTemplate&#x27;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(tempWithFlowData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TEMPLATE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0b71813-a19b-4206-877b-8354061ac29b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;32db99b5-a8a4-412a-8eed-721e37a2c2c3&quot;,&quot;c1c94b39-68d0-40ce-85dc-a041ca7446af&quot;,&quot;110c1223-a485-48fa-8c1f-fe06c3e9e9d2&quot;,&quot;8d1dbb46-3950-45d8-86c2-ad6c9f176037&quot;,&quot;d0b71813-a19b-4206-877b-8354061ac29b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:626,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5b96a34e-c850-40e1-83c5-360c4cd46f3c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\listTagsOfTemplates.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTagsOfTemplates.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e5bc0b16-6bd4-42a9-b642-8d233caca8b8&quot;,&quot;title&quot;:&quot;Template.ListTagsOfTemplates&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\listTagsOfTemplates.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTagsOfTemplates.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Template.ListTagsOfTemplates \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:312,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5eb3a52e-99bf-4a6c-af45-045b232f6459&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of templates by Tags.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Template.ListTagsOfTemplates Should get list of templates by Tags.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df339789-2afe-4c7c-bc81-a5b34bb41e5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;df339789-2afe-4c7c-bc81-a5b34bb41e5c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bb2cce55-fb7f-48c8-ac68-38076fef0a1d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\listTemplateIcons.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplateIcons.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c24e91bc-c868-406b-bb46-61a647c03169&quot;,&quot;title&quot;:&quot;Templates.listTemplatesIcon&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\listTemplateIcons.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplateIcons.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplatesIcon \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:294,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            });\n    }\n], function(err, result) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = result.body.output;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0549f3c0-b467-490f-8013-45db13598077&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplatesIcon \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.User.remove({ uid: dummyUser.uid }, function(err) {\n            cb(err)\n        });\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5b6db635-9c67-4a80-8708-588baf0cfa3d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplatesIcon Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff6d4d93-ecc6-40e4-a56d-cd5290ff94eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of icons of templates.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplatesIcon Should get list of icons of templates.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:70,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            expect(_.first(res.body.output)).to.have.all.keys([&#x27;category&#x27;, &#x27;category_icons&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a21b8072-0273-4704-970f-ff20322304f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ff6d4d93-ecc6-40e4-a56d-cd5290ff94eb&quot;,&quot;a21b8072-0273-4704-970f-ff20322304f5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:86,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;91127feb-ba33-4a66-bff3-53bd893416eb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\listTemplates.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplates.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e49fdec6-6923-46e8-85a1-04186e517d30&quot;,&quot;title&quot;:&quot;Templates.list&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\listTemplates.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplates.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.list \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:303,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f7757119-b17b-4b11-805c-4cc1a93d143a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.list \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.User.remove({ uid: dummyUser.uid }, function(err) {\n            cb(err)\n        });\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2932c1f4-822d-44fe-a8db-a64492c332d6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.list Should get list template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea51ddcb-018a-46ac-854f-dc2299b562cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ea51ddcb-018a-46ac-854f-dc2299b562cd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;048ce81c-c4fa-4ef1-9792-b3bcfd4d4bd0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\listTemplateServices.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplateServices.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c65a4960-c968-4877-a75c-f5865d520561&quot;,&quot;title&quot;:&quot;Templates.listTemplateServices&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\templates\\listTemplateServices.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplateServices.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplateServices \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:381,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            });\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.get(&#x27;/enterprise/v1/templatesicon&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, result) {\n                cbk(err, result);\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        templates = res.body.output;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e27f1163-ff17-48cc-b36f-a8a7ddaf9fd6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplateServices \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.User.remove({ uid: dummyUser.uid }, function(err) {\n            cb(err)\n        });\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc5488b4-9d42-4a2d-b16e-25f2b9ecb7ae&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of services of template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplateServices Should get list of services of template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/&#x27; + templates[0].category + &#x27;/services&#x27;)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.have.all.keys([&#x27;count&#x27;, &#x27;objects&#x27;]);\n            expect(_.first(_.first(res.body.output.objects).category)).to.be.equal(templates[0].category);\n            expect(_.first(_.first(res.body.output.objects).activities)).to.be.String;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4291694a-f6b7-47b9-a796-821ead43a1d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4291694a-f6b7-47b9-a796-821ead43a1d4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b893b2d4-4898-4d86-ad60-65687a263392&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\createUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\createUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f862b570-c203-4c9a-afdc-3544738b363e&quot;,&quot;title&quot;:&quot;Trigger.CreateUserTrigger&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\createUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\createUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:431,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                api.get(&#x27;/enterprise/v1/user&#x27;)\n                    .set(&#x27;authtoken&#x27;, orgData.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            dummyUser = res.body.output;\n                            cbk(err, dummyUser)\n                        }\n                    });\n            },\n            function(dummyUser, cbk) {\n                _models.Project.findOne({\n                    name: config.default_project,\n                    owner_uid: dummyUser.uid\n                }, function(err, project) {\n                    cbk(err, project)\n                })\n            },\n            function(result, cbk) {\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(testData.enterpriseFlowBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f497778-aeb7-476a-9218-7a68810baa4d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        createdTriggers.push(userTrigger.uid)\n        _models.UserTrigger.remove({ uid: { $in: createdTriggers } }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        clearRecords(function(err, result) {\n            cb(err, result)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;24264c9c-fc33-4305-9306-6afb1cca9b1e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;729b94d0-c513-44c1-8267-07472d4ea09c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.clone(testData.enterpriseFlowBody);\ntriggerData = _.omit(triggerData, &#x27;trigger&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e87ba16-44b9-4d95-8e1c-d5c263517ba6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if trigger data is invalid in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should get error if trigger data is invalid in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.clone(testData.triggerBody);\ntriggerData = _.omit(triggerData.trigger, &#x27;name&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;09c15bdb-9ec0-4a14-9791-384a14b22c0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user-auth token is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should get error if user-auth token is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath }\ncommonMock.triggerCreateExchangeTokenError(opt)\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.triggerBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ERROR_WHILE_EXCHANGING_TOKEN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1597b903-70f1-4ba3-a29c-593b9604ea0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create trigger, if trigger data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should create trigger, if trigger data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        var trigUID = testData.expressTriggerResponse.uid;\n        // _models.UserTrigger.remove({uid: trigUID}, function(err, ut) {\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, ut) {\n                var data = { uid: trigUID }\n                _models.UserTrigger.findOneAndUpdate({ uid: ut.uid }, data, { new: true }, function(err, userTrig) {\n                    cbk(err, userTrig);\n                })\n            })\n            // })\n    },\n    function(ut, cbk) {\n        var opt = { path: triggerPath, body: triggerPath }\n        commonMock.triggerCreateSuccess(opt);\n        var opt1 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt1);\n        var opt2 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt2);\n        var opt3 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;pull\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt3);\n        var triggerData = _.cloneDeep(testData.triggerEnterpriseBody);\n        triggerData.trigger.flow = userFlow.uid\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(triggerData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userTrigger = res.body.output;\n        expect(userTrigger).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n        expect(userTrigger).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n        _models.UserTrigger.remove({ uid: userTrigger.uid }, function(err) {\n            done(err)\n        })\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;daa7b32a-cd1e-40c3-8b07-bc165ad654b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create trigger within organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should create trigger within organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:251,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        testData.mongoUserTriggerObj.user_uid = orgData.organization.user_uid;\n        testData.mongoUserTriggerObj.org_uid = orgData.organization.uid;\n        var trigUID = testData.expressTriggerResponse.uid;\n        // _models.UserTrigger.remove({uid: trigUID}, function(err, ut) {\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, ut) {\n            var data = { uid: trigUID }\n            _models.UserTrigger.findOneAndUpdate({ uid: ut.uid }, data, { new: true }, function(err, userTrig) {\n                cbk(err, userTrig);\n            })\n        })\n    },\n    function(userTrig, cbk) {\n        api.post(flowURL)\n            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n            .send(testData.enterpriseFlowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            })\n    },\n    function(res, org, cbk) {\n        orgFlow = res.body.output\n        var opt = { path: triggerPath, body: triggerPath }\n        commonMock.triggerCreateSuccess(opt);\n        var opt1 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] }, update: true };\n        commonMock.triggerPushSuccess(opt1);\n        var opt2 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true };\n        commonMock.triggerPushSuccess(opt2);\n        var opt3 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;pull\&quot;: [/^fl\\w*/] }, update: true };\n        commonMock.triggerPushSuccess(opt3);\n        var triggerData = _.cloneDeep(testData.triggerEnterpriseBody);\n        triggerData.trigger.flow = orgFlow.uid\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken, org_uid: orgData.organization.uid })\n            .send(triggerData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            });\n    }\n], function(err, res, org) {\n    if (err) {\n        done(err);\n    } else {\n        userTrigger = res.body.output;\n        expect(userTrigger).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n        expect(userTrigger).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n        expect(userTrigger.org_uid).to.equal(orgData.organization.uid);\n        expect(userTrigger.user_uid).to.equal(orgData.organization.user_uid);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a561655c-cb2e-4e79-b7c8-cbf5589d6e02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user trigger limit exceeds.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should get error, if user trigger limit exceeds.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        userTriggerLimit = (dummyUser.user_plan.trigger || {}).count\n        var triggerData = _.cloneDeep(testData.mongoUserTriggerObj)\n        triggerData.user_uid = dummyUser.uid;\n        async.times(userTriggerLimit, function(n, next) {\n            _models.UserTrigger.create(triggerData, function(err, userTrigger) {\n                next(err, userTrigger);\n            })\n        }, function(err, result) {\n            createdTriggers = _.map(_.flattenDeep(result), &#x27;uid&#x27;)\n            cbk(err, result)\n        })\n    },\n    function(result, cbk) {\n        var triggerData = _.cloneDeep(testData.triggerEnterpriseBody);\n        triggerData.trigger.flow = userFlow.uid\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(triggerData)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        var errMSG = \&quot;Your current plan does not allow using more than \&quot; + userTriggerLimit + \&quot; trigger(s) in your workflows. Please delete a trigger or upgrade your account before creating a new one.\&quot;;\n        expect(res.body.error.message).to.be.equal(errMSG);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32bbedb7-7aac-45e6-bc29-820d6cedb9f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;729b94d0-c513-44c1-8267-07472d4ea09c&quot;,&quot;9e87ba16-44b9-4d95-8e1c-d5c263517ba6&quot;,&quot;09c15bdb-9ec0-4a14-9791-384a14b22c0c&quot;,&quot;1597b903-70f1-4ba3-a29c-593b9604ea0a&quot;,&quot;daa7b32a-cd1e-40c3-8b07-bc165ad654b5&quot;,&quot;a561655c-cb2e-4e79-b7c8-cbf5589d6e02&quot;,&quot;32bbedb7-7aac-45e6-bc29-820d6cedb9f7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:555,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;368a7298-4177-4ae0-8391-5eb2093684e9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\deleteUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\deleteUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;16708e2a-50f3-4074-b27f-bb68bb47f079&quot;,&quot;title&quot;:&quot;Trigger.DeleteUserTrigger&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\deleteUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\deleteUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.DeleteUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:269,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bdc0776f-3e09-4385-957f-36f932b6841e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.DeleteUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;150c1b30-4523-42b6-a04b-e46e86abb5a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.DeleteUserTrigger Should get error, if trigger not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerDeleteNotFound(opt);\napi.delete(apiURL404)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n            httpmock.cleanAll();\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;361d65b7-fa75-4d02-8de3-cf158c579a20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete trigger, if trigger is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.DeleteUserTrigger Should delete trigger, if trigger is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerDeleteSuccess(opt);\ntestData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n//testData.mongoUserTriggerObj.project_uid = project.uid;\ntestData.mongoUserTriggerObj.uid = &#x27;dummyTrigger&#x27;\n_models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, result) {\n    //cbk(err, userTrigger);\n    if (err) {\n        done(err)\n    } else {\n        api.delete(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.message.should.equal(messageList.TRIGGER_DELETED_SUCCESSFULLY);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;67573b84-212c-4e4a-a730-1a3bea128ee9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;150c1b30-4523-42b6-a04b-e46e86abb5a5&quot;,&quot;361d65b7-fa75-4d02-8de3-cf158c579a20&quot;,&quot;67573b84-212c-4e4a-a730-1a3bea128ee9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:154,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;19c28475-8418-4dda-9cbb-b65d0c2af5a0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\executeUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\executeUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0dba68a6-48b0-4a85-a4e8-d5ccff47c399&quot;,&quot;title&quot;:&quot;Trigger.ExecuteUserTrigger&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\executeUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\executeUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ExecuteUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:297,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;556ffca9-64be-4428-8fd7-6216ae9ae221&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ExecuteUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48f3bc7f-aef1-469a-aad3-61ba051bc700&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ExecuteUserTrigger Should get error, if trigger not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerExecuteNotFound(opt);\napi.get(apiURL404)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d83bdbb-7725-4fcc-961d-3d8fcc6a7124&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should execute trigger, if trigger is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ExecuteUserTrigger Should execute trigger, if trigger is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerExecuteSuccess(opt);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.TRIGGER_EXECUTED_SUCCESSFULLY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4672b003-a736-4ae2-aced-6a5d2b72a5bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;48f3bc7f-aef1-469a-aad3-61ba051bc700&quot;,&quot;1d83bdbb-7725-4fcc-961d-3d8fcc6a7124&quot;,&quot;4672b003-a736-4ae2-aced-6a5d2b72a5bc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:127,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;15885191-26c2-4871-b28d-4a08b51baff1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\getUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\getUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;95c627c5-1e97-474c-9be9-dad4254c3e68&quot;,&quot;title&quot;:&quot;Trigger.GetUserTrigger&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\getUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\getUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:285,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        _models.Project.findOne({ name: config.default_project, owner_uid: dummyUser.uid }, function(err, project) {\n            cbk(err, project)\n        })\n    },\n    function(project, cbk) {\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        testData.mongoUserTriggerObj.project_uid = project.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    }\n], function(err, userTrigger) {\n    if (err) {\n        done(err);\n    } else {\n        userTriggerObj = userTrigger\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a8fa535e-8f94-4d9a-954b-4c29fed02201&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, userTrigger) {\n    if (err) {\n        done(err)\n    } else {\n        clearRecords(function(err, result) {\n            done(err)\n        })\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66c8a536-74da-4c2a-bdd4-499b75003e14&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + userTriggerObj.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b034f5c-14b0-4440-8846-7406d25b03bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger is not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger Should get error, if trigger is not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL404)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c75790c7-9d06-423a-9079-66033aa50eeb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger server is not responding.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger Should get error, if trigger server is not responding.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerRequestTimeout(opt);\napi.get(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.GATEWAY_TIMEOUT)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.TRIGGER_SERVER_DOWN)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9916edbd-43b9-4d38-888a-00421f1aa411&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user-trigger, if trigger is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger Should get user-trigger, if trigger is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerGetSuccess(opt);\napi.get(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe204a00-34e9-418b-8dea-c965350e7f65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8b034f5c-14b0-4440-8846-7406d25b03bf&quot;,&quot;c75790c7-9d06-423a-9079-66033aa50eeb&quot;,&quot;9916edbd-43b9-4d38-888a-00421f1aa411&quot;,&quot;fe204a00-34e9-418b-8dea-c965350e7f65&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:143,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8a88b82f-6d7a-4cbe-99a2-b76c876dd48e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\getUserTriggerByAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\getUserTriggerByAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;89b0c4a2-4d85-4fc0-a2a3-6f4872d6763b&quot;,&quot;title&quot;:&quot;Trigger.GetUserTriggerByAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\getUserTriggerByAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\getUserTriggerByAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTriggerByAuth \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:268,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82a03f55-ebd7-4761-bc62-4fb804d5037b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTriggerByAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98398f4a-2f48-4355-a9b9-7e294a77ac40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;uid\&quot; param is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTriggerByAuth Should get error, if \&quot;uid\&quot; param is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send()\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1cd8c9c3-d41f-4085-9469-21327a1721fb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user-triggers, if auth uid is present and valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTriggerByAuth Should get user-triggers, if auth uid is present and valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;843c8bfd-a51e-4f7d-b90a-b9246a0512a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;98398f4a-2f48-4355-a9b9-7e294a77ac40&quot;,&quot;1cd8c9c3-d41f-4085-9469-21327a1721fb&quot;,&quot;843c8bfd-a51e-4f7d-b90a-b9246a0512a0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:101,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5bbcc563-16f3-4e0d-8c5e-79bf9ef74696&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\listTriggers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\listTriggers.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5c737862-b645-45ed-a0ed-8605b7feb077&quot;,&quot;title&quot;:&quot;Trigger.ListTriggers&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\listTriggers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\listTriggers.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListTriggers \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:241,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef62596c-7e7a-4c17-912e-93036d0174c5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of triggers.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListTriggers Should get list of triggers.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c3e579d-3934-4742-97d9-d321061906be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListTriggers Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;90693f65-48fb-44c0-a0d6-514514c952b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2c3e579d-3934-4742-97d9-d321061906be&quot;,&quot;90693f65-48fb-44c0-a0d6-514514c952b5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:52,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c569efa6-c32e-4abe-9db9-cc220831a113&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\listUserTriggers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\listUserTriggers.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9fbc7ea3-452c-4094-9434-ca8682829f85&quot;,&quot;title&quot;:&quot;Trigger.ListUserTriggers&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\listUserTriggers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\listUserTriggers.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListUserTriggers \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:254,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        _models.Project.findOne({ name: config.default_project, owner_uid: dummyUser.uid }, function(err, project) {\n            cbk(err, project)\n        })\n    },\n    function(project, cbk) {\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        testData.mongoUserTriggerObj.project_uid = project.uid;\n        testData.mongoUserTriggerObj.env_uid = project.env_uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    }\n], function(err, userTrigger) {\n    if (err) {\n        done(err);\n    } else {\n        userTriggerObj = userTrigger\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b4ee40b-f41b-48d9-a0da-10821be29222&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListUserTriggers \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, userTrigger) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6edf6f92-4305-4320-9dde-ce77ca9cfda9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of triggers.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListUserTriggers Should get list of triggers.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var response = res.body.output\n            response.should.be.instanceOf(Array);\n            expect(_.first(_.first(response).triggers)).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n            expect(_.first(_.first(response).triggers)).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab77d46b-6c2b-42b7-b01d-cde057a73739&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListUserTriggers Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3614ffd-1bf8-4f2e-8d58-fd69d7ef2ec5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ab77d46b-6c2b-42b7-b01d-cde057a73739&quot;,&quot;f3614ffd-1bf8-4f2e-8d58-fd69d7ef2ec5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;104e8a6e-4924-4997-90db-434a32909e1f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\pullUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\pullUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;16aefbdc-251a-4aa0-af6a-2ea07f05632b&quot;,&quot;title&quot;:&quot;Trigger.PullUserTrigger&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\pullUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\pullUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:346,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        testData.flowBody.trigger.handlers = [userTriggerObj.uid]\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.flowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    },\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        pullTriggerData = {\n            \&quot;trigger\&quot;: {\n                \&quot;flow_uid\&quot;: userFlow.uid,\n                \&quot;uid\&quot;: userTriggerObj.uid,\n                \&quot;provider\&quot;: \&quot;clock\&quot;\n            }\n        }\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95b34415-9b5e-4b95-a3c6-604f7bb05e4d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;50c44e53-4b3d-45bd-954e-cc2897251753&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d00db9cc-9b60-4910-9f08-7e770d93932a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.clone(pullTriggerData);\ndata = _.omit(data, &#x27;trigger&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4101347-8cea-4e9f-bf9b-158bf1555125&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;flow_uid\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger Should get error if \&quot;flow_uid\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.clone(pullTriggerData);\ndata = _.omit(data.trigger, &#x27;flow_uid&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e556488-2484-4c63-b0de-5ced98e61eaf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should pull trigger, if trigger data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger Should pull trigger, if trigger data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] } };\ncommonMock.triggerPullSuccess(opt);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(pullTriggerData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.flow.trigger.handlers).to.be.empty\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;302c9063-a37f-44c4-bc84-8697799964b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if trigger not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger Should get error if trigger not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.clone(pullTriggerData);\ndata.trigger.uid = &#x27;dummyTrigger&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60ce088b-5ba8-4948-bd15-21dba71e3335&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d00db9cc-9b60-4910-9f08-7e770d93932a&quot;,&quot;d4101347-8cea-4e9f-bf9b-158bf1555125&quot;,&quot;3e556488-2484-4c63-b0de-5ced98e61eaf&quot;,&quot;302c9063-a37f-44c4-bc84-8697799964b5&quot;,&quot;60ce088b-5ba8-4948-bd15-21dba71e3335&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:208,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;cffca1ea-31a0-49d2-ab59-293c38d54100&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\testUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\testUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7fc70a33-2b06-45b4-b9e8-9066f57c7d28&quot;,&quot;title&quot;:&quot;Trigger.TestUserTrigger&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\testUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\testUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:286,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                api.get(&#x27;/enterprise/v1/user&#x27;)\n                    .set(&#x27;authtoken&#x27;, orgData.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            dummyUser = res.body.output;\n                            cbk(err, dummyUser)\n                        }\n                    });\n            },\n            function(dummyUser, cbk) {\n                _models.Project.findOne({\n                    name: config.default_project,\n                    owner_uid: dummyUser.uid\n                }, function(err, project) {\n                    cbk(err, project)\n                })\n            },\n            function(result, cbk) {\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(testData.enterpriseFlowBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a08181c-3c46-48d5-ad3d-09c8b76d226f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        createdTriggers.push(userTrigger.uid)\n        _models.UserTrigger.remove({ uid: { $in: createdTriggers } }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7591a12-8486-4ff1-9439-f95d3f21994e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c246d0d-2660-4af2-8dba-6db36ddeb88c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.clone(testData.enterpriseFlowBody);\ntriggerData = _.omit(triggerData, &#x27;trigger&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c697d588-c108-43a6-b6fa-7d58be743c45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if trigger data is invalid in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger Should get error if trigger data is invalid in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:218,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.clone(testData.triggerBody);\ntriggerData = _.omit(triggerData.trigger, &#x27;name&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;edf70aa8-e2ec-4c3c-abf8-0d3a79bd46d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user-auth token is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger Should get error if user-auth token is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath }\ncommonMock.triggerCreateExchangeTokenError(opt)\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.triggerBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ERROR_WHILE_EXCHANGING_TOKEN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1e921969-0255-434f-857a-e7e8a76ec526&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should test trigger, if trigger data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger Should test trigger, if trigger data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        var trigUID = testData.expressTriggerResponse.uid;\n        // _models.UserTrigger.remove({uid: trigUID}, function(err, ut) {\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, ut) {\n                var data = { uid: trigUID }\n                _models.UserTrigger.findOneAndUpdate({ uid: ut.uid }, data, { new: true }, function(err, userTrig) {\n                    cbk(err, userTrig);\n                })\n            })\n            // })\n    },\n    function(ut, cbk) {\n        var opt = { path: triggerPath, body: triggerPath }\n        commonMock.triggerCreateSuccess(opt);\n        var opt1 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt1);\n        var opt2 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt2);\n        var opt3 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;pull\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt3);\n        var triggerData = _.cloneDeep(testData.triggerEnterpriseBody);\n        triggerData.trigger.flow = userFlow.uid\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(triggerData)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userTrigger = res.body.output;\n        expect(userTrigger).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n        expect(userTrigger).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n        _models.UserTrigger.remove({ uid: userTrigger.uid }, function(err) {\n            done(err)\n        })\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14ce1ebb-10c9-4424-a7da-fd03d774b001&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0c246d0d-2660-4af2-8dba-6db36ddeb88c&quot;,&quot;c697d588-c108-43a6-b6fa-7d58be743c45&quot;,&quot;edf70aa8-e2ec-4c3c-abf8-0d3a79bd46d6&quot;,&quot;1e921969-0255-434f-857a-e7e8a76ec526&quot;,&quot;14ce1ebb-10c9-4424-a7da-fd03d774b001&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:350,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5a863fcb-3fc5-48c3-a4d3-f58d43daa75d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\updateUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\updateUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8c5ac540-a336-4ffc-b18f-084906893b5b&quot;,&quot;title&quot;:&quot;Trigger.UpdateUserTrigger&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\updateUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\updateUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:257,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        _models.Project.findOne({ name: config.default_project, owner_uid: dummyUser.uid }, function(err, project) {\n            cbk(err, project)\n        })\n    },\n    function(project, cbk) {\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        testData.mongoUserTriggerObj.project_uid = project.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    }\n], function(err, userTrigger) {\n    if (err) {\n        done(err);\n    } else {\n        userTriggerObj = userTrigger\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80d50d0a-3ce2-475d-9a6e-3a391d27b4db&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, userTrigger) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cecddeef-c457-4057-a1bb-62b535995afd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + userTriggerObj.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c4a8f77-d23e-4ac4-99ec-00dee9eb717e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should get error, if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.cloneDeep(testData.triggerBody);\ntriggerData = _.omit(triggerData, &#x27;trigger&#x27;);\napi.put(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acfdfb25-1914-46ce-b6a2-9786e1b6e7f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger data is invalid in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should get error, if trigger data is invalid in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.clone(testData.triggerBody);\ntriggerData = _.omit(triggerData.trigger, &#x27;name&#x27;);\napi.put(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a993ddf-1db1-4558-bc72-f923e7948ed4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user-auth token is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should get error, if user-auth token is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerUpdateExchangeTokenError(opt);\napi.put(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.triggerBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ERROR_WHILE_EXCHANGING_TOKEN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14edc5cb-1107-4094-b2ed-be1e72b0b6e8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update trigger, if trigger data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should update trigger, if trigger data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerUpdateSuccess(opt);\napi.put(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.triggerBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userTrigger = res.body.output;\n            expect(userTrigger).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;93b602d9-2f22-4219-a551-fd5f8b90d884&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should get error, if trigger not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerUpdateNotFound(opt);\napi.put(apiURL + &#x27;dummyTrigger&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.triggerBody)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;764919cc-b560-4353-9ccd-c1a461e60e06&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4c4a8f77-d23e-4ac4-99ec-00dee9eb717e&quot;,&quot;acfdfb25-1914-46ce-b6a2-9786e1b6e7f7&quot;,&quot;1a993ddf-1db1-4558-bc72-f923e7948ed4&quot;,&quot;14edc5cb-1107-4094-b2ed-be1e72b0b6e8&quot;,&quot;93b602d9-2f22-4219-a551-fd5f8b90d884&quot;,&quot;764919cc-b560-4353-9ccd-c1a461e60e06&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:275,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;604bfe91-aa69-479a-a9e7-587aba82b2c3&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\upsertUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\upsertUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f5459253-2989-4648-8e18-56962eff0022&quot;,&quot;title&quot;:&quot;Trigger.UpsertUserTrigger&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\trigger\\upsertUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\upsertUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:258,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                _models.Project.findOne({\n                    name: config.default_project,\n                    owner_uid: dummyUser.uid\n                }, function(err, project) {\n                    cbk(err, project)\n                })\n            },\n            function(project, cbk) {\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                testData.mongoUserTriggerObj.project_uid = project.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger;\n                testData.flowBody.trigger.handlers = [userTriggerObj]\n                var flow = _.cloneDeep(testData.flowBody)\n                flow.active = false;\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flow)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                upsertData = { flow_uid: userFlow.uid, trigger_uid: userTriggerObj.uid }\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78f000a7-db2e-433e-a8f1-8bd19e99ab25&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(cb) {\n        clearRecords(function(err, result) {\n            cb(err, result)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0ac8d7fa-a82f-49b3-8f3c-ee63ee40b161&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87728648-09ad-45b7-bb75-79a548906e48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;trigger_uid\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should get error if \&quot;trigger_uid\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.cloneDeep(upsertData);\ndata = _.omit(data, &#x27;trigger_uid&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95bc0092-faf6-4627-90a0-6058f264c45f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;flow_uid\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should get error if \&quot;flow_uid\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.cloneDeep(upsertData);\ndata = _.omit(data, &#x27;flow_uid&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac4f148d-7cbc-4ff0-9f65-a4e31804350e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should get error if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.cloneDeep(upsertData);\ndata.flow_uid = &#x27;dummyFlow&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14078b28-74c5-4298-9754-5e949b29aee7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should upsert trigger and keep flow in in-active state if plan exceeds and trigger data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should upsert trigger and keep flow in in-active state if plan exceeds and trigger data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:350,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] }\ncommonMock.triggerPushSuccess(opt);\nvar flowData = testData.enterpriseFlowBody\nasync.times(5, function(n, next) {\n    createFlow(flowURL, flowData, dummyUser, function(err, flow) {\n        next(err, flow)\n    })\n}, function(err, results) {\n    if (err) {\n        done(err)\n    } else {\n        var triggerData = testData.triggerEnterpriseBody;\n        triggerData.trigger.flow = userFlow.uid\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(upsertData)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(res.body.output.uid).to.be.equal(upsertData.trigger_uid)\n                    expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n                    _models.newFlow.findOne({ uid: userFlow.uid }, function(err, result) {\n                        if (err) {\n                            done(err)\n                        } else {\n                            expect(result.active).to.be.equal(false)\n                            done();\n                        }\n                    })\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4aac78a-76c6-4a4c-8093-aade16fb3067&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should upsert trigger within organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should upsert trigger within organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:184,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] }, update: true };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] }\ncommonMock.triggerPushSuccess(opt);\nvar tempOrgBody = orgBody;\n// var opt = { path: getTriggerPath, body: getTriggerPath, times: 2 };\n// commonMock.triggerCreateSuccess(opt);\nasync.waterfall([\n    function(cbk) {\n        //dummyUser = result.body.output;\n        _models.Project.findOne({ name: config.default_project, owner_uid: orgData.organization.user_uid }, function(err, project) {\n            cbk(err, project, org)\n        })\n    },\n    function(project, org, cbk) {\n        testData.mongoUserTriggerObj.user_uid = orgData.organization.user_uid;\n        testData.mongoUserTriggerObj.project_uid = project.uid;\n        testData.mongoUserTriggerObj.org_uid = orgData.organization.uid;\n        var trigUID = testData.expressTriggerResponse.uid;\n        // _models.UserTrigger.remove({uid: trigUID}, function(err, ut) {\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, ut) {\n                var data = { uid: trigUID }\n                _models.UserTrigger.findOneAndUpdate({ uid: ut.uid }, data, { new: true }, function(err, userTrig) {\n                    cbk(err, userTrig, org);\n                })\n            })\n            // })\n    },\n    function(userTrig, org, cbk) {\n        api.post(flowURL)\n            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n            .send(testData.enterpriseFlowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res, org, userTrig)\n            })\n    },\n    function(res, org, userTrig, cbk) {\n        orgFlow = res.body.output\n        upsertData.flow_uid = orgFlow.uid;\n        upsertData.trigger_uid = userTrig.uid;\n        var opt = { path: triggerPath, body: triggerPath }\n        commonMock.triggerCreateSuccess(opt);\n        var triggerData = testData.triggerEnterpriseBody;\n        triggerData.trigger.flow = orgFlow.uid\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken, org_uid: orgData.organization.uid })\n            .send(upsertData)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            });\n\n    }\n], function(err, res, org) {\n    if (err) {\n        done(err);\n    } else {\n        expect(res.body.output.uid).to.be.equal(upsertData.trigger_uid)\n            // expect(res.body.output.org_uid).to.be.equal(orgData.organization.uid)\n            // expect(res.body.output.user_uid).to.be.equal(orgData.organization.user_uid)\n        expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n        expect(res.body.output.project_uid).not.to.be.null;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;90db23f4-fa54-442a-8d4b-7baaf0110f0b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;87728648-09ad-45b7-bb75-79a548906e48&quot;,&quot;95bc0092-faf6-4627-90a0-6058f264c45f&quot;,&quot;ac4f148d-7cbc-4ff0-9f65-a4e31804350e&quot;,&quot;14078b28-74c5-4298-9754-5e949b29aee7&quot;,&quot;b4aac78a-76c6-4a4c-8093-aade16fb3067&quot;,&quot;90db23f4-fa54-442a-8d4b-7baaf0110f0b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:666,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;21ac2f0c-e72e-4998-afa2-5e4214a37536&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;87fe4046-f8ce-4bfa-95d8-122fad81de22&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;884d63a4-8549-4467-ae3b-7f5385dc5ebc&quot;,&quot;title&quot;:&quot;UserAuth.createUserAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a7e3ada-8408-48d9-aafe-31f7b210e3d6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nclearRecords(function(err, result) {\n    done(err);\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;784559a1-44c9-4215-9537-d2c36e1e08d8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create user auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should create user auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(userAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0724e03e-bfc7-4ecb-8d37-0e44c80f4b8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create user auth within organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should create user auth within organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3884,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = orgBody;\nasync.waterfall([\n    function(cbk) {\n        createOrgPlans(function() {\n            api.post(&#x27;/enterprise/v1/organizations&#x27;)\n                .send(tempOrgBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var org = res.body.output;\n                        _models.User.findOne({\n                            uid: res.body.output.user_uid\n                        }).lean().exec(function(err, user) {\n                            cbk(err, org)\n                        });\n                    }\n                });\n        });\n    },\n    function(org, cbk) {\n        api.post(apiURL)\n            .send(userAuthyBody)\n            .set({ authtoken: authToken, org_uid: org.uid })\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            });\n    }\n], function(err, res, org) {\n    if (err) {\n        done(err);\n    } else {\n        var userAuth = res.body.output\n        var isValid = userAuth.uid != \&quot;\&quot; &amp;&amp;\n            typeof(userAuth._id) == \&quot;undefined\&quot; &amp;&amp;\n            typeof(userAuth.__v) == \&quot;undefined\&quot;;\n        isValid.should.equal(true);\n        expect(userAuth).to.have.any.keys([&#x27;uid&#x27;, &#x27;org_uid&#x27;, &#x27;env_uid&#x27;, &#x27;project_uid&#x27;]);\n        expect(userAuth.org_uid).equal(org.uid);\n        expect(userAuth.user).equal(org.org_account.uid);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7316458d-8872-4663-b611-376cc9a94ae0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as auth name is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should give error as auth name is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(userAuthyBody);\ndelete tempUserAuthyBody.name;\napi.post(apiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.name.message.should.equal(messageList.USER_AUTH_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca6eed73-a54a-48cc-bba7-27d5cc358674&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create auth when category is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should create auth when category is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(userAuthyBody);\ndelete tempUserAuthyBody.category;\napi.post(apiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5160d954-cfe2-4dba-9c5c-e717a66f5431&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as auth data is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should give error as auth data is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(userAuthyBody);\ndelete tempUserAuthyBody.data;\napi.post(apiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.data.message.should.equal(messageList.USER_AUTH_DATA_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2ea2deea-8dbf-4f7d-9574-d546ae4b2446&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(userAuthyBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;22a2cd11-7f25-4d0a-b8dc-1a3c40dbb009&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0724e03e-bfc7-4ecb-8d37-0e44c80f4b8a&quot;,&quot;7316458d-8872-4663-b611-376cc9a94ae0&quot;,&quot;ca6eed73-a54a-48cc-bba7-27d5cc358674&quot;,&quot;5160d954-cfe2-4dba-9c5c-e717a66f5431&quot;,&quot;2ea2deea-8dbf-4f7d-9574-d546ae4b2446&quot;,&quot;22a2cd11-7f25-4d0a-b8dc-1a3c40dbb009&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4044,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;850c9abb-1ab1-4095-9f4c-1344ecdb5170&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b31e515e-b309-4329-9577-8876fa9151af&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b03f16ca-fdaf-45d4-b014-bcf1ef8b9dcc&quot;,&quot;title&quot;:&quot;UserAuth.deleteUserAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.deleteUserAuth \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            apiURL = apiURL.replace(\&quot;:user_uid\&quot;, uid);\n            api.post(apiURL)\n                .send(userAuthyBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _authUid = res.body.output.uid;\n                        done();\n                    }\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4b0ae64a-c953-48e2-9cfe-bfaf91507bb9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.deleteUserAuth \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0dad1003-dfdf-4362-868c-cbd3838d9c07&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete user auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.deleteUserAuth Should delete user auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar deleteAPIURL = apiURL + \&quot;/\&quot; + _authUid;\nvar opt = { path: &#x27;/oauth/&#x27; + _authUid };\ncommonMock.authDeleteSuccess(opt);\napi.delete(deleteAPIURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.USER_AUTH_DELETED_SUCCESSFULLY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bbe9dc73-d88c-46ec-b0e4-f3b790ab6e60&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete another user&#x27;s auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.deleteUserAuth Should not delete another user&#x27;s auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:279,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: &#x27;/oauth/&#x27; + _authUid };\ncommonMock.authNotFound(opt);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            anotherUserAuthToken = res.body.output.authtoken;\n            anotherUserUid = res.body.output._id;\n            var deleteAPIURL = apiURL + \&quot;/\&quot; + _authUid;\n            api.delete(deleteAPIURL)\n                .set(&#x27;authtoken&#x27;, anotherUserAuthToken)\n                .expect(httpStatus.NOT_FOUND)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.USER_AUTH_NOT_FOUND);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d429afef-de5f-4984-b6f7-0c506328d767&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.deleteUserAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar deleteAPIURL = apiURL + \&quot;/\&quot; + _authUid;\napi.delete(deleteAPIURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c3a1f59-c6de-49b3-9ca0-1594a2b85c1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bbe9dc73-d88c-46ec-b0e4-f3b790ab6e60&quot;,&quot;d429afef-de5f-4984-b6f7-0c506328d767&quot;,&quot;0c3a1f59-c6de-49b3-9ca0-1594a2b85c1c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:328,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;94b09e15-a209-4c3d-a373-fe457535c7e4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2a4481b4-9a1a-4b1d-86ca-1b2ecb859dbf&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;694bc98c-87ff-474e-80aa-f6af7fdafcc8&quot;,&quot;title&quot;:&quot;UserAuth.findUserAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.findUserAuth \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            apiURL = apiURL.replace(\&quot;:user_uid\&quot;, uid);\n            api.post(apiURL)\n                .send(userAuthyBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _authUid = res.body.output.uid;\n                        done();\n                    }\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ce24127-37f0-4806-99c6-0649b68aecb8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.findUserAuth \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6e695b8-fd73-403b-927a-f8a884eea743&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should find user auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.findUserAuth Should find user auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar getAPIURL = apiURL + \&quot;/\&quot; + _authUid;\napi.get(getAPIURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(_authUid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ebb0bed-7abb-44bf-a3b8-a92bc37dd9ab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if user auth not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.findUserAuth Should give error, if user auth not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar getAPIURL = apiURL + \&quot;/dummyAuth\&quot;;\napi.get(getAPIURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_AUTH_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20e4e3c4-d63e-48c3-97f7-0f18978b34c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.findUserAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar getAPIURL = apiURL + \&quot;/\&quot; + _authUid;\napi.get(getAPIURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a0f6e9fe-76ac-49e6-b392-172784fadc6b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8ebb0bed-7abb-44bf-a3b8-a92bc37dd9ab&quot;,&quot;20e4e3c4-d63e-48c3-97f7-0f18978b34c7&quot;,&quot;a0f6e9fe-76ac-49e6-b392-172784fadc6b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:88,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;41dc4f1f-2439-460e-9c1c-2bbf0effa455&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a86176a5-51a6-4d6c-b477-4630b16d0be4&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1ff46c57-18a5-479f-8bb6-eb18e8628469&quot;,&quot;title&quot;:&quot;UserAuth.getUserAuthList&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1466,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    saveUserAuthForOneUser(\&quot;test.user@raweng.com\&quot;, done, function() {\n        saveUserAuthForOneUser(\&quot;test.user+10@raweng.com\&quot;, done, function() {\n            done();\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8d0aafe1-ebba-4ae8-8bb7-e4f2fef3898d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;243622fc-ea34-4e0e-918b-07473112d6e0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get user auths list group by type.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList Should get user auths list group by type.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output[0].userauths.length == 10;\n                _.each(res.body.output[0].userauths, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b5567f59-5b18-43c0-b376-f129082b565b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user auths.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList Should get list of user auths.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?list=true\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 10;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a7106d9-cc84-43c2-ae35-dde387a37c37&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user auths based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList Should get limited list of user auths based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?list=true&amp;skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;765d99e1-32ce-47e8-a43b-e74dd8189de5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user auths based on skip/limit in description descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList Should get limited list of user auths based on skip/limit in description descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?list=true&amp;skip=2&amp;limit=2&amp;field=description&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e7817d3-9087-4414-bde3-12cd048492b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d2214c1-aaaf-4390-b458-23dde8a1458d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b5567f59-5b18-43c0-b376-f129082b565b&quot;,&quot;3a7106d9-cc84-43c2-ae35-dde387a37c37&quot;,&quot;765d99e1-32ce-47e8-a43b-e74dd8189de5&quot;,&quot;6e7817d3-9087-4414-bde3-12cd048492b8&quot;,&quot;7d2214c1-aaaf-4390-b458-23dde8a1458d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:212,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1b2ff61e-a4d4-4e14-8bb2-c1729714820e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4171f6cf-e862-434d-9178-b970bbb76dc8&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;93332f09-7bdc-4297-8cd9-e7b2a2f09a04&quot;,&quot;title&quot;:&quot;UserAuth.updateUserAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:428,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            apiURL = apiURL.replace(\&quot;:uid\&quot;, uid);\n            saveUserAuthEntries({\n                authtoken: authToken\n            }, function(error, userAuthEntries) {\n                _userAuthEntries = userAuthEntries;\n                done();\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1fec24bf-1088-48c0-adbe-26db7aad17c6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fb566af-732a-4bee-abe7-f01988ce2931&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98a40387-dd84-4da1-ac2a-e1be2472ecd0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update user auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should update user auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\ntempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;09038cc0-cf2a-4615-aaa3-6f632e58dac0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update user auth within organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should update user auth within organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4341,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = orgBody;\nvar userAuth = {\n    \&quot;category\&quot;: \&quot;google\&quot;,\n    \&quot;name\&quot;: \&quot;utest_cases_org\&quot;,\n    \&quot;data\&quot;: {\n        \&quot;code\&quot;: \&quot;o2t:a0738c29-7775-4cbf-88df-d2718b7cbb7d\&quot;,\n        \&quot;keys\&quot;: [\n            \&quot;access_token\&quot;\n        ]\n    },\n    \&quot;description\&quot;: \&quot;google_drive login\&quot;,\n    \&quot;type\&quot;: \&quot;google_drive\&quot;,\n    \&quot;icon\&quot;: \&quot;google-drive\&quot;\n};\nasync.waterfall([\n    function(cbk) {\n        createOrgPlans(function() {\n            api.post(&#x27;/enterprise/v1/organizations&#x27;)\n                .send(tempOrgBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var org = res.body.output;\n                        _models.User.findOne({\n                            uid: res.body.output.user_uid\n                        }).lean().exec(function(err, user) {\n                            cbk(err, org)\n                        });\n                    }\n                });\n        });\n    },\n    function(org, cbk) {\n        api.post(&#x27;/enterprise/v1/user/auths&#x27;)\n            .send(userAuth)\n            .set({ authtoken: authToken, org_uid: org.uid })\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            });\n    },\n    function(res, org, cbk) {\n        var tempUserAuthyBody = res.body.output\n        tempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\n        paramURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\n        api.put(paramURL)\n            .send(tempUserAuthyBody)\n            .set({ authtoken: authToken, org_uid: org.uid })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            });\n    }\n], function(err, res, org) {\n    if (err) {\n        done(err);\n    } else {\n        var userAuth = res.body.output\n        var isValid = userAuth.uid != \&quot;\&quot; &amp;&amp;\n            typeof(userAuth._id) == \&quot;undefined\&quot; &amp;&amp;\n            typeof(userAuth.__v) == \&quot;undefined\&quot;;\n        isValid.should.equal(true);\n        expect(userAuth).to.have.any.keys([&#x27;uid&#x27;, &#x27;org_uid&#x27;, &#x27;env_uid&#x27;, &#x27;project_uid&#x27;]);\n        expect(userAuth.org_uid).equal(org.uid);\n        expect(userAuth.user).equal(org.org_account.uid);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba13180e-8a8a-44b7-bc8c-585936dbb5d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as auth name is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should give error as auth name is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\ndelete tempUserAuthyBody.name;\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.name.message.should.equal(messageList.USER_AUTH_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4dfb8779-35fd-4a40-af57-2bda421a1bea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if user auth not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should give error, if user auth not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, \&quot;dummyAuth\&quot;);\ntempUserAuthyBody.uid = \&quot;dummyAuth\&quot;\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_AUTH_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e44e31af-998e-4e0d-b3db-b7f7cfa158d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as auth data is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should give error as auth data is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\ndelete tempUserAuthyBody.data;\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.data.message.should.equal(messageList.USER_AUTH_DATA_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3bb6e5a-f307-4171-a2c6-30067e8076ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if user auth not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should give error, if user auth not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, \&quot;dummyAuth\&quot;);\ntempUserAuthyBody.uid = \&quot;dummyAuth\&quot;\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_AUTH_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9691c7d0-49b9-4b5b-b7fd-a10ebda938d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\ntempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46bcb69a-0ef5-4f60-b2e5-264d61076896&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;09038cc0-cf2a-4615-aaa3-6f632e58dac0&quot;,&quot;ba13180e-8a8a-44b7-bc8c-585936dbb5d6&quot;,&quot;4dfb8779-35fd-4a40-af57-2bda421a1bea&quot;,&quot;e44e31af-998e-4e0d-b3db-b7f7cfa158d7&quot;,&quot;e3bb6e5a-f307-4171-a2c6-30067e8076ee&quot;,&quot;9691c7d0-49b9-4b5b-b7fd-a10ebda938d5&quot;,&quot;46bcb69a-0ef5-4f60-b2e5-264d61076896&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4558,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f2c0c967-c7da-4dbd-869c-226729c6cf19&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;917a8ed9-dda2-4218-94a0-8a043f602454&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d33a8949-3fa5-437e-b5fe-057f24cfac1f&quot;,&quot;title&quot;:&quot;UserAuth.updateUserAuthName&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1899,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                saveUserAuthEntries({\n                    authtoken: res.body.output.authtoken\n                }, function(error, userAuthEntries) {\n                    _userAuthEntries0 = userAuthEntries;\n                    var tempRegistrationBody = global.getImmutable(registrationBody);\n                    tempRegistrationBody.email = \&quot;test.user+101@raweng.com\&quot;;\n                    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                    api.post(\&quot;/enterprise/v1/signup\&quot;)\n                        .send(tempRegistrationBody)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                authToken = res.body.output.authtoken;\n                                _id = res.body.output._id;\n\n                                saveUserAuthEntries({\n                                    authtoken: authToken\n                                }, function(error, userAuthEntries) {\n                                    _userAuthEntries1 = userAuthEntries;\n                                    done();\n                                });\n                            }\n                        });\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4bc65aea-7d2a-474a-af2e-a0e150147994&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;22b2827d-243b-4656-b22b-5fcaa816d15d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79cdc868-21a5-4aaf-a732-9319da2fa908&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update user auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName Should update user auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries1[0].body.output);\ntempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\nvar paramApiURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramApiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.name.should.equal(\&quot;utest_cases_MODIFIED\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2499929a-6203-4276-8e80-34fc205f9f5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as authname is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName Should give error as authname is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries0[0].body.output);\ntempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\nvar paramApiURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramApiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_AUTH_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c23b72c8-6f9a-450b-bb7f-eb65fb7c47d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as authname is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName Should give error as authname is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries1[0].body.output);\ndelete tempUserAuthyBody.name;\nvar paramApiURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramApiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.name.message.should.equal(messageList.USER_AUTH_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;577fd186-3eb0-4f1f-9c06-83970ffca3d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries1[0].body.output);\ntempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\nvar paramApiURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramApiURL)\n    .send(tempUserAuthyBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9fc7a69-da61-42dc-93ad-a831e2b1cc41&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2499929a-6203-4276-8e80-34fc205f9f5a&quot;,&quot;c23b72c8-6f9a-450b-bb7f-eb65fb7c47d5&quot;,&quot;577fd186-3eb0-4f1f-9c06-83970ffca3d5&quot;,&quot;a9fc7a69-da61-42dc-93ad-a831e2b1cc41&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:177,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;04f86242-12b4-43f1-9a4c-cd9c90fcb829&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userConfig\\getConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\getConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;72f48ecf-67f5-4342-bedf-858fcf3afab7&quot;,&quot;title&quot;:&quot;UserConfig.GetConfigData&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userConfig\\getConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\getConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.GetConfigData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:317,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                _id = dummyUser._id\n                flowData.trigger.handlers = [userTriggerObj]\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                var query = _models.ConfigData.find({ flow_uid: userFlow.uid })\n                query.lean().exec(function(err, results) {\n                    if (err) {\n                        done(err)\n                    } else {\n                        configData = results\n                        done()\n                    }\n                })\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3079682-4515-4485-ae5e-eb766ebd64fb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.GetConfigData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.ConfigData.remove({ uid: { $in: _.map(configData, &#x27;uid&#x27;) } }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7311e280-23de-4727-9bcb-58a7961857f8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.GetConfigData Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndata.active_config = &#x27;default&#x27;\nvar triggerConfigData = _.find(configData, { activity_id: &#x27;start&#x27; })\napi.get(apiURL + dummyUser.default_config + &#x27;/configdata&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c6784942-c17f-4896-9c63-333a0b846682&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user config uid is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.GetConfigData Should get error, if user config uid is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;dummyUser.default_config/configdata&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_CONFIG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;26bc1b5f-06cc-45d6-8612-884e286b3b25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get config data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.GetConfigData Should get config data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + dummyUser.default_config + &#x27;/configdata&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).to.be.above(1);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12fdf37b-a6ed-4de4-8a49-068beaf59c6b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c6784942-c17f-4896-9c63-333a0b846682&quot;,&quot;26bc1b5f-06cc-45d6-8612-884e286b3b25&quot;,&quot;12fdf37b-a6ed-4de4-8a49-068beaf59c6b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:111,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;96c3755a-39f3-42ac-9dd7-a95ee6b35c41&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userConfig\\getUsage.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\getUsage.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f08e9db9-2d8f-49b9-b040-9bd508af70f0&quot;,&quot;title&quot;:&quot;ConfigData.getUsage&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userConfig\\getUsage.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\getUsage.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:363,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        dummyUser = res.body.output;\n        var opt = { path: getTriggerPath, body: getTriggerPath };\n        commonMock.triggerGetSuccess(opt);\n        opt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\n        opt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\n        commonMock.triggerPullSuccess(opt);\n        opt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\n        commonMock.triggerPushSuccess(opt);\n\n        api.post(&#x27;/enterprise/v1/flows&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowWithAllData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userConfig = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21b64da8-101d-4e46-8cb3-9064fe3826ff&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.ConfigData.remove({ user_uid: dummyUser.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f530422e-2573-4540-b80b-f4c416a05bca&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77c48b9b-53d8-455d-99fe-00efa5d65e05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of auth usage, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should get list of auth usage, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?auth=fl05b96ad7388b364a4d1f7c&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;activities&#x27;, &#x27;name&#x27;, &#x27;uid&#x27;, &#x27;flow_version&#x27;]);;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54d92f0e-b61b-4929-bf28-542dbe41ee2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of trigger usage, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should get list of trigger usage, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:213,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\n\napi.put(&#x27;/enterprise/v1/flows/&#x27; + userConfig.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(flowWithAllData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        //cbk(err, res)\n        api.get(apiURL + &#x27;?trigger=tgb00434df13b4b8564796af&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(_.first(res.body.output)).to.have.any.keys([&#x27;name&#x27;, &#x27;uid&#x27;, &#x27;flow_version&#x27;]);;\n                    done();\n                }\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c91b1e1-4dc7-4833-9421-2340e520521b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of connection usage, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should get list of connection usage, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?connection=fl3ade9788e74f0554ec1852&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;activities&#x27;, &#x27;name&#x27;, &#x27;uid&#x27;, &#x27;flow_version&#x27;]);;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a29bf39-d5fe-415b-b466-bcce71c4f67e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of agent usage, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should get list of agent usage, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?agent=ega6fdbacca405caf12f0c15f&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;activities&#x27;, &#x27;name&#x27;, &#x27;uid&#x27;, &#x27;flow_version&#x27;]);;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66f200c2-159f-4a09-a020-bb40c24a5ecc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of agent usage, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should get list of agent usage, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?param=random&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;activities&#x27;, &#x27;name&#x27;, &#x27;uid&#x27;, &#x27;flow_version&#x27;]);;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b3e9c1d2-998e-4603-98d7-e51b218c4e5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;77c48b9b-53d8-455d-99fe-00efa5d65e05&quot;,&quot;54d92f0e-b61b-4929-bf28-542dbe41ee2a&quot;,&quot;0c91b1e1-4dc7-4833-9421-2340e520521b&quot;,&quot;0a29bf39-d5fe-415b-b466-bcce71c4f67e&quot;,&quot;66f200c2-159f-4a09-a020-bb40c24a5ecc&quot;,&quot;b3e9c1d2-998e-4603-98d7-e51b218c4e5a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:451,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;756b4447-aeaf-453e-959b-3fc4659a0d78&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userConfig\\listConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\listConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;85e7e836-1f05-4cf4-8f08-e1391c277401&quot;,&quot;title&quot;:&quot;ConfigData.List&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userConfig\\listConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\listConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.List \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:389,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        dummyUser = res.body.output;\n        api.post(&#x27;/enterprise/v1/flows&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.flowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userConfig = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0e8e00b-7b1f-4920-b2f2-58688fed16f9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.List \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.ConfigData.remove({ user_uid: dummyUser.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;394f1f0a-f29b-49c2-aae8-ff4a4239a3ca&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.List Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3112fcaa-d70e-4366-acbe-b9eb181dfcf1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user configs, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.List Should get list of user configs, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.array;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a49ca0d-49ed-470b-9182-2196ab07526d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3112fcaa-d70e-4366-acbe-b9eb181dfcf1&quot;,&quot;5a49ca0d-49ed-470b-9182-2196ab07526d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:77,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ada5e0db-34e1-4074-97e9-a7d21d700faf&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userConfig\\listConfigSchema.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\listConfigSchema.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4db21401-d1a5-4ffe-8e3b-19ba78a6644d&quot;,&quot;title&quot;:&quot;ConfigSchema.List&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userConfig\\listConfigSchema.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\listConfigSchema.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigSchema.List \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:418,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        dummyUser = res.body.output;\n        api.post(&#x27;/enterprise/v1/flows&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.flowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userConfig = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b1e98d5-4be5-4437-8d45-6922c874c4a9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigSchema.List \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.ConfigSchema.remove({ uid: dummyUser.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a812230e-c721-4a60-b146-da1fa7734e9c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigSchema.List Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e90fe21a-1c06-489f-95e9-58a36b930c25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user configs, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigSchema.List Should get list of user configs, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.array;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9199dc30-19bd-4af5-b356-f584f2fbac0e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e90fe21a-1c06-489f-95e9-58a36b930c25&quot;,&quot;9199dc30-19bd-4af5-b356-f584f2fbac0e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:98,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e1a29878-79a2-4b8f-9b72-34a7481cfd24&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userConfig\\updateConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\updateConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d8927195-8816-45a0-a484-a133617a8e97&quot;,&quot;title&quot;:&quot;UserConfig.UpdateConfigData&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userConfig\\updateConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\updateConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:348,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                _id = dummyUser._id\n                flowData.trigger.handlers = [userTriggerObj]\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                var query = _models.ConfigData.find({ flow_uid: userFlow.uid })\n                query.lean().exec(function(err, results) {\n                    if (err) {\n                        done(err)\n                    } else {\n                        configData = results\n                        done()\n                    }\n                })\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ccf1c8b-a787-4ea7-9335-dbed4a990163&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.ConfigData.remove({ uid: { $in: _.map(configData, &#x27;uid&#x27;) } }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8d7ea6c-a01b-4601-807b-e9c0203e7cbc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndata.active_config = &#x27;default&#x27;\nvar triggerConfigData = _.find(configData, { activity_id: &#x27;start&#x27; })\napi.put(apiURL + triggerConfigData.uid)\n    .send(data)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fed03e60-becb-4305-b097-3a4a841c0254&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user config uid is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should get error, if user config uid is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndata.config_uid = &#x27;dummyConfig&#x27;\napi.put(apiURL + configData.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_CONFIG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f4e6ef1-b631-4d6e-a1d0-d30b2ee19f1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if same record already present.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should get error, if same record already present.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar authConfigData = _.find(configData, { activity_id: &#x27;a0&#x27; })\nvar connConfigData = _.find(configData, { activity_id: &#x27;a1&#x27; })\napi.put(apiURL + authConfigData.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connConfigData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.RECORD_ALREADY_PRESENT);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39792873-e36f-42bd-8fc3-85dfb51e7804&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update config data and update flow for auth remove.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should update config data and update flow for auth remove.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nvar authConfigData = _.find(configData, { activity_id: &#x27;a0&#x27; })\ndelete authConfigData.auth\n    //authConfigData.auth = &#x27;dummyAuth&#x27;\napi.put(apiURL + authConfigData.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(authConfigData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flowConfigData = res.body.output\n            expect(flowConfigData.auth).to.be.equal(undefined);\n            var query = _models.newFlow.findOne({ uid: flowConfigData.flow_uid })\n            query.lean().exec(function(err, flow) {\n                if (err) {\n                    done(err)\n                } else {\n                    expect(flow.is_draft).to.be.equal(true);\n                    expect(flow.trigger.handlers.length).to.be.equal(1);\n                    var error = _.filter(flow.errors_obj, { id: &#x27;a0-token&#x27; })\n                    expect(error.length).to.be.gte(1);\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5b439bb3-be23-4b7e-a0a1-b2869ce4299e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update config data and update flow for connection remove.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should update config data and update flow for connection remove.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nvar connConfigData = _.find(configData, { activity_id: &#x27;a1&#x27; })\ndelete connConfigData.connection\napi.put(apiURL + connConfigData.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connConfigData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flowConfigData = res.body.output\n            expect(flowConfigData.connection).to.be.equal(undefined);\n            var query = _models.newFlow.findOne({ uid: flowConfigData.flow_uid })\n            query.lean().exec(function(err, flow) {\n                if (err) {\n                    done(err)\n                } else {\n                    expect(flow.is_draft).to.be.equal(true);\n                    var error = _.filter(flow.errors_obj, { id: &#x27;a1-connection&#x27; })\n                    expect(error.length).to.be.gte(1);\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;222f2aec-829c-4c0b-ad16-82e399efca33&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update config data and update flow for agent remove.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should update config data and update flow for agent remove.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nvar agentConfigData = _.find(configData, { activity_id: &#x27;a2&#x27; })\ndelete agentConfigData.agent\napi.put(apiURL + agentConfigData.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(agentConfigData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flowConfigData = res.body.output\n            expect(flowConfigData.agent).to.be.equal(undefined);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7c73784-be87-4ceb-9617-cf9adbac8431&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if config data uid is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should get error, if config data uid is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connConfigData = _.find(configData, { activity_id: &#x27;a1&#x27; })\nconnConfigData.flow_uid = &#x27;abc&#x27;\napi.put(apiURL + &#x27;dummyConfigData&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connConfigData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.RECORD_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;664d0a9c-c1cd-4af2-aa19-bc22bc3fc2f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fed03e60-becb-4305-b097-3a4a841c0254&quot;,&quot;9f4e6ef1-b631-4d6e-a1d0-d30b2ee19f1b&quot;,&quot;39792873-e36f-42bd-8fc3-85dfb51e7804&quot;,&quot;5b439bb3-be23-4b7e-a0a1-b2869ce4299e&quot;,&quot;222f2aec-829c-4c0b-ad16-82e399efca33&quot;,&quot;a7c73784-be87-4ceb-9617-cf9adbac8431&quot;,&quot;664d0a9c-c1cd-4af2-aa19-bc22bc3fc2f1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:429,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;52ae25eb-d683-4416-b3f0-c9e715c2ef24&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;aa3e000c-50aa-45e3-ab6b-4189688b1cd3&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7642c86a-b9c2-4266-bbcc-e947b49ceaaf&quot;,&quot;title&quot;:&quot;UserLogs.downloadLogsBasedOnBillUid&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUid \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3563,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                fillEntries(res.body.output.uid, res.body.output.authtoken, function(error, result) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        var tempImmutableSignupObject = getImmutable(registrationBody);\n                        tempImmutableSignupObject.email = \&quot;test.user+101@raweng.com\&quot;;\n                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                            email: tempImmutableSignupObject.email\n                        });\n                        api.post(\&quot;/enterprise/v1/signup\&quot;)\n                            .send(tempImmutableSignupObject)\n                            .expect(httpStatus.CREATED)\n                            .end(function(error, res) {\n                                if (error) {\n                                    done(error);\n                                } else {\n                                    authToken = res.body.output.authtoken;\n                                    user_uid = res.body.output.uid;\n                                    fillEntries(res.body.output.uid, res.body.output.authtoken, function(error, result) {\n                                        if (error) {\n                                            done(error);\n                                        } else {\n                                            done();\n                                        }\n                                    });\n                                }\n                            });\n                    }\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0ec38f7-a086-4b69-99da-7381c356aeab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUid \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b273d5c2-dca7-452c-b283-62129675f4a0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bill logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUid Should get list of bill logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?authtoken=\&quot; + authToken;\napi.get(paramURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f62569b5-87b8-4f4c-b473-629ae0295dfe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUid Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce61f778-2bf2-4c5f-a194-a7edcfc31b40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f62569b5-87b8-4f4c-b473-629ae0295dfe&quot;,&quot;ce61f778-2bf2-4c5f-a194-a7edcfc31b40&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:77,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b18a8aee-8a40-4810-8d2d-0a394b9cd4ea&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1715eede-f1cc-48d0-934f-0115ea9aeee0&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0983798a-1205-49be-b21b-e354358c1fe3&quot;,&quot;title&quot;:&quot;UserLogs.downloadLogsBasedOnBillUidOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUidOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1795,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/projects\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                project_uid = _.first(res.body.output.projects).uid\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        fillEntries(user_uid, authToken, function(error, result) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                done();\n                            }\n                        });\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d776b92-c692-4883-81f3-dcab191606c0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUidOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3c3a0c82-1a12-4eed-bd5a-9aaaf25a2672&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bill logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUidOrg Should get list of bill logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?authtoken=\&quot; + authToken;\napi.get(paramURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .set(\&quot;project_uid\&quot;, project_uid)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;08663b2d-96f0-4be2-940e-2f38ad69b5fa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUidOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .set(\&quot;project_uid\&quot;, project_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8f4b80a-aeca-4d02-b372-4ec38170aa47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;08663b2d-96f0-4be2-940e-2f38ad69b5fa&quot;,&quot;d8f4b80a-aeca-4d02-b372-4ec38170aa47&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:70,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4859c6a0-1bf2-47d9-9b48-043d31930654&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6a0a9455-6f42-46d4-ac14-04fa7998d40f&quot;,&quot;title&quot;:&quot;logs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;922e3b22-e678-42ad-9bbc-70a7a7fcac0b&quot;,&quot;title&quot;:&quot;UserLogs.getDebugMessage&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessage \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:566,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nclearRecords(function() {\n    _models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            _models.Log.remove({ flow_name: new RegExp(&#x27;^utest_cases_&#x27;, \&quot;i\&quot;) }, function(error, user) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(registrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            authToken = res.body.output.authtoken;\n                            api.get(\&quot;/enterprise/v1/user\&quot;)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    user_uid = res.body.output.uid;\n                                    env_uid = res.body.output.env_uid;\n                                    saveUserLogs({\n                                            authtoken: authToken,\n                                            user_uid: user_uid\n                                        },\n                                        function(error, userLogs) {\n                                            _userLogs = userLogs;\n                                            done();\n                                        });\n                                });\n                        }\n                    });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e74c66b-f053-4bef-ac06-954737fd2e52&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessage \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Log.remove({ flow_name: new RegExp(&#x27;^utest_cases_&#x27;, \&quot;i\&quot;) }, function(error, user) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d49f5c3-b864-40e7-8697-a89b458c4ad5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessage Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar log_uid = _userLogs[0].body.output.uid;\nvar paramURL = apiURL.replace(\&quot;:log_uid\&quot;, log_uid);\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(log_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da280e16-4deb-49a5-9e42-944cd051b11e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessage Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;beee595e-601f-44de-93a4-faeed49947f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;da280e16-4deb-49a5-9e42-944cd051b11e&quot;,&quot;beee595e-601f-44de-93a4-faeed49947f1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:57,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;92982e1e-0e0a-4a01-87a7-e708b5dcdeba&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4a31141d-73b7-4003-b1d9-a43d069d843e&quot;,&quot;title&quot;:&quot;logs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;42d9e968-2787-44ad-a536-b1cc197bc486&quot;,&quot;title&quot;:&quot;UserLogs.getDebugMessageOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessageOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:710,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/projects\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                project_uid = _.first(res.body.output.projects).uid\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        saveUserLogs({\n                                authtoken: authToken,\n                                user_uid: user_uid\n                            },\n                            function(error, userLogs) {\n                                _userLogs = userLogs;\n                                done();\n                            });\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;793f760b-7275-4190-9618-ed9a3c38de18&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessageOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df2732a3-a3f9-46ad-9a35-9677940fb10b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessageOrg Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar log_uid = _userLogs[0].body.output.uid;\nvar paramURL = apiURL.replace(\&quot;:log_uid\&quot;, log_uid);\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(log_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72378985-c47a-4356-9efd-3e71d5b2833a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessageOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5bec2770-89eb-4e2a-b392-495537079baa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;72378985-c47a-4356-9efd-3e71d5b2833a&quot;,&quot;5bec2770-89eb-4e2a-b392-495537079baa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:55,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;71a0a794-1969-4e69-b59f-dea049fed921&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;72725774-4ed2-48c2-97ab-ff7173f20cd2&quot;,&quot;title&quot;:&quot;logs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;23495d6b-a569-4430-a84c-8fba41bc0f6a&quot;,&quot;title&quot;:&quot;UserLogs.getLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:431,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                saveUserLogs({\n                        authtoken: authToken,\n                        user_uid: user_uid\n                    },\n                    function(error, userLogs) {\n                        savedUserLogs = userLogs;\n                        done();\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9e45922-9001-47a8-9f04-dc42b5ea161e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f65972e1-1e31-4837-abe8-b7129b65b1cf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11e7d3df-e147-4475-8939-26f3171a617b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should get limited list of user logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar skipLimitURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(skipLimitURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.count == 5) {\n                isValid = Array.isArray(res.body.output.objects) &amp;&amp;\n                    res.body.output.objects.length == 2;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9609b82d-134d-4c5c-885e-abb72da6305f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f21c220-ddee-4608-b397-7541b0c18ddb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;11e7d3df-e147-4475-8939-26f3171a617b&quot;,&quot;9609b82d-134d-4c5c-885e-abb72da6305f&quot;,&quot;2f21c220-ddee-4608-b397-7541b0c18ddb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:105,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;96699b6e-6758-477c-b7b9-55e5a5ce06ed&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c16ed803-53bd-461b-a1d4-3991c3df62ac&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0f6a1388-7702-4b09-86ac-068fd6343002&quot;,&quot;title&quot;:&quot;UserLogs.getLogsBasedOnBillUid&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1681,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        user_uid = res.body.output.uid;\n                        env_uid = res.body.output.env_uid;\n                        fillEntries(res.body.output.uid, res.body.output.authtoken, function(error, result) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                done();\n                            }\n                        });\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77d99e57-3a4f-4604-b638-ffa32f7e0053&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ab03272-5f16-4c0b-ac4a-3a9a457f8e8e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bill logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get list of bill logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 10;\n                if (isValid) {\n                    _.each(res.body.output.objects, function(item) {\n                        isValid = isValid &amp;&amp;\n                            item.user_uid == user_uid &amp;&amp;\n                            typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(item.__v) == \&quot;undefined\&quot;;\n                    });\n                }\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f8b6e755-f692-4111-9a2a-5ca4ebefede8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get limited list of bill logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec19a5de-4775-41c4-9f5a-2196607367f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill logs based on skip/limit in descending order of message.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get limited list of bill logs based on skip/limit in descending order of message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?skip=2&amp;limit=2&amp;field=message&amp;direction=asc\&quot;;\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6c4c33b-b2c7-4a8d-a499-cbbced21d7f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of bill old logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get list of bill old logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                //isValid = res.body.output.objects.length == 10;\n                isValid = true; //res.body.output.objects.length == 10;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a1d706fa-dff9-462e-b0ef-e04115221506&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill old logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get limited list of bill old logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, firstBillUid) + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                /*\n                isValid = res.body.output.objects[0].uid == _oldLogEntries[7].body.output.uid &amp;&amp;\n                    res.body.output.objects[1].uid == _oldLogEntries[6].body.output.uid;\n                */\n                isValid = true; //res.body.output.objects.length == 2;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d353357-2450-4c12-9eae-a155649154d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill old logs based on skip/limit in descending order of message.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get limited list of bill old logs based on skip/limit in descending order of message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, firstBillUid) + \&quot;?skip=2&amp;limit=2&amp;field=message&amp;direction=asc\&quot;;\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = true; //res.body.output.objects.length == 2;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56405bfc-0ba7-4865-b117-64cd48708e95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7509f41c-f6d1-414d-8124-4bc7518e4a18&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f8b6e755-f692-4111-9a2a-5ca4ebefede8&quot;,&quot;ec19a5de-4775-41c4-9f5a-2196607367f2&quot;,&quot;a6c4c33b-b2c7-4a8d-a499-cbbced21d7f8&quot;,&quot;a1d706fa-dff9-462e-b0ef-e04115221506&quot;,&quot;6d353357-2450-4c12-9eae-a155649154d2&quot;,&quot;56405bfc-0ba7-4865-b117-64cd48708e95&quot;,&quot;7509f41c-f6d1-414d-8124-4bc7518e4a18&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:318,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e9aded90-b288-45da-815a-2672c57fb9d8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f4cb8806-3470-47a8-abbc-7422de457ec2&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a6eac72b-9854-4db1-acb3-55765d30193b&quot;,&quot;title&quot;:&quot;UserLogs.getLogsBasedOnBillUidOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1843,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/projects\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                project_uid = _.first(res.body.output.projects).uid\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        fillEntries(user_uid, authToken, function(error, result) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                done();\n                            }\n                        });\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd52ae76-a902-4ebd-8be3-8620e590a47c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b30f696-0482-4d82-96a7-5b142dc7b859&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bill logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get list of bill logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 10;\n                if (isValid) {\n                    _.each(res.body.output.objects, function(item) {\n                        isValid = isValid &amp;&amp;\n                            item.user_uid == org_account_uid &amp;&amp;\n                            typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(item.__v) == \&quot;undefined\&quot;;\n                    });\n                }\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2ac53e83-8d2f-4358-8f68-709ea35e60cc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get limited list of bill logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed83c7da-65a4-4115-9604-58dfeb60a1b2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill logs based on skip/limit in descending order of message.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get limited list of bill logs based on skip/limit in descending order of message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?skip=2&amp;limit=2&amp;field=message&amp;direction=asc\&quot;;\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0d2f06ac-c828-4a7d-8780-96aebcdb288e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of bill old logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get list of bill old logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, firstBillUid);\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                //isValid = res.body.output.objects.length == 10;\n                isValid = res.body.output.objects.length == 10;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;af3c8bcc-7455-43a8-a885-7576e88504c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill old logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get limited list of bill old logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, firstBillUid) + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                /*\n                isValid = res.body.output.objects[0].uid == _oldLogEntries[7].body.output.uid &amp;&amp;\n                    res.body.output.objects[1].uid == _oldLogEntries[6].body.output.uid;\n                */\n                isValid = res.body.output.objects.length == 2;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1813653a-1d0b-49a4-b4dc-c56e6257ac29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill old logs based on skip/limit in descending order of message.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get limited list of bill old logs based on skip/limit in descending order of message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, firstBillUid) + \&quot;?skip=2&amp;limit=2&amp;field=message&amp;direction=asc\&quot;;\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                /*\n                isValid = res.body.output.objects[0].uid == _oldLogEntries[2].body.output.uid &amp;&amp;\n                    res.body.output.objects[1].uid == _oldLogEntries[3].body.output.uid;\n                */\n                isValid = res.body.output.objects.length == 2;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;823f81a2-93dc-4ab1-9987-667b4159808c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc196f30-6813-43db-89a5-53cd01905c15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2ac53e83-8d2f-4358-8f68-709ea35e60cc&quot;,&quot;ed83c7da-65a4-4115-9604-58dfeb60a1b2&quot;,&quot;0d2f06ac-c828-4a7d-8780-96aebcdb288e&quot;,&quot;af3c8bcc-7455-43a8-a885-7576e88504c2&quot;,&quot;1813653a-1d0b-49a4-b4dc-c56e6257ac29&quot;,&quot;823f81a2-93dc-4ab1-9987-667b4159808c&quot;,&quot;cc196f30-6813-43db-89a5-53cd01905c15&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:327,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1fe673aa-5b31-48a4-a4df-6b2d92259496&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8ab6f389-f9e7-4e69-bed5-1827e8917917&quot;,&quot;title&quot;:&quot;logs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;609cbda5-8f66-4e80-954e-1f2d6e89c19a&quot;,&quot;title&quot;:&quot;UserLogs.getLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:485,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/projects\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                project_uid = _.first(res.body.output.projects).uid\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        saveUserLogs({\n                                authtoken: authToken,\n                                user_uid: user_uid\n                            },\n                            function(error, userLogs) {\n                                savedUserLogs = userLogs;\n                                done();\n                            });\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a29b136-3d32-46f5-a1b2-df99bb30edb9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cab6fd90-6c5f-4b72-8f77-972419ba5553&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7cac76f1-81b3-48ef-af2a-ff9f79c8fe90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should get limited list of user logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar skipLimitURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(skipLimitURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97053d14-e3c7-4076-b67b-78b73db2d84f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98dbc0cb-21c5-4133-9774-71c2fa186cd6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7cac76f1-81b3-48ef-af2a-ff9f79c8fe90&quot;,&quot;97053d14-e3c7-4076-b67b-78b73db2d84f&quot;,&quot;98dbc0cb-21c5-4133-9774-71c2fa186cd6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:116,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c79adb2e-4f76-4bcc-884f-62eaa90b184b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f8068c04-5400-40a3-a11e-f5fd70f56dd0&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4621ca30-dedc-466e-a063-d14420d3c1f3&quot;,&quot;title&quot;:&quot;User.activate&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c48cc8e-a92f-4ba1-88d4-8d48341d40c9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d277867a-7819-43a4-bf85-9272c3d06799&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should activate account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate Should activate account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        user_uid: uid,\n        token: token\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.USER_ACTIVATION_ACTIVATED_SUCCESSFULLY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d209e33-e0a4-446a-ad67-e8fc834884a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should activate account after activation_expired gets false.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate Should activate account after activation_expired gets false.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({\n    uid: uid\n}, {\n    activation_expired: true,\n    active: false\n}, function(error, result) {\n    api.post(apiURL)\n        .send({\n            user_uid: uid,\n            token: token\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                _models.User.findOne({\n                    uid: uid\n                }).lean().exec(function(error, user) {\n                    (user.activation_expired == false &amp;&amp; user.active).should.equal(true);\n                    done();\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a88c0686-09d4-4f75-a07d-50146e48bc3c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should activate account, when user is lock.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate Should activate account, when user is lock.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n    failed_login_count: 7\n}, { new: true }, function(err, user) {\n    api.post(\&quot;/enterprise/v1/user/activate\&quot;)\n        .send({\n            user_uid: uid,\n            token: token\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.USER_ACTIVATION_ACTIVATED_SUCCESSFULLY);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5442bbd6-a5db-4212-99ad-d3ae9352cb52&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to raised forgot password request, for 5 times invalid login attempt user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate Should allowed to raised forgot password request, for 5 times invalid login attempt user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\nvar loginCount = [];\n_models.User.findOneAndUpdate({\n    uid: uid\n}, {\n    failed_login_count: 5\n}, { new: true }, function(error, result) {\n    if (error) {\n        done(error);\n    } else {\n        api.post(\&quot;/enterprise/v1/user/activate\&quot;)\n            .send({\n                user_uid: uid,\n                token: token\n            })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.message.should.equal(messageList.USER_ACTIVATION_ACTIVATED_SUCCESSFULLY);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2cb75150-f976-4f1c-a5a5-03369d69db9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as email not register.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate Should give error as email not register.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        user_uid: uid,\n        token: \&quot;FAKE_CODE\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_ACTIVATION_INCORRECT_CODE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3582526-55d7-404c-b0f1-f77cd22d8078&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2d209e33-e0a4-446a-ad67-e8fc834884a2&quot;,&quot;a88c0686-09d4-4f75-a07d-50146e48bc3c&quot;,&quot;5442bbd6-a5db-4212-99ad-d3ae9352cb52&quot;,&quot;2cb75150-f976-4f1c-a5a5-03369d69db9b&quot;,&quot;a3582526-55d7-404c-b0f1-f77cd22d8078&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:75,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4e9f94cc-2dff-4a6e-ba63-1fec88c8cf93&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;be6b971e-9da8-4753-b776-880a7d1643eb&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;925c63cc-9e89-4a4b-853d-e5a758e21fd6&quot;,&quot;title&quot;:&quot;User.authyContact&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:258,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ deleted_at: null }, function(error, user) {\n    _models.Mail.remove({ deleted_at: null }, function(error, user) {\n        _models.Authy.remove({ deleted_at: null }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bdb2a62f-eaf6-43de-bff2-da81244a2cab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3db6eff2-9f6a-4341-a278-aa5407ed5a8f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get error, if user is unauthorised.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should get error, if user is unauthorised.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;)\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05c5c5df-d5da-4bd2-a82c-4374c9dcc89b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should register phone number with authy.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should register phone number with authy.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.authy_number == tempRegistrationBody.authy_number &amp;&amp;\n                res.body.output.enable_twofa == \&quot;enable\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d41f24e8-30a9-4c81-980c-0dd3ee52cfba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should get default plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                    //return (plan || {}).enterprise_plan || false;\n                    return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                })) || {};\n                defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e6fb8c5-788f-4596-be73-3e68cfbcb5a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should get default attributes.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                isValid = utils.isHaveKeyVals(res.body.output, [\n                        \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                        \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                    ]) &amp;&amp;\n                    res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                    moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                    moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9fbd2d5-3df7-4999-b59a-a131f147d4b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as authy number is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should give error as authy number is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\n//tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.authy_number.message == messageList.AUTHY_NUMBER_IS_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cde7d559-5a62-4f62-bc33-6a5ea30055cc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as authy country code is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should give error as authy country code is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n//tempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.country_code.message == messageList.AUTHY_COUNTRY_CODE_IS_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45dcbeae-bccb-4000-a844-e290efa6f506&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should de-register and then register same phone number with authy.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should de-register and then register same phone number with authy.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:179,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\n\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var oldAuthyUserID = res.body.output.authy_user_uid;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(apiURL)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid =\n                            res.body.output.authy_user_uid == oldAuthyUserID &amp;&amp;\n                            (res.body.output.authy_user_uid || \&quot;\&quot;) != \&quot;\&quot; &amp;&amp;\n                            (oldAuthyUserID || \&quot;\&quot;) != \&quot;\&quot; &amp;&amp;\n                            res.body.output.enable_twofa == \&quot;enable\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;26ebb1bf-2693-4c48-9dfa-836957ba656b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;05c5c5df-d5da-4bd2-a82c-4374c9dcc89b&quot;,&quot;d41f24e8-30a9-4c81-980c-0dd3ee52cfba&quot;,&quot;3e6fb8c5-788f-4596-be73-3e68cfbcb5a6&quot;,&quot;d9fbd2d5-3df7-4999-b59a-a131f147d4b8&quot;,&quot;cde7d559-5a62-4f62-bc33-6a5ea30055cc&quot;,&quot;45dcbeae-bccb-4000-a844-e290efa6f506&quot;,&quot;26ebb1bf-2693-4c48-9dfa-836957ba656b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:532,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;02c4743b-df48-440e-aa8e-305ac8ea9be8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c39a431d-f32e-47a5-bb1c-3c66d0b54bd4&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;04ed5714-5142-4cd6-8696-c4400ba27969&quot;,&quot;title&quot;:&quot;User.cancelTwoFA&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:248,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ deleted_at: null }, function(error, user) {\n    _models.Mail.remove({ deleted_at: null }, function(error, user) {\n        _models.Authy.remove({ deleted_at: null }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e71ab71-9403-497e-bbef-24ed6a094066&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bf0a2a52-b375-4001-b299-e1fc1309ceb3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should cancel twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should cancel twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:231,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid =\n                                                        res.body.output.enable_twofa == \&quot;disable\&quot; &amp;&amp;\n                                                        res.body.output.authy_user_uid == \&quot;\&quot; &amp;&amp;\n                                                        res.body.output.is_twofa_sms_enabled == false;\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9487e2c4-facc-4a22-8a8c-37f560864ca9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should cancel twofa if same email account exists in express.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should cancel twofa if same email account exists in express.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2978,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;);\napi.post(\&quot;/express/v1/login\&quot;)\n    .send({\n        email: registrationBody.email,\n        password: registrationBody.password\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid =\n                                                                    res.body.output.enable_twofa == \&quot;disable\&quot; &amp;&amp;\n                                                                    res.body.output.authy_user_uid == \&quot;\&quot; &amp;&amp;\n                                                                    res.body.output.is_twofa_sms_enabled == false;\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9aabf49-6769-4382-b61c-43bc0f663ca3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for cancel twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should get default plan for cancel twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:224,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = false;\n                                                    if (res.body.output.plan.length == 1) {\n                                                        var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                            //return (plan || {}).express_plan || false;\n                                                            return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                        })) || {};\n                                                        defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                        isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6ea01d2b-7daf-4bd1-823c-9add312fbd66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for cancel twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should get default attributes for cancel twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:225,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = false;\n                                                    if (res.body.output.plan.length == 1) {\n                                                        isValid = utils.isHaveKeyVals(res.body.output, [\n                                                                \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                                \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                            ]) &amp;&amp;\n                                                            res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                            moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                            moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de8392d0-5048-41f8-b72e-9e95a9037c27&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should cancel twofa for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should cancel twofa for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:377,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid =\n                                                                    res.body.output.enable_twofa == \&quot;disable\&quot; &amp;&amp;\n                                                                    res.body.output.authy_user_uid == \&quot;\&quot; &amp;&amp;\n                                                                    res.body.output.is_twofa_sms_enabled == false;\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;599d8b6c-cb94-4a2f-baa5-db5e59a28d6b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for cancel twofa with google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should get default plan for cancel twofa with google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:339,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid = false;\n                                                                if (res.body.output.plan.length == 1) {\n                                                                    var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                                        //return (plan || {}).express_plan || false;\n                                                                        return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                                    })) || {};\n                                                                    defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                                    isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                                }\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c684a6e-5845-475c-b46f-4e3b7a412e8b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for cancel twofa with google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should get default attributes for cancel twofa with google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:350,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid = false;\n                                                                if (res.body.output.plan.length == 1) {\n                                                                    isValid = utils.isHaveKeyVals(res.body.output, [\n                                                                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                                        ]) &amp;&amp;\n                                                                        res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                                }\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0622b7ec-04f8-448f-9fce-10598985bff6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f8e870a-5e37-460a-ac41-50685eab0b5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9487e2c4-facc-4a22-8a8c-37f560864ca9&quot;,&quot;c9aabf49-6769-4382-b61c-43bc0f663ca3&quot;,&quot;6ea01d2b-7daf-4bd1-823c-9add312fbd66&quot;,&quot;de8392d0-5048-41f8-b72e-9e95a9037c27&quot;,&quot;599d8b6c-cb94-4a2f-baa5-db5e59a28d6b&quot;,&quot;7c684a6e-5845-475c-b46f-4e3b7a412e8b&quot;,&quot;0622b7ec-04f8-448f-9fce-10598985bff6&quot;,&quot;0f8e870a-5e37-460a-ac41-50685eab0b5d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4733,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d300a7e8-d5ac-4376-ae6d-b1a2429b2f2e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;25389ce0-8adb-4eb4-bd41-5871ad964339&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;293604b8-2d0a-43d0-9d4a-98cbe87be990&quot;,&quot;title&quot;:&quot;User.changeFirstTime&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:244,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab80baea-f7ff-4191-92bd-326e2f18c0b4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;43bebe76-218a-41c0-bbb6-dfe7b9b69e03&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should set first time login false.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime Should set first time login false.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:99,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.first_login.should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e2f69cc-cc53-41c3-a6cc-39e4583546f6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organizations details for firsttime login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime Should get organizations details for firsttime login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:216,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        api.put(apiURL)\n            .set(&#x27;authtoken&#x27;, data.role1.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.organizations.length == 1;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;083b5dac-82a7-4fa8-83ff-b36ba017ad5f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set first time login false if user is expired.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime Should set first time login false if user is expired.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({\n    uid: uid\n}, {\n    activation_token: \&quot;fl554d45sfdsfdsf54554\&quot;,\n    activation_expired: true,\n    active: false,\n    created_at: new Date(2017, 00, 01),\n    subscription: {\n        \&quot;start_date\&quot;: new Date(2017, 00, 01),\n        \&quot;hasUnlimitedPlan\&quot;: false,\n        \&quot;days\&quot;: 30,\n        \&quot;expired\&quot;: false\n    }\n}, { new: true }, function(err, activity) {\n    if (err) {\n        done(err);\n    } else {\n        api.put(apiURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.first_login.should.equal(false);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04290acc-ce4b-424a-81b9-d9621e3833b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;264b1af0-4047-47da-a5a9-5ee0f90fe5b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4e2f69cc-cc53-41c3-a6cc-39e4583546f6&quot;,&quot;083b5dac-82a7-4fa8-83ff-b36ba017ad5f&quot;,&quot;04290acc-ce4b-424a-81b9-d9621e3833b0&quot;,&quot;264b1af0-4047-47da-a5a9-5ee0f90fe5b0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:390,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;28820a69-ed96-4bb4-bbb4-5d407b859359&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f08fcd87-5c04-4a2f-adb0-d8f9376da137&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;953a96b4-fe6b-4a04-be03-57821fed8f2e&quot;,&quot;title&quot;:&quot;User.changePassword&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:238,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18ea125e-520b-4d60-8830-5f90df63b8bb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77186fcb-5e5c-4d0b-a401-5c1a063f87a9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update new password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should update new password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:402,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;036be2e9-f25b-4d2f-87f2-84739ae2b9aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid password format.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give error as invalid password format.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.password.message.should.equal(messageList.USER_REG_INVALID_PASSWORD);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bbb570ed-04a6-4e23-941b-1d5d592ccd22&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as password is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give error as password is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\n//tempRegistrationBody.password = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.password.message.should.equal(messageList.USER_REG_INVALID_PASSWORD);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aaba01e9-d885-423c-add8-4f2c73619fdf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as confirm password is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give error as confirm password is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw@1235\&quot;;\n//tempRegistrationBody.password_confirmation = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.password_confirmation.message.should.equal(messageList.USER_PASS_NOT_MATCH_WITH_CONFIRM_PASS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c4d059c1-3e37-4dfb-9fde-465384bb23cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as old password is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give error as old password is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1235\&quot;;\n//tempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.oldpassword.message.should.equal(messageList.USER_CHANGE_PASSWARD_OLD_PASSWORD_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca9a7fa1-d69e-4cd4-be4e-48b77e1c029a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as password and confirm passwords are different.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give error as password and confirm passwords are different.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1236\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.password_confirmation.message.should.equal(messageList.USER_PASS_NOT_MATCH_WITH_CONFIRM_PASS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8fc8a8fe-17d3-42aa-acf4-eb0f0756e533&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1236\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0b0213a-bb26-44f1-9835-bce54c919847&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;036be2e9-f25b-4d2f-87f2-84739ae2b9aa&quot;,&quot;bbb570ed-04a6-4e23-941b-1d5d592ccd22&quot;,&quot;aaba01e9-d885-423c-add8-4f2c73619fdf&quot;,&quot;c4d059c1-3e37-4dfb-9fde-465384bb23cd&quot;,&quot;ca9a7fa1-d69e-4cd4-be4e-48b77e1c029a&quot;,&quot;8fc8a8fe-17d3-42aa-acf4-eb0f0756e533&quot;,&quot;b0b0213a-bb26-44f1-9835-bce54c919847&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:626,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;13260468-2386-480b-b610-25f6faf3df6c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bec24164-692a-47e4-8711-fe2e466012b9&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8c304620-2fcb-4808-b647-b9183100476e&quot;,&quot;title&quot;:&quot;User.checkMyEmail&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:232,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;965a9b86-3975-4e2d-b318-596efab0377b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c646f972-20a9-432f-8667-93a6b81a8812&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give false for block status after first fail login attempt.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail Should give false for block status after first fail login attempt.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL + \&quot;?email=test.user@raweng.com\&quot;;\napi.get(paramURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.block.should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;394b5f26-c190-4530-8531-1e3b98282656&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give true for show_captcha status for user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail Should give true for show_captcha status for user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:682,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send({\n                    \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                    \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                })\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send({\n                                \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                            })\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var paramURL = apiURL + \&quot;?email=test.user@raweng.com\&quot;;\n                                    api.get(paramURL)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.output.show_captcha.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18a00205-2634-46cf-8e0b-d69f2f751823&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give false for show_captcha status after two fail login attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail Should give false for show_captcha status after two fail login attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:438,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send({\n                    \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                    \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                })\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var paramURL = apiURL + \&quot;?email=test.user@raweng.com\&quot;;\n                        api.get(paramURL)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.show_captcha.should.equal(false);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c6a10f67-c688-4831-a5b3-1ea17320968b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give true block status for user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail Should give true block status for user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1325,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send({\n                    \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                    \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                })\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send({\n                                \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                            })\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n\n                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                        .send({\n                                            \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                            \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                                        })\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n\n                                                api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                    .send({\n                                                        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                                        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                                                    })\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                                .send({\n                                                                    \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                                                    \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                                                                })\n                                                                .expect(httpStatus.UNAUTHORIZED)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        var paramURL = apiURL + \&quot;?email=test.user@raweng.com\&quot;;\n                                                                        api.get(paramURL)\n                                                                            .expect(httpStatus.OK)\n                                                                            .end(function(err, res) {\n                                                                                if (err) {\n                                                                                    done(err);\n                                                                                } else {\n                                                                                    res.body.output.block.should.equal(true);\n                                                                                    done();\n                                                                                }\n                                                                            });\n\n\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b7e7d10f-cb6a-44c5-912e-d1a87b78486c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give false for block status after fifth fail login attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail Should give false for block status after fifth fail login attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1119,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send({\n                    \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                    \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                })\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send({\n                                \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                            })\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n\n                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                        .send({\n                                            \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                            \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                                        })\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n\n                                                api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                    .send({\n                                                        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                                        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                                                    })\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n\n                                                            var paramURL = apiURL + \&quot;?email=test.user@raweng.com\&quot;;\n                                                            api.get(paramURL)\n                                                                .expect(httpStatus.OK)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        res.body.output.block.should.equal(false);\n                                                                        done();\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e21f7617-f7d3-4606-94f5-0f3d2658afa7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;394b5f26-c190-4530-8531-1e3b98282656&quot;,&quot;18a00205-2634-46cf-8e0b-d69f2f751823&quot;,&quot;c6a10f67-c688-4831-a5b3-1ea17320968b&quot;,&quot;b7e7d10f-cb6a-44c5-912e-d1a87b78486c&quot;,&quot;e21f7617-f7d3-4606-94f5-0f3d2658afa7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3575,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0b205eee-4df4-4d0b-9d6d-e811ebba35f9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;402ba74e-4daa-4d40-8ed0-d31272cd178d&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;daae63b3-40a4-4ffd-88d3-b1191a87dc49&quot;,&quot;title&quot;:&quot;User.clearPendingUserStream&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.clearPendingUserStream \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2423,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                saveBillEntries({\n                    user_uid: user_uid,\n                    authtoken: authToken,\n                    email: res.body.output.email\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        saveUserStreamEntries({\n                            user_uid: user_uid,\n                            authtoken: authToken,\n                            email: res.body.output.email\n                        }, function(error, userStreamEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _userStreamEntries = userStreamEntries;\n                                done();\n                            }\n                        });\n                    }\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4fc76436-29ca-4c08-b336-dfaa63d1e07c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.clearPendingUserStream \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4db26030-dddc-4822-a854-5ba2cd4a8d39&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should clear pending stream of user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.clearPendingUserStream Should clear pending stream of user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        stream_ids: [userStreamIDs[0], userStreamIDs[1]]\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.UserStream.find({ user_uid: user_uid }, function(error, userStreams) {\n                var isValid01 = true,\n                    isValid02 = true;\n                _.each(userStreams, function(item) {\n                    if (item.uid == userStreamIDs[0] || item.uid == userStreamIDs[1]) {\n                        isValid01 = isValid01 &amp;&amp; item.pending_view == false;\n                    } else {\n                        isValid02 = isValid02 &amp;&amp; item.pending_view;\n                    }\n                });\n                (isValid01 &amp;&amp; isValid02).should.equal(true);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1244415a-aaa0-40e3-bfda-31447dfe5a80&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give ids required error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.clearPendingUserStream Should give ids required error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_STREAM_REQUIRED_IDS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3483d77f-8bef-488b-aca8-eedc5fb23956&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.clearPendingUserStream Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        stream_ids: [userStreamIDs[0], userStreamIDs[1]]\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5aa4b0ba-6d49-4d0d-9b40-0ff0e2f9ebcb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1244415a-aaa0-40e3-bfda-31447dfe5a80&quot;,&quot;3483d77f-8bef-488b-aca8-eedc5fb23956&quot;,&quot;5aa4b0ba-6d49-4d0d-9b40-0ff0e2f9ebcb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:115,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;813143e2-40c9-49dc-afcb-968ee4115f7f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8bf96ca0-3e79-4754-a1a8-22244917c033&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f406a337-3d7a-44af-bf1d-a7a4341c2230&quot;,&quot;title&quot;:&quot;User.Create&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;removeRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2db53162-42e9-474a-92e6-6272d5dc5db0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;removeRecords(function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75075c42-0473-4016-9a06-4bec38602758&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should return success output on pass of valid parameters.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return success output on pass of valid parameters.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:239,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.email == registrationBody.email &amp;&amp;\n                res.body.output.marketo_lead_id != \&quot;\&quot; &amp;&amp;\n                (res.body.output.authtoken || \&quot;\&quot;) != \&quot;\&quot; &amp;&amp;\n                res.body.output.flow_uid != \&quot;\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;498f003b-45c4-45b2-92c8-e8e7e9ec357c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode add signup.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should add promocode add signup.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:261,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;gmail.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    var tempRegistrationBody = getImmutable(registrationBody);\n    tempRegistrationBody.promo_code = promoCodes[0].promo_code;\n    api.post(apiURL)\n        .send(tempRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.subscription.days.should.equal(40);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20abeb31-08f3-41e3-9ac5-673607b42af9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode fatures with default plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should add promocode fatures with default plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:253,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Plan.findOne({ \&quot;uid\&quot;: \&quot;fl6f0c5a598b56e5e4e3fbf5\&quot; }, function(error, plan) {\n    var plan_id = null;\n    if (plan) {\n        plan_id = plan._id;\n    }\n    addPromcode({\n        count: 1,\n        promo_code: \&quot;PROMO_CODE\&quot;,\n        domain: \&quot;gmail.com\&quot;,\n        redemption_count: 1,\n        redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n        redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n        allowed_plans: [],\n        default_plan: plan_id,\n        addon_credits: 5,\n        addon_flows: 2,\n        addon_triggers: 2,\n        addon_trial_days: 10,\n        braintree_discount_id: \&quot;\&quot;,\n        promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n    }, function(error, promoCodes) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        var tempRegistrationBody = getImmutable(registrationBody);\n        tempRegistrationBody.promo_code = promoCodes[0].promo_code;\n        api.post(apiURL)\n            .send(tempRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var userNewFeatures = {};\n                    userNewFeatures.flow_count = res.body.output.user_plan.flow.count;\n                    userNewFeatures.flow_active = res.body.output.user_plan.flow.active;\n                    userNewFeatures.trigger_count = res.body.output.user_plan.trigger.count;\n                    userNewFeatures.days = (res.body.output.user_plan.reimburse || {}).period || 0;\n                    userNewFeatures.credits = (res.body.output.user_plan.reimburse || {}).credits || 0;\n                    (userNewFeatures.credits == 10005 &amp;&amp; userNewFeatures.days == 30 &amp;&amp;\n                        userNewFeatures.trigger_count == 12).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a4831b1c-99bf-4c66-8553-90ed23a87ba4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return success output for intercom error output.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return success output for intercom error output.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:236,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar service = \&quot;enterprise\&quot;;\nvar options = {\n};\ncommonMock.brainTreeCustomerCreate(httpmock, service, {\n    email: options.email,\n    access_token: options.access_token\n});\ncommonMock.brainTreeClientToken(httpmock, service, {\n    email: options.email,\n    access_token: options.access_token\n});\ncommonMock.brainTreeGenerateAuthToken(httpmock, service, {\n    email: options.email,\n    access_token: options.access_token\n});\ncommonMock.intercomUserError(httpmock, service, {\n    email: options.email,\n    access_token: options.access_token,\n    times: 2\n});\ncommonMock.marketoGetToken(httpmock, service, {});\ncommonMock.marketoCreateLead(httpmock, service, {});\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.email.should.equal(registrationBody.email);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de653cf7-acc5-4229-a246-d30ec3e04876&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return success output if same user with blank user_type exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return success output if same user with blank user_type exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:467,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOneAndUpdate({\n                uid: res.body.output.uid\n            }, {\n                user_type: null\n            }, { new: true }, function(error, user) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send(registrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.email.should.equal(registrationBody.email);\n                            done();\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3315abda-842c-451b-9f15-9fabf0a890a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to create enterprise account, if express account exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should not allowed to create enterprise account, if express account exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2840,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;);\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.EXPRESS_ACCOUNT_ALREADY_EXISTS);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75ee696e-e47c-4578-a6c8-80140c5835f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to create enterprise account, if other partner account exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should allowed to create enterprise account, if other partner account exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2752,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;);\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOneAndUpdate({\n                uid: res.body.output.uid\n            }, {\n                user_type: \&quot;box\&quot;\n            }, {\n                new: true\n            }, function(error, result) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(registrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.email.should.equal(registrationBody.email);\n                            done();\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea3f1a39-f65a-453e-873a-5a56c6699986&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give user already exists error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should give user already exists error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3278,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempLoginBody = {\n                email: tempRegistrationBody.email,\n                password: tempRegistrationBody.password,\n            };\n            commonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n                email: tempRegistrationBody.email\n            });\n            commonMock.flowLogin(httpmock, \&quot;express\&quot;, {\n                email: tempRegistrationBody.email\n            });\n            api.post(\&quot;/express/v1/login\&quot;)\n                .send(tempLoginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        api.post(\&quot;/enterprise/v1/signup\&quot;)\n                            .send(tempRegistrationBody)\n                            .expect(httpStatus.BAD_REQUEST)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.USER_ALREADY_EXISTS);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a483170-04b6-4a92-87b2-83d1183bdb49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to create user for invalid password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should not allowed to create user for invalid password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.password = \&quot;built@12\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;built@12\&quot;;\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.password.message ==\n                messageList.USER_REG_INVALID_PASSWORD;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea82feb4-be3a-45f9-a23a-ebedb356f001&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get default plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:245,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                    //return (plan || {}).express_plan || false;\n                    return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                })) || {};\n                defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ace6263-d6ce-4fa8-9456-98bc4373e202&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get default attributes.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:253,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                isValid = utils.isHaveKeyVals(res.body.output, [\n                        \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                        \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                    ]) &amp;&amp;\n                    res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                    moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                    moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f8538f20-44e7-47ca-81bd-bb2b160dec40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get plan provided trial days.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get plan provided trial days.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:248,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncreatePlan(0, function(trialPeriodPlan) {\n    var tmpRegBody = getImmutable(registrationBody);\n    tmpRegBody.plan = trialPeriodPlan.name;\n    api.post(apiURL)\n        .send(tmpRegBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = false;\n                if (res.body.output.plan.length == 1) {\n                    isValid = utils.isHaveKeyVals(res.body.output, [\n                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                        ]) &amp;&amp;\n                        res.body.output.subscription.days == 180 &amp;&amp;\n                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                }\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ad193329-c723-485c-aace-c38d19ee1dce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get enterprise default trial days.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get enterprise default trial days.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:244,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncreatePlan(1, function(trialPeriodPlan) {\n    var tmpRegBody = getImmutable(registrationBody);\n    tmpRegBody.plan = trialPeriodPlan.name;\n    api.post(apiURL)\n        .send(tmpRegBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = false;\n                if (res.body.output.plan.length == 1) {\n                    isValid = utils.isHaveKeyVals(res.body.output, [\n                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                        ]) &amp;&amp;\n                        res.body.output.subscription.days ==\n                        config.service_types.enterprise.default_trial_days &amp;&amp;\n                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                }\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c51f2a16-b126-43c9-9c7e-17d551af7dde&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get plan provided trial days for days as false.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get plan provided trial days for days as false.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:243,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncreatePlan(2, function(trialPeriodPlan) {\n    var tmpRegBody = getImmutable(registrationBody);\n    tmpRegBody.plan = trialPeriodPlan.name;\n    api.post(apiURL)\n        .send(tmpRegBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = false;\n                if (res.body.output.plan.length == 1) {\n                    isValid = utils.isHaveKeyVals(res.body.output, [\n                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                        ]) &amp;&amp;\n                        res.body.output.subscription.days == 90 &amp;&amp;\n                        typeof(res.body.output.subscription.start_date) == \&quot;undefined\&quot;;\n                }\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd173eb3-53d7-433f-973c-6b560fa3920f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get zero trial days for days as false.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get zero trial days for days as false.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:256,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncreatePlan(3, function(trialPeriodPlan) {\n    var tmpRegBody = getImmutable(registrationBody);\n    tmpRegBody.plan = trialPeriodPlan.name;\n    api.post(apiURL)\n        .send(tmpRegBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = false;\n                if (res.body.output.plan.length == 1) {\n                    isValid = utils.isHaveKeyVals(res.body.output, [\n                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                        ]) &amp;&amp;\n                        res.body.output.subscription.days == 0 &amp;&amp;\n                        typeof(res.body.output.subscription.start_date) == \&quot;undefined\&quot;;\n                }\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;776f86e0-c3a7-4faf-bd98-2de19f2f076d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not copy authtoken from request header.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should not copy authtoken from request header.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:257,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, \&quot;TEST_TEST\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.email = registrationBody.email;\n            if (isValid) {\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, \&quot;TEST_TEST\&quot;)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0ead2693-58d9-4d50-aa50-c8af18d1c80d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create braintree user on successfull registration of user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should create braintree user on successfull registration of user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:229,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.email.should.equal(registrationBody.email);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d693455d-1353-4de4-8def-0da86b414c82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for invalid email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for invalid email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;ambermore\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.email.message ==\n                messageList.USER_REG_EMAIL_NOT_VALID;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27d8ba93-9b8b-4e1a-b280-f0e19f3ff118&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for empty first_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for empty first_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.first_name;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.first_name.message ==\n                messageList.USER_REG_FIRST_NAME_EMPTY;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da1b67ac-f642-48a0-8458-a74b2ee7ecd9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for empty last_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for empty last_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.last_name;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.last_name.message ==\n                messageList.USER_REG_LAST_NAME_EMPTY;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3edc96be-d8df-42af-8497-b013c0c041d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not accepting terms.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for not accepting terms.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.terms;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.terms.message ==\n                messageList.USER_REG_TERMS_NOT_ACCEPTED;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5b5c998c-a014-4cb3-b72e-823707ccfc55&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not providing invalid terms.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for not providing invalid terms.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.terms = \&quot;true123\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.terms.message ==\n                messageList.USER_REG_TERMS_NOT_ACCEPTED;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a78b872b-cebf-4fbd-ab04-5b41df2552b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not passing password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for not passing password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.password;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.password.message ==\n                messageList.USER_REG_INVALID_PASSWORD;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2aff1221-ec12-4c5e-be2d-193f733758b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not passing valid password accordingly to criteria.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for not passing valid password accordingly to criteria.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.password = \&quot;raw\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.password.message ==\n                messageList.USER_REG_INVALID_PASSWORD;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f644958b-f46a-43ce-83b9-1ceb7011245b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not passing confirm password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for not passing confirm password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.password_confirmation;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.password_confirmation.message ==\n                messageList.USER_REG_MATCHED_CONFIRM_PASSWORD;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd50d9cd-b10e-430e-a7db-5fdeb905b63b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for passing different confirm password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for passing different confirm password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.password_confirmation = \&quot;a\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.password_confirmation.message ==\n                messageList.USER_REG_MATCHED_CONFIRM_PASSWORD;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55d6a006-038e-452c-82f4-f096024ad441&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Register user should be enterprise user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Register user should be enterprise user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:232,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.user_type.should.equal(config.service_types.enterprise.name);\n            expect(res.body.output.prod_env).is.not.null\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;50e60046-31ca-42be-82ed-fa9a6a23f281&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set braintree_customerId.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should set braintree_customerId.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:236,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.braintree_customerId.should.not.empty;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d7b3d7b-2c6f-49f0-b1ad-f2c4bc8061b2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set merchantid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should set merchantid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:242,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.merchantid.should.not.empty;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2fd5c45c-7aa4-406d-b440-0f278921753e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed user to register with same email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should not allowed user to register with same email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:300,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(registrationBody)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.USER_ALREADY_EXISTS);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23ad6e22-54d9-4b2b-b636-5b332ea8420e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update profile fields properly.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should update profile fields properly.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:253,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar jobTitle = \&quot;Tech Architect\&quot;;\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.job_title = jobTitle;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.job_title.should.equal(jobTitle);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6da84833-1bbd-4612-aacd-bf59fcb020d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return success on valid plan selected.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return success on valid plan selected.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:227,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar jobTitle = \&quot;Tech Architect\&quot;;\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.plan = \&quot;ciscosparkvip2017\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var plan = res.body.output.plan[0] || {};\n            var isValid = (plan.name == tempRegistrationBody.plan ||\n                    plan.braintree_plan == tempRegistrationBody.plan) &amp;&amp;\n                plan.plan_type == \&quot;enterprise\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;71cb804d-fcef-4ffc-a8c5-c549dee244e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error on invalid plan selection.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error on invalid plan selection.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar jobTitle = \&quot;Tech Architect\&quot;;\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.plan = \&quot;ABC Plan\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.INVALID_PLAN_SELECTED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed1f73eb-68c8-4306-a3c4-b18bc838d43d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set default plan, if plan is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should set default plan, if plan is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:266,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var plan = res.body.output.plan[0] || {};\n            var isValid = plan.name == server.plan.enterprise.name &amp;&amp;\n                plan.braintree_plan == server.plan.enterprise.braintree_plan;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;452a3ccb-f017-44d6-9bf2-095432081e1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send welcome email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should send welcome email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:284,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n///global.isTestSuit = false;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar expectedEmail = {\n    \&quot;to\&quot;: \&quot;test.user@raweng.com\&quot;,\n    \&quot;from\&quot;: \&quot;Built.io Flow Enterprise Support &lt;noreply-flowdev@raweng.com&gt;\&quot;,\n    \&quot;title\&quot;: \&quot;No Title\&quot;,\n    \&quot;subject\&quot;: \&quot;Activate Your Account\&quot;,\n    \&quot;html\&quot;: \&quot;\&quot;\n};\nmockMailer.expectEmail(5, function(sentEmail) {\n    return expectedEmail.to == sentEmail.to &amp;&amp;\n        expectedEmail.from == sentEmail.from &amp;&amp;\n        expectedEmail.title == sentEmail.title &amp;&amp;\n        expectedEmail.subject == sentEmail.subject;\n}, done);\napi.post(apiURL)\n    .send(registrationBody)\n    .end(function(err, res) {\n        done();\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76e30492-1524-4eda-89a9-098cc2280189&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;498f003b-45c4-45b2-92c8-e8e7e9ec357c&quot;,&quot;20abeb31-08f3-41e3-9ac5-673607b42af9&quot;,&quot;a4831b1c-99bf-4c66-8553-90ed23a87ba4&quot;,&quot;de653cf7-acc5-4229-a246-d30ec3e04876&quot;,&quot;3315abda-842c-451b-9f15-9fabf0a890a0&quot;,&quot;75ee696e-e47c-4578-a6c8-80140c5835f3&quot;,&quot;ea3f1a39-f65a-453e-873a-5a56c6699986&quot;,&quot;4a483170-04b6-4a92-87b2-83d1183bdb49&quot;,&quot;ea82feb4-be3a-45f9-a23a-ebedb356f001&quot;,&quot;3ace6263-d6ce-4fa8-9456-98bc4373e202&quot;,&quot;f8538f20-44e7-47ca-81bd-bb2b160dec40&quot;,&quot;ad193329-c723-485c-aace-c38d19ee1dce&quot;,&quot;c51f2a16-b126-43c9-9c7e-17d551af7dde&quot;,&quot;dd173eb3-53d7-433f-973c-6b560fa3920f&quot;,&quot;776f86e0-c3a7-4faf-bd98-2de19f2f076d&quot;,&quot;0ead2693-58d9-4d50-aa50-c8af18d1c80d&quot;,&quot;d693455d-1353-4de4-8def-0da86b414c82&quot;,&quot;27d8ba93-9b8b-4e1a-b280-f0e19f3ff118&quot;,&quot;da1b67ac-f642-48a0-8458-a74b2ee7ecd9&quot;,&quot;3edc96be-d8df-42af-8497-b013c0c041d4&quot;,&quot;5b5c998c-a014-4cb3-b72e-823707ccfc55&quot;,&quot;a78b872b-cebf-4fbd-ab04-5b41df2552b0&quot;,&quot;2aff1221-ec12-4c5e-be2d-193f733758b5&quot;,&quot;f644958b-f46a-43ce-83b9-1ceb7011245b&quot;,&quot;dd50d9cd-b10e-430e-a7db-5fdeb905b63b&quot;,&quot;55d6a006-038e-452c-82f4-f096024ad441&quot;,&quot;50e60046-31ca-42be-82ed-fa9a6a23f281&quot;,&quot;7d7b3d7b-2c6f-49f0-b1ad-f2c4bc8061b2&quot;,&quot;2fd5c45c-7aa4-406d-b440-0f278921753e&quot;,&quot;23ad6e22-54d9-4b2b-b636-5b332ea8420e&quot;,&quot;6da84833-1bbd-4612-aacd-bf59fcb020d7&quot;,&quot;71cb804d-fcef-4ffc-a8c5-c549dee244e7&quot;,&quot;ed1f73eb-68c8-4306-a3c4-b18bc838d43d&quot;,&quot;452a3ccb-f017-44d6-9bf2-095432081e1c&quot;,&quot;76e30492-1524-4eda-89a9-098cc2280189&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14517,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;23175fd5-8963-48db-8451-ecd524ed57ea&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dcad3546-0324-449f-a27e-03ac17976876&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2e9fd3fc-dff0-4a32-9e49-596b2fc196cb&quot;,&quot;title&quot;:&quot;User.creditOverLimitMail&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.creditOverLimitMail \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:263,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nclearRecords(function() {\n    _models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(registrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            authToken = res.body.output.authtoken;\n                            _id = res.body.output._id;\n                            uid = res.body.output.uid;\n                            apiURL = apiURL.replace(\&quot;:uid\&quot;, uid);\n                            done();\n                        }\n                    });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;022be4af-f7c6-42b6-897d-383c5d06b6a4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.creditOverLimitMail \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bd518474-3776-4253-814f-46d2f9c35836&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should process credit over limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.creditOverLimitMail Should process credit over limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        user_uid: uid,\n        percent_used: 90\n    })\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.message == \&quot;done\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5769780-a0cd-49a1-8607-2ea531064a35&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should process credit over limit for organizations.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.creditOverLimitMail Should process credit over limit for organizations.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2033,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncreateOrgPlans(function() {\n    createOrg({\n        done: done\n    }, function(org) {\n        var email = \&quot;test.user+1@raweng.com\&quot;;\n        fetchRoles({\n            done: done,\n            org_uid: org.uid\n        }, function(res) {\n            inviteUsers({\n                roles: res.body.output.objects,\n                user_uid: \&quot;\&quot;,\n                org_uid: org.uid\n            }, function() {\n                api.post(apiURL)\n                    .send({\n                        user_uid: org.org_account.uid,\n                        percent_used: 90\n                    })\n                    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.message == \&quot;done\&quot;;\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;642780e4-9559-4f26-b745-2576b6d31fe6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should skip credit over limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.creditOverLimitMail Should skip credit over limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({\n        \&quot;uid\&quot;: uid\n    }, {\n        credit_limit_email: true\n    },\n    function(err, updatedUser) {\n        api.post(apiURL)\n            .send({\n                user_uid: uid,\n                percent_used: 90\n            })\n            .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var isValid = res.body.message == \&quot;skipped\&quot;;\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f3ff419-6d08-49ee-b52a-f28fb3c4d6db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f5769780-a0cd-49a1-8607-2ea531064a35&quot;,&quot;642780e4-9559-4f26-b745-2576b6d31fe6&quot;,&quot;2f3ff419-6d08-49ee-b52a-f28fb3c4d6db&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2103,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dbbde10b-35c7-4aa5-9318-6d8664255174&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1954ce65-4a22-483b-95ab-f8d40e550ec4&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;67172ddc-ae32-4040-aa1c-321b2bcf8052&quot;,&quot;title&quot;:&quot;User.disableTwoFA&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:262,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ deleted_at: null }, function(error, user) {\n    _models.Mail.remove({ deleted_at: null }, function(error, user) {\n        _models.Authy.remove({ deleted_at: null }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ae652b01-5f1b-4cc0-9493-0e99df6c4163&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ebb07f7-e7b8-4fb2-b3c1-1466c404642f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should disable twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should disable twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:253,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid =\n                                                        res.body.output.enable_twofa == \&quot;disable\&quot; &amp;&amp;\n                                                        res.body.output.authy_user_uid == \&quot;\&quot; &amp;&amp;\n                                                        res.body.output.is_twofa_sms_enabled == false;\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;07367cc8-6fae-4a71-aa3c-a77087fbe5a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for disable twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should get default plan for disable twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:250,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = false;\n                                                    if (res.body.output.plan.length == 1) {\n                                                        var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                            //return (plan || {}).enterprise_plan || false;\n                                                            return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                        })) || {};\n                                                        defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                        isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41e9e25b-d7b6-4b1e-9152-7b3b4516943a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for disable twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should get default attributes for disable twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:351,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = false;\n                                                    if (res.body.output.plan.length == 1) {\n                                                        isValid = utils.isHaveKeyVals(res.body.output, [\n                                                                \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                                \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                            ]) &amp;&amp;\n                                                            res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                            moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                            moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c98a432-5645-472a-b0e2-b35a78d8f2a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should disable twofa for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should disable twofa for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:341,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid =\n                                                                    res.body.output.enable_twofa == \&quot;disable\&quot; &amp;&amp;\n                                                                    res.body.output.authy_user_uid == \&quot;\&quot; &amp;&amp;\n                                                                    res.body.output.is_twofa_sms_enabled == false;\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a1bbd76f-d348-4bff-b545-1252939f47b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should get default plan for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:414,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid = false;\n                                                                if (res.body.output.plan.length == 1) {\n                                                                    var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                                        //return (plan || {}).enterprise_plan || false;\n                                                                        return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                                    })) || {};\n                                                                    defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                                    isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                                }\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf0b1294-b2d2-431a-a8c4-ff0b1fc0419a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should get default attributes for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:366,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid = false;\n                                                                if (res.body.output.plan.length == 1) {\n                                                                    isValid = utils.isHaveKeyVals(res.body.output, [\n                                                                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                                        ]) &amp;&amp;\n                                                                        res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                                }\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a4ca3c2-d184-4c53-b2e2-852875c79bc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d23f4675-d934-4074-8ebf-de4367dd44f6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;07367cc8-6fae-4a71-aa3c-a77087fbe5a6&quot;,&quot;41e9e25b-d7b6-4b1e-9152-7b3b4516943a&quot;,&quot;6c98a432-5645-472a-b0e2-b35a78d8f2a6&quot;,&quot;a1bbd76f-d348-4bff-b545-1252939f47b0&quot;,&quot;cf0b1294-b2d2-431a-a8c4-ff0b1fc0419a&quot;,&quot;9a4ca3c2-d184-4c53-b2e2-852875c79bc6&quot;,&quot;d23f4675-d934-4074-8ebf-de4367dd44f6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1982,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;61060fb3-cfcf-4f65-9ebc-17bf2c8bcfb4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;50a3fb1b-14dc-4c66-b676-9051ca82838f&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dfe2071e-7554-4c7e-9d31-89c49a3499f4&quot;,&quot;title&quot;:&quot;User.forceSuspendUser&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forceSuspendUser \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:258,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    token = res.body.output.activation_token;\n                    _id = res.body.output._id;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d09b8d55-3558-45ec-b25f-98a8960c61b4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forceSuspendUser \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c6e36e9-880d-42fe-905f-fd8f12e89003&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should suspend user account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forceSuspendUser Should suspend user account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({})\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.force_suspend.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12b92914-3fe5-4284-8483-2844d00fb39c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forceSuspendUser Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6676e12b-2818-4b01-a015-2fbe195e9d7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;12b92914-3fe5-4284-8483-2844d00fb39c&quot;,&quot;6676e12b-2818-4b01-a015-2fbe195e9d7f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:60,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;351464b1-0a6a-48c2-9358-28d4bb61ac6f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d75f974a-6d34-407b-b58f-a1f81a7140c8&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ca40473b-8e1f-43ce-ab40-7e1571cdb40c&quot;,&quot;title&quot;:&quot;User.forgotPassword&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:240,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    activationToken = res.body.output.activation_token;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;697eabc9-67c1-4c3e-a84c-f9b430ba431d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;093e441a-06e5-4bbf-9653-6eae3c0ff260&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should send forgot password email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should send forgot password email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/activate\&quot;)\n    .send({\n        user_uid: uid,\n        token: activationToken\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send({\n                    email: registrationBody.email,\n                    captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.message.should.equal(messageList.USER_FP_USER_SENT_MAIL);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca9cb176-ffb8-46ff-be79-0a1a02cabc81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error for account activation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should give error for account activation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        email: registrationBody.email,\n        captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_FP_ACTIVATE_YOUR_ACCOUNT);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2fad9aa3-0e19-4dc3-a6ca-455e8c5a247a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as email not register.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should give error as email not register.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:198,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        email: \&quot;test.user.example.unit.test@example.com\&quot;,\n        captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_FP_USER_NOT_REGISTER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b51e7ca9-a0b6-4d40-be9f-e27490f29d20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to raised forgot password request, when user is locked.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should allowed to raised forgot password request, when user is locked.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n    failed_login_count: 7\n}, { new: true }, function(err, user) {\n    api.post(\&quot;/enterprise/v1/user/activate\&quot;)\n        .send({\n            user_uid: uid,\n            token: activationToken\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send({\n                        email: registrationBody.email,\n                        captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.message.should.equal(messageList.USER_FP_USER_SENT_MAIL);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38d52a5a-7842-44fc-8cc4-24c6c2cf2955&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to raised forgot password request, for 5 times invalid login attempt user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should allowed to raised forgot password request, for 5 times invalid login attempt user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1156,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\nvar loginCount = [];\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                loginCount.push(res.body.error.failed_login_count);\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                            loginCount.push(res.body.error.failed_login_count);\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                        loginCount.push(res.body.error.failed_login_count);\n                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                    loginCount.push(res.body.error.failed_login_count);\n                                                api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                                loginCount.push(res.body.error.failed_login_count);\n                                                            var isValid =\n                                                                loginCount[0] == 1 &amp;&amp;\n                                                                loginCount[1] == 2 &amp;&amp;\n                                                                loginCount[2] == 3 &amp;&amp;\n                                                                loginCount[3] == 4 &amp;&amp;\n                                                                loginCount[4] == 5;\n                                                            if (isValid) {\n                                                                _models.User.findOneAndUpdate({ uid: uid }, {\n                                                                        active: true\n                                                                    },\n                                                                    function(error, user) {\n                                                                        commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                                                        api.post(apiURL)\n                                                                            .send({\n                                                                                email: registrationBody.email,\n                                                                                captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n                                                                            })\n                                                                            .expect(httpStatus.OK)\n                                                                            .end(function(err, res) {\n                                                                                if (err) {\n                                                                                    done(err);\n                                                                                } else {\n                                                                                    res.body.output.message.should.equal(messageList.USER_FP_USER_SENT_MAIL);\n                                                                                    done();\n                                                                                }\n                                                                            });\n                                                                    });\n                                                            } else {\n                                                                false.should.equal(true);\n                                                            }\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f8568585-4e0c-4a65-8012-4a89a600232c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give captcha verification fail error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should give captcha verification fail error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        email: \&quot;test.user.example.unit.test@example.com\&quot;,\n        captcha_code: \&quot;\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CAPTCHA_VERIFICATION_FAIL);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a48c2fbc-9f95-41ca-b352-0c0977a13841&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ca9cb176-ffb8-46ff-be79-0a1a02cabc81&quot;,&quot;2fad9aa3-0e19-4dc3-a6ca-455e8c5a247a&quot;,&quot;b51e7ca9-a0b6-4d40-be9f-e27490f29d20&quot;,&quot;38d52a5a-7842-44fc-8cc4-24c6c2cf2955&quot;,&quot;f8568585-4e0c-4a65-8012-4a89a600232c&quot;,&quot;a48c2fbc-9f95-41ca-b352-0c0977a13841&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1436,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d532717f-4ee6-4407-bb2c-e0a5f3dffd99&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e33c3cc4-47b7-4628-8712-edbe69795438&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;88815fd3-1e33-43d8-8244-886005ef8984&quot;,&quot;title&quot;:&quot;User.generateSupportKey&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:249,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    token = res.body.output.activation_token;\n                    _id = res.body.output._id;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6da57985-9223-4d10-a2c8-a29c3317f712&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;db17e992-4cbf-407f-a5a1-aec136e55f4b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should generate support key.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey Should generate support key.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:226,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncheckSupportKey(done, function(isValid) {\n    isValid.should.equal(true);\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;550bf5b7-9786-410b-b292-f300b95e97db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should generate support key for second time.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey Should generate support key for second time.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:684,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncheckSupportKey(done, function(isValid) {\n    var firstTime = isValid;\n    api.post(\&quot;/enterprise/v1/login\&quot;)\n        .send({\n            email: registrationBody.email,\n            password: registrationBody.password\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                checkSupportKey(done, function(isValid) {\n                    var secondTime = isValid;\n                    (firstTime &amp;&amp; secondTime).should.equal(true);\n                    done();\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e1f8b4f-315b-4581-b0ea-316cc05ae5e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should generate support key for third time.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey Should generate support key for third time.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1084,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncheckSupportKey(done, function(isValid) {\n    var firstTime = isValid;\n    api.post(\&quot;/enterprise/v1/login\&quot;)\n        .send({\n            email: registrationBody.email,\n            password: registrationBody.password\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                checkSupportKey(done, function(isValid) {\n                    var secondTime = isValid;\n                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                        .send({\n                            email: registrationBody.email,\n                            password: registrationBody.password\n                        })\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                authToken = res.body.output.authtoken;\n                                checkSupportKey(done, function(isValid) {\n                                    var thirdTime = isValid;\n                                    (firstTime &amp;&amp; secondTime &amp;&amp; thirdTime).should.equal(true);\n                                    done();\n                                });\n                            }\n                        });\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a1b0c73-2bcb-4a12-8a78-e29bc3126765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should person should not be generating suport key.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey Should person should not be generating suport key.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:245,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncheckSupportKey(done, function(isValid, user) {\n    api.post(apiURL)\n        .set(&#x27;authtoken&#x27;, user.authtoken)\n        .send({})\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.SUPPORT_PERSON_SUPPORT_KEY_GENERATION_ERROR);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a7f0fcf-1cdd-4545-8391-ca5e2016f223&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00d741fe-696d-40e8-b9c9-f76fc8b74b84&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;550bf5b7-9786-410b-b292-f300b95e97db&quot;,&quot;3e1f8b4f-315b-4581-b0ea-316cc05ae5e5&quot;,&quot;8a1b0c73-2bcb-4a12-8a78-e29bc3126765&quot;,&quot;5a7f0fcf-1cdd-4545-8391-ca5e2016f223&quot;,&quot;00d741fe-696d-40e8-b9c9-f76fc8b74b84&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2247,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0fcb65f4-f43b-4dc3-b698-0a23e666d238&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8c1a0048-da8c-4550-b8f0-c6d33722deff&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2d66a7d7-3646-427b-85a3-7bfbf80b2492&quot;,&quot;title&quot;:&quot;User.getAutoRefresh&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAutoRefresh \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:243,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        token = res.body.output.activation_token;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee892951-5247-4bc8-a99e-cbdf4d52a0c2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAutoRefresh \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ee068d5-1313-4ca9-81cd-ac0425468b4e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get auto_refresh to true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAutoRefresh Should get auto_refresh to true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:108,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(\&quot;/enterprise/v1/user/autorefresh\&quot;)\n    .send({\n        auto_refresh: true\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/user/autorefresh\&quot;)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.auto_refresh.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a429fbc-01e7-4ec7-9439-8b076698f7fb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives error as valid parameters required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAutoRefresh Should gives error as valid parameters required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(\&quot;/enterprise/v1/user/autorefresh\&quot;)\n    .send({\n        auto_refresh: \&quot;true1\&quot;\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;455d0986-dfa3-4f80-bf4b-30babf39812a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAutoRefresh Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(\&quot;/enterprise/v1/user/autorefresh\&quot;)\n    .send({\n        auto_refresh: true\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ffd63bc-a3ad-491a-8544-360eadae4884&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7a429fbc-01e7-4ec7-9439-8b076698f7fb&quot;,&quot;455d0986-dfa3-4f80-bf4b-30babf39812a&quot;,&quot;3ffd63bc-a3ad-491a-8544-360eadae4884&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:161,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7b003572-0a2b-486a-95ed-14b03cc0da2b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ef8a136a-c3b6-4943-b811-01a907a8a3ff&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;939e11e0-4d3e-4e00-ad23-bac2749ccd89&quot;,&quot;title&quot;:&quot;User.getAvatar&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAvatar \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:245,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    user_uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d536ca1d-c835-4df4-82a7-9c4026ae0628&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAvatar \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37da33e8-ff81-44ce-9b1d-d218ba7beb41&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get avatar.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAvatar Should get avatar.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.myCroppedImage = \&quot;https://example.com/region/fl3769c85311cc403d31ff45\&quot;;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, tempRegistrationBody.myCroppedImage);\n};\ncommonMock.avatarGetURL(httpmock, \&quot;enterprise\&quot;, {});\napi.put(\&quot;/enterprise/v1/user/avatar\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(apiURL.replace(\&quot;:user_uid\&quot;, user_uid))\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.length.should.equal(2114);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;794524aa-e73d-4db4-8436-785ff88f5906&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default avatar.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAvatar Should get default avatar.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, \&quot;https://example.com/region/fl3769c85311cc403d31ff45\&quot;);\n};\ncommonMock.avatarGetURL(httpmock, \&quot;enterprise\&quot;, {});\napi.get(apiURL.replace(\&quot;:user_uid\&quot;, \&quot;default\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.length.should.equal(2114);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47b291a3-1921-4179-a32f-b3a821402fe7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;794524aa-e73d-4db4-8436-785ff88f5906&quot;,&quot;47b291a3-1921-4179-a32f-b3a821402fe7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:95,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6e39ae6c-f962-42a1-a7f5-4b7fc479b1fc&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b254aecc-76a2-4003-a80c-61a2c28e74b9&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0018ca26-8bef-43e3-8ce8-aa73a957ac16&quot;,&quot;title&quot;:&quot;User.getCreditInfo&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:217,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                userPlan = res.body.output.user_plan;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fcb786f-42b1-4efd-94aa-58196c0f0090&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfo \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e81cc43-116a-4f0c-9899-6c90b32ee4ad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get credits info of authenticated user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfo Should get credits info of authenticated user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (typeof(res.body.output.available) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;24bf9d80-f0ca-43a6-98d9-22e11cd9ee80&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfo Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;50b1bf82-8cff-404d-9b2b-c21bd692f6a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;24bf9d80-f0ca-43a6-98d9-22e11cd9ee80&quot;,&quot;50b1bf82-8cff-404d-9b2b-c21bd692f6a1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7df5fd2b-c738-44ff-83eb-2a3acdeebca2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4f103a45-3a8c-44f4-b944-9d91b52c66bd&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;17e874a2-e6fb-4d25-8a54-7a6ae022ecf3&quot;,&quot;title&quot;:&quot;User.getCreditInfoOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfoOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:175,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        userPlan = data.owner.user_plan;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1155b6fa-afd0-4510-afa7-07fa31282f26&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfoOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51521fc6-62cd-4211-a201-72e1146a86d9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get credit info of organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfoOrg Should get credit info of organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        //console.log(err, res.body.error);\n        if (err) {\n            done(err);\n        } else {\n            (typeof(res.body.output.available) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e2a3f50-1f13-45b4-863f-4764a616624a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfoOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4bf83586-d38f-4ade-9404-e28d265dc426&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5e2a3f50-1f13-45b4-863f-4764a616624a&quot;,&quot;4bf83586-d38f-4ade-9404-e28d265dc426&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:47,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7ded34f9-0988-4cb6-953e-6c7d7a868429&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6981f353-4195-4441-b5ed-52a90832f7d9&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1d9707e8-bde2-44e5-b57a-abec391403fd&quot;,&quot;title&quot;:&quot;User.getCurrentUser&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:264,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        _models.Sessions.remove({}, function(error, user) {\n            _models.User.remove({}, function(error, user) {\n                _models.UserToken.remove({}, function(error, user) {\n                    _models.Mail.remove({}, function(error, user) {\n                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/signup\&quot;)\n                            .send(registrationBody)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                authToken = res.body.output.authtoken;\n                                cbk(err, res)\n                            });\n                    });\n                });\n            });\n        });\n    }\n], function(err, result) {\n    if (err) {\n        done(err);\n    } else {\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f0cbc80-d011-486c-b06f-2708f3624e0f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d437c341-2901-4159-82c0-53a1de1b6976&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a622223f-16a7-4e54-981b-bcb729b08eda&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should unauthenticate session after 4 hours.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser Should unauthenticate session after 4 hours.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var date = moment(new Date());\n            date.subtract({ hours: 4, minutes: 5 });\n            _models.UserToken.findOneAndUpdate({\n                authtoken: authToken\n            }, {\n                idle_valid_till: date\n            }, {\n                new: true\n            }, function(error, user) {\n                api.get(apiURL)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n                            done();\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a1aa9b1-2f3c-4a71-aa2d-e6469382b5d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser Should get current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4574bf57-32e7-45df-a53a-9c08780dee2d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e5f8c582-bcf6-45d1-bf56-f12596b594a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9a1aa9b1-2f3c-4a71-aa2d-e6469382b5d0&quot;,&quot;4574bf57-32e7-45df-a53a-9c08780dee2d&quot;,&quot;e5f8c582-bcf6-45d1-bf56-f12596b594a0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:141,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;13288921-a2a5-4aa9-883f-2a90040c9bab&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2c116201-df75-4c89-8130-0be4ac9a8526&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;85f6a26d-860c-4bdc-97af-21ac52564bae&quot;,&quot;title&quot;:&quot;User.getUserStreamDistinctFlowNamesOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2047,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                env_uid = res.body.output.env_uid;\n                saveBillEntries({\n                    user_uid: user_uid,\n                    authtoken: authToken,\n                    email: data.owner.email\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        saveUserStreamEntries({\n                            user_uid: user_uid,\n                            authtoken: authToken,\n                            email: data.owner.email\n                        }, function(error, userStreamEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _userStreamEntries = userStreamEntries;\n                                done();\n                            }\n                        });\n                    }\n                });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5724c43f-da01-40ba-bf57-54f1a20b4571&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a1a6506c-c0b0-4c5a-a264-cb6c4b612a95&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get distinct list of flow names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of flow names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;workflows\&quot;))\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79144a2d-1a12-4521-9016-7f21b401ecab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of flow based on projects.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of flow based on projects.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar userStreamURL = apiURL.replace(\&quot;{type}\&quot;, \&quot;workflows\&quot;) + \&quot;&amp;project_uid=\&quot; + project_uids[0] + \&quot;,\&quot; + project_uids[1];\napi.get(userStreamURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b41060a-7c49-4ef8-8eb4-7f9769e004bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of projects names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of projects names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;projects\&quot;))\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce6d84d2-34f0-46b6-8483-c740a680b5a3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;adaa46b2-2d7a-4d59-a386-0476b51c41c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;79144a2d-1a12-4521-9016-7f21b401ecab&quot;,&quot;3b41060a-7c49-4ef8-8eb4-7f9769e004bb&quot;,&quot;ce6d84d2-34f0-46b6-8483-c740a680b5a3&quot;,&quot;adaa46b2-2d7a-4d59-a386-0476b51c41c0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:158,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e7d983a9-92d1-48e2-8674-84ade8fef975&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;98723199-43d2-4e76-80cc-f2de221eab7a&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;17b1d060-1d65-4ff3-b744-f77b2ae18926&quot;,&quot;title&quot;:&quot;User.getPlanUsesCheck&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheck \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2865,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    async.waterfall([\n        function(cbk) {\n            _models.User.remove({}, function(error, user) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(testData.testRegistrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        authToken = res.body.output.authtoken;\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                env_uid = res.body.output.env_uid;\n                                user_uid = res.body.output.uid;\n                                cbk(err, res);\n                            });\n                    });\n            });\n        },\n        function(res, cbk) {\n            saveBillEntries({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserTriggers({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserFlows({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, userFlows) {\n                    cbk(null, userFlows);\n                });\n        }\n    ], function(err, results) {\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bd92ac6c-bd2b-4987-9abc-8753a37342f7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheck \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a8d7dd5-79ed-47a2-9a46-c51d061a0d58&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheck \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a1bdca17-6932-4cf5-8243-b808254981f7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get plan uses stats.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheck Should get plan uses stats.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = isNaN(parseInt(res.body.output.trigger_count)) == false &amp;&amp;\n                isNaN(parseInt(res.body.output.flow_count)) == false &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a7b020f-b7da-4441-af41-ada8d1088631&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3a7b020f-b7da-4441-af41-ada8d1088631&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:53,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bccd2f6b-a539-4b81-8bac-ad311c88adc4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f117c78f-ba2c-4686-9c8d-ebc6f0c0d6f8&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9f0ec223-679d-465c-8085-e495cb2990c9&quot;,&quot;title&quot;:&quot;User.getPlanUsesCheckOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheckOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2581,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        testCollection.organizationRemoveRecords({}, function() {\n            testCollection.organizationRecordsEntry({}, function(data) {\n                authToken = data.owner.authtoken;\n                user_uid = data.organization_account.uid;\n                org_acc_authToken = _.first(data.organization_account.authtoken);\n                org_account_uid = data.organization_account.uid;\n                org_uid = data.organization.uid;\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        user_uid = res.body.output.uid;\n                        cbk(null, res);\n                    });\n            });\n        });\n    },\n    function(res, cbk) {\n        saveBillEntries({\n                done: done,\n                authtoken: authToken\n            },\n            function(error, bills) {\n                savedBills = bills;\n                cbk(null, savedBills);\n            });\n    },\n    function(res, cbk) {\n        saveUserTriggers({\n                done: done,\n                authtoken: authToken\n            },\n            function(error, bills) {\n                savedBills = bills;\n                cbk(null, savedBills);\n            });\n    },\n    function(res, cbk) {\n        saveUserFlows({\n                done: done,\n                authtoken: authToken\n            },\n            function(error, userFlows) {\n                cbk(null, userFlows);\n            });\n    }\n], function(err, results) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f08ce4b-bec5-48ff-8136-c9fd03c8122a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheckOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a538fa0b-5a5d-4f89-a65e-a5251554d2af&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheckOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44d7b08d-1f93-4603-a58b-ad5909ef9adb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get plan uses stats.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheckOrg Should get plan uses stats.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = isNaN(parseInt(res.body.output.trigger_count)) == false &amp;&amp;\n                isNaN(parseInt(res.body.output.flow_count)) == false &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b90457b-34fb-4922-9046-d9c01629721b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9b90457b-34fb-4922-9046-d9c01629721b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:58,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e020fbb8-f7c6-46b9-bddf-72467b5ec793&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;91b20e13-b52d-4823-b4bd-1ea312b5ea47&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;43e0bb54-dc09-4b09-86b4-3c04e11eb35e&quot;,&quot;title&quot;:&quot;User.getSupportKey&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getSupportKey \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:238,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    token = res.body.output.activation_token;\n                    _id = res.body.output._id;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5aa65d6c-b3c3-4744-aa59-25d543247203&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getSupportKey \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b907c65d-24ae-4d53-b373-5466d89cf75a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get support key.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getSupportKey Should get support key.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({})\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        api.get(apiURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.supportKey.should.not.equal(\&quot;\&quot;);\n                    done();\n                }\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f72132eb-50ed-4f16-895d-4f2854743701&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getSupportKey Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c38b403-0e1e-4c7f-8099-2b0ca724b39d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f72132eb-50ed-4f16-895d-4f2854743701&quot;,&quot;1c38b403-0e1e-4c7f-8099-2b0ca724b39d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:100,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4c11c4c6-3c62-4d28-a5ab-f03214df958b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ef6cc2af-d6e0-47d4-a3bd-c06626f5b414&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ee3727ef-0bd2-483c-8d51-64998574ebdd&quot;,&quot;title&quot;:&quot;User.getTransactionsInfo&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:412,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                userPlan = res.body.output.user_plan;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;265fe56a-1c22-4524-97a1-2dd33a5eaa22&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfo \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a31bf1e-ac4a-416a-b7f4-62a1882d1dc8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get transactions info of authenticated user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfo Should get transactions info of authenticated user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (typeof(res.body.output.available) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0ff40bc8-8fa7-4766-bf3d-abfdf6e6bdb6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfo Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95695a6d-208e-4f0c-9f6d-3aa58e4585d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0ff40bc8-8fa7-4766-bf3d-abfdf6e6bdb6&quot;,&quot;95695a6d-208e-4f0c-9f6d-3aa58e4585d6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f302d89a-a75c-40c1-a9ef-50ba9c61b0dd&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4a44dded-8ff7-4b7c-8167-862b28c60035&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;74db3049-f0a3-4a99-89b6-df777591ef54&quot;,&quot;title&quot;:&quot;User.getTransactionsInfoOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfoOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:224,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        userPlan = data.owner.user_plan;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2838586-1a03-4f78-8a12-56c6b011b55d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfoOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c503237a-a728-4ba9-92a2-65717a2c0caf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get transactions info of organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfoOrg Should get transactions info of organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        //console.log(err, res.body.error);\n        if (err) {\n            done(err);\n        } else {\n            (typeof(res.body.output.available) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8596c82a-5759-4381-bd12-d10ca0e29600&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfoOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82d5d215-dbc4-4654-be65-edfede257796&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8596c82a-5759-4381-bd12-d10ca0e29600&quot;,&quot;82d5d215-dbc4-4654-be65-edfede257796&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:57,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ad1bf2a3-eff8-4899-a3f8-2acd3854cf28&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e33b685c-0769-4705-9745-43a76932a372&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;202e7fcf-7b2e-43fe-a140-d114cbcce6e5&quot;,&quot;title&quot;:&quot;User.getUserById&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:519,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                var tempRegistrationBody = global.getImmutable(registrationBody);\n                tempRegistrationBody.email = \&quot;test.user+2@raweng.com\&quot;;\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(tempRegistrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(error, res) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            other_user_uid = res.body.output.uid;\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5f18a5d-6779-446c-96cf-551f73d869b4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;15bb169b-1f04-4ba0-a61e-c2153ce96510&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6fe8f023-38f7-4d3b-b0fa-3c43fcb62f6a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get user based on user uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById Should get user based on user uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar apiURLWithID = apiURL.replace(\&quot;:user_uid\&quot;, other_user_uid);\napi.get(apiURLWithID)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(other_user_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef823c61-13bb-4935-a6b8-29c53cc99d8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById Should get user not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar apiURLWithID = apiURL.replace(\&quot;:user_uid\&quot;, \&quot;ABC\&quot;);\napi.get(apiURLWithID)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;776c23a7-9876-4beb-b044-23a4b59391dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar apiURLWithID = apiURL.replace(\&quot;:user_uid\&quot;, other_user_uid);\napi.get(apiURLWithID)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a821bca1-98c7-44e6-83f6-95ff632b74e8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ef823c61-13bb-4935-a6b8-29c53cc99d8c&quot;,&quot;776c23a7-9876-4beb-b044-23a4b59391dd&quot;,&quot;a821bca1-98c7-44e6-83f6-95ff632b74e8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:102,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ac416eed-b942-46ee-a67c-52c9af13fda8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e9f234d9-b6fe-4518-a025-98b06b57d402&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;57435336-4b8b-4f05-bd4d-aee57c564e63&quot;,&quot;title&quot;:&quot;User.getUserCount&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserCount \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:266,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a994a67-b0cd-4ea3-a2b4-a3b2d4548892&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserCount \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8028af4f-c46a-4b7b-9b8b-788367ed9f77&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserCount \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4dd300d8-af12-439d-94fd-8bdf794b20a2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get register user count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserCount Should get register user count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            isNaN(parseInt(res.body.output.count)).should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47d6f5ee-442b-4338-99b3-02ffd017d2bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserCount Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce722243-b1a4-455b-904d-41b68e5f3554&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;47d6f5ee-442b-4338-99b3-02ffd017d2bf&quot;,&quot;ce722243-b1a4-455b-904d-41b68e5f3554&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:60,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8fea7574-c3fe-4f53-918a-da734ab06a60&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f397bbc3-4fb0-4245-a3b8-dcedfbfd55d8&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0b2ee2bb-a6e6-4407-94f5-903a7c50c41c&quot;,&quot;title&quot;:&quot;Users.getUserFlowExecutionList&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionList \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:545,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_org_uid = utils.generateUID();\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(error, res) {\n                        _env_uid = res.body.output.env_uid;\n                        saveBillEntries({\n                            org_uid: _org_uid,\n                            user_uid: user_uid,\n                            env_uid: _env_uid,\n                            authtoken: authToken,\n                            email: res.body.output.email\n                        }, function(error, billEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _billEntries = billEntries;\n                                done();\n                            }\n                        });\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c3fb95a-fcc9-42f9-8d3d-9d34accbfc05&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionList \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;089129c0-9824-435d-8bb1-141e2ea3f5f2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionList Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid);\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.flow_uid == flow_uid;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02dfc55f-eed3-44aa-96a8-afd85a8038c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionList Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid) + \&quot;?skip=1&amp;limit=1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10ddef2d-23b9-4afc-92a0-09b3d090f476&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionList Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1628681c-cf5f-4cc2-b080-800236ade5a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;02dfc55f-eed3-44aa-96a8-afd85a8038c5&quot;,&quot;10ddef2d-23b9-4afc-92a0-09b3d090f476&quot;,&quot;1628681c-cf5f-4cc2-b080-800236ade5a6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:117,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;57f9b71f-11bc-4603-9e6e-078797b430bd&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;78d39b4f-5cac-4b38-b65b-8d25463773c7&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;847024d5-d27f-4c3d-b241-d33469cad58f&quot;,&quot;title&quot;:&quot;Users.getUserFlowExecutionListOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionListOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:492,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n//_org_uid = utils.generateUID();\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                _env_uid = res.body.output.env_uid;\n                saveBillEntries({\n                    org_uid: _org_uid,\n                    user_uid: user_uid,\n                    env_uid: _env_uid,\n                    authtoken: authToken,\n                    email: res.body.output.email\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        done();\n                    }\n                });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14fdc469-5e6a-4df8-bc36-6148725ded05&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionListOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;08c5782d-237f-4716-a59a-8b4b88b7f9fc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionListOrg Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid);\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.flow_uid == flow_uid;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57b3ad0b-6f28-44ac-b99f-f6911e7f432a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionListOrg Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid) + \&quot;?skip=1&amp;limit=1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d17f01e8-e19d-4437-b569-1ca0b475543d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionListOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97214c1e-10ca-4d21-baa3-88d8022f8d2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;57b3ad0b-6f28-44ac-b99f-f6911e7f432a&quot;,&quot;d17f01e8-e19d-4437-b569-1ca0b475543d&quot;,&quot;97214c1e-10ca-4d21-baa3-88d8022f8d2c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:91,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;fadb7c9c-974b-4b2d-8a20-292b0afba0db&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5182ef87-5e62-476e-a39b-202b10722c94&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a50f3602-090b-437c-b894-c1afda062a88&quot;,&quot;title&quot;:&quot;Users.getUserStreamData&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2470,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_org_uid = utils.generateUID();\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(error, res) {\n                        _env_uid = res.body.output.env_uid;\n                        saveBillEntries({\n                            org_uid: _org_uid,\n                            user_uid: user_uid,\n                            env_uid: _env_uid,\n                            authtoken: authToken,\n                            email: res.body.output.email\n                        }, function(error, billEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _billEntries = billEntries;\n                                saveUserStreamEntries({\n                                    org_uid: _org_uid,\n                                    user_uid: user_uid,\n                                    env_uid: _env_uid,\n                                    authtoken: authToken,\n                                    email: res.body.output.email\n                                }, function(error, userStreamEntries) {\n                                    if (error) {\n                                        done(error);\n                                    } else {\n                                        _userStreamEntries = userStreamEntries;\n                                        done();\n                                    }\n                                });\n                            }\n                        });\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13e163ea-7536-4bbc-bd64-1086759f30c9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37e55a2f-38e3-4043-a321-1cd724161c2c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        (typeof(item.env_uid) == \&quot;undefined\&quot; ||\n                            item.env_uid == _env_uid ||\n                            item.env_uid == null)\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6d378af-03f4-43d4-b553-4870ac8e0741&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular flow uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user stream for particular flow uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;015dcfa3-ff68-40b4-9da3-0c6f3b5f8f1f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular project uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user stream for particular project uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?project_uid=\&quot; + project_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.project_uid == project_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ae0e1fe-3ef5-413e-ad2f-d97b2cfb6704&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular flow uid and project uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user stream for particular flow uid and project uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[3] + \&quot;&amp;project_uid=\&quot; + project_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3] &amp;&amp;\n                        item.metadata.project_uid == project_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05eca2d9-2566-4e1c-a9d5-85e998fe5891&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user stream based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user stream based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.UserStream.find({\n                \&quot;deleted_at\&quot;: null,\n                \&quot;user_uid\&quot;: user_uid\n            }, function(error, userStreams) {\n                var isValid = false;\n                if (!error) {\n                    if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                        Array.isArray(res.body.output.objects)) {\n                        userStreams = utils.sortBy(userStreams, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                        isValid = res.body.output.objects.length == 2;\n                    }\n                }\n                isValid.should.equal(true);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45180d85-3706-47e6-a2c0-721846c6eb68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user stream based on skip/limit for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user stream based on skip/limit for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:79,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.UserStream.find({\n                \&quot;deleted_at\&quot;: null,\n                \&quot;user_uid\&quot;: user_uid,\n                \&quot;metadata.flow_uid\&quot;: flow_uids[3]\n            }, function(error, userStreams) {\n                var isValid = false;\n                if (!error) {\n                    if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                        Array.isArray(res.body.output.objects)) {\n                        isValid = res.body.output.objects.length == 2;\n                    }\n                    if (isValid) {\n                        _.each(res.body.output.objects, function(item) {\n                            isValid = isValid &amp;&amp;\n                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                item.metadata.flow_uid == flow_uids[3];\n                        });\n                    }\n                }\n                isValid.should.equal(true);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a4ddf4ac-5357-4ae5-b936-44ddf3306212&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams based on skip/limit in title descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user streams based on skip/limit in title descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=title&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ca4b713-063c-4b2a-9bbe-ee960367aa68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams based on skip/limit in title descending order for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user streams based on skip/limit in title descending order for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=title&amp;direction=desc&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 2;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;879cf7f6-cc5a-4ffb-b8ec-41a8f98251ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5eab7118-325e-4fb8-ac01-1e3c0f08d971&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[0];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dde0ce7f-afbd-4507-b1ea-e543f9a8177b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=1&amp;limit=1&amp;flow=flow-execution\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52825ff8-7492-4b86-9438-8f7bb561d3a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user streams of flow-execution based on skip/limit for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=1&amp;limit=1&amp;flow=flow-execution&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5feeeebc-9cfb-43b5-a117-f14d71af870a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of publish-flow-downloaded.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dbf3cbc0-137a-450b-a244-118adc51804a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of publish-flow-downloaded.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;445dce74-7b7c-405a-8819-18d29a13ebac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of share-flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f4b38ab-94f2-4e13-b0a1-c3c4dd2fc338&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of share-flow for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;flow_uid=\&quot; + flow_uids[2];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6de7d8e-0bbe-4e02-a773-aced33a1a93c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of credits.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of credits.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=credits\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;01345e44-9627-46b9-8105-dc6bd8d7c5e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of credits for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of credits for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=credits&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;26c410e5-b540-433c-aa84-29809b392f10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for specific flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;name=utest_cases_01\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27cd4710-77a1-46d0-9a05-5fc11c6e616b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific flow for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for specific flow for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;name=utest_cases_01&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;438bfe4e-4ac6-42d7-8ad5-a2d59c35b347&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a355a9ab-d4df-4948-9d10-b1a52915dc07&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04d9e617-a46a-4f77-b444-f638e1c80291&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of flow-execution for specific details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of flow-execution for specific details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e71b928-1182-4ed1-96be-a032892ce988&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2ffb8ff9-6d0d-4852-84b2-1ebc18228e9c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9ca7674-bc5c-4a4a-b205-2d115bfbaebf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e9097a7-e4ae-4d52-b383-964308a70c81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6155f8b1-7218-4751-bab9-bd85fe65e209&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;567d92cc-f256-4a7e-9b61-9c01a85d0336&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of share-flow for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9244d26-5875-4d29-a7c3-4d33bb5190ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[1];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ace773b-4c16-4d17-9205-2a64c462bb86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of share-flow for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of share-flow for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd3a480b-ceef-4d91-90db-0b9a139af389&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of result from date range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of result from date range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;from=\&quot; + from_date + \&quot;&amp;to=\&quot; + to_date;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 4 &amp;&amp;\n                    res.body.output.count == 4;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d8bf575-cf39-4f8f-a69a-dd4fff8b9921&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:74,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;544f5fca-ef81-4cd1-823b-773b33f96c57&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for bill status success.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16591887-3187-4207-9730-ab84a069e835&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[0];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a5d8b8b-0259-42a9-9976-5e6ed2ef3a53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for bill status success.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;61ecb16e-9f5c-41ef-a5db-441a5e7ba6ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1dbbf2b7-e2be-4d63-9a6e-c8a3fdf6f54e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c02312cb-92ef-4488-a85f-36daef4665da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d6d378af-03f4-43d4-b553-4870ac8e0741&quot;,&quot;015dcfa3-ff68-40b4-9da3-0c6f3b5f8f1f&quot;,&quot;1ae0e1fe-3ef5-413e-ad2f-d97b2cfb6704&quot;,&quot;05eca2d9-2566-4e1c-a9d5-85e998fe5891&quot;,&quot;45180d85-3706-47e6-a2c0-721846c6eb68&quot;,&quot;a4ddf4ac-5357-4ae5-b936-44ddf3306212&quot;,&quot;3ca4b713-063c-4b2a-9bbe-ee960367aa68&quot;,&quot;879cf7f6-cc5a-4ffb-b8ec-41a8f98251ad&quot;,&quot;5eab7118-325e-4fb8-ac01-1e3c0f08d971&quot;,&quot;dde0ce7f-afbd-4507-b1ea-e543f9a8177b&quot;,&quot;52825ff8-7492-4b86-9438-8f7bb561d3a7&quot;,&quot;5feeeebc-9cfb-43b5-a117-f14d71af870a&quot;,&quot;dbf3cbc0-137a-450b-a244-118adc51804a&quot;,&quot;445dce74-7b7c-405a-8819-18d29a13ebac&quot;,&quot;1f4b38ab-94f2-4e13-b0a1-c3c4dd2fc338&quot;,&quot;f6de7d8e-0bbe-4e02-a773-aced33a1a93c&quot;,&quot;01345e44-9627-46b9-8105-dc6bd8d7c5e6&quot;,&quot;26c410e5-b540-433c-aa84-29809b392f10&quot;,&quot;27cd4710-77a1-46d0-9a05-5fc11c6e616b&quot;,&quot;438bfe4e-4ac6-42d7-8ad5-a2d59c35b347&quot;,&quot;a355a9ab-d4df-4948-9d10-b1a52915dc07&quot;,&quot;04d9e617-a46a-4f77-b444-f638e1c80291&quot;,&quot;6e71b928-1182-4ed1-96be-a032892ce988&quot;,&quot;2ffb8ff9-6d0d-4852-84b2-1ebc18228e9c&quot;,&quot;b9ca7674-bc5c-4a4a-b205-2d115bfbaebf&quot;,&quot;5e9097a7-e4ae-4d52-b383-964308a70c81&quot;,&quot;6155f8b1-7218-4751-bab9-bd85fe65e209&quot;,&quot;567d92cc-f256-4a7e-9b61-9c01a85d0336&quot;,&quot;d9244d26-5875-4d29-a7c3-4d33bb5190ad&quot;,&quot;1ace773b-4c16-4d17-9205-2a64c462bb86&quot;,&quot;dd3a480b-ceef-4d91-90db-0b9a139af389&quot;,&quot;7d8bf575-cf39-4f8f-a69a-dd4fff8b9921&quot;,&quot;544f5fca-ef81-4cd1-823b-773b33f96c57&quot;,&quot;16591887-3187-4207-9730-ab84a069e835&quot;,&quot;1a5d8b8b-0259-42a9-9976-5e6ed2ef3a53&quot;,&quot;61ecb16e-9f5c-41ef-a5db-441a5e7ba6ff&quot;,&quot;1dbbf2b7-e2be-4d63-9a6e-c8a3fdf6f54e&quot;,&quot;c02312cb-92ef-4488-a85f-36daef4665da&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2220,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c5b1a6dc-cad5-4936-82d5-821946b3028d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;98ef6ade-eae7-4f67-9c37-977136e4ee56&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;aff887f3-076b-409d-b516-518761122bea&quot;,&quot;title&quot;:&quot;Users.getUserStreamDataOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2676,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                var env_uid = res.body.output.env_uid;\n                saveBillEntries({\n                    user_uid: user_uid,\n                    authtoken: authToken,\n                    email: data.owner.email,\n                    env_uid: env_uid\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        saveUserStreamEntries({\n                            user_uid: user_uid,\n                            authtoken: authToken,\n                            email: data.owner.email,\n                            env_uid: env_uid\n                        }, function(error, userStreamEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _userStreamEntries = userStreamEntries;\n                                done();\n                            }\n                        });\n                    }\n                });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;878ecd5f-2b33-4acf-beae-bb37ffa906a7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d168271a-be33-47a0-8555-6a0ce32e6818&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;366a18d5-77db-44f1-aa5a-cf0617d61f5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular flow uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user stream for particular flow uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:70,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca1e90e5-617d-4c3f-8ad6-e58ac6901e55&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular project uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user stream for particular project uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?project_uid=\&quot; + project_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.project_uid == project_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49ae5efd-1054-41cd-b167-b7e646200678&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular flow uid and project uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user stream for particular flow uid and project uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[3] + \&quot;&amp;project_uid=\&quot; + project_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3] &amp;&amp;\n                        item.metadata.project_uid == project_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;94a95752-b387-40c4-97e7-b5d86d431aa5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user stream based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user stream based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:72,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.UserStream.find({\n                \&quot;deleted_at\&quot;: null,\n                \&quot;user_uid\&quot;: user_uid\n            }, function(error, userStreams) {\n                var isValid = false;\n                if (!error) {\n                    if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                        Array.isArray(res.body.output.objects)) {\n                        userStreams = utils.sortBy(userStreams, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                        isValid = res.body.output.objects.length == 2;\n                    }\n                }\n                isValid.should.equal(true);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7ce24d6-b12b-4f10-8635-3cce93fd7954&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user stream based on skip/limit for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user stream based on skip/limit for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.UserStream.find({\n                \&quot;deleted_at\&quot;: null,\n                \&quot;user_uid\&quot;: user_uid,\n                \&quot;metadata.flow_uid\&quot;: flow_uids[3]\n            }, function(error, userStreams) {\n                var isValid = false;\n                if (!error) {\n                    if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                        Array.isArray(res.body.output.objects)) {\n                        isValid = res.body.output.objects.length == 2;\n                    }\n                    if (isValid) {\n                        _.each(res.body.output.objects, function(item) {\n                            isValid = isValid &amp;&amp;\n                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                item.metadata.flow_uid == flow_uids[3];\n                        });\n                    }\n                }\n                isValid.should.equal(true);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;650a8511-bafe-4ddb-9433-000d69562237&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams based on skip/limit in title descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user streams based on skip/limit in title descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=title&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0371aec-7fc0-4784-bc7a-77f04b7dbf02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams based on skip/limit in title descending order for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user streams based on skip/limit in title descending order for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=title&amp;direction=desc&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _userStreamEntries = utils.sortBy(_userStreamEntries, \&quot;body.output.title\&quot;);\n                isValid = res.body.output.objects.length == 2 &amp;&amp;\n                    res.body.output.objects[0].metadata.flow_uid == flow_uids[3] &amp;&amp;\n                    res.body.output.objects[1].metadata.flow_uid == flow_uids[3];\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c1797d2-ef15-4bd5-82a0-836fe8914e98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e2a2040-8c04-4fbf-94c8-176de9a7dd3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[0];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84714c6e-eee7-4051-b1cb-00469618eb56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=1&amp;limit=1&amp;flow=flow-execution\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d758e29-da6c-4c0d-b48d-eb9d627edd35&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user streams of flow-execution based on skip/limit for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=1&amp;limit=1&amp;flow=flow-execution&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 1 &amp;&amp;\n                    res.body.output.objects[0].metadata.flow_uid == flow_uids[0];\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1090d296-8a30-4bb7-a0b2-4b1176decdae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of publish-flow-downloaded.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:72,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;588e56c3-8d48-4ee9-8eaf-041d066b651b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of publish-flow-downloaded.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a35b89f-b32f-4e9a-a25e-d420d94975eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of share-flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c4d18a88-feba-41ac-8534-19e4a3ed299a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of share-flow for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;flow_uid=\&quot; + flow_uids[2];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[2];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;150857ba-1f16-43fc-8a4c-90c5bda46dbe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of credits.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of credits.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=credits\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe5204fe-1dc9-4baf-8aec-1d6eb1867e88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of credits for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of credits for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=credits&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95566d6d-d201-470a-93b7-67241fb50a62&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for specific flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;name=utest_cases_01\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98ce05ac-f821-4e77-8019-1a3da1901787&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific flow for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for specific flow for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;name=utest_cases_01&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e92f9ce-b325-446e-b97b-3b47f93c8088&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;322d293c-e0e8-4e62-8b8c-7959d72f1f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[1];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ae085605-10b6-45ec-ab58-b60772af5e90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of flow-execution for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of flow-execution for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;430dfcb5-9b99-4f5d-89a0-6ab3bd49225e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39176dd7-33cd-46a5-806b-09417639a151&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6230f77-f327-4c28-90c5-a389fd8fd0b2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[1];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46d5adb1-4db0-432f-897a-e5ff4161a675&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2226e4cb-1698-4b74-afa5-b5129186aa06&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e9a36ec-88d1-4cee-bd3c-2b9e6491c092&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of share-flow for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;939d169f-5f53-40b6-906f-7240be7b3bd9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[1];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41215e7e-702d-403f-85e1-ac34fc32a6b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of share-flow for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of share-flow for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41073dfd-9afd-451b-8ef9-f28240a2d8a3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13e8651a-fcef-45b7-8a29-3c1ec2430bed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for bill status success.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c68f6cdb-e1cc-4598-829c-e2f7dc24a9b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[0];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e922659c-8bf9-4741-a253-a1a748ab393d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for bill status success.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4fb354e1-ba6d-411f-b4f4-484d3aa4b434&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6cd19699-6685-4389-98ef-0552a154eaa9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95caf47e-90d5-4f46-8ba2-76fcc9152aa6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;366a18d5-77db-44f1-aa5a-cf0617d61f5c&quot;,&quot;ca1e90e5-617d-4c3f-8ad6-e58ac6901e55&quot;,&quot;49ae5efd-1054-41cd-b167-b7e646200678&quot;,&quot;94a95752-b387-40c4-97e7-b5d86d431aa5&quot;,&quot;e7ce24d6-b12b-4f10-8635-3cce93fd7954&quot;,&quot;650a8511-bafe-4ddb-9433-000d69562237&quot;,&quot;f0371aec-7fc0-4784-bc7a-77f04b7dbf02&quot;,&quot;4c1797d2-ef15-4bd5-82a0-836fe8914e98&quot;,&quot;3e2a2040-8c04-4fbf-94c8-176de9a7dd3a&quot;,&quot;84714c6e-eee7-4051-b1cb-00469618eb56&quot;,&quot;5d758e29-da6c-4c0d-b48d-eb9d627edd35&quot;,&quot;1090d296-8a30-4bb7-a0b2-4b1176decdae&quot;,&quot;588e56c3-8d48-4ee9-8eaf-041d066b651b&quot;,&quot;9a35b89f-b32f-4e9a-a25e-d420d94975eb&quot;,&quot;c4d18a88-feba-41ac-8534-19e4a3ed299a&quot;,&quot;150857ba-1f16-43fc-8a4c-90c5bda46dbe&quot;,&quot;fe5204fe-1dc9-4baf-8aec-1d6eb1867e88&quot;,&quot;95566d6d-d201-470a-93b7-67241fb50a62&quot;,&quot;98ce05ac-f821-4e77-8019-1a3da1901787&quot;,&quot;4e92f9ce-b325-446e-b97b-3b47f93c8088&quot;,&quot;322d293c-e0e8-4e62-8b8c-7959d72f1f38&quot;,&quot;ae085605-10b6-45ec-ab58-b60772af5e90&quot;,&quot;430dfcb5-9b99-4f5d-89a0-6ab3bd49225e&quot;,&quot;39176dd7-33cd-46a5-806b-09417639a151&quot;,&quot;d6230f77-f327-4c28-90c5-a389fd8fd0b2&quot;,&quot;46d5adb1-4db0-432f-897a-e5ff4161a675&quot;,&quot;2226e4cb-1698-4b74-afa5-b5129186aa06&quot;,&quot;8e9a36ec-88d1-4cee-bd3c-2b9e6491c092&quot;,&quot;939d169f-5f53-40b6-906f-7240be7b3bd9&quot;,&quot;41215e7e-702d-403f-85e1-ac34fc32a6b0&quot;,&quot;41073dfd-9afd-451b-8ef9-f28240a2d8a3&quot;,&quot;13e8651a-fcef-45b7-8a29-3c1ec2430bed&quot;,&quot;c68f6cdb-e1cc-4598-829c-e2f7dc24a9b4&quot;,&quot;e922659c-8bf9-4741-a253-a1a748ab393d&quot;,&quot;4fb354e1-ba6d-411f-b4f4-484d3aa4b434&quot;,&quot;6cd19699-6685-4389-98ef-0552a154eaa9&quot;,&quot;95caf47e-90d5-4f46-8ba2-76fcc9152aa6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2306,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b95aeff8-78c5-4a1c-852b-f32782f671f2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e7b43827-e66c-416b-bcc0-071f26dda02e&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7c185147-cdb0-48ad-bf12-bb611fe35ccc&quot;,&quot;title&quot;:&quot;User.getUserStreamDistinctFlowNames&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNames \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2730,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(error, res) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            user_uid = res.body.output.uid;\n                            env_uid = res.body.output.env_uid;\n                            _id = res.body.output._id;\n                            saveBillEntries({\n                                user_uid: user_uid,\n                                authtoken: authToken,\n                                email: res.body.output.email\n                            }, function(error, billEntries) {\n                                if (error) {\n                                    done(error);\n                                } else {\n                                    _billEntries = billEntries;\n                                    saveUserStreamEntries({\n                                        user_uid: user_uid,\n                                        authtoken: authToken,\n                                        email: res.body.output.email\n                                    }, function(error, userStreamEntries) {\n                                        if (error) {\n                                            done(error);\n                                        } else {\n                                            _userStreamEntries = userStreamEntries;\n                                            done();\n                                        }\n                                    });\n                                }\n                            });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3a70ae4-d1a1-4410-aeda-48750bf4ff61&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNames \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6368b3e-68ee-45e7-ad34-67a5debad689&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get distinct list of flow names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNames Should get distinct list of flow names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;flows\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb78d56d-0e3c-4a7f-8abb-c7434ba2592b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of projects names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNames Should get distinct list of projects names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;projects\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e9fa021-7b6d-4b61-8106-24466651dbf0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNames Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06381734-0346-4376-90dc-656353237056&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fb78d56d-0e3c-4a7f-8abb-c7434ba2592b&quot;,&quot;2e9fa021-7b6d-4b61-8106-24466651dbf0&quot;,&quot;06381734-0346-4376-90dc-656353237056&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:123,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1ffa588f-405a-42cf-9a4c-86fae8362aca&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e11be98b-2ca6-47a5-b3b9-8bef1a1cd220&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;88501885-6023-47e0-911e-c2d7ee3b22a6&quot;,&quot;title&quot;:&quot;User.getUserStreamDistinctFlowNamesOrg&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2148,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                env_uid = res.body.output.env_uid;\n                saveBillEntries({\n                    user_uid: user_uid,\n                    authtoken: authToken,\n                    email: data.owner.email\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        saveUserStreamEntries({\n                            user_uid: user_uid,\n                            authtoken: authToken,\n                            email: data.owner.email\n                        }, function(error, userStreamEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _userStreamEntries = userStreamEntries;\n                                done();\n                            }\n                        });\n                    }\n                });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;be88b211-20d7-4c95-8f32-8ab80a442236&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31adbd9c-b66d-4f8c-82e2-716e21d3b799&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get distinct list of flow names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of flow names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;workflows\&quot;))\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;506843dc-1745-4c64-895e-67bb69fd4089&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of flow based on projects.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of flow based on projects.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar userStreamURL = apiURL.replace(\&quot;{type}\&quot;, \&quot;workflows\&quot;) + \&quot;&amp;project_uid=\&quot; + project_uids[0] + \&quot;,\&quot; + project_uids[1];\napi.get(userStreamURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2acb562b-0f0e-4ba6-b213-c97d4e0ab1ed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of projects names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of projects names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;projects\&quot;))\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3439f17e-696c-4ae2-91fc-3adaa49d1986&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5b88cf3f-2973-4794-857d-990d6beb7985&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;506843dc-1745-4c64-895e-67bb69fd4089&quot;,&quot;2acb562b-0f0e-4ba6-b213-c97d4e0ab1ed&quot;,&quot;3439f17e-696c-4ae2-91fc-3adaa49d1986&quot;,&quot;5b88cf3f-2973-4794-857d-990d6beb7985&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:164,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b4365fa1-7021-4db8-9b50-3b4e94f24524&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\inviteUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\inviteUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5ffd70cb-657e-4ad5-8c22-ddfbf5f91566&quot;,&quot;title&quot;:&quot;User.Invite&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\inviteUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\inviteUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:194,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner\n        dummyUser.authtoken = dummyUser.authtoken;\n        done()\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf3a9293-04f2-4f68-a700-1fe62660e30e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(data)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;94f27ac3-395a-4847-a343-f13d922f892b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if body is empty not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite Should get error, if body is empty not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidData = _.cloneDeep(data)\ninvalidData.emails = []\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1e707719-c33d-45d2-b507-dcfb3f1aea8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user sents invitations to self.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite Should get error, if user sents invitations to self.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidData = _.cloneDeep(data)\ninvalidData.emails = [dummyUser.email]\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.INVITATION_CAN_NOT_SENT_TO_SELF);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77c6a2df-a83e-4611-9007-332d3cfa8fe8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user sents invitations to more than 10 user(s) at a time.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite Should get error, if user sents invitations to more than 10 user(s) at a time.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;The invitation can not be sent with more than 10 users at a time.&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46a77722-7a98-4d82-b9b9-00f91a3caee5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should invite users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite Should invite users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar validData = _.cloneDeep(data)\nvalidData.emails = [validData.emails[0]]\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(validData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var result = res.body.output.message;\n            expect(result).to.be.equal(&#x27;test@1.com has been invited successfully.&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11ff806c-6d5c-4bb8-b9b9-b3c5edb558e9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;94f27ac3-395a-4847-a343-f13d922f892b&quot;,&quot;1e707719-c33d-45d2-b507-dcfb3f1aea8c&quot;,&quot;77c6a2df-a83e-4611-9007-332d3cfa8fe8&quot;,&quot;46a77722-7a98-4d82-b9b9-00f91a3caee5&quot;,&quot;11ff806c-6d5c-4bb8-b9b9-b3c5edb558e9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:144,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bca53f02-9a78-4bca-b34c-362044668236&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b645e055-9b52-484a-bce5-a9aa024c845f&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8d21897b-d256-45e5-a413-10764c677b2a&quot;,&quot;title&quot;:&quot;User.ListUsers&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.ListUsers \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:981,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        signUpUsers({}, function(error, users) {\n            if (error) {\n                done(error);\n            } else {\n                registerUsers = users;\n                done();\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd8755a7-4229-4063-a0f2-5cbc91daa161&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.ListUsers \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;15493752-c128-483d-b19a-e3b134bf77d6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.ListUsers Should get list of users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar authToken = registerUsers[0].body.output.authtoken;\napi.get(apiURL)\n    .set({ &#x27;authtoken&#x27;: authToken, \&quot;ui_admin_key\&quot;: config.UI_ADMIN_KEY })\n    .expect(httpStatus.OK)\n    .end(function(error, res) {\n        if (error) {\n            done(error);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57c97866-535c-4b08-ad22-00429eedbc83&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of only uids of register users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.ListUsers Should get list of only uids of register users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar authToken = registerUsers[0].body.output.authtoken;\nvar paramURL = apiURL + \&quot;?get=user_uids\&quot;\napi.get(paramURL)\n    .set({ &#x27;authtoken&#x27;: authToken, \&quot;ui_admin_key\&quot;: config.UI_ADMIN_KEY })\n    .expect(httpStatus.OK)\n    .end(function(error, res) {\n        if (error) {\n            done(error);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                var eachMatched = true;\n                _.each(res.body.output, function(item) {\n                    if (!(typeof(item.uid) != \&quot;undefined\&quot; &amp;&amp; typeof(item.email) == \&quot;undefined\&quot;)) {\n                        eachMatched = false;\n                    }\n                });\n                isValid = eachMatched;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;28742df5-16e6-4e24-b8c4-f5b735e9c804&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.ListUsers Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(error, res) {\n        if (error) {\n            done(error);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e17d9d1-d131-4518-ac50-668b64bb21d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;57c97866-535c-4b08-ad22-00429eedbc83&quot;,&quot;28742df5-16e6-4e24-b8c4-f5b735e9c804&quot;,&quot;2e17d9d1-d131-4518-ac50-668b64bb21d7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:95,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;da4df12a-8c02-42f2-87f8-3663564f1629&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d48d2b30-ecd1-43e3-b7bc-a7a1302c3501&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;37168581-4081-41ee-93ff-50ef0aaf7199&quot;,&quot;title&quot;:&quot;User.Login&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;732e4292-bc9d-496f-8e1d-41ee3eaa5ae2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17741c4b-000a-41f2-aaab-319b238fada6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should login successfully.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should login successfully.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:213,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.email == loginBody.email &amp;&amp;\n                res.body.output.active == false &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;58b9f2ac-165b-45d7-93e0-463c53809587&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to re-login successfully.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should allowed to re-login successfully.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:440,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.email == loginBody.email &amp;&amp;\n                res.body.output.active == false &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n\n            if (isValid) {\n                api.post(\&quot;/enterprise/v1/logout\&quot;)\n                    .set(\&quot;authtoken\&quot;, res.body.output.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                            api.post(apiURL)\n                                .send(loginBody)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = res.body.output.email == loginBody.email &amp;&amp;\n                                            res.body.output.active == false &amp;&amp;\n                                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                        isValid.should.equal(true);\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;34fa37b1-db9c-4b55-bcf9-1b94f672f609&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not login if user_type is null.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should not login if user_type is null.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({\n    uid: uid\n}, {\n    user_type: null\n}, function(error, user) {\n    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n    api.post(apiURL)\n        .send(loginBody)\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL);\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9ba1776-a4f5-477f-bb29-bef12a8d62ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user_plan for old user records.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should get user_plan for old user records.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:217,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOne({ uid: uid }, function(error, user) {\n    var planObjectID = new ObjectId(convert.getJSON(user).plan[0]);\n    _models.User.findOneAndUpdate({ uid: uid }, {\n        plan: planObjectID\n    }, { new: true }, function(error, user) {\n        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n        api.post(apiURL)\n            .send(loginBody)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var isValid = res.body.output.email == loginBody.email &amp;&amp;\n                        res.body.output.active == false &amp;&amp;\n                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c3cce53-eac7-4bf5-bbe9-5ffae570d822&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to login if activation is expired.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should not allowed to login if activation is expired.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:202,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: uid }, {\n    activation_expired: true\n}, function(error, user) {\n    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n    api.post(apiURL)\n        .send(loginBody)\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.USER_LOGIN_ACTIVATION_REQUIRED_ERROR);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f0119a7-c50b-4aab-8a6e-ab42d40ecfec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login with support key.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should allowed to login with support key.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/supportkey\&quot;)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({})\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send({\n                    \&quot;email\&quot;: loginBody.email,\n                    \&quot;password\&quot;: res.body.output.supportKey || \&quot;\&quot;\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.support_key == \&quot;\&quot; &amp;&amp;\n                            res.body.output.email == loginBody.email;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c2bb0b8-defd-4275-bf25-466f071a9cd6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to login deleted user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should not allowed to login deleted user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:240,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var currentDate = new Date();\n            _models.User.update({\n                \&quot;uid\&quot;: res.body.output.uid\n            }, { $set: { \&quot;deleted_at\&quot;: currentDate } }, function(error, user) {\n                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send(loginBody)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.USER_LOGIN_INVALID_CREDENTIAL);\n                            done();\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62372e9a-a377-4cff-a337-b4c88ca42631&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid param errors.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should give invalid param errors.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.email.message == messageList.USER_REG_EMAIL_NOT_VALID &amp;&amp;\n                res.body.error.password.message == messageList.USER_LOGIN_REQUIRED_PASSWORD;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30ed1725-9e6e-434e-bad0-44902d26714b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should get default plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:215,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                    //return (plan || {}).enterprise_plan || false;\n                    return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                })) || {};\n                defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                isValid = utils.matchObjects(res.body.output.plan[0], defaultPlan);\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;277c39f2-f913-48e1-9f9e-42106944d516&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should get default attributes.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:208,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                isValid = utils.isHaveKeyVals(res.body.output, [\n                        \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                        \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                    ]) &amp;&amp;\n                    res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                    moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                    moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20500cda-279f-4ab7-90b5-44268e878ed4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should get default user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:232,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.user_plan.should.exist;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df4cb4b5-e847-4aec-887d-0bfa30db0d9d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login with enterprise account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should login with enterprise account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:203,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.user_type.should.equal(config.service_types.enterprise.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0d1e8acd-2dc1-41d6-82fb-09d388e0ac5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get different authtoken on re-login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should get different authtoken on re-login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:420,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var firstAuthToken = res.body.output.authtoken;\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var secondAuthToken = res.body.output.authtoken;\n                        firstAuthToken.should.not.equal(secondAuthToken);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e4c6c42b-62a6-4949-bc12-e9177d221db6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create account if express user exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should create account if express user exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3347,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempLoginBody = global.getImmutable(loginBody);\n            tempLoginBody.email = tempRegistrationBody.email;\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempLoginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.email.should.equal(tempLoginBody.email);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acdab79c-4e23-4e59-93a6-1ad2563e3d10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create activated account if express account is already created.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should create activated account if express account is already created.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3003,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email\n});\nvar newSignupUid = \&quot;\&quot;;\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            newSignupUid = res.body.output.uid;\n            _models.User.findOneAndUpdate({\n                uid: newSignupUid\n            }, {\n                active: true\n            }, { new: true }, function(error, user) {\n                var tempLoginBody = global.getImmutable(loginBody);\n                tempLoginBody.email = tempRegistrationBody.email;\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send(tempLoginBody)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            (res.body.output.email == tempLoginBody.email &amp;&amp;\n                                res.body.output.active).should.equal(true);\n                            done();\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;197d7c63-1939-4205-859f-78b9aab6e084&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login after three fail attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should login after three fail attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:822,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    tempBody.password = \&quot;Raw@1234\&quot;;\n                                    tempBody.captcha_code = \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;;\n                                    commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.output.email.should.equal(loginBody.email);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4fab7bc3-c941-400d-8016-e0541d9b5d4a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give captcha verification fail error for valid credential.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should give captcha verification fail error for valid credential.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:809,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar loginCount = [];\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            loginCount.push(res.body.error.failed_login_count);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        loginCount.push(res.body.error.failed_login_count);\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    loginCount.push(res.body.error.failed_login_count);\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    tempBody.password = \&quot;Raw@1234\&quot;;\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                loginCount.push(res.body.error.failed_login_count);\n                                                var isValid = res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED &amp;&amp;\n                                                    loginCount[0] == 1 &amp;&amp;\n                                                    loginCount[1] == 2 &amp;&amp;\n                                                    loginCount[2] == 3 &amp;&amp;\n                                                    loginCount[3] == 4;\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cde52080-82fe-457f-8e89-9dd011cb5c62&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give captcha verification fail error for invalid credential.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should give captcha verification fail error for invalid credential.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:828,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    tempBody.password = \&quot;abc123\&quot;;\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.error.message.should.equal(messageList.USER_LOGIN_CAPTCHA_REQUIRED);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e8c80a1-05e8-4e48-9122-25f6640d34a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid credential error if captcha is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should give invalid credential error if captcha is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1020,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                tempBody.captcha_code = \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;;\n                                                commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                api.post(apiURL)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            res.body.error.message.should.equal(messageList.USER_LOGIN_INVALID_CREDENTIAL);\n                                                            done();\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4aecb37c-eacd-49f8-b09c-f193cdb9928f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should lock user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should lock user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1222,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\nvar loginCount = [];\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                loginCount.push(res.body.error.failed_login_count);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                            loginCount.push(res.body.error.failed_login_count);\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                        loginCount.push(res.body.error.failed_login_count);\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                    loginCount.push(res.body.error.failed_login_count);\n                                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                api.post(apiURL)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                                loginCount.push(res.body.error.failed_login_count);\n                                                            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                            api.post(apiURL)\n                                                                .send(tempBody)\n                                                                .expect(httpStatus.UNAUTHORIZED)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        if (res.body.error.message == messageList.ENTERPRISE_USER_LOGIN_ACCOUNT_LOCK)\n                                                                            loginCount.push(res.body.error.failed_login_count);\n                                                                        var isValid = loginCount[0] == 1 &amp;&amp;\n                                                                            loginCount[1] == 2 &amp;&amp;\n                                                                            loginCount[2] == 3 &amp;&amp;\n                                                                            loginCount[3] == 4 &amp;&amp;\n                                                                            loginCount[4] == 5 &amp;&amp;\n                                                                            loginCount[5] == 6;\n                                                                        isValid.should.equal(true);\n                                                                        done();\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;34468200-e95f-4d26-824b-d4859a061495&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login after five fail login attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should allowed to login after five fail login attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1230,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\nvar loginCount = [];\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                loginCount.push(res.body.error.failed_login_count);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                            loginCount.push(res.body.error.failed_login_count);\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                        loginCount.push(res.body.error.failed_login_count);\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                    loginCount.push(res.body.error.failed_login_count);\n                                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                api.post(apiURL)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                                loginCount.push(res.body.error.failed_login_count);\n\n                                                            tempBody.captcha_code = \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;;\n                                                            tempBody.password = \&quot;Raw@1234\&quot;;\n                                                            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                            commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                                            api.post(apiURL)\n                                                                .send(tempBody)\n                                                                .expect(httpStatus.OK)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        var isValid = res.body.output.email == tempBody.email &amp;&amp;\n                                                                            loginCount[0] == 1 &amp;&amp;\n                                                                            loginCount[1] == 2 &amp;&amp;\n                                                                            loginCount[2] == 3 &amp;&amp;\n                                                                            loginCount[3] == 4 &amp;&amp;\n                                                                            loginCount[4] == 5;\n                                                                        isValid.should.equal(true);\n                                                                        done();\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9bd26151-a4aa-4d80-aa86-df6eb17fdf74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login after four fail login attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should allowed to login after four fail login attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:983,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\nvar loginCount = [];\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                loginCount.push(res.body.error.failed_login_count);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                            loginCount.push(res.body.error.failed_login_count);\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                        loginCount.push(res.body.error.failed_login_count);\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                    loginCount.push(res.body.error.failed_login_count);\n                                                tempBody.captcha_code = \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;;\n                                                tempBody.password = \&quot;Raw@1234\&quot;;\n                                                commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                api.post(apiURL)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            var isValid = res.body.output.email == tempBody.email &amp;&amp;\n                                                                loginCount[0] == 1 &amp;&amp;\n                                                                loginCount[1] == 2 &amp;&amp;\n                                                                loginCount[2] == 3 &amp;&amp;\n                                                                loginCount[3] == 4\n                                                            isValid.should.equal(true);\n                                                            done();\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e687910a-a4f6-4f28-bf98-8fd89c2d0d08&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login witout 2FA if express account is verified for 2FA.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should allowed to login witout 2FA if express account is verified for 2FA.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4819,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var loginBody2 = global.getImmutable(loginBody);\n            loginBody2.email = \&quot;test.user+1@raweng.com\&quot;;\n            commonMock.flowLogin(httpmock, \&quot;express\&quot;);\n            api.post(\&quot;/express/v1/login\&quot;)\n                .send(loginBody2)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var expressAuthToken = res.body.output.authtoken;\n                        //var tempRegistrationBody = global.getImmutable(registrationBody);\n                        tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n                        tempRegistrationBody.country_code = \&quot;91\&quot;;\n                        delete tempRegistrationBody.password;\n                        commonMock.authyNumberChange(httpmock, \&quot;express\&quot;);\n                        commonMock.authyDelete(httpmock, \&quot;express\&quot;);\n                        api.put(\&quot;/express/v1/user\&quot;)\n                            .send(tempRegistrationBody)\n                            .set(&#x27;authtoken&#x27;, expressAuthToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var authy_userId = res.body.output.authy_user_uid;\n                                    commonMock.authySMSVerification(httpmock, \&quot;express\&quot;);\n                                    api.post(\&quot;/express/v1/authy/sms\&quot;)\n                                        .send({\n                                            authy_id: authy_userId\n                                        })\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                commonMock.authyAppTokenVerification(httpmock, \&quot;express\&quot;);\n                                                api.post(\&quot;/express/v1/authy/verifyotp\&quot;)\n                                                    .send({\n                                                        authy_user_uid: authy_userId,\n                                                        token: otpBody.token,\n                                                        option_selected: \&quot;otp\&quot;\n                                                    })\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            commonMock.authyAppTokenVerification(httpmock, \&quot;express\&quot;);\n                                                            api.post(\&quot;/express/v1/authy/verify\&quot;)\n                                                                .send({\n                                                                    authy_user_uid: authy_userId,\n                                                                    token: otpBody.token\n                                                                })\n                                                                .expect(httpStatus.OK)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                                                                            email: tempRegistrationBody.email\n                                                                        });\n                                                                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                                        api.post(apiURL)\n                                                                            .send(loginBody2)\n                                                                            .expect(httpStatus.OK)\n                                                                            .end(function(err, res) {\n                                                                                if (err) {\n                                                                                    done(err);\n                                                                                } else {\n                                                                                    var isValid = res.body.output.email == loginBody2.email &amp;&amp;\n                                                                                        res.body.output.active == false &amp;&amp;\n                                                                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                                                                    isValid.should.equal(true);\n                                                                                    done();\n                                                                                }\n                                                                            });\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2eb85aa4-b13d-4757-800d-5a4bd8d0adb2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login user if two-factor is enabled but not verified.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should login user if two-factor is enabled but not verified.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:281,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.email.should.equal(tempRegistrationBody.email);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ee43517-f150-4978-80a6-99b9f696cdd6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not login user if two-factor is verified.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should not login user if two-factor is verified.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:328,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(loginBody)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = res.body.output.authy_user_uid == authy_userId &amp;&amp;\n                                                    res.body.output.is_sms_enabled &amp;&amp;\n                                                    res.body.output.is_two_fa_verified &amp;&amp;\n                                                    res.body.output.user_uid != \&quot;\&quot;;\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16adc2c7-1f4f-4118-9df4-e502fc125896&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not login user if two-factor is verified and user activation is expired.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should not login user if two-factor is verified and user activation is expired.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:323,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    _models.User.findOneAndUpdate({\n                                        uid: uid\n                                    }, {\n                                        activation_expired: true,\n                                        active: false\n                                    }, function(error, result) {\n                                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                        api.post(apiURL)\n                                            .send(loginBody)\n                                            .expect(httpStatus.UNAUTHORIZED)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    res.body.error.message.should.equal(messageList.USER_LOGIN_ACTIVATION_REQUIRED_ERROR);\n                                                    done();\n                                                }\n                                            });\n                                    });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c6c614b-ab97-4f5e-8535-751f83f8e512&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;58b9f2ac-165b-45d7-93e0-463c53809587&quot;,&quot;34fa37b1-db9c-4b55-bcf9-1b94f672f609&quot;,&quot;b9ba1776-a4f5-477f-bb29-bef12a8d62ee&quot;,&quot;7c3cce53-eac7-4bf5-bbe9-5ffae570d822&quot;,&quot;7f0119a7-c50b-4aab-8a6e-ab42d40ecfec&quot;,&quot;1c2bb0b8-defd-4275-bf25-466f071a9cd6&quot;,&quot;62372e9a-a377-4cff-a337-b4c88ca42631&quot;,&quot;30ed1725-9e6e-434e-bad0-44902d26714b&quot;,&quot;277c39f2-f913-48e1-9f9e-42106944d516&quot;,&quot;20500cda-279f-4ab7-90b5-44268e878ed4&quot;,&quot;df4cb4b5-e847-4aec-887d-0bfa30db0d9d&quot;,&quot;0d1e8acd-2dc1-41d6-82fb-09d388e0ac5e&quot;,&quot;e4c6c42b-62a6-4949-bc12-e9177d221db6&quot;,&quot;acdab79c-4e23-4e59-93a6-1ad2563e3d10&quot;,&quot;197d7c63-1939-4205-859f-78b9aab6e084&quot;,&quot;4fab7bc3-c941-400d-8016-e0541d9b5d4a&quot;,&quot;cde52080-82fe-457f-8e89-9dd011cb5c62&quot;,&quot;4e8c80a1-05e8-4e48-9122-25f6640d34a0&quot;,&quot;4aecb37c-eacd-49f8-b09c-f193cdb9928f&quot;,&quot;34468200-e95f-4d26-824b-d4859a061495&quot;,&quot;9bd26151-a4aa-4d80-aa86-df6eb17fdf74&quot;,&quot;e687910a-a4f6-4f28-bf98-8fd89c2d0d08&quot;,&quot;2eb85aa4-b13d-4757-800d-5a4bd8d0adb2&quot;,&quot;3ee43517-f150-4978-80a6-99b9f696cdd6&quot;,&quot;16adc2c7-1f4f-4118-9df4-e502fc125896&quot;,&quot;1c6c614b-ab97-4f5e-8535-751f83f8e512&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21737,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;36f9ea74-e90b-4961-bf76-822c3622c76f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d818303d-3c84-4820-994c-cd1bbb4c1257&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ceea7c1e-7902-4fbe-b591-f9264b743ff0&quot;,&quot;title&quot;:&quot;User.LoginGoogle&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({}, function(error, user) {\n    _models.Mail.remove({}, function(error, user) {\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4d8afb5-a323-46b9-b068-22c0413d54cc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7fa85707-1bef-43f5-be0e-b614d6081c77&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should allowed to login into gmail account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should allowed to login into gmail account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:259,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.email == registrationBody.email &amp;&amp; res.body.output.active;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57315480-f674-4adb-8334-65a4f160ac65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give same plan on login with google account for already register enterprise account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should give same plan on login with google account for already register enterprise account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:398,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var user_uid = res.body.output.uid;\n            var authtoken = res.body.output.authtoken;\n            var plan_uid = res.body.output.plan[0].uid;\n            _models.Plan.find({\n                deleted_at: null,\n                plan_type: \&quot;enterprise\&quot;,\n                default: false\n            }, function(error, plans) {\n                if (err) {\n                    done(err);\n                } else {\n                    var plan = plans[0];\n                    _models.User.findOneAndUpdate({\n                        uid: user_uid\n                    }, {\n                        plan: [plan._id]\n                    }, { new: true }, function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            api.get(\&quot;/enterprise/v1/user\&quot;)\n                                .set({\n                                    authtoken: authtoken\n                                })\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                                        commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n                                        api.post(apiURL)\n                                            .send(loginBody)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = res.body.output.email ==\n                                                        registrationBody.email &amp;&amp;\n                                                        res.body.output.plan[0].uid == plan.uid &amp;&amp;\n                                                        res.body.output.active;\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57759fb8-862d-4d3d-af8f-779a2c1ad05e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login into existing account register with same email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should login into existing account register with same email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:331,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.email == registrationBody.email &amp;&amp;\n                            res.body.output.active == true;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d265f2e8-e101-4b82-a664-5cad22c68d95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create another record if existing deleted login record available&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should create another record if existing deleted login record available&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:516,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var uid = res.body.output.uid || \&quot;\&quot;;\n            _models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n                deleted_at: new Date()\n            }, { new: true }, function(err, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                    commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n                    api.post(apiURL)\n                        .send(loginBody)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _models.User.find({ \&quot;email\&quot;: registrationBody.email }, function(err, users) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = users.length == 2;\n                                        isValid.should.equal(true);\n                                        done();\n                                    }\n                                });\n                            }\n                        });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e76fddf-5611-471d-b7c3-4b6d08efcb64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should get default plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:254,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                    //return (plan || {}).express_plan || false;\n                    return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                })) || {};\n                defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b16c9900-a75f-41ff-b610-9ce24b5dc06c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should get default attributes.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:253,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                isValid = utils.isHaveKeyVals(res.body.output, [\n                        \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                        \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                    ]) &amp;&amp;\n                    res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                    moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                    moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce9e2b88-7e9a-47cc-9c1c-42e5dfdf7559&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should get default user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:260,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.user_plan.should.exist;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ffdd8f90-75a7-4508-9e59-80fc6db177dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login with enterprise account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should login with enterprise account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:255,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.user_type.should.equal(config.service_types.enterprise.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f861010c-1edf-4f68-b637-1a4c80462497&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get different authtoken on re-login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should get different authtoken on re-login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:355,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var firstAuthToken = res.body.output.authtoken;\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var secondAuthToken = res.body.output.authtoken;\n                        firstAuthToken.should.not.equal(secondAuthToken);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef1da445-b9dd-4422-ab84-7b54e0a8aeee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create account with enterprise details, if express user exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should create account with enterprise details, if express user exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3303,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email,\n    access_token: plus1User.access_token\n});\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                email: tempRegistrationBody.email,\n                access_token: plus1User.access_token\n            });\n            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n                email: tempRegistrationBody.email,\n                access_token: plus1User.access_token\n            });\n            api.post(apiURL)\n                .send(plus1User)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.email.should.equal(tempRegistrationBody.email);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;889e608e-8dda-41cc-a333-7871c407816a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create account with enterprise details, if one active and one deleted express user exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should create account with enterprise details, if one active and one deleted express user exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5568,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var user_uid = res.body.output.uid;\n            _models.User.findOneAndUpdate({ \&quot;uid\&quot;: user_uid }, {\n                \&quot;deleted_at\&quot;: new Date()\n            }, { new: true }, function(error, result) {\n                if (error) {\n                    done(error);\n                } else {\n                    commonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n                        email: tempRegistrationBody.email\n                    });\n                    api.post(\&quot;/express/v1/signup\&quot;)\n                        .send(tempRegistrationBody)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var user_uid = res.body.output.uid;\n                                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                                    email: tempRegistrationBody.email\n                                });\n                                commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n                                    email: tempRegistrationBody.email\n                                });\n                                api.post(apiURL)\n                                    .send(plus1User)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            res.body.output.email.should.equal(tempRegistrationBody.email);\n                                            done();\n                                        }\n                                    });\n                            }\n                        });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fc44eec-a685-4297-b002-bea6047a6e7c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should register user if email dosen&#x27;t register with any service.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should register user if email dosen&#x27;t register with any service.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:445,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: tempRegistrationBody.email\n});\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(apiURL)\n    .send(plus1User)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.email.should.equal(tempRegistrationBody.email);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;db24ca8f-9f03-4a8b-8cf0-02a3dfb88710&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login with lock user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should allowed to login with lock user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1970,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(registrationBody);\ntempBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: tempBody.email\n});\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(tempBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var curDate = new Date();\n            _models.User.findOneAndUpdate({\n                uid: res.body.output.uid\n            }, {\n                deleted_at: curDate\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                        email: tempBody.email\n                    });\n                    api.post(\&quot;/enterprise/v1/signup\&quot;)\n                        .send(tempBody)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var tempBody2 = getImmutable(loginBody);\n                                tempBody2.email = tempBody.email;\n                                tempBody2.password = \&quot;abc123\&quot;;\n                                var loginCount = [];\n                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                api.post(\&quot;/enterprise/v1/login\&quot;)\n                                    .send(tempBody2)\n                                    .expect(httpStatus.UNAUTHORIZED)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                                loginCount.push(res.body.error.failed_login_count);\n                                            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                            api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                .send(tempBody2)\n                                                .expect(httpStatus.UNAUTHORIZED)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                                            loginCount.push(res.body.error.failed_login_count);\n                                                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                            .send(tempBody2)\n                                                            .expect(httpStatus.UNAUTHORIZED)\n                                                            .end(function(err, res) {\n                                                                if (err) {\n                                                                    done(err);\n                                                                } else {\n                                                                    if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                                                        loginCount.push(res.body.error.failed_login_count);\n                                                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                                        .send(tempBody2)\n                                                                        .expect(httpStatus.UNAUTHORIZED)\n                                                                        .end(function(err, res) {\n                                                                            if (err) {\n                                                                                done(err);\n                                                                            } else {\n                                                                                if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                                                    loginCount.push(res.body.error.failed_login_count);\n                                                                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                                                api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                                                    .send(tempBody2)\n                                                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                                                    .end(function(err, res) {\n                                                                                        if (err) {\n                                                                                            done(err);\n                                                                                        } else {\n                                                                                            if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                                                                loginCount.push(res.body.error.failed_login_count);\n                                                                                            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                                                            api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                                                                .send(tempBody2)\n                                                                                                .expect(httpStatus.UNAUTHORIZED)\n                                                                                                .end(function(err, res) {\n                                                                                                    if (err) {\n                                                                                                        done(err);\n                                                                                                    } else {\n                                                                                                        if (res.body.error.message == messageList.ENTERPRISE_USER_LOGIN_ACCOUNT_LOCK)\n                                                                                                            loginCount.push(res.body.error.failed_login_count);\n                                                                                                        var isValid = loginCount[0] == 1 &amp;&amp;\n                                                                                                            loginCount[1] == 2 &amp;&amp;\n                                                                                                            loginCount[2] == 3 &amp;&amp;\n                                                                                                            loginCount[3] == 4 &amp;&amp;\n                                                                                                            loginCount[4] == 5 &amp;&amp;\n                                                                                                            loginCount[5] == 6;\n                                                                                                        if (isValid) {\n                                                                                                            api.get(\&quot;/enterprise/v1/status?email=\&quot; + tempBody2.email)\n                                                                                                                .expect(httpStatus.OK)\n                                                                                                                .end(function(err, res) {\n                                                                                                                    if (err) {\n                                                                                                                        done(err);\n                                                                                                                    } else {\n                                                                                                                        if (res.body.output.block &amp;&amp; res.body.output.show_captcha) {\n                                                                                                                            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                                                                                                                                email: tempBody2.email\n                                                                                                                            });\n                                                                                                                            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n                                                                                                                                email: tempBody2.email\n                                                                                                                            });\n                                                                                                                            api.post(apiURL)\n                                                                                                                                .send(tempBody2)\n                                                                                                                                .expect(httpStatus.OK)\n                                                                                                                                .end(function(err, res) {\n                                                                                                                                    if (err) {\n                                                                                                                                        done(err);\n                                                                                                                                    } else {\n                                                                                                                                        var isValid = res.body.output.email == tempBody2.email &amp;&amp; res.body.output.active;\n                                                                                                                                        isValid.should.equal(true);\n                                                                                                                                        done();\n                                                                                                                                    }\n                                                                                                                                });\n                                                                                                                        } else {\n                                                                                                                            false.should.equal(true);\n                                                                                                                        }\n                                                                                                                    }\n                                                                                                                });\n                                                                                                        } else {\n                                                                                                            false.should.equal(true);\n                                                                                                        }\n                                                                                                    }\n                                                                                                });\n                                                                                        }\n                                                                                    });\n                                                                            }\n                                                                        });\n                                                                }\n                                                            });\n                                                    }\n                                                });\n                                        }\n                                    });\n                            }\n                        });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d02ce67-e630-4414-97a9-b1f99da8773f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login with captcha, after three fail attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should allowed to login with captcha, after three fail attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:998,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempBody = getImmutable(loginBody);\n            tempBody.email = registrationBody.email;\n            tempBody.password = \&quot;abc123\&quot;;\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                                                commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n                                                commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                                tempBody.password = \&quot;Raw@1234\&quot;;\n                                                tempBody.captcha_code = \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;;\n                                                api.post(apiURL)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            registrationBody.email.should.equal(res.body.output.email);\n                                                            done();\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6a6723e-90af-47bc-b634-ec6c55525dc1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not required captcha for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should not required captcha for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1034,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempBody = getImmutable(loginBody);\n            tempBody.email = registrationBody.email;\n            tempBody.password = \&quot;abc123\&quot;;\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                tempBody.password = registrationBody.password;\n                                                api.get(\&quot;/enterprise/v1/status?email=\&quot; + tempBody.email)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            if (res.body.output.block == false &amp;&amp; res.body.output.show_captcha) {\n                                                                commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n                                                                commonMock.brainTreeFailClientToken(httpmock, \&quot;enterprise\&quot;);\n                                                                api.post(apiURL)\n                                                                    .send(tempBody)\n                                                                    .expect(httpStatus.OK)\n                                                                    .end(function(err, res) {\n                                                                        if (err) {\n                                                                            done(err);\n                                                                        } else {\n                                                                            var isValid = res.body.output.email == registrationBody.email &amp;&amp; res.body.output.active;\n                                                                            isValid.should.equal(true);\n                                                                            done();\n                                                                        }\n                                                                    });\n                                                            } else {\n                                                                false.should.equal(true);\n                                                            }\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf5faded-cf70-40df-8366-a2f44e88f3da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;57315480-f674-4adb-8334-65a4f160ac65&quot;,&quot;57759fb8-862d-4d3d-af8f-779a2c1ad05e&quot;,&quot;d265f2e8-e101-4b82-a664-5cad22c68d95&quot;,&quot;9e76fddf-5611-471d-b7c3-4b6d08efcb64&quot;,&quot;b16c9900-a75f-41ff-b610-9ce24b5dc06c&quot;,&quot;ce9e2b88-7e9a-47cc-9c1c-42e5dfdf7559&quot;,&quot;ffdd8f90-75a7-4508-9e59-80fc6db177dd&quot;,&quot;f861010c-1edf-4f68-b637-1a4c80462497&quot;,&quot;ef1da445-b9dd-4422-ab84-7b54e0a8aeee&quot;,&quot;889e608e-8dda-41cc-a333-7871c407816a&quot;,&quot;0fc44eec-a685-4297-b002-bea6047a6e7c&quot;,&quot;db24ca8f-9f03-4a8b-8cf0-02a3dfb88710&quot;,&quot;4d02ce67-e630-4414-97a9-b1f99da8773f&quot;,&quot;b6a6723e-90af-47bc-b634-ec6c55525dc1&quot;,&quot;cf5faded-cf70-40df-8366-a2f44e88f3da&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:16199,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;838df875-eb41-41ad-9a5d-8e5f3b511ae4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;63f1514f-e1ea-4465-b7de-934a9a7e74c8&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;be19ddfe-d296-4b7d-b3c2-77b56fa1447c&quot;,&quot;title&quot;:&quot;User.Logout&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:248,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({}, function(error, user) {\n    _models.Mail.remove({}, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    userObj = res.body.output\n                    authToken = userObj.authtoken;\n                    _id = userObj._id;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ef3d083-7272-4e28-a2c5-477e065601cf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f21d2335-d59a-465d-b478-4f2a37c5a950&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;User should get logout.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout User should get logout.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.LOGOUT_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e60f35ed-34d0-46d0-b6e3-2b66b1dfce53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;User should get logout with get route.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout User should get logout with get route.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.LOGOUT_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bba6a80a-5ac6-496d-a5ec-17edcde52d87&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;User should get logout even if his account is suspend.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout User should get logout even if his account is suspend.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar query = _models.User.findOneAndUpdate({ uid: userObj.uid }, { force_suspend: true }, { new: true })\nquery.lean().exec(function(err, user) {\n    if (err) {\n        done(err);\n    } else {\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.message.should.equal(messageList.LOGOUT_SUCCESS);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;28f9dd7c-ae24-4a90-954d-d7bafc0058d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;User authtoken should get remove from user collection.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout User authtoken should get remove from user collection.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({ _id: _id }, function(err, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    (((user || {})[\&quot;_doc\&quot;] || {}).authtoken || []).length.should.equal(0);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b4091b4-8e6d-4caf-bf29-5b731fa43e27&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2ed9b553-d961-4bc6-80ea-2f5b24169f24&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e60f35ed-34d0-46d0-b6e3-2b66b1dfce53&quot;,&quot;bba6a80a-5ac6-496d-a5ec-17edcde52d87&quot;,&quot;28f9dd7c-ae24-4a90-954d-d7bafc0058d4&quot;,&quot;3b4091b4-8e6d-4caf-bf29-5b731fa43e27&quot;,&quot;2ed9b553-d961-4bc6-80ea-2f5b24169f24&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:220,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8489ff94-2820-4c39-9a7e-88ab68ce0f7b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b66125f9-fc2b-4812-917a-751064740778&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a2b27f66-7eab-4dc4-bf74-1fea659f4924&quot;,&quot;title&quot;:&quot;User.processSSOLogin&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6235329-2d96-4ed7-868c-951e836aeb97&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c875dd4e-8360-4e1a-8bbc-dbb0ca1de88b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should login with SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should login with SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1880,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncreateSSOProvider({\n}, function(error, ssoProvider) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var data = getImmutable(usersData.SMALRespWithoutAuthtoken);\n                    delete data.RelayState;\n                    api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                        .send(data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                var _config = config;\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set({ &#x27;authtoken&#x27;: authtoken })\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                res.body.output.plan[0].name.indexOf(\&quot;Trial\&quot;) &gt; -1;\n                                            isValid.should.equal(true);\n                                            done();\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9f1b003-ea84-4499-b917-3ffb2a259956&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get specific plan to user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should get specific plan to user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1588,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncreateSSOProvider({\n    plan: \&quot;fl4d44d77af613ae44845883\&quot;\n}, function(error, ssoProvider) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var data = getImmutable(usersData.SMALRespWithoutAuthtoken);\n                    delete data.RelayState;\n                    api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                        .send(data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                var _config = config;\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set({ &#x27;authtoken&#x27;: authtoken })\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                res.body.output.plan[0].name.indexOf(\&quot;Light Plan\&quot;) != -1;\n                                            isValid.should.equal(true);\n                                            done();\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c2654795-6718-4521-b3f2-9d386f507e3d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get metadata xml.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should get metadata xml.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// sso.getMetadata\nthis.timeout(apiTimeOut);\ncreateSSOProvider({\n}, function(error, ssoProvider) {\n    api.get(\&quot;/enterprise/v1/sso/metadata/raweng\&quot;)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.text.toString().startsWith(\&quot;&lt;?xml\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec1c4925-8393-4dcf-856d-93b46561187c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should overwrite user session management timeout.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should overwrite user session management timeout.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1988,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncreateSSOProvider({\n}, function(error, ssoProvider) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var data = usersData.SMALRespWithoutAuthtoken;\n                    api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                        .send(data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                var date = moment(new Date());\n                                date.subtract({ hours: 4, minutes: 5 });\n                                _models.UserToken.findOneAndUpdate({\n                                    authtoken: authtoken\n                                }, {\n                                    idle_valid_till: date\n                                }, {\n                                    new: true\n                                }, function(error, user) {\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f039126d-b9f6-4ba6-9f5d-903e699bd565&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should do test login without enabling SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should do test login without enabling SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:375,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar email = \&quot;amber.more@raweng.com\&quot;;\ncreateSSOProvider({\n    enable_sso: false\n}, function(error, ssoProvider) {\n    signUpUser({\n        email: email\n    }, function(res) {\n        var newUserAuthtoken = res.body.output.authtoken;\n        api.get(\&quot;/enterprise/v1/login/raweng?test=true\&quot;)\n            .expect(httpStatus.MOVED_TEMPORARILY)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                        var qs = querystring.parse(res.headers.location);\n                        var data = usersData.SMALRespWithoutAuthtoken;\n                        data.RelayState = qs.RelayState;\n                        api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                            .send(data)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var qs = querystring.parse(res.headers.location);\n                                    var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success_test + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b10201e-e873-495f-adc9-6f5038fb364c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should use same token for secondtime login if validtill satisfies.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should use same token for secondtime login if validtill satisfies.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1670,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar SSOLogin = function(sso_data, cb) {\n    var authtoken = \&quot;\&quot;;\n    var ssoLogin = \&quot;/enterprise/v1/login/raweng\&quot;;\n    if (sso_data.RelayState) {\n        authtoken = sso_data.authtoken || \&quot;\&quot;;\n        ssoLogin += \&quot;?sid=\&quot; + authtoken\n    }\n    api.get(ssoLogin)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var qs = querystring.parse(res.headers.location);\n                    var rs = utils.getRelayState({\n                        body: {\n                            RelayState: qs.RelayState\n                        }\n                    });\n                    if ((rs.authtoken || \&quot;\&quot;) == authtoken) {\n                        sso_data.RelayState = encryption.encryptSync(JSON.stringify({\n                            a: authtoken,\n                            t: false\n                        }), encryption.getKeySync());\n                        api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                            .send(sso_data)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var qs = querystring.parse(res.headers.location);\n                                    var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                                if (isValid) {\n                                                    cb(isValid, authtoken);\n                                                } else {\n                                                    false.should.equal(true);\n                                                    done();\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\ncreateSSOProvider({}, function(error, ssoProvider) {\n    var data = usersData.SMALRespWithoutAuthtoken;\n    SSOLogin(data, function(isValid, authtoken) {\n        var firstToken = authtoken;\n        data.RelayState = encryption.encryptSync(JSON.stringify({\n            a: authtoken\n        }), encryption.encryptSync());\n        data.authtoken = authtoken;\n        SSOLogin(data, function(isValid, authtoken) {\n            var secondToken = authtoken;\n            if (firstToken == secondToken) {\n                _models.UserToken.find({}, function(error, tokens) {\n                    (tokens.length == 1).should.equal(true);\n                    done();\n                });\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d72384e1-b2f1-4b93-b23f-bcdf82851bdd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not do SSO login if SSO is disabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should not do SSO login if SSO is disabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:255,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar email = \&quot;amber.more@raweng.com\&quot;;\nvar loginWithSSO = function(status, callback) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(\&quot;error\&quot;) &gt; -1) {\n                    var qs = querystring.parse(res.headers.location);\n                    var error = qs[\&quot;error\&quot;] || qs[sso_urls.error + \&quot;?error\&quot;] || \&quot;\&quot;;\n                    callback(error, null);\n                } else {\n                    if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                        var data = usersData.SMALRespWithoutAuthtoken;\n                        api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                            .send(data)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var qs = querystring.parse(res.headers.location);\n                                    var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .expect(status)\n                                        .end(callback);\n                                }\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                }\n            }\n        });\n};\ncreateSSOProvider({\n    enable_sso: false\n}, function(error, ssoProvider) {\n    signUpUser({\n        email: email\n    }, function(res) {\n        var newUserAuthtoken = res.body.output.authtoken;\n        loginWithSSO(httpStatus.BAD_REQUEST, function(err, res) {\n            err.should.equal(messageList.SSO_DISABLE);\n            done();\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1cb19ff1-3b85-4257-9e19-636237c13802&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should logout all tokens.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should logout all tokens.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2323,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar last_authtoken = \&quot;\&quot;;\nvar SSOLogin = function(cb) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var data = usersData.SMALRespWithoutAuthtoken;\n                    api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                        .send(data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, authtoken)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                            if (isValid) {\n                                                last_authtoken = authtoken;\n                                                cb(isValid);\n                                            } else {\n                                                false.should.equal(true);\n                                                done();\n                                            }\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\ncreateSSOProvider({}, function(error, ssoProvider) {\n    SSOLogin(function() {\n        _models.UserToken.update({}, {\n            valid_till: new Date(2001, 12, 1)\n        }, {\n            multi: true\n        }, function(error, tokens) {\n            SSOLogin(function() {\n                api.post(\&quot;/enterprise/v1/logout\&quot;)\n                    .set(&#x27;authtoken&#x27;, last_authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        _models.UserToken.find({ authtoken: last_authtoken }, function(error, tokens) {\n                            var is_valid = true;\n                            _.each(tokens, function(item) {\n                                is_valid = is_valid &amp;&amp; item.deleted_at != null;\n                            });\n                            is_valid.should.equal(true);\n                            done();\n                        });\n                    });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25822f82-d352-4f59-b2a9-9b1d34bda7d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d9f1b003-ea84-4499-b917-3ffb2a259956&quot;,&quot;c2654795-6718-4521-b3f2-9d386f507e3d&quot;,&quot;ec1c4925-8393-4dcf-856d-93b46561187c&quot;,&quot;f039126d-b9f6-4ba6-9f5d-903e699bd565&quot;,&quot;0b10201e-e873-495f-adc9-6f5038fb364c&quot;,&quot;d72384e1-b2f1-4b93-b23f-bcdf82851bdd&quot;,&quot;1cb19ff1-3b85-4257-9e19-636237c13802&quot;,&quot;25822f82-d352-4f59-b2a9-9b1d34bda7d5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10099,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;df2ee136-03bf-4bef-81f5-0b274997f9d5&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d0123676-f1cb-4a4c-9824-d988f151d1b2&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;67615f6a-482f-481d-9230-126bc558e574&quot;,&quot;title&quot;:&quot;User.projectsworkflows&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2095,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                env_uid = res.body.output.env_uid;\n                saveBillEntries({\n                    user_uid: user_uid,\n                    authtoken: authToken,\n                    email: data.owner.email\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        saveUserStreamEntries({\n                            user_uid: user_uid,\n                            authtoken: authToken,\n                            email: data.owner.email\n                        }, function(error, userStreamEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _userStreamEntries = userStreamEntries;\n                                done();\n                            }\n                        });\n                    }\n                });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2beeb734-7412-4b81-aad6-bfa38284c7eb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;391f6db0-ede4-4db8-80c7-1083ed60db60&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get distinct list of flow names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows Should get distinct list of flow names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.flows) &amp;&amp;\n                Array.isArray(res.body.output.projects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a615c0fb-b1c0-410d-bec5-f2a851a23cd2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of flow based on projects.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows Should get distinct list of flow based on projects.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.flows) &amp;&amp;\n                Array.isArray(res.body.output.projects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e34a5e2-a674-497d-873f-ce20428b7c3b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of projects names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows Should get distinct list of projects names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.flows) &amp;&amp;\n                Array.isArray(res.body.output.projects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d5a3c04b-246f-4311-b9ed-56aff0e316f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5dd98a69-a4ee-4cf3-b419-3b808533ddf0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a615c0fb-b1c0-410d-bec5-f2a851a23cd2&quot;,&quot;6e34a5e2-a674-497d-873f-ce20428b7c3b&quot;,&quot;d5a3c04b-246f-4311-b9ed-56aff0e316f0&quot;,&quot;5dd98a69-a4ee-4cf3-b419-3b808533ddf0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:181,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f15459dd-2d94-45d1-9142-8ed2882318da&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0a7eb3ec-4749-46ba-a635-f94be6f96568&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e7e27929-deff-423c-b9fe-144c735d51db&quot;,&quot;title&quot;:&quot;User.resendActivationMail&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:272,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({}, function(error, user) {\n    _models.Mail.remove({}, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    activationToken = res.body.output.activation_token;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a797ae20-8ae6-4b03-a57c-f36f589164ed&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should send activation email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail Should send activation email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        email: registrationBody.email,\n        captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.USER_ACTIVATION_MAIL_SENT);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cfb52d69-32d6-42ea-875d-9a62357fb6c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to send activation link when user is locked.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail Should allowed to send activation link when user is locked.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n    failed_login_count: 7\n}, { new: true }, function(err, user) {\n    commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n    api.post(apiURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .send({\n            email: registrationBody.email,\n            captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.USER_ACTIVATION_MAIL_SENT);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69c78f53-e04b-47f2-ac63-966f82c959e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as user is not register.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail Should give error as user is not register.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        email: \&quot;FAKE_EMAIL@example.com\&quot;,\n        captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_ACTIVATION_NOT_REGISTER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b42cfefe-a665-4e22-adf6-1ff537217e10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as user has been already activated.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail Should give error as user has been already activated.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/activate\&quot;)\n    .send({\n        user_uid: uid,\n        token: activationToken\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .send({\n                    email: registrationBody.email,\n                    captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n                })\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.USER_ACTIVATION_ALREADY_ACTIVATED);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5766c16-12d9-4037-83ec-51dcbc8a5503&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give captcha verification fail error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail Should give captcha verification fail error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        email: registrationBody.email\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CAPTCHA_VERIFICATION_FAIL);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;209ff10a-b941-444a-b51f-22f99971e537&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cfb52d69-32d6-42ea-875d-9a62357fb6c8&quot;,&quot;69c78f53-e04b-47f2-ac63-966f82c959e6&quot;,&quot;b42cfefe-a665-4e22-adf6-1ff537217e10&quot;,&quot;c5766c16-12d9-4037-83ec-51dcbc8a5503&quot;,&quot;209ff10a-b941-444a-b51f-22f99971e537&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:103,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0d3d451c-9343-4194-b4e8-d890202b2b15&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7c2ea276-d745-418a-8a06-d9848debf3c4&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3a18749c-e52a-4320-873d-b570ef6d6d69&quot;,&quot;title&quot;:&quot;User.resetPassword&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:279,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                activationToken = res.body.output.activation_token;\n                uid = res.body.output.uid;\n                api.post(\&quot;/enterprise/v1/user/activate\&quot;)\n                    .send({\n                        user_uid: uid,\n                        token: activationToken\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e868d846-dd55-420f-8e0d-7819c6c20f95&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4b9d3916-d894-4ba2-b3ea-1dd6b6bf036d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2982a593-08b6-4f18-a700-c68a018933cb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should reset password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should reset password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:239,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12345\&quot;,\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.OK\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.output.message.should.equal(messageList.USER_RESET_PASS_SUCCESSFULLY);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d528ad8-8747-4781-bfdf-154d27a25139&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to reset password, when user is locked.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should allowed to reset password, when user is locked.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:236,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n    failed_login_count: 7\n}, { new: true }, function(err, user) {\n    passwordReseting({\n        password: \&quot;Raw@12345\&quot;,\n        password_confirmation: \&quot;Raw@12345\&quot;,\n        captcha_code: captchaCode,\n        httpStatus: httpStatus.OK\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.USER_RESET_PASS_SUCCESSFULLY);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e71e3428-2018-4889-b2eb-87acc08a773c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set failed login count to zero, when user reset password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should set failed login count to zero, when user reset password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:241,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n    failed_login_count: 7\n}, { new: true }, function(err, user) {\n    passwordReseting({\n        password: \&quot;Raw@12345\&quot;,\n        password_confirmation: \&quot;Raw@12345\&quot;,\n        captcha_code: captchaCode,\n        httpStatus: httpStatus.OK\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({ \&quot;uid\&quot;: uid }, function(err, user) {\n                user.failed_login_count.should.equal(0);\n                done();\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe0ae3eb-e507-483f-80b0-6072627ae353&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error for using same password while reseting password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give error for using same password while reseting password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:231,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@1234\&quot;,\n    password_confirmation: \&quot;Raw@1234\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.message.should.equal(messageList.PASSWORD_REPEAT_ERROR);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d1548b9c-c097-4c32-9588-aa895ba95c3b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not passing valid password accordingly to criteria.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should return error for not passing valid password accordingly to criteria.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:70,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Rawaaaaaaaaaaaa\&quot;,\n    password_confirmation: \&quot;Rawaaaaaaaaaaaa\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.password.message.should.equal(messageList.USER_REG_INVALID_PASSWORD);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;708ca81c-29ac-41b2-9c8e-a16dd1139812&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not passing confirm password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should return error for not passing confirm password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@1234\&quot;,\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.password_confirmation.message.should.equal(messageList.USER_REG_MATCHED_CONFIRM_PASSWORD);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;098ea8d1-084d-44a5-afb6-a3e01d823c69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to use first password on fifth time password reseting.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should not allowed to use first password on fifth time password reseting.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1201,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12341\&quot;,\n    password_confirmation: \&quot;Raw@12341\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.OK\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n            passwordReseting({\n                password: \&quot;Raw@12342\&quot;,\n                password_confirmation: \&quot;Raw@12342\&quot;,\n                captcha_code: captchaCode,\n                httpStatus: httpStatus.OK\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                        passwordReseting({\n                            password: \&quot;Raw@12343\&quot;,\n                            password_confirmation: \&quot;Raw@12343\&quot;,\n                            captcha_code: captchaCode,\n                            httpStatus: httpStatus.OK\n                        }, function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                                    passwordReseting({\n                                        password: \&quot;Raw@12344\&quot;,\n                                        password_confirmation: \&quot;Raw@12344\&quot;,\n                                        captcha_code: captchaCode,\n                                        httpStatus: httpStatus.OK\n                                    }, function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                                                passwordReseting({\n                                                    password: \&quot;Raw@1234\&quot;,\n                                                    password_confirmation: \&quot;Raw@1234\&quot;,\n                                                    captcha_code: captchaCode,\n                                                    httpStatus: httpStatus.BAD_REQUEST\n                                                }, function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        res.body.error.message.should.equal(messageList.PASSWORD_REPEAT_ERROR);\n                                                        done();\n                                                    }\n                                                });\n                                            } else {\n                                                true.should.equal(false);\n                                            }\n                                        }\n                                    });\n                                } else {\n                                    true.should.equal(false);\n                                }\n                            }\n                        });\n                    } else {\n                        true.should.equal(false);\n                    }\n                }\n            });\n        } else {\n            true.should.equal(false);\n        }\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;928daa94-1fc2-4d2e-8713-ad7efc564dad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to use first password on sixth time password reseting.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should allowed to use first password on sixth time password reseting.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1458,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12341\&quot;,\n    password_confirmation: \&quot;Raw@12341\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.OK\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n            passwordReseting({\n                password: \&quot;Raw@12342\&quot;,\n                password_confirmation: \&quot;Raw@12342\&quot;,\n                captcha_code: captchaCode,\n                httpStatus: httpStatus.OK\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                        passwordReseting({\n                            password: \&quot;Raw@12343\&quot;,\n                            password_confirmation: \&quot;Raw@12343\&quot;,\n                            captcha_code: captchaCode,\n                            httpStatus: httpStatus.OK\n                        }, function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                                    passwordReseting({\n                                        password: \&quot;Raw@12344\&quot;,\n                                        password_confirmation: \&quot;Raw@12344\&quot;,\n                                        captcha_code: captchaCode,\n                                        httpStatus: httpStatus.OK\n                                    }, function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                                                passwordReseting({\n                                                    password: \&quot;Raw@12345\&quot;,\n                                                    password_confirmation: \&quot;Raw@12345\&quot;,\n                                                    captcha_code: captchaCode,\n                                                    httpStatus: httpStatus.OK\n                                                }, function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                                                            passwordReseting({\n                                                                password: \&quot;Raw@1234\&quot;,\n                                                                password_confirmation: \&quot;Raw@1234\&quot;,\n                                                                captcha_code: captchaCode,\n                                                                httpStatus: httpStatus.OK\n                                                            }, function(err, res) {\n                                                                if (err) {\n                                                                    done(err);\n                                                                } else {\n                                                                    res.body.output.message.should.equal(messageList.USER_RESET_PASS_SUCCESSFULLY);\n                                                                    done();\n                                                                }\n                                                            });\n                                                        } else {\n                                                            true.should.equal(false);\n                                                        }\n                                                    }\n                                                });\n                                            } else {\n                                                true.should.equal(false);\n                                            }\n                                        }\n                                    });\n                                } else {\n                                    true.should.equal(false);\n                                }\n                            }\n                        });\n                    } else {\n                        true.should.equal(false);\n                    }\n                }\n            });\n        } else {\n            true.should.equal(false);\n        }\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;660e5939-6ad3-4d90-8804-12f4e5a376e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as password is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give error as password is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.password.message.should.equal(messageList.USER_REG_INVALID_PASSWORD);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;826cf778-cc16-41e9-9ab2-9bacbd74ce91&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as request toke is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give error as request toke is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12345\&quot;,\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    captcha_code: captchaCode,\n    token: \&quot;\&quot;,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.token.message.should.equal(messageList.USER_RESET_PASS_TOKEN_MUST_NOT_BE_EMPTY);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f005c542-3e41-4617-ab4e-258d4661b7e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid forgot password token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give error as invalid forgot password token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:241,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12345\&quot;,\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    captcha_code: captchaCode,\n    token: \&quot;FAKE\&quot;,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.message.should.equal(messageList.USER_INVALID_RESET_PASS_TOKEN);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc3bc5fe-db64-4bc9-a4f3-0a1dd16f551f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as password and confirm password are not equal.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give error as password and confirm password are not equal.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:72,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12345\&quot;,\n    password_confirmation: \&quot;Raw@12346\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.password_confirmation.message.should.equal(messageList.USER_REG_MATCHED_CONFIRM_PASSWORD);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;370bbbd6-f07c-49eb-af35-5622ced92998&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give captcha verification fail error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give captcha verification fail error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12345\&quot;,\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.message.should.equal(messageList.CAPTCHA_VERIFICATION_FAIL);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;566c4a94-6a46-423c-b1c1-50638d05a54a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6d528ad8-8747-4781-bfdf-154d27a25139&quot;,&quot;e71e3428-2018-4889-b2eb-87acc08a773c&quot;,&quot;fe0ae3eb-e507-483f-80b0-6072627ae353&quot;,&quot;d1548b9c-c097-4c32-9588-aa895ba95c3b&quot;,&quot;708ca81c-29ac-41b2-9c8e-a16dd1139812&quot;,&quot;098ea8d1-084d-44a5-afb6-a3e01d823c69&quot;,&quot;928daa94-1fc2-4d2e-8713-ad7efc564dad&quot;,&quot;660e5939-6ad3-4d90-8804-12f4e5a376e0&quot;,&quot;826cf778-cc16-41e9-9ab2-9bacbd74ce91&quot;,&quot;f005c542-3e41-4617-ab4e-258d4661b7e4&quot;,&quot;cc3bc5fe-db64-4bc9-a4f3-0a1dd16f551f&quot;,&quot;370bbbd6-f07c-49eb-af35-5622ced92998&quot;,&quot;566c4a94-6a46-423c-b1c1-50638d05a54a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4301,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f3f29f51-88f0-414f-b329-ea8924a9e53d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9c9858ad-98e1-44d5-916e-1187dff2f5d7&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;465a53cc-911d-4ac8-bd2e-9632eca75568&quot;,&quot;title&quot;:&quot;User.saveMetadata&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.saveMetadata \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:257,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cef9a6c7-816c-49b0-a515-77781321c2ca&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.saveMetadata \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3cb9db9-dbad-4be1-9238-83f69fdea750&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update new password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.saveMetadata Should update new password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserBody = {};\ntempUserBody.metadata = {\n    \&quot;name\&quot;: \&quot;demo\&quot;\n};\napi.put(apiURL)\n    .send(tempUserBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                res.body.output.metadata.name == \&quot;demo\&quot; &amp;&amp;\n                res.body.output.first_name == registrationBody.first_name;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7d190cd-2792-4421-83c5-d5d4d3e39f26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as metadata is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.saveMetadata Should give error as metadata is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserBody = {};\napi.put(apiURL)\n    .send(tempUserBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.metadata.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2fb6a14e-ca8d-41bf-9b7c-3f9d6e914daf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.saveMetadata Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserBody = {};\ntempUserBody.metadata = {\n    \&quot;name\&quot;: \&quot;demo\&quot;\n};\napi.put(apiURL)\n    .send(tempUserBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a7bf7de-b5cf-42c5-8ed3-61248e8da143&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a7d190cd-2792-4421-83c5-d5d4d3e39f26&quot;,&quot;2fb6a14e-ca8d-41bf-9b7c-3f9d6e914daf&quot;,&quot;4a7bf7de-b5cf-42c5-8ed3-61248e8da143&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:115,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;12ebb38b-3e1e-4c76-aa10-477ea823df29&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;05121893-6fc6-4dbc-aa3a-6cc1a4525d93&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b8872ed1-4600-49e6-b765-11560261d765&quot;,&quot;title&quot;:&quot;User.SaveProfile&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:240,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;921bf411-95bd-4f94-8eff-254180d1ec29&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;271fc25e-df30-4fbe-9ef3-371e5ec17256&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update first_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update first_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.first_name = \&quot;amber 1\&quot;;\ntempRegistrationBody.last_name = \&quot;More\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.first_name == tempRegistrationBody.first_name &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;496b1fc9-2439-4152-9459-28585fa0519b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give first_name required error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give first_name required error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.first_name;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.first_name.message == messageList.USER_PROFILE_FIRST_NAME_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;edc9195e-6b3e-442e-8c02-d487384bb5cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give first_name required error for empty spaces first_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give first_name required error for empty spaces first_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.first_name = \&quot;   \&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.first_name.message == messageList.USER_PROFILE_FIRST_NAME_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e41407a-3ae8-43bb-b60a-0a88664dee0e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update last_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update last_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.last_name = \&quot;more 1\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.last_name == tempRegistrationBody.last_name &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a1ce75d-0d82-4806-80d1-147074a8f6d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.last_name = \&quot;more 1\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.user_plan) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;749831af-156a-463f-b43c-fb180d932e40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give last_name required error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give last_name required error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.last_name;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.last_name.message == messageList.USER_PROFILE_LAST_NAME_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9057da5-8519-402f-8081-7cd13f3a8ebf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give last_name required error for empty spaces last_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give last_name required error for empty spaces last_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.last_name = \&quot;  \&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.last_name.message == messageList.USER_PROFILE_LAST_NAME_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a6fe2f3-6096-43f7-85d8-d08931dd1422&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update company.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update company.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.company = \&quot;built.io 1\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.company == tempRegistrationBody.company &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3648a15-8a21-4eef-90d1-9967e97f971e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update empty company.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update empty company.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:72,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.company = \&quot;\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.company == tempRegistrationBody.company &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4880b12b-fb91-4961-84ef-fb78654117e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update empty job_title.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update empty job_title.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.job_title = \&quot;\&quot;; //None 1\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.job_title == tempRegistrationBody.job_title &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2cf73e7c-b151-4aba-bebd-fcf0fc15c186&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update locale.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update locale.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.locale = \&quot;en-uk\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.locale == tempRegistrationBody.locale &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9cce3fd9-ae91-4b89-b148-95eec50783db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:524,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\ntempRegistrationBody.password = \&quot;raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;raw@1235\&quot;;\ntempRegistrationBody.first_name = \&quot;Amber\&quot;;\ntempRegistrationBody.last_name = \&quot;More\&quot;;\nutils.encryptPassword(tempRegistrationBody.password).then(function(newPassHashed) {\n    api.put(apiURL)\n        .send(tempRegistrationBody)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                if (isValid) {\n                    _models.User.findOne({ uid: res.body.output.uid }, function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else if (user) {\n                            (user.password == newPassHashed).should.equal(true);\n                            done();\n                        } else {\n                            false.should.equal(true);\n                            done();\n                        }\n                    });\n                } else {\n                    isValid.should.equal(true);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe152efc-cefd-4049-86c7-7e60bc4f47e2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error for using same password while updating password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give error for using same password while updating password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\ntempRegistrationBody.password = \&quot;Raw@1234\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_CHANGE_PASS_OLD_PASS_PASS_NOT_BE_SAME);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb422aa3-4f2e-4c34-a1db-a27c29ea759c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to use first password on fifth time while updating password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should not allowed to use first password on fifth time while updating password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1831,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\ntempRegistrationBody.password = \&quot;Raw@1241\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1241\&quot;;\ntempRegistrationBody.first_name = \&quot;Amber\&quot;;\ntempRegistrationBody.last_name = \&quot;More\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            tempRegistrationBody.oldpassword = \&quot;Raw@1241\&quot;;\n            tempRegistrationBody.password = \&quot;Raw@1242\&quot;;\n            tempRegistrationBody.password_confirmation = \&quot;Raw@1242\&quot;;\n            api.put(apiURL)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        tempRegistrationBody.oldpassword = \&quot;Raw@1242\&quot;;\n                        tempRegistrationBody.password = \&quot;Raw@1243\&quot;;\n                        tempRegistrationBody.password_confirmation = \&quot;Raw@1243\&quot;;\n                        api.put(apiURL)\n                            .send(tempRegistrationBody)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    tempRegistrationBody.oldpassword = \&quot;Raw@1243\&quot;;\n                                    tempRegistrationBody.password = \&quot;Raw@1244\&quot;;\n                                    tempRegistrationBody.password_confirmation = \&quot;Raw@1244\&quot;;\n                                    api.put(apiURL)\n                                        .send(tempRegistrationBody)\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                tempRegistrationBody.oldpassword = \&quot;Raw@1244\&quot;;\n                                                tempRegistrationBody.password = \&quot;Raw@1234\&quot;;\n                                                tempRegistrationBody.password_confirmation = \&quot;Raw@1234\&quot;;\n                                                api.put(apiURL)\n                                                    .send(tempRegistrationBody)\n                                                    .set(&#x27;authtoken&#x27;, authToken)\n                                                    .expect(httpStatus.BAD_REQUEST)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            res.body.error.message.should.equal(messageList.PASSWORD_REPEAT_ERROR);\n                                                            done();\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4181bd37-24c8-4885-be0c-22f6bbf14881&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to use first password on sixth time password reseting.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should allowed to use first password on sixth time password reseting.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2589,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\ntempRegistrationBody.password = \&quot;Raw@1241\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1241\&quot;;\ntempRegistrationBody.first_name = \&quot;Amber\&quot;;\ntempRegistrationBody.last_name = \&quot;More\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            tempRegistrationBody.oldpassword = \&quot;Raw@1241\&quot;;\n            tempRegistrationBody.password = \&quot;Raw@1242\&quot;;\n            tempRegistrationBody.password_confirmation = \&quot;Raw@1242\&quot;;\n            api.put(apiURL)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        tempRegistrationBody.oldpassword = \&quot;Raw@1242\&quot;;\n                        tempRegistrationBody.password = \&quot;Raw@1243\&quot;;\n                        tempRegistrationBody.password_confirmation = \&quot;Raw@1243\&quot;;\n                        api.put(apiURL)\n                            .send(tempRegistrationBody)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    tempRegistrationBody.oldpassword = \&quot;Raw@1243\&quot;;\n                                    tempRegistrationBody.password = \&quot;Raw@1244\&quot;;\n                                    tempRegistrationBody.password_confirmation = \&quot;Raw@1244\&quot;;\n                                    api.put(apiURL)\n                                        .send(tempRegistrationBody)\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                tempRegistrationBody.oldpassword = \&quot;Raw@1244\&quot;;\n                                                tempRegistrationBody.password = \&quot;Raw@1245\&quot;;\n                                                tempRegistrationBody.password_confirmation = \&quot;Raw@1245\&quot;;\n                                                api.put(apiURL)\n                                                    .send(tempRegistrationBody)\n                                                    .set(&#x27;authtoken&#x27;, authToken)\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            tempRegistrationBody.oldpassword = \&quot;Raw@1245\&quot;;\n                                                            tempRegistrationBody.password = \&quot;Raw@1234\&quot;;\n                                                            tempRegistrationBody.password_confirmation = \&quot;Raw@1234\&quot;;\n                                                            utils.encryptPassword(\&quot;Raw@1234\&quot;).then(function(newPassHashed) {\n                                                                api.put(apiURL)\n                                                                    .send(tempRegistrationBody)\n                                                                    .set(&#x27;authtoken&#x27;, authToken)\n                                                                    .expect(httpStatus.OK)\n                                                                    .end(function(err, res) {\n                                                                        var isValid = typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                                                        if (isValid) {\n                                                                            _models.User.findOne({ uid: res.body.output.uid }, function(error, user) {\n                                                                                if (error) {\n                                                                                    done(error);\n                                                                                } else if (user) {\n                                                                                    (user.password == newPassHashed).should.equal(true);\n                                                                                    done();\n                                                                                } else {\n                                                                                    false.should.equal(true);\n                                                                                    done();\n                                                                                }\n                                                                            });\n                                                                        } else {\n                                                                            isValid.should.equal(true);\n                                                                            done();\n                                                                        }\n                                                                    });\n                                                            });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce8d3fda-970e-4d40-9c7a-e980068fda73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to update password, as old incorrect password provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should not allowed to update password, as old incorrect password provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:354,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.oldpassword = \&quot;Raw@123\&quot;;\ntempRegistrationBody.password = \&quot;raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_PROFILE_OLD_PASS_INCORRECT);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f76b9456-6b26-4cda-81f0-3ec436e82463&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to update password, as old and new password same.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should not allowed to update password, as old and new password same.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.oldpassword = tempRegistrationBody.password;\ntempRegistrationBody.password_confirmation = tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_CHANGE_PASS_OLD_PASS_PASS_NOT_BE_SAME);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef21fc13-4e7e-46b3-abf0-cac5cffac443&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update password for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update password for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:524,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.oldpassword = tempRegistrationBody.password;\ntempRegistrationBody.password = \&quot;raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = tempRegistrationBody.password;\nutils.encryptPassword(tempRegistrationBody.password).then(function(newPassHashed) {\n    api.put(apiURL)\n        .send(tempRegistrationBody)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                if (isValid) {\n                    _models.User.findOne({ uid: res.body.output.uid }, function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else if (user) {\n                            (user.password == newPassHashed).should.equal(true);\n                            done();\n                        } else {\n                            false.should.equal(true);\n                            done();\n                        }\n                    });\n                } else {\n                    isValid.should.equal(true);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b659809-69d6-441c-9a8e-d4daff7d90bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should save phone number with profile.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should save phone number with profile.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.phone = \&quot;9619982150\&quot;;\n//tempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.phone == tempRegistrationBody.phone &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;71e1f225-2fbf-4b49-acc0-dc42b2b1f292&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should register phone number with authy.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should register phone number with authy.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = tempRegistrationBody.authy_number == tempRegistrationBody.authy_number &amp;&amp;\n                res.body.output.enable_twofa == \&quot;enable\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dcb3ddc5-3efb-4a48-a91e-7f036a39bef6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should de-register and then register same phone number with authy.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should de-register and then register same phone number with authy.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:173,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var oldAuthyUserID = res.body.output.authy_user_uid;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(apiURL)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid =\n                            res.body.output.authy_user_uid == oldAuthyUserID &amp;&amp;\n                            (res.body.output.authy_user_uid || \&quot;\&quot;) != \&quot;\&quot; &amp;&amp;\n                            (oldAuthyUserID || \&quot;\&quot;) != \&quot;\&quot; &amp;&amp;\n                            res.body.output.enable_twofa == \&quot;enable\&quot; &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a94866d0-ddc0-48e8-810b-a33eaca14adf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;496b1fc9-2439-4152-9459-28585fa0519b&quot;,&quot;edc9195e-6b3e-442e-8c02-d487384bb5cf&quot;,&quot;5e41407a-3ae8-43bb-b60a-0a88664dee0e&quot;,&quot;3a1ce75d-0d82-4806-80d1-147074a8f6d5&quot;,&quot;749831af-156a-463f-b43c-fb180d932e40&quot;,&quot;c9057da5-8519-402f-8081-7cd13f3a8ebf&quot;,&quot;1a6fe2f3-6096-43f7-85d8-d08931dd1422&quot;,&quot;d3648a15-8a21-4eef-90d1-9967e97f971e&quot;,&quot;4880b12b-fb91-4961-84ef-fb78654117e7&quot;,&quot;2cf73e7c-b151-4aba-bebd-fcf0fc15c186&quot;,&quot;9cce3fd9-ae91-4b89-b148-95eec50783db&quot;,&quot;fe152efc-cefd-4049-86c7-7e60bc4f47e2&quot;,&quot;cb422aa3-4f2e-4c34-a1db-a27c29ea759c&quot;,&quot;4181bd37-24c8-4885-be0c-22f6bbf14881&quot;,&quot;ce8d3fda-970e-4d40-9c7a-e980068fda73&quot;,&quot;f76b9456-6b26-4cda-81f0-3ec436e82463&quot;,&quot;ef21fc13-4e7e-46b3-abf0-cac5cffac443&quot;,&quot;0b659809-69d6-441c-9a8e-d4daff7d90bc&quot;,&quot;71e1f225-2fbf-4b49-acc0-dc42b2b1f292&quot;,&quot;dcb3ddc5-3efb-4a48-a91e-7f036a39bef6&quot;,&quot;a94866d0-ddc0-48e8-810b-a33eaca14adf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:6991,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;60da0159-3957-4f20-aea0-0f834258af20&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a7f93309-9cb8-4997-ba18-81a5fbffe350&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7f078033-22fe-4713-bc90-39fac2fed05b&quot;,&quot;title&quot;:&quot;User.search&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.search \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:622,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function(error, output) {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                user_uid = res.body.output.uid;\n                email = res.body.output.email;\n                saveUserFlows({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                }, function(error, flows) {\n                    saveBillEntries({\n                        authtoken: authToken,\n                        user_uid: user_uid,\n                        flow_uid: flows[0].uid\n                    }, function(error, billEntries) {\n                        saveTemplateEntries({\n                            authtoken: authToken,\n                            user_uid: user_uid\n                        }, function(error, billEntries) {\n                            done();\n                        });\n                    });\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c42f4b18-b367-46ac-804b-5fef4c1a726c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.search \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;removeRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;668910cc-aa66-46aa-808a-7c27cbb13990&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.search \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19e23251-25d7-4028-8e03-4f84b7c2ee2e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should search within user&#x27;s flows and templates.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.search Should search within user&#x27;s flows and templates.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL + \&quot;?search=UNIT_TEST_1\&quot;;\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c2ff51b1-0138-4fe1-a36e-2f770fb1812c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.search Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL + \&quot;?search=UNIT_TEST_1\&quot;;\napi.get(paramURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f1c933f-d17f-4169-8438-b5e750a63801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c2ff51b1-0138-4fe1-a36e-2f770fb1812c&quot;,&quot;4f1c933f-d17f-4169-8438-b5e750a63801&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:66,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8cfd1046-5961-4914-8845-bd3392ea7c59&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0eb57cac-e0b6-4897-9abc-45df865ed1b3&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;969c3937-6823-4534-b713-5c88a158166a&quot;,&quot;title&quot;:&quot;User.sendLeadActivityLog&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        userPlan = data.owner.user_plan;\n        adminUser = data.admin;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;229594c2-4573-4ca7-86aa-5e787288b2b8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f19f63a4-148a-4b9b-8157-81a3397d9185&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should log leads activity.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog Should log leads activity.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n        \&quot;email\&quot;: adminUser.email\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.LEAD_ACTIVITY_LOGGED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0149dbdc-991f-4a6c-a72b-27f8d7ec05ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should log leads activity for second time.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog Should log leads activity for second time.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n        \&quot;email\&quot;: adminUser.email\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.LEAD_ACTIVITY_LOGGED) {\n                commonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send({\n                        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n                        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n                        \&quot;email\&quot;: adminUser.email\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.message.should.equal(messageList.LEAD_ACTIVITY_LOGGED);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;053c6fe6-dbe6-4aa0-9083-6d8efbdc8810&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should log leads activity with organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog Should log leads activity with organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n        \&quot;email\&quot;: adminUser.email\n    })\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.LEAD_ACTIVITY_LOGGED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7abaeab-369b-4c93-a18b-9005a0cde7a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should log leads activity with organization for second time.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog Should log leads activity with organization for second time.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n        \&quot;email\&quot;: adminUser.email\n    })\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.LEAD_ACTIVITY_LOGGED) {\n                commonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send({\n                        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n                        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n                        \&quot;email\&quot;: adminUser.email\n                    })\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.message.should.equal(messageList.LEAD_ACTIVITY_LOGGED);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b31042b4-da0b-4b07-b5ce-c3608d9d348f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0149dbdc-991f-4a6c-a72b-27f8d7ec05ad&quot;,&quot;053c6fe6-dbe6-4aa0-9083-6d8efbdc8810&quot;,&quot;e7abaeab-369b-4c93-a18b-9005a0cde7a5&quot;,&quot;b31042b4-da0b-4b07-b5ce-c3608d9d348f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:124,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;070be39e-ca33-4316-b18f-758e38a72d54&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c1a37267-84af-4230-bcad-9d70ee31a102&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;05cdfbcf-066b-4bac-a13f-ade7d574cb07&quot;,&quot;title&quot;:&quot;User.updateActivationExpired&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateActivationExpired \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:242,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6cc6773-fd19-488a-9f1c-34ad70a85681&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateActivationExpired \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;516ca298-8f64-4b13-ab66-6d63fbbaf752&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should expire account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateActivationExpired Should expire account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.activation_expired.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;770290f8-451b-423f-bcdf-5ce8e69a7e2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateActivationExpired Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3c3e34b8-07f9-41be-a940-41c33ef9df5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;770290f8-451b-423f-bcdf-5ce8e69a7e2c&quot;,&quot;3c3e34b8-07f9-41be-a940-41c33ef9df5c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:48,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c3131508-c732-4a51-96f6-08b6df197be0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5b1a14bd-02bc-4067-a76b-451af902ecc4&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f601580f-2e97-4a43-a52e-3999234159b0&quot;,&quot;title&quot;:&quot;User.updateAutoRefresh&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:434,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f704f6f-6902-40d0-89dd-902a5639e1ea&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f7a172b5-b35b-4a15-aa3d-fe8b1327aa8b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update auto_refresh to true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh Should update auto_refresh to true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .send({\n        auto_refresh: true\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.auto_refresh.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0bb03fc5-79ae-4e1a-9960-8183e9cc6268&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update auto_refresh to true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh Should update auto_refresh to true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .send({\n        auto_refresh: \&quot;true1\&quot;\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.auto_refresh.message.should.equal(messageList.AUTO_REFRESH_SHOULD_BE_BOOLEAN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76e066b6-98c6-42df-a22a-13044fb59304&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error for invalid auto_refresh flag in old api.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh Should give error for invalid auto_refresh flag in old api.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/autorefresh\&quot;)\n    .send({\n        data: \&quot;true1\&quot;\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .set(&#x27;driver&#x27;, \&quot;enterprise\&quot;)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.data.message.should.equal(messageList.AUTO_REFRESH_SHOULD_BE_BOOLEAN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9fa4683f-860b-47b2-bd8c-820aaa814388&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .send({\n        auto_refresh: true\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;797fcb20-e14e-49fe-b971-8392e6aff6be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0bb03fc5-79ae-4e1a-9960-8183e9cc6268&quot;,&quot;76e066b6-98c6-42df-a22a-13044fb59304&quot;,&quot;9fa4683f-860b-47b2-bd8c-820aaa814388&quot;,&quot;797fcb20-e14e-49fe-b971-8392e6aff6be&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:118,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3401dd76-ba2b-4290-a778-64be43038f48&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;055d1412-5504-4228-a5e6-2007b36ce588&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fa4e7319-2d9e-4e99-b419-a411a3c19c01&quot;,&quot;title&quot;:&quot;User.updateAvatar&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:252,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    user_uid = res.body.output.uid;\n                    _id = res.body.output._id;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef0f4a3f-f2f8-48cd-a142-2287a1bb52c2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dfe218aa-a180-4ac4-8e82-97697a77d21e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update avatar.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar Should update avatar.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.myCroppedImage = \&quot;/img/user-img2.png\&quot;;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, tempRegistrationBody.myCroppedImage);\n};\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.avatar.should.equal(tempRegistrationBody.myCroppedImage);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c764326c-aad3-4502-a02a-7e40367b5747&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update avatar twice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar Should update avatar twice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.myCroppedImage = \&quot;/img/user-img2.png\&quot;;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, tempRegistrationBody.myCroppedImage);\n};\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var temp2RegistrationBody = global.getImmutable(registrationBody);\n            temp2RegistrationBody.myCroppedImage = \&quot;/img/user-img3.png\&quot;;\n            server.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n                callback(null, temp2RegistrationBody.myCroppedImage);\n            };\n            api.put(apiURL)\n                .send(temp2RegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.avatar.should.equal(temp2RegistrationBody.myCroppedImage);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd870994-2bc2-4532-8998-a87fedd9ebdd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update avatar trice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar Should update avatar trice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:127,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.myCroppedImage = \&quot;/img/user-img2.png\&quot;;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, tempRegistrationBody.myCroppedImage);\n};\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var temp2RegistrationBody = global.getImmutable(registrationBody);\n            temp2RegistrationBody.myCroppedImage = \&quot;/img/user-img3.png\&quot;;\n            server.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n                callback(null, temp2RegistrationBody.myCroppedImage);\n            };\n            api.put(apiURL)\n                .send(temp2RegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var temp3RegistrationBody = global.getImmutable(registrationBody);\n                        temp3RegistrationBody.myCroppedImage = \&quot;/img/user-img4.png\&quot;;\n                        server.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n                            callback(null, temp3RegistrationBody.myCroppedImage);\n                        };\n                        api.put(apiURL)\n                            .send(temp3RegistrationBody)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.avatar.should.equal(temp3RegistrationBody.myCroppedImage);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b430bbf6-d4e1-496e-8639-969411ac239b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.myCroppedImage = \&quot;/img/user-img2.png\&quot;;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, tempRegistrationBody.myCroppedImage);\n};\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9ca5f4f0-f864-4b94-8eaf-fde6809a944b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should able to remove avatar.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar Should able to remove avatar.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar defaultImage = \&quot;https://example.com/region/fl0e7d7815746566ce65a2ae?v=f0491af1-cdf3-11e8-a60a-f340282cec93\&quot;;\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.avatar = null;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, defaultImage);\n};\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.avatar.should.equal(defaultImage);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6da03ea1-2dcd-4643-b0b0-9e7358673c18&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c764326c-aad3-4502-a02a-7e40367b5747&quot;,&quot;dd870994-2bc2-4532-8998-a87fedd9ebdd&quot;,&quot;b430bbf6-d4e1-496e-8639-969411ac239b&quot;,&quot;9ca5f4f0-f864-4b94-8eaf-fde6809a944b&quot;,&quot;6da03ea1-2dcd-4643-b0b0-9e7358673c18&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:322,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2ad45c19-d80b-49d0-a84f-e86f406231c5&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateCanvasTourUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateCanvasTourUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b0454eca-c9c9-4f57-b0ac-cfbac361872f&quot;,&quot;title&quot;:&quot;User.updateCanvasTour&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateCanvasTourUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateCanvasTourUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.updateCanvasTour \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:239,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30a0a591-7ca7-4078-ba5c-8f44f8f2b8b2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.updateCanvasTour \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d461023-9573-418d-9d1c-5e900492108b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.updateCanvasTour Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;319df35e-7869-4c9e-b1a1-702cd38cb0d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set \&quot;canvas_first_tour\&quot; to true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.updateCanvasTour Should set \&quot;canvas_first_tour\&quot; to true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.canvas_first_tour;\n            isValid = isValid &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e514a6aa-0231-4e7f-bd59-50e6563776d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;319df35e-7869-4c9e-b1a1-702cd38cb0d3&quot;,&quot;e514a6aa-0231-4e7f-bd59-50e6563776d0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:53,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e819a55c-3a8d-4870-9781-372d2f3b9d3b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3493cd86-25d9-49e5-9a61-f6b215e1d465&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;06fb08dc-c7f0-4225-8aa4-8880cc7f598f&quot;,&quot;title&quot;:&quot;User.updateLastSeen&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateLastSeen \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:229,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13a6f363-f8da-430f-9abf-e8fbfdf7caab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateLastSeen \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a068ae30-4141-4d58-a433-11d4796abeb9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update when last announcements seen.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateLastSeen Should update when last announcements seen.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar dt = (new Date()).toISOString();\napi.post(apiURL)\n    .send({\n        timestamp: dt\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.last_product_announcement_seen.should.equal(dt);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73544497-3dac-4042-b1ab-9725e172e621&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateLastSeen Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        auto_refresh: true\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a1d4c2b-0d2a-4dd3-a270-5f78dc2ac559&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;73544497-3dac-4042-b1ab-9725e172e621&quot;,&quot;7a1d4c2b-0d2a-4dd3-a270-5f78dc2ac559&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:78,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9092b315-f945-4ed2-88ca-15281ac92d5a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1a61e22a-ef10-42c8-9116-35e071cc6d5b&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;422c20fa-c410-4c03-be37-8e5ee6ced532&quot;,&quot;title&quot;:&quot;User.validateToken&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.validateToken \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:235,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        activationToken = res.body.output.activation_token;\n                        user_uid = res.body.output.uid;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76188be8-f967-4d20-b38d-cb8b2365c58f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.validateToken \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;90255ba0-da93-4e6a-b2d2-ef201a715212&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should validate valid reset password token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.validateToken Should validate valid reset password token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/activate\&quot;)\n    .send({\n        user_uid: user_uid,\n        token: activationToken\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/forgotpassword\&quot;)\n                .send({\n                    email: registrationBody.email,\n                    captcha_code: captchaCode\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var options = {\n                                        \&quot;token\&quot;: res.body.output.password_token || \&quot;\&quot;\n                                    };\n                                    api.post(apiURL.replace(\&quot;:token_type\&quot;, \&quot;resetpassword\&quot;))\n                                        .send(options)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.output.message.should.equal(messageList.VALID_RESET_PASSWORD_TOKEN);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56ede563-e3e8-40f7-a366-2308a8f6de3c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid reset password token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.validateToken Should give error as invalid reset password token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:263,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/activate\&quot;)\n    .send({\n        user_uid: user_uid,\n        token: activationToken\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/forgotpassword\&quot;)\n                .send({\n                    email: registrationBody.email,\n                    captcha_code: captchaCode\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var options = {\n                                        password: \&quot;Raw@12345\&quot;,\n                                        password_confirmation: \&quot;Raw@12345\&quot;,\n                                        captcha_code: captchaCode,\n                                        token: res.body.output.password_token || \&quot;\&quot;\n                                    };\n                                    commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/resetpassword\&quot;)\n                                        .send(options)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                api.post(apiURL.replace(\&quot;:token_type\&quot;, \&quot;resetpassword\&quot;))\n                                                    .send({\n                                                        token: options.token || \&quot;\&quot;\n                                                    })\n                                                    .expect(httpStatus.BAD_REQUEST)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            res.body.error.message.should.equal(messageList.INVALID_RESET_PASSWORD_TOKEN);\n                                                            done();\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fdf55ba9-dfaa-4c2c-9cd1-82a5302ad929&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid token type.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.validateToken Should give error as invalid token type.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:token_type\&quot;, \&quot;FAKE\&quot;))\n    .send({\n        token: \&quot;FAKE\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.INVALID_TOKEN_TYPE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ff37c63-fb91-46a3-bd19-9d0f4bb51c1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;56ede563-e3e8-40f7-a366-2308a8f6de3c&quot;,&quot;fdf55ba9-dfaa-4c2c-9cd1-82a5302ad929&quot;,&quot;5ff37c63-fb91-46a3-bd19-9d0f4bb51c1b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:366,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bcb6ec15-200e-45ef-b714-c3e5af267c2f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;962a59f6-7fcc-497d-90d9-f6d298d4aa05&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7acb2f60-f82d-4cfc-8f23-b87b2a4def6f&quot;,&quot;title&quot;:&quot;User.verifyAuthy&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:471,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ deleted_at: null }, function(error, user) {\n    _models.Mail.remove({ deleted_at: null }, function(error, user) {\n        _models.Authy.remove({ deleted_at: null }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        var tempRegistrationBody = global.getImmutable(registrationBody);\n                        tempRegistrationBody.email = secondUserEmail;\n                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                            email: tempRegistrationBody.email\n                        });\n                        api.post(\&quot;/enterprise/v1/signup\&quot;)\n                            .send(tempRegistrationBody)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    secondAuthToken = res.body.output.authtoken;\n                                    secondId = res.body.output._id;\n                                    done();\n                                }\n                            });\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a493075-0898-4224-8166-113ec42164b7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0be70526-6f18-43fa-a1c8-58790d0bf70d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:235,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    _models.User.findOne({\n                                        authy_user_uid: authy_userId\n                                    }, function(error, user) {\n                                        var authtoken = [\&quot;\&quot;].concat(user.authtoken);\n                                        _models.User.findOneAndUpdate({\n                                            uid: user.uid\n                                        }, {\n                                            authtoken: authtoken\n                                        }, {\n                                            new: true\n                                        }, function(error, user) {\n                                            api.post(apiURL)\n                                                .send({\n                                                    authy_user_uid: authy_userId,\n                                                    token: otpBody.token\n                                                })\n                                                .set(&#x27;authtoken&#x27;, authToken)\n                                                .expect(httpStatus.OK)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        var isValid = res.body.output.is_twofa_sms_enabled.should &amp;&amp;\n                                                            typeof(res.body.output.plan[0]._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(res.body.output.plan[0].__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                            res.body.output.authtoken != \&quot;\&quot;;\n                                                        if (isValid) {\n                                                            _.each(res.body.output.plan[0].features, function(item) {\n                                                                isValid = isValid &amp;&amp;\n                                                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                                                            });\n                                                        }\n                                                        isValid.should.equal(true);\n                                                        done();\n                                                    }\n                                                });\n                                        });\n                                    });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e37a2355-c722-41c9-a489-dd099fcae62f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should verify OTP for user in 2FA disable enterprise user exist.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should verify OTP for user in 2FA disable enterprise user exist.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:559,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: registrationBody.email\n});\n\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: registrationBody.email,\n        \&quot;password\&quot;: registrationBody.password,\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var enterpriseAuthToken = res.body.output.authtoken;\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, enterpriseAuthToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n                        commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n                        api.put(\&quot;/enterprise/v1/user\&quot;)\n                            .send(tempRegistrationBody)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var authy_userId = res.body.output.authy_user_uid;\n                                    commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                                        .send({\n                                            authy_id: authy_userId\n                                        })\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                                api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                                    .send({\n                                                        authy_user_uid: authy_userId,\n                                                        token: otpBody.token,\n                                                        option_selected: \&quot;otp\&quot;\n                                                    })\n                                                    .set(&#x27;authtoken&#x27;, authToken)\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                                            api.post(apiURL)\n                                                                .send({\n                                                                    authy_user_uid: authy_userId,\n                                                                    token: otpBody.token\n                                                                })\n                                                                .set(&#x27;authtoken&#x27;, authToken)\n                                                                .expect(httpStatus.OK)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        var isValid = res.body.output.is_twofa_sms_enabled.should &amp;&amp;\n                                                                            typeof(res.body.output.plan[0]._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                            typeof(res.body.output.plan[0].__v) == \&quot;undefined\&quot;;\n                                                                        if (isValid) {\n                                                                            _.each(res.body.output.plan[0].features, function(item) {\n                                                                                isValid = isValid &amp;&amp;\n                                                                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                                                                            });\n                                                                        }\n                                                                        isValid.should.equal(true);\n                                                                        done();\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13610af3-774e-4207-9fc6-4250e9599649&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should get default plan for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:219,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = false;\n                                                if (res.body.output.plan.length == 1) {\n                                                    var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                        //return (plan || {}).enterprise_plan || false;\n                                                        return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                    })) || {};\n                                                    defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                    isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                }\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b070617f-b8e4-4e17-be26-16d42623466f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should get default attributes for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:218,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = false;\n                                                if (res.body.output.plan.length == 1) {\n                                                    isValid = utils.isHaveKeyVals(res.body.output, [\n                                                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                        ]) &amp;&amp;\n                                                        res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                }\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00e7a9f7-66a7-410c-99a2-1cde446a1ee7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as authy need to verified before using twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should give error as authy need to verified before using twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:160,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.BAD_REQUEST)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.NEED_TO_VERIFY_2FA);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b33b792-c49c-4827-a527-1b773968cc22&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should reset login fail count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should reset login fail count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:263,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n_models.User.findOneAndUpdate({ uid: uid }, { failed_login_count: 0 }, function(error, user) {\n    api.put(\&quot;/enterprise/v1/user\&quot;)\n        .send(tempRegistrationBody)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var authy_userId = res.body.output.authy_user_uid;\n                commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                    .send({\n                        authy_id: authy_userId\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                            api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                .send({\n                                    authy_user_uid: authy_userId,\n                                    token: otpBody.token,\n                                    option_selected: \&quot;otp\&quot;\n                                })\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                        api.post(apiURL)\n                                            .send({\n                                                authy_user_uid: authy_userId,\n                                                token: otpBody.token\n                                            })\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = res.body.output.is_twofa_sms_enabled &amp;&amp;\n                                                        res.body.output.failed_login_count == 0 &amp;&amp;\n                                                        typeof(res.body.output.plan[0]._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(res.body.output.plan[0].__v) == \&quot;undefined\&quot;;\n                                                    if (isValid) {\n                                                        _.each(res.body.output.plan[0].features, function(item) {\n                                                            isValid = isValid &amp;&amp;\n                                                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                typeof(item.__v) == \&quot;undefined\&quot;;\n                                                        });\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;183596c3-d451-403c-bdd0-54b38b95eebc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should verify authy, by email and token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should verify authy, by email and token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:230,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ntempRegistrationBody.email = secondUserEmail;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, secondAuthToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    email: tempRegistrationBody.email\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                email: tempRegistrationBody.email,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            email: tempRegistrationBody.email,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = tempRegistrationBody.email == res.body.output.email &amp;&amp;\n                                                    res.body.output.is_twofa_sms_enabled &amp;&amp;\n                                                    typeof(res.body.output.plan[0]._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.plan[0].__v) == \&quot;undefined\&quot;;\n                                                if (isValid) {\n                                                    _.each(res.body.output.plan[0].features, function(item) {\n                                                        isValid = isValid &amp;&amp;\n                                                            typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(item.__v) == \&quot;undefined\&quot;;\n                                                    });\n                                                }\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;61fd355d-662e-4a23-8fa4-a5a2043673b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e37a2355-c722-41c9-a489-dd099fcae62f&quot;,&quot;13610af3-774e-4207-9fc6-4250e9599649&quot;,&quot;b070617f-b8e4-4e17-be26-16d42623466f&quot;,&quot;00e7a9f7-66a7-410c-99a2-1cde446a1ee7&quot;,&quot;6b33b792-c49c-4827-a527-1b773968cc22&quot;,&quot;183596c3-d451-403c-bdd0-54b38b95eebc&quot;,&quot;61fd355d-662e-4a23-8fa4-a5a2043673b7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1884,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dd342d56-2f12-4cdc-b94e-0f0917b99c38&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;57862d3a-2b9e-482a-b983-f82d231009d4&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3a0a3695-0f42-4735-be66-810935072ed1&quot;,&quot;title&quot;:&quot;User.verifyAuthyForGoogle&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:248,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/login/google\&quot;)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        uid = res.body.output.uid;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9ae3653-30aa-4496-b2d7-4cca0fe3d37f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;15de5032-4fec-4fd5-bc5c-96894100f236&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle Should verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:259,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.output.is_twofa_sms_enabled.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5aa48010-35b1-4127-9606-3354b89dc5c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle Should get default plan for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:234,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = false;\n                                                if (res.body.output.plan.length == 1) {\n                                                    var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                        //return (plan || {}).enterprise_plan || false;\n                                                        return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                    })) || {};\n                                                    defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                    isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                }\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5343130e-9458-4209-a8d0-7b7d5e59a47e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle Should get default attributes for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:212,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = false;\n                                                if (res.body.output.plan.length == 1) {\n                                                    isValid = utils.isHaveKeyVals(res.body.output, [\n                                                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                        ]) &amp;&amp;\n                                                        res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                }\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b2494d86-2850-4de8-ab5f-e0aee3c0dc61&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should reset login fail count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle Should reset login fail count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:224,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n_models.User.findOneAndUpdate({ uid: uid }, { failed_login_count: 0 }, function(error, user) {\n    api.put(\&quot;/enterprise/v1/user\&quot;)\n        .send(tempRegistrationBody)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var authy_userId = res.body.output.authy_user_uid;\n                commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                    .send({\n                        authy_id: authy_userId\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                            api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                .send({\n                                    authy_user_uid: authy_userId,\n                                    token: otpBody.token,\n                                    option_selected: \&quot;otp\&quot;\n                                })\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                        api.post(apiURL)\n                                            .send({\n                                                authy_user_uid: authy_userId,\n                                                token: otpBody.token\n                                            })\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = res.body.output.is_twofa_sms_enabled &amp;&amp;\n                                                        res.body.output.failed_login_count == 0;\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e99f641-97a2-4a7d-8b8c-90b6475d141e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should verify authy, by email and token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle Should verify authy, by email and token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:260,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    email: tempRegistrationBody.email\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                email: tempRegistrationBody.email,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            email: tempRegistrationBody.email,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = tempRegistrationBody.email == res.body.output.email &amp;&amp;\n                                                    res.body.output.is_twofa_sms_enabled;\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82b63421-b132-47c8-a0af-745e5e7d4d8b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5aa48010-35b1-4127-9606-3354b89dc5c2&quot;,&quot;5343130e-9458-4209-a8d0-7b7d5e59a47e&quot;,&quot;b2494d86-2850-4de8-ab5f-e0aee3c0dc61&quot;,&quot;9e99f641-97a2-4a7d-8b8c-90b6475d141e&quot;,&quot;82b63421-b132-47c8-a0af-745e5e7d4d8b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1189,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;425d2b2b-89c9-473f-ae60-fac423d1c8b8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;34f4319a-5bd5-4ba7-8b95-53fa0e68651e&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;eee2438d-e14e-4f5c-81ae-b087995c2f27&quot;,&quot;title&quot;:&quot;User.verifyOTP&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:475,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                email: registrationBody.email\n            });\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        var tempRegistrationBody = global.getImmutable(registrationBody);\n                        tempRegistrationBody.email = secondUserEmail;\n                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                            email: tempRegistrationBody.email\n                        });\n                        api.post(\&quot;/enterprise/v1/signup\&quot;)\n                            .send(tempRegistrationBody)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    secondAuthToken = res.body.output.authtoken;\n                                    secondId = res.body.output._id;\n                                    done();\n                                }\n                            });\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;016528c7-e452-40ff-85eb-da8df4c75e01&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a8afcd1-2309-4c3c-9ebd-e54bf367cfb6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP Should verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:148,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.enable_twofa.should.equal(\&quot;verified\&quot;);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21f60a07-9565-4c4b-ac5d-fee8047efe17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP Should get default plan for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:165,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = false;\n                                    if (res.body.output.plan.length == 1) {\n                                        var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                            //return (plan || {}).enterprise_plan || false;\n                                            return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                        })) || {};\n                                        defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                        isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                    }\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69383e54-c1f7-455b-b10b-fee52dc368ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP Should get default attributes for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:161,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = false;\n                                    if (res.body.output.plan.length == 1) {\n                                        isValid = utils.isHaveKeyVals(res.body.output, [\n                                                \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                            ]) &amp;&amp;\n                                            res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                            moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                            moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                    }\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d713498-8261-4cbd-ae65-97209b3a4bbd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should verify OTP, by email and token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP Should verify OTP, by email and token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:157,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ntempRegistrationBody.email = secondUserEmail;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, secondAuthToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                email: tempRegistrationBody.email,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, secondAuthToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = tempRegistrationBody.email == res.body.output.email &amp;&amp;\n                                        res.body.output.is_twofa_sms_enabled &amp;&amp;\n                                        res.body.output.enable_twofa == \&quot;verified\&quot;;\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe550521-7f37-4d91-8de9-e1f107e09f74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;21f60a07-9565-4c4b-ac5d-fee8047efe17&quot;,&quot;69383e54-c1f7-455b-b10b-fee52dc368ee&quot;,&quot;4d713498-8261-4cbd-ae65-97209b3a4bbd&quot;,&quot;fe550521-7f37-4d91-8de9-e1f107e09f74&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:631,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;27609452-053e-4961-82d2-8804a73c842d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3e704560-f22c-4301-bf0a-6667f0562fde&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;66d98393-7e35-44f3-83d0-ea9275759929&quot;,&quot;title&quot;:&quot;User.verifyOTPForGoogle&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:491,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/login/google\&quot;)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;03d9d649-ec7f-45af-a138-166d8ba1960d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3ec8e54-2d65-42c2-b247-6c668a23ca97&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle Should verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:166,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.enable_twofa.should.equal(\&quot;verified\&quot;);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd66f00f-1f8f-4ac6-9775-992293c29022&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle Should get default plan for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:145,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = false;\n                                    if (res.body.output.plan.length == 1) {\n                                        var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                            //return (plan || {}).enterprise_plan || false;\n                                            return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                        })) || {};\n                                        defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                        isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                    }\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;be1a8b2d-a8d1-42aa-9eb6-8776e1fd2885&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle Should get default attributes for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:192,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = false;\n                                    if (res.body.output.plan.length == 1) {\n                                        isValid = utils.isHaveKeyVals(res.body.output, [\n                                                \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                            ]) &amp;&amp;\n                                            res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                            moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                            moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                    }\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5aa14901-a034-445f-948a-c2b686d345b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should verify OTP, by email and token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle Should verify OTP, by email and token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                email: tempRegistrationBody.email,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = tempRegistrationBody.email == res.body.output.email &amp;&amp;\n                                        res.body.output.is_twofa_sms_enabled &amp;&amp;\n                                        res.body.output.enable_twofa == \&quot;verified\&quot;;\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a0a444a-fbf7-4391-9cc2-e2ec5b2b95a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dd66f00f-1f8f-4ac6-9775-992293c29022&quot;,&quot;be1a8b2d-a8d1-42aa-9eb6-8776e1fd2885&quot;,&quot;5aa14901-a034-445f-948a-c2b686d345b3&quot;,&quot;2a0a444a-fbf7-4391-9cc2-e2ec5b2b95a7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:667,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;74ef3fc2-eaa6-4af6-a043-60990336058c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\createArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\createArbitrary.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;427efb38-81f8-4411-bf7d-dee0576be7c8&quot;,&quot;title&quot;:&quot;Arbitrary.Create&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\createArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\createArbitrary.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Create \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:193,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken[0];\n        done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba0536ee-1623-4ba6-b54a-b827e6d499f3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Arbitrary.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [arbitrary.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6acbf15-c1ac-4808-9b07-978bf0b81a70&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Create Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHORIZED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fcdff2d3-86aa-4ca1-9ce9-eff94a0c207a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create arbitrary, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Create Should create arbitrary, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send(arbitraryData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            arbitrary = res.body.output\n            expect(arbitrary.data).to.be.a(&#x27;object&#x27;);\n            expect(arbitrary.uid).to.be.equal(&#x27;dummy&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54fe31f8-2ed6-422c-bc0c-08d4c185d2e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error,  if \&quot;data\&quot; key is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Create Should get error,  if \&quot;data\&quot; key is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aa547e26-a92b-43fd-ab57-790e4b7eba05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fcdff2d3-86aa-4ca1-9ce9-eff94a0c207a&quot;,&quot;54fe31f8-2ed6-422c-bc0c-08d4c185d2e3&quot;,&quot;aa547e26-a92b-43fd-ab57-790e4b7eba05&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b90a013f-3a3e-4abc-8a18-705dfa000049&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\deleteArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\deleteArbitrary.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;11c992c7-1b4b-4e3d-ac6d-4f2a63547e22&quot;,&quot;title&quot;:&quot;Arbitrary.Delete&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\deleteArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\deleteArbitrary.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Delete \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:219,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken[0];\n        api.post(apiURL)\n            .set({ ui_admin_key: config.UI_ADMIN_KEY })\n            .send(arbitraryData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    arbitrary = res.body.output\n                    done();\n                }\n            });\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45bcc1a2-e885-4690-a7d3-aaa0bed03c52&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Delete \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Arbitrary.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [arbitrary.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;886e2f9f-87ef-4faa-85ad-94a046d61274&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Delete Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + arbitrary.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHORIZED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;602901b0-5860-4974-92e3-b3a996c44e3c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if arbitrary not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Delete Should get error if arbitrary not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;dummy&#x27;)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send(arbitraryData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.RECORD_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e229814-603d-4790-bcbf-d004fa86ec48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete arbitrary, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Delete Should delete arbitrary, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + arbitrary.uid)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            arbitrary = res.body.output\n            expect(arbitrary.delete_at).not.to.be.null;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;303de0d5-f57d-4a37-81bf-43598fcbc40a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;602901b0-5860-4974-92e3-b3a996c44e3c&quot;,&quot;7e229814-603d-4790-bcbf-d004fa86ec48&quot;,&quot;303de0d5-f57d-4a37-81bf-43598fcbc40a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;34ed8fa0-d8e2-48e5-9a63-490cb413f218&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\fetchConfig.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\fetchConfig.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e409ab6a-c091-4496-8624-dc0e6d932f4e&quot;,&quot;title&quot;:&quot;Utility.FetchConfig&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\fetchConfig.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\fetchConfig.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get required config.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.FetchConfig Should get required config.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.have.all.keys(keySet);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab65d617-511f-4162-bcc8-3e5e745852c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ab65d617-511f-4162-bcc8-3e5e745852c8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:12,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a9d18095-d9cb-41d4-9418-d44a7cd22bf6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getArbitrary.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b37b2219-93b6-434f-a84e-7010e4fe3573&quot;,&quot;title&quot;:&quot;Arbitrary.Get&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getArbitrary.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Get \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:189,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken[0];\n        api.post(apiURL)\n            .set({ ui_admin_key: config.UI_ADMIN_KEY })\n            .send(arbitraryData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    arbitrary = res.body.output\n                    done();\n                }\n            });\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c9fb316-cf1a-44bd-89c8-dc3247d4ab39&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Get \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Arbitrary.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [arbitrary.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2436c052-ef2f-4854-92c5-3daba125e684&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get error if arbitrary not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Get Should get error if arbitrary not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;dummy&#x27;)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.RECORD_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b033a9e6-d4ac-4c09-acea-837b8aed55b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get arbitrary.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Get Should get arbitrary.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + arbitrary.uid)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            arbitrary = res.body.output\n            expect(arbitrary.data).to.be.a(&#x27;object&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c585fb28-ff0b-428e-815f-3687b3c62ec0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get arbitrary by sending only[data]=true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Get Should get arbitrary by sending only[data]=true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + arbitrary.uid + &#x27;?only[data]=true&#x27;)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body).to.be.a(&#x27;object&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d00b1dc8-0649-453a-b9fc-eaf825ecb904&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b033a9e6-d4ac-4c09-acea-837b8aed55b9&quot;,&quot;c585fb28-ff0b-428e-815f-3687b3c62ec0&quot;,&quot;d00b1dc8-0649-453a-b9fc-eaf825ecb904&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;75330947-d70a-4462-8c1f-ff2119fc9c93&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getAuditLogs.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getAuditLogs.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;397dd0ab-1a0a-4e9e-88e6-9ef95417407f&quot;,&quot;title&quot;:&quot;Utility.getAuditLogs&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getAuditLogs.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getAuditLogs.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:376,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                _id = dummyUser._id\n                flowData.trigger.handlers = [userTriggerObj]\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res, userTriggerObj)\n                    })\n            },\n            function(res, userTrigger, cbk) {\n                userFlow = res.body.output;\n                flowData.trigger.handlers = [userTriggerObj]\n                api.post(flowURL)\n                    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                orgFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5bdb92f5-ed53-40cf-9229-c798840a8566&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cb) {\n        _models.ConfigData.remove({ flow_uid: userFlow.uid }, function(err) {\n            cb(err);\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ flow_uid: userFlow.uid }, function(err) {\n            cb(err);\n        })\n    },\n    function(cb) {\n        removeFlow([userFlow.uid, (sharedFlow || {}).uid], function(err, deletedFlows) {\n            cb(err, deletedFlows);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e93853b-1042-4d70-951b-aa130ef8204c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .send(shareCriteria)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36c65e38-6535-4a27-b706-71205ec3358d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get org audit logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get org audit logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:120,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).metadata.org_uid).to.be.equal(orgData.organization.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;261898de-a19c-4c6a-b9bf-8c3318af63f6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get own audit logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get own audit logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).owner_uid).to.be.equal(dummyUser.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3504840-96e7-4f6a-99df-8e33c15ce8f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by module.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by module.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?modules=Workflow&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).module).to.be.equal(&#x27;Workflow&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3be7aade-c71c-48c1-8781-25c38e1f67b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by actions.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by actions.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?actions=Create&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).event_type).to.be.equal(&#x27;Create&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4fb223ef-a83a-466c-a1f3-5c97d18da99b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by created_by.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by created_by.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?created_by=&#x27; + dummyUser.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).created_by).to.be.equal(dummyUser.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e96f85b7-7036-4217-99c0-d5e771ac9671&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by project_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by project_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?project_uid=&#x27; + userFlow.project_uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).metadata.project_uid).to.be.equal(userFlow.project_uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a0df948-b3e8-4ae2-863b-22dca3b15e86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by workflow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by workflow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?workflow_uid=&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).metadata.workflow_uid).to.be.equal(userFlow.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ad8cc204-b8ef-4af6-8e3c-75ac7872c609&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by startDate.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by startDate.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?startDate=&#x27; + moment.utc().format())\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).metadata.project_uid).to.be.equal(userFlow.project_uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7ff3c5b-a132-4c6c-ac59-302d7fc9bca8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;36c65e38-6535-4a27-b706-71205ec3358d&quot;,&quot;261898de-a19c-4c6a-b9bf-8c3318af63f6&quot;,&quot;d3504840-96e7-4f6a-99df-8e33c15ce8f8&quot;,&quot;3be7aade-c71c-48c1-8781-25c38e1f67b9&quot;,&quot;4fb223ef-a83a-466c-a1f3-5c97d18da99b&quot;,&quot;e96f85b7-7036-4217-99c0-d5e771ac9671&quot;,&quot;8a0df948-b3e8-4ae2-863b-22dca3b15e86&quot;,&quot;ad8cc204-b8ef-4af6-8e3c-75ac7872c609&quot;,&quot;c7ff3c5b-a132-4c6c-ac59-302d7fc9bca8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:538,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;13852818-02d1-4757-a00a-13cdd4fa37e4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ea4e04cf-9425-40f7-932a-e826b8729b28&quot;,&quot;title&quot;:&quot;Utility&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;533dc243-dc2a-4616-b1c7-9200ba13ac0c&quot;,&quot;title&quot;:&quot;Utility.getCustomCss&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.getCustomCss \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({$or:[{email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;)},{email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;)}]}, function(error, user) {\n    _models.Mail.remove({$or:[{to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;)},{to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;)}]}, function(error, user) {\n        _models.CustomCss.remove({ label: new RegExp(&#x27;^UNIT_TEST_LABEL_+&#x27;, \&quot;i\&quot;) }, function(error, user) {\n            saveCustomCSS({}, function(errors, cssEntries) {\n                _cssEntries = cssEntries;\n                done();\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c1b3d51-b199-4bd6-9b29-7bb64dd7d758&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get specific published custom css.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.getCustomCss Should get specific published custom css.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:uid\&quot;, _cssEntries[1].uid))\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.not.empty;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3c805e5a-e8ed-44ea-a3cd-898fbdf8ebba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if customcss not found .&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.getCustomCss Should get error, if customcss not found .&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_CSS_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;07ca96e1-d74a-4b59-8d2f-d88f28792c1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get unpublished custom css.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.getCustomCss Should not get unpublished custom css.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:uid\&quot;, _cssEntries[0].uid))\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_CSS_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17b582a0-580f-4754-a30b-8a84c02bf413&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3c805e5a-e8ed-44ea-a3cd-898fbdf8ebba&quot;,&quot;07ca96e1-d74a-4b59-8d2f-d88f28792c1c&quot;,&quot;17b582a0-580f-4754-a30b-8a84c02bf413&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:36,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;fa092e18-ac6b-4372-8d3a-b720f9f155a8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getUsage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getUsage.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c710b94a-40a5-4dd6-b6df-c5eebb88c7cc&quot;,&quot;title&quot;:&quot;Utility.getUsage&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getUsage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getUsage.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:254,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.CustomIntegration.remove().exec(function(err) {\n                    _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                        cbk(err, userTrigger);\n                    })\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                _id = dummyUser._id\n                flowData.trigger.handlers = [userTriggerObj]\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a5e9cc2-8cef-4997-8bbb-27c4de68fece&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cb) {\n        removeFlow([userFlow.uid, (sharedFlow || {}).uid], function(err, deletedFlows) {\n            cb(err, deletedFlows);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b30e3516-c9b9-413a-8a9f-bfd84ff6ef1e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?trigger=&#x27; + userTriggerObj.uid)\n    .send(shareCriteria)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;89e93221-0f71-4bd7-8b18-8947a3633cc9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get trigger data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage Should get trigger data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?trigger=&#x27; + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output.length).to.be.equal(1)\n            expect(_.first(_.first(res.body.output).activities)).to.be.equal(&#x27;start&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97546f63-9353-446d-b7fb-17c516cfbc71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get auth data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage Should get auth data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?auth=fl5adf8ba83fd0ec3ddb949f&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output.length).to.be.equal(1)\n            expect(_.first(_.first(res.body.output).activities)).to.be.equal(&#x27;a0&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ff75445-e95b-4e3a-a213-7e918482339a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get connection data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage Should get connection data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?connection=fl2a1c66a0103e97e0f2cec5&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output.length).to.be.equal(1)\n            expect(_.first(_.first(res.body.output).activities)).to.be.equal(&#x27;a1&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4981c8c-d591-4b61-baa9-0f03c526d1c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get agent data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage Should get agent data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?agent=ega9d1573323eb3fa10436fe0&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            Array.isArray(res.body.output).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d9859be-a897-4211-ac97-2a7b27da4613&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;89e93221-0f71-4bd7-8b18-8947a3633cc9&quot;,&quot;97546f63-9353-446d-b7fb-17c516cfbc71&quot;,&quot;7ff75445-e95b-4e3a-a213-7e918482339a&quot;,&quot;d4981c8c-d591-4b61-baa9-0f03c526d1c2&quot;,&quot;6d9859be-a897-4211-ac97-2a7b27da4613&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:163,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4f520505-9a45-41c9-bc28-f036a70aa115&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getUsersData.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getUsersData.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;69d5447d-4060-4ac9-a046-764f987ea84c&quot;,&quot;title&quot;:&quot;Utility.getUsersData&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\getUsersData.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getUsersData.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsersData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:191,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken;\n        usersData = { users: [dummyUser.uid] }\n        done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ff21cd6-8429-40df-a32d-b9deceae90e1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get users data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsersData Should get users data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(usersData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output).uid).to.be.equal(dummyUser.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3292aed-808f-4aba-80ee-83c802506672&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c3292aed-808f-4aba-80ee-83c802506672&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5558da4f-edb5-46e9-a2e5-fa6ad54962e1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7a565aa9-ad2b-4ff2-9ca7-4a8309c6ebdf&quot;,&quot;title&quot;:&quot;Utility&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3c9b2088-37d9-4272-ae86-d7f798bf80f8&quot;,&quot;title&quot;:&quot;Utility.createInstallationData&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.createInstallationData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:246,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f15bdff1-1e94-43c7-a0a3-a7d71c601376&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create installation data at builtio backend.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.createInstallationData Should create installation data at builtio backend.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.builtInstallationData(httpmock, \&quot;enterprise\&quot;);\n\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .send(data)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.notice).to.be.equal(response.output.notice);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d35d870-5b75-4420-8096-80a44c3585d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3d35d870-5b75-4420-8096-80a44c3585d1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;76190a75-c84d-45bc-ae04-fe6a8497e0b1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;655f2597-7cdd-4406-9ccf-50a1cbed966b&quot;,&quot;title&quot;:&quot;Utility&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c4108ba6-20b7-4a78-992a-9c544ef48a38&quot;,&quot;title&quot;:&quot;Utility.listCustomCss&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.listCustomCss \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.CustomCss.remove({ label: new RegExp(&#x27;^UNIT_TEST_LABEL_+&#x27;, \&quot;i\&quot;) }, function(error, user) {\n            saveCustomCSS({}, function(errors, cssEntries) {\n                done();\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b913b5eb-19e5-46da-92ad-8ad6c833797e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get publish list of custom css.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.listCustomCss Should get publish list of custom css.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.length &gt;= 5;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c9b522c-10b3-43b2-ac5c-887fc3192d52&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2c9b522c-10b3-43b2-ac5c-887fc3192d52&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8a06b49a-ee1a-4f93-862b-635e00e7cd20&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;07182db2-7ec7-4273-b2d7-e8d762cf54f3&quot;,&quot;title&quot;:&quot;Utility&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e11209cf-d68c-421f-86ae-7815cd32df34&quot;,&quot;title&quot;:&quot;Utility.LogError&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.LogError \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:239,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45e11246-3e4a-4c58-8436-9aa84360b0c4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should log an error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.LogError Should log an error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ error: &#x27;error&#x27; })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(&#x27;done&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ca9d119-92ff-4190-8d86-b08365f4bd50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8ca9d119-92ff-4190-8d86-b08365f4bd50&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;37cd28b7-70aa-41ce-a1e0-3a9af630aa38&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\updateArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\updateArbitrary.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b7a75a22-5878-4348-9bcf-99b17a2bcd52&quot;,&quot;title&quot;:&quot;Arbitrary.Update&quot;,&quot;fullFile&quot;:&quot;D:\\api\\controllers\\test\\utility\\updateArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\updateArbitrary.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:174,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken[0];\n        api.post(apiURL)\n            .set({ ui_admin_key: config.UI_ADMIN_KEY })\n            .send(arbitraryData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    arbitrary = res.body.output\n                    done();\n                }\n            });\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;03010173-878b-4cdc-b958-e2363cc89f55&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Arbitrary.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [arbitrary.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e64ef855-a1d2-46a0-9e98-7baff22e441f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + arbitrary.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHORIZED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cfe5a984-9467-406f-a401-382d40794c34&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if arbitrary not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update Should get error if arbitrary not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + &#x27;dummy&#x27;)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send(arbitraryData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.RECORD_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d356136-9030-4f77-91f0-d30c330b0927&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update arbitrary, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update Should update arbitrary, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + arbitrary.uid)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send(arbitraryData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            arbitrary = res.body.output\n            expect(arbitrary.data).to.be.a(&#x27;object&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc37ec3a-4ae8-41ab-9c25-90a06993e3ed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error,  if \&quot;data\&quot; key is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update Should get error,  if \&quot;data\&quot; key is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + arbitrary.uid)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9e39d68-068f-4aff-a400-0131a2839591&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cfe5a984-9467-406f-a401-382d40794c34&quot;,&quot;7d356136-9030-4f77-91f0-d30c330b0927&quot;,&quot;bc37ec3a-4ae8-41ab-9c25-90a06993e3ed&quot;,&quot;b9e39d68-068f-4aff-a400-0131a2839591&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:34,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000},&quot;copyrightYear&quot;:2018}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;api&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:true,&quot;enableCharts&quot;:true,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report\\assets&quot;,&quot;jsonFile&quot;:&quot;D:\\api\\mochawesome-report\\mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;D:\\api\\mochawesome-report\\mochawesome.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>