<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:751,&quot;tests&quot;:1594,&quot;passes&quot;:1594,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2018-12-28T07:31:52.625Z&quot;,&quot;end&quot;:&quot;2018-12-28T07:44:46.709Z&quot;,&quot;duration&quot;:774084,&quot;testsRegistered&quot;:1594,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false,&quot;passPercentClass&quot;:&quot;success&quot;,&quot;pendingPercentClass&quot;:&quot;danger&quot;},&quot;suites&quot;:{&quot;uuid&quot;:&quot;edab51b0-3f38-4495-92da-89f2bf4317a3&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;16fa3f34-6d69-4200-a8a6-7dd7c68acf4d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\activity\\listActivities.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activity\\listActivities.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;33ffae2d-4528-443e-9486-5860914414db&quot;,&quot;title&quot;:&quot;Activity.ListActivities&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\activity\\listActivities.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activity\\listActivities.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2959,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1cc57dfe-a896-4e8c-baf4-16e9f20c42f1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6e64425-460b-48af-9d1e-ab56e94071e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of \&quot;all\&quot; activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities Should get list of \&quot;all\&quot; activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:947,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            expect(_.first(res.body.output)).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;622ed376-5446-41a6-ba30-953fc2c53e6b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of \&quot;category\&quot; activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities Should get list of \&quot;category\&quot; activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:940,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?type=category&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.be.all.keys([&#x27;_id&#x27;, &#x27;act&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3de804ef-f413-4168-b969-934f02b0f10e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of \&quot;category\&quot; activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities Should get list of \&quot;category\&quot; activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?type=condition&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.name).to.be.equal(&#x27;condition&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1618485c-0890-4d61-975c-d851939d25f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of \&quot;searchAuth\&quot; activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.ListActivities Should get list of \&quot;searchAuth\&quot; activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:977,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?type=searchAuth&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.Array;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e32578c4-aedb-49ce-a666-3a2f8f1afcf1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f6e64425-460b-48af-9d1e-ab56e94071e4&quot;,&quot;622ed376-5446-41a6-ba30-953fc2c53e6b&quot;,&quot;3de804ef-f413-4168-b969-934f02b0f10e&quot;,&quot;1618485c-0890-4d61-975c-d851939d25f7&quot;,&quot;e32578c4-aedb-49ce-a666-3a2f8f1afcf1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2885,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;116263c6-3c15-4179-be71-7cf0d3deba90&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\activity\\searchActivities.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activity\\searchActivities.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;caad9717-0326-48bc-97a5-d1ad5ad140e2&quot;,&quot;title&quot;:&quot;Activity.SearchActivities&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\activity\\searchActivities.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activity\\searchActivities.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.SearchActivities \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3782,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                //console.log(&#x27;err&#x27;, err)\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;58e4dcfd-441c-4769-9569-be539c001871&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of \&quot;search\&quot; param activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Activity.SearchActivities Should get list of \&quot;search\&quot; param activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({ search: &#x27;test&#x27; })\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7a4628d-88a1-445d-b6af-167ce1c165ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e7a4628d-88a1-445d-b6af-167ce1c165ad&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:17,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;36edbf66-26bb-49db-8e23-90c126600c82&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\activityBuilder\\validateCode.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activityBuilder\\validateCode.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;819b9692-2922-4c83-a81c-12cd45374fb1&quot;,&quot;title&quot;:&quot;ActivityBuilder.Validate&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\activityBuilder\\validateCode.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\activityBuilder\\validateCode.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5420,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31b9352d-2eb5-4264-81c8-748a9275209f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20bd3686-d776-470a-9e1e-89a52eeebe92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;code\&quot; is not having value as string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should give error, if \&quot;code\&quot; is not having value as string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCodeKey = { code: {} }\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidCodeKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.INVALID_CODE_KEY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f08ba8e-8338-4f71-9ef2-d536f11d4a64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if json schema has invalid keys like \&quot;input\&quot;, \&quot;output\&quot;, \&quot;execute\&quot;.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should give error, if json schema has invalid keys like \&quot;input\&quot;, \&quot;output\&quot;, \&quot;execute\&quot;.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidJsonForKeys)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.status.should.equal(&#x27;failed&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf94f01a-ffac-41fe-8c46-e1b3c337b5d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if json schema has invalid schema.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should give error, if json schema has invalid schema.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidJsonSchema)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.status.should.equal(&#x27;failed&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd757c07-6ab4-4c9d-ac44-5d7a323e1084&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if data is string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should give error, if data is string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(\&quot;\&quot;)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Code key should be of type string.&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;85c7ca92-a9bd-4165-844a-28c838bb7eb4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should be valid, if passed json schema is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ActivityBuilder.Validate Should be valid, if passed json schema is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCodeKey = { code: {} }\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(validJson)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.status.should.equal(&#x27;passed&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c790fa97-9fdb-4892-b0e3-15bf676ae96e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;20bd3686-d776-470a-9e1e-89a52eeebe92&quot;,&quot;5f08ba8e-8338-4f71-9ef2-d536f11d4a64&quot;,&quot;cf94f01a-ffac-41fe-8c46-e1b3c337b5d8&quot;,&quot;fd757c07-6ab4-4c9d-ac44-5d7a323e1084&quot;,&quot;85c7ca92-a9bd-4165-844a-28c838bb7eb4&quot;,&quot;c790fa97-9fdb-4892-b0e3-15bf676ae96e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:78,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c58eee6b-cabe-4c0a-92b7-a81575c07147&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;abfba9e0-2a6a-4797-9fca-cf0930b46042&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;24dc2a16-6bfb-4173-8db2-8d57d5839c98&quot;,&quot;title&quot;:&quot;AddOn.addAddOn&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOn \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            saveAddOns({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                },\n                function(error, addOns) {\n                    savedAddOns = addOns;\n                    done();\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a91f32a8-fff4-4efd-9edf-b51b5bf443e1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOn \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3eeea345-db50-4879-9b58-80286c8494db&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should apply addon.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOn Should apply addon.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:117,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyAddOn(httpmock, function(error) {\n    if (error) {\n        false.should.equal(true);\n        done();\n    } else {\n        commonMock.braintreeTransaction(httpmock, \&quot;enterprise\&quot;);\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .send({})\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.message.should.equal(messageList.ADDON_APPLY_SUCCESS);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f254eeee-a4d7-4666-acfa-adc796b1abe4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOn Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd627e78-9c52-4ac5-aaaf-8716413d36c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f254eeee-a4d7-4666-acfa-adc796b1abe4&quot;,&quot;fd627e78-9c52-4ac5-aaaf-8716413d36c1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:122,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8a516d36-d90c-4b0a-aa72-5e58d2d2553a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;da5a2b5a-182e-4a2b-a793-d580c5ab5533&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;72f986d0-37dc-454d-821a-f68b98b98a59&quot;,&quot;title&quot;:&quot;AddOn.addAddOnOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\addAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOnOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        saveAddOns({\n                authtoken: authToken,\n                user_uid: user_uid\n            },\n            function(error, addOns) {\n                savedAddOns = addOns;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c94db88-5e88-448a-a820-c844f27729b6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOnOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;206f0595-e1e0-452b-8d5b-92eb49940fc2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.addAddOnOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;89970007-7719-48f1-8fb4-d7e800dc93c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;89970007-7719-48f1-8fb4-d7e800dc93c4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3c3395d1-1dbd-4303-a687-3b898a9759e0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;107534fc-cba9-4f2f-a090-d8aaa6de2a8e&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a90eab5d-bdd9-4db6-a826-17bd50c21a39&quot;,&quot;title&quot;:&quot;AddOn.list&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.list \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            saveAddOns({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                },\n                function(error, userLogs) {\n                    savedUserLogs = userLogs;\n                    done();\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9db213b-03b3-462c-8bd7-9213ac166318&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.list \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;739670ae-0150-48d9-8cd6-a2f12e179707&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plan addons.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.list Should get list of plan addons.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPlan(httpmock, function(error, userPlanOutput) {\n    api.get(apiURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.should.be.instanceOf(Array);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;209b3267-b3a8-41b9-87f9-a522813476a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.list Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6994b1ed-ff9b-4de4-b26c-3556c10e2cf2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;209b3267-b3a8-41b9-87f9-a522813476a1&quot;,&quot;6994b1ed-ff9b-4de4-b26c-3556c10e2cf2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:50,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4d98aea6-0a3f-41e9-a035-39377cd3314b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b128da86-c5bb-4906-8062-7d910258267c&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;81450a26-1836-49b6-b6f8-60bb794155be&quot;,&quot;title&quot;:&quot;AddOn.listOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\listOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.listOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        saveAddOns({\n                authtoken: authToken,\n                user_uid: user_uid\n            },\n            function(error, addOns) {\n                savedAddOns = addOns;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0e898fd-5580-4121-90f8-430313fd7e61&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.listOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c8b8e86-cd48-4f18-a933-861efad6865a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plan addons.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.listOrg Should get list of plan addons.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPlan(httpmock, function(error, userPlanOutput) {\n    api.get(apiURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.should.be.instanceOf(Array);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dfa8f717-5b76-4116-8de8-64ea5951331a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.listOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f40553ab-17c5-4a13-8e88-dbd7e0a972bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dfa8f717-5b76-4116-8de8-64ea5951331a&quot;,&quot;f40553ab-17c5-4a13-8e88-dbd7e0a972bc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:70,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1781bfc4-7ca0-4489-b7db-5359df5368e8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0edd5d8e-d5a7-4642-8a27-b201af3d198e&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1787e75a-d21a-42bb-8358-5922ec7a0150&quot;,&quot;title&quot;:&quot;AddOn.selectAddOn&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOn.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOn \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            saveAddOns({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                },\n                function(error, addOns) {\n                    savedAddOns = addOns;\n                    done();\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0c451ae-acd0-45d7-820a-45bd1f1b3d6f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOn \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;99278f1f-e857-4ebe-b2b7-7ee7d458ecfe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should apply addon.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOn Should apply addon.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPlan(httpmock, function(error, userPlanOutput) {\n    api.get(\&quot;/enterprise/v1/addons\&quot;)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var addon_uid = _.first(res.body.output).uid;\n                api.put(apiURL)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .send({\n                        \&quot;addon_uid\&quot;: addon_uid\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            if (res.body.output.message == messageList.ADDON_ASSIGNED) {\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, authToken)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            res.body.output.addon_uid.should.equal(addon_uid);\n                                            done();\n                                        }\n                                    });\n                            } else {\n                                (true).should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52e9cd69-fa34-496c-96ca-9c8017d35c15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOn Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49de0810-1912-4515-8b7b-5a7742fdb570&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;52e9cd69-fa34-496c-96ca-9c8017d35c15&quot;,&quot;49de0810-1912-4515-8b7b-5a7742fdb570&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:75,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9edb709f-1915-46f6-84ff-2bc7eb42484f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ddcabc8d-503b-4729-b59d-8fe946ecaeb2&quot;,&quot;title&quot;:&quot;AddOn&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ef851d9d-5a96-4d89-97b5-dc570cb5fbb6&quot;,&quot;title&quot;:&quot;AddOn.selectAddOnOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\addOn\\selectAddOnOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOnOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        saveAddOns({\n                authtoken: authToken,\n                user_uid: user_uid\n            },\n            function(error, userLogs) {\n                savedUserLogs = userLogs;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7eded544-6da3-4427-8ea8-d00d5ccb8768&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOnOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e638f8d-e688-48bf-963b-91379c7407a9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should apply addon.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOnOrg Should apply addon.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPlan(httpmock, function(error, userPlanOutput) {\n    api.get(\&quot;/enterprise/v1/addons\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var addon_uid = _.first(((res || {}).body || {}).output || []).uid || \&quot;\&quot;;\n                api.put(apiURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .send({\n                        \&quot;addon_uid\&quot;: addon_uid\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            if (res.body.output.message == messageList.ADDON_ASSIGNED) {\n                                _models.User.findOne({ uid: org_account_uid }, function(error, user) {\n                                    user.addon_uid.should.equal(addon_uid);\n                                    done();\n                                });\n                            } else {\n                                (true).should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1aa2825-4780-4c2e-a5bf-2eeaaf889f20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise AddOn AddOn.selectAddOnOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82dce5e3-7660-4df1-8aec-8a35a128d9f6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f1aa2825-4780-4c2e-a5bf-2eeaaf889f20&quot;,&quot;82dce5e3-7660-4df1-8aec-8a35a128d9f6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:82,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d397b96b-e909-4f27-b234-83aedb9aaaed&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\createUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\createUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c9d42042-16e4-4159-b51e-793d1ca3e365&quot;,&quot;title&quot;:&quot;Agent.CreateUserAgent&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\createUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\createUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.CreateUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2596,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3248e3e0-c0b5-4af5-80e7-a7ab553ac463&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.CreateUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac5f219a-5ffe-472b-983c-c93c612b2ec0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.CreateUserAgent Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f3ed3c0-bab8-46f3-a7a7-bd6ba7ce72d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.CreateUserAgent Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar agentBody = _.clone(agentData);\nagentBody = _.omit(agentBody, &#x27;name&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(agentBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41671c37-3e3d-42b7-a3fb-a7fdde472ead&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create agent, if agent data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.CreateUserAgent Should create agent, if agent data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(agentData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userAgent = res.body.output;\n            userAgent.should.have.property(&#x27;name&#x27;);\n            //expect(userAgent).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3b19dcc-89b0-4ef8-81d1-d1fd25f97256&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5f3ed3c0-bab8-46f3-a7a7-bd6ba7ce72d0&quot;,&quot;41671c37-3e3d-42b7-a3fb-a7fdde472ead&quot;,&quot;a3b19dcc-89b0-4ef8-81d1-d1fd25f97256&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;51e6d523-ee43-4228-8a57-ff4683e0cb67&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\deleteUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\deleteUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;82b653d0-e2b8-4240-b133-1a0780406a29&quot;,&quot;title&quot;:&quot;Agent.DeleteUserAgent&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\deleteUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\deleteUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.DeleteUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3080,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(agentData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userAgent = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;af21b97f-0961-4600-8b8f-d43e29f9b6cf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.DeleteUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a99ea8f-9d58-457b-8342-c6d40cb545fa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.DeleteUserAgent Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/&#x27; + userAgent.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a6c6bd1-5660-4ce9-b991-0f955a8b2ae3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user agent not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.DeleteUserAgent Should get error if user agent not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/dummyAgent&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ name: &#x27;updated&#x27; })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.AGENT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9695d573-d719-4363-915e-324844bee54a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete agent, if user agent found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.DeleteUserAgent Should delete agent, if user agent found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/&#x27; + userAgent.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userAgent = res.body.output;\n            expect(userAgent.deleted_at).not.to.be.null;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;130bc320-2cbb-4c89-ad49-4c039ec68d10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9a6c6bd1-5660-4ce9-b991-0f955a8b2ae3&quot;,&quot;9695d573-d719-4363-915e-324844bee54a&quot;,&quot;130bc320-2cbb-4c89-ad49-4c039ec68d10&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3418b7a5-34f7-47a3-b5b4-4ca8fdac38af&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\initUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\initUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4dc106fe-6e98-4425-834b-5af386d57eab&quot;,&quot;title&quot;:&quot;Agent.InitUserAgent&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\initUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\initUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2943,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(&#x27;/enterprise/v1/user/agents&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(agentData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userAgent = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee3d2726-b48a-4b3c-98ee-7b15adf734f5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5ac43f3-c655-44b1-98c1-8f29d303b934&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get error if \&quot;gateway_key\&quot; key missing or not valid in request headers.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent Should get error if \&quot;gateway_key\&quot; key missing or not valid in request headers.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;gatewaykey&#x27;, &#x27;invalid key&#x27;)\n    .send(body)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Unauthorized&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6032ded-3e37-488a-b11e-58a5de1e1093&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user agent not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent Should get error if user agent not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;gateway_key&#x27;, &#x27;invalid key&#x27;)\n    .send(body)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.AGENT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;34ed6b63-16e6-42f8-9431-39455941beac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should init agent, if agent data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent Should init agent, if agent data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;gateway_key&#x27;, userAgent.uid)\n    .send(body)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.contain.any.keys([&#x27;service&#x27;, &#x27;credentials&#x27;, &#x27;admin_key&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0d2fddf-312c-45b4-9492-b3f3bde0db96&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should init agent, if agent without any data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.InitUserAgent Should init agent, if agent without any data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;gateway_key&#x27;, userAgent.uid)\n    .send()\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.contain.any.keys([&#x27;service&#x27;, &#x27;credentials&#x27;, &#x27;admin_key&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;42cecebe-4f99-4234-88fd-ee69dc5285b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a6032ded-3e37-488a-b11e-58a5de1e1093&quot;,&quot;34ed6b63-16e6-42f8-9431-39455941beac&quot;,&quot;c0d2fddf-312c-45b4-9492-b3f3bde0db96&quot;,&quot;42cecebe-4f99-4234-88fd-ee69dc5285b0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2ec2ffe4-02f3-4f28-b4b5-90d7b9783ae8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\listUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\listUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;756d9476-4e6c-441e-8b62-8d96f17f583d&quot;,&quot;title&quot;:&quot;Agent.ListUserAgent&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\listUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\listUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ListUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2430,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(agentData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userAgent = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b730d5b-b0f1-4d8a-9900-1e49d45857b9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ListUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d1dbd76a-9dd1-4ac5-bb99-97f86bd43a4a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ListUserAgent Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52ae182e-6496-4cf0-9bbc-2fefc7232f4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user agent list, if user is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ListUserAgent Should get user agent list, if user is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.a(&#x27;array&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87946860-76c5-4082-8c30-d41ff87a61c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;52ae182e-6496-4cf0-9bbc-2fefc7232f4f&quot;,&quot;87946860-76c5-4082-8c30-d41ff87a61c7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2aab53e2-afff-480f-9353-73d476676562&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\updateUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\updateUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e39ab311-24a4-4bc1-82a6-7b7d017683a1&quot;,&quot;title&quot;:&quot;Agent.UpdateUserAgent&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\updateUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\updateUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2566,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(agentData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userAgent = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fcaa5126-f2ec-4e6a-becb-fa785d8c77ab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d567bc4c-8949-49f8-bd4f-df18cdb3de68&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + userAgent.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0651a777-e3e4-4301-8778-28e175d45765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar agentBody = _.clone(agentData);\nagentBody = _.omit(agentBody, &#x27;name&#x27;);\napi.put(apiURL + userAgent.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(agentBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0cec2b78-25ee-47b1-89de-6da38312c6ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user agent not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent Should get error if user agent not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + &#x27;dummyAgent&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ name: &#x27;updated&#x27; })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.AGENT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f2cfd00e-c306-4e54-bd85-7dbaf7015c1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update agent, if agent data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.UpdateUserAgent Should update agent, if agent data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + userAgent.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ name: &#x27;updated&#x27; })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userAgent = res.body.output;\n            expect(userAgent.name).to.be.equal(&#x27;updated&#x27;);\n            expect(userAgent).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;351fe383-c7fc-4fc1-b632-afc04579674b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0651a777-e3e4-4301-8778-28e175d45765&quot;,&quot;0cec2b78-25ee-47b1-89de-6da38312c6ee&quot;,&quot;f2cfd00e-c306-4e54-bd85-7dbaf7015c1a&quot;,&quot;351fe383-c7fc-4fc1-b632-afc04579674b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:57,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9ab41ddc-f258-4791-887e-02301ec3f526&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\validateUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\validateUserAgent.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;742d5040-89f4-4bb9-bef8-4d80448bbb3d&quot;,&quot;title&quot;:&quot;Agent.ValidateUserAgent&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\agent\\validateUserAgent.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\agent\\validateUserAgent.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ValidateUserAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2698,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(&#x27;/enterprise/v1/user/agents&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(agentData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userAgent = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c45b3d16-21e4-439f-8c46-eda1dcc4b318&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ValidateUserAgent \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Agent.remove({ uid: userAgent.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;354c7f46-2c6d-432a-ba8e-c7c0d58d5fa7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get error if \&quot;gateway_key\&quot; key missing or not valid in request headers.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ValidateUserAgent Should get error if \&quot;gateway_key\&quot; key missing or not valid in request headers.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;gatewaykey&#x27;, &#x27;invalid key&#x27;)                \n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Unauthorized&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66b76c1b-0a1a-49bb-9689-5eab1efc4c8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user agent not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ValidateUserAgent Should get error if user agent not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;gateway_key&#x27;, &#x27;invalid key&#x27;)               \n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.AGENT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5329f0b6-dd90-473c-a942-f05da0ae4bcb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate agent, if agent data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Agent.ValidateUserAgent Should validate agent, if agent data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4288,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;gateway_key&#x27;, userAgent.uid)               \n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.contain.any.keys([&#x27;message&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;628b5675-7f75-4071-9b6a-c189a6d0b2ed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;66b76c1b-0a1a-49bb-9689-5eab1efc4c8f&quot;,&quot;5329f0b6-dd90-473c-a942-f05da0ae4bcb&quot;,&quot;628b5675-7f75-4071-9b6a-c189a6d0b2ed&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4299,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b7bbfb55-db07-4c9a-9b93-060283150530&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bc8b806a-3544-436d-9367-42904d8b0e38&quot;,&quot;title&quot;:&quot;authyUser&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c83654be-1ea1-4f02-b85d-885525909910&quot;,&quot;title&quot;:&quot;authyUser.requestSMS&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\authyUser\\requestSMS.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise authyUser authyUser.requestSMS \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84fa8d1c-7aec-4f2f-b9de-d952cf7a9b69&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise authyUser authyUser.requestSMS \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe2543cf-c94e-4e1d-9633-9ec4dea3df06&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should send otp with SMS.&quot;,&quot;fullTitle&quot;:&quot;Enterprise authyUser authyUser.requestSMS Should send otp with SMS.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var authy_userId = res.body.output.authy.authy_userId;\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send({\n                    authy_user_uid: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.success.should.equal(\&quot;true\&quot;);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;327aeeec-0929-4abe-9e19-215bd9786441&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send otp with SMS by passing email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise authyUser authyUser.requestSMS Should send otp with SMS by passing email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send({\n                    email: res.body.output.email\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.success.should.equal(\&quot;true\&quot;);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dc1bb0d0-4e41-4cb1-b322-632da5f0ae6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as user not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise authyUser authyUser.requestSMS Should give error as user not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var authy_userId = res.body.output.authy.authy_userId;\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send({})\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.USER_NOT_FOUND);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a55f876-6ba3-48c6-858c-54f4bff553ed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;327aeeec-0929-4abe-9e19-215bd9786441&quot;,&quot;dc1bb0d0-4e41-4cb1-b322-632da5f0ae6f&quot;,&quot;0a55f876-6ba3-48c6-858c-54f4bff553ed&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:105,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;99b17b85-5d02-4bc1-a59d-39dafab42910&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\createUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\createUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;14af4772-9a73-43a4-986c-1965d18fe9e5&quot;,&quot;title&quot;:&quot;Connection.CreateUserConnection&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\createUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\createUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:79,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        done()\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0060192d-f7d9-44c9-8846-4e617594e9d5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n    done(err)\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e8ce4a9-ed98-4334-acf9-f3834112cf0c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a793109c-6e7b-4471-bd1b-8465fe09a8bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;data\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection Should get error if \&quot;data\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.clone(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;data&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e1f7e7d5-6f1d-4af9-a242-b82e939de165&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;input\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection Should get error if \&quot;input\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.cloneDeep(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;input&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b3e98819-65fe-4d71-828a-dccb030e3331&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.cloneDeep(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;name&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77c2db7f-e41d-4bc5-9b46-5b85794bbe26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create connection, if connection data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.CreateUserConnection Should create connection, if connection data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.cloneDeep(testData.connectionBody);\nvar opt = { body: data, path: &#x27;/connection/create&#x27; }\ncommonMock.connectionCreateSuccess(opt)\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.connectionBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userConnection = res.body.output\n            expect(userConnection).to.have.any.keys(_.union(_.keys(testData.connectionBody), [&#x27;uid&#x27;, &#x27;user&#x27;]));\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ea59efb-4588-467a-a8fa-c704fc7cd2e2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a793109c-6e7b-4471-bd1b-8465fe09a8bb&quot;,&quot;e1f7e7d5-6f1d-4af9-a242-b82e939de165&quot;,&quot;b3e98819-65fe-4d71-828a-dccb030e3331&quot;,&quot;77c2db7f-e41d-4bc5-9b46-5b85794bbe26&quot;,&quot;3ea59efb-4588-467a-a8fa-c704fc7cd2e2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:60,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ab6aa8e6-e324-4eba-a3b6-19112dd5f36b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\deleteUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\deleteUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;34c8fdde-be22-4c81-8ea4-981984d3912d&quot;,&quot;title&quot;:&quot;Connection.DeleteUserConnection&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\deleteUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\deleteUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.DeleteUserConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        var conndata = _.cloneDeep(connectionData)\n        conndata.user = dummyUser.uid\n        _models.UserConnection.create(conndata, function(err, result) {\n            if (result) {\n                userConnection = result.toJSON()\n            }\n            done()\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9cfbaeb1-fa25-4f86-9565-51448ee5a7c2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.DeleteUserConnection \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;28822a88-b1b1-45a0-be25-26de0d690609&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.DeleteUserConnection Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + userConnection.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb0c1544-ee51-4c7a-8ba4-6b6f6484d42f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user connection not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.DeleteUserConnection Should get error, if user connection not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;dummyUser&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.CONNECTION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;500b75a4-a137-49fc-9751-92a149da6dde&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete connection, if user connection found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.DeleteUserConnection Should delete connection, if user connection found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.cloneDeep(testData.connectionBody);\nvar opt = { path: &#x27;/connection/&#x27; + userConnection.uid };\ncommonMock.connectionDeleteSuccess(opt);\napi.delete(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.notice).to.be.equal(messageList.CONNECTION_DELETED_SUCCESSFULLY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;261ebb68-b777-45ef-b2fb-a398d7f9b5f6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fb0c1544-ee51-4c7a-8ba4-6b6f6484d42f&quot;,&quot;500b75a4-a137-49fc-9751-92a149da6dde&quot;,&quot;261ebb68-b777-45ef-b2fb-a398d7f9b5f6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;92c900bd-d7e9-4d83-a47a-00cf7a289b74&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\getUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\getUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d0b33bc1-8cd9-48ae-a716-5fb0f35d8af7&quot;,&quot;title&quot;:&quot;Connection.GetUserConnection&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\getUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\getUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        var conndata = _.cloneDeep(connectionData)\n        conndata.user = dummyUser.uid\n        _models.UserConnection.create(conndata, function(err, result) {\n            if (result) {\n                userConnection = result.toJSON()\n            }\n            done()\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39d31dab-8c42-46ca-9d98-0465b82f3370&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnection \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27ba834a-4fcd-46cd-8621-b16d1a32488f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnection Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + userConnection.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f7a2683-24b5-4404-b63b-44050a2c86cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user connection not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnection Should get error, if user connection not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: &#x27;/connection/dummyUser/details&#x27; };\ncommonMock.connectionGetNotFound(opt);\napi.get(apiURL + &#x27;dummyUser&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.CONNECTION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3b36885-9d35-467b-9f84-15a7cdf2e649&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get connection, if user connection found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnection Should get connection, if user connection found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: &#x27;/connection/&#x27; + userConnection.uid + &#x27;/details&#x27; };\ncommonMock.connectionGetSuccess(opt);\napi.get(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userConnection = res.body.output\n            expect(userConnection).to.have.all.keys([&#x27;connection&#x27;]);\n            expect(userConnection.connection).to.have.any.keys(_.union(_.keys(connectionData), [&#x27;uid&#x27;, &#x27;user&#x27;]));\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd5f9af0-0044-4525-8faa-74908e93e2e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2f7a2683-24b5-4404-b63b-44050a2c86cf&quot;,&quot;f3b36885-9d35-467b-9f84-15a7cdf2e649&quot;,&quot;dd5f9af0-0044-4525-8faa-74908e93e2e3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:35,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ed259932-219a-479a-b02b-e7fc25c52e46&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\getUserConnections.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\getUserConnections.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;be5b3e4b-ba0e-410e-bbb6-1e3c1936ea92&quot;,&quot;title&quot;:&quot;Connection.GetUserConnections&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\getUserConnections.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\getUserConnections.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnections \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3308,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            var entUser = _.cloneDeep(testData.userObj)\n            _models.User.create(entUser, function(err, newuser) {\n                cbk(err, newuser);\n            })\n        })\n    },\n    function(user, cbk) {\n        fakeUser = user\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        var conndata = _.cloneDeep(connectionData)\n        conndata.user = dummyUser.uid\n        _models.UserConnection.create(conndata, function(err, result) {\n            if (result) {\n                userConnection = result.toJSON()\n            }\n            cbk(err, userConnection)\n        })\n    }\n], function(err, res) {\n    done(err);\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a086327-9a69-4b45-82f9-aa7eee7248a4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnections \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.User.remove({ uid: fakeUser.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b016ca56-8566-4a59-b80b-7eab08e4a1e2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnections Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de2a70d3-5db6-4489-90e8-8b3532bf4b17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get connection, if user connection found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.GetUserConnections Should get connection, if user connection found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.all.keys([&#x27;_id&#x27;, &#x27;userauths&#x27;, &#x27;icons&#x27;,&#x27;label&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06597a0d-51c8-4f05-be4b-23f39a56d5ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;de2a70d3-5db6-4489-90e8-8b3532bf4b17&quot;,&quot;06597a0d-51c8-4f05-be4b-23f39a56d5ce&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bf4f710a-1cfd-4224-b77c-068fa3efadf2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\listConnections.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\listConnections.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a3bae970-9668-43e5-a646-32a7240a2d48&quot;,&quot;title&quot;:&quot;Connection.ListConnections&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\listConnections.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\listConnections.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.ListConnections \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5721,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4d0a1a6-df85-46d1-9462-be9e0ab2409e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of connection.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.ListConnections Should get list of connection.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91287ad8-2c3d-45ef-97f0-8d96745952c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.ListConnections Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f31e1fca-d147-44d1-8ef3-1056f3fa457f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;91287ad8-2c3d-45ef-97f0-8d96745952c9&quot;,&quot;f31e1fca-d147-44d1-8ef3-1056f3fa457f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e341793f-27aa-4ca9-8bf9-9fd3721b8b11&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\testUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\testUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;93767efb-d6f5-43fe-b155-3400995f757f&quot;,&quot;title&quot;:&quot;Connection.TestUserConnection&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\testUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\testUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.TestUserConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        var conndata = _.cloneDeep(connectionData)\n        conndata.user = dummyUser.uid\n        _models.UserConnection.create(conndata, function(err, result) {\n            if (result) {\n                userConnection = result.toJSON()\n            }\n            done()\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;26410e5d-17f5-456b-ad55-1577752bc981&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.TestUserConnection \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    done(err)\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb06258b-c110-4bba-aaa2-c42cb1a8731f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.TestUserConnection Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + userConnection.uid + &#x27;/validate&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a773188e-2f92-4d46-ab3b-5779b8133933&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update connection, if connection data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.TestUserConnection Should update connection, if connection data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.cloneDeep(testData.connectionBody);\nconnectionData.uid = userConnection.uid;\nvar opt = { uid: userConnection.uid, path: &#x27;/connection/&#x27; + userConnection.uid + &#x27;/validate&#x27; };\ncommonMock.connectionTestSuccess(opt);\napi.get(apiURL + userConnection.uid + &#x27;/validate&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userConnection = res.body.output\n            expect(userConnection).to.have.any.keys(_.union(_.keys(testData.connectionBody), [&#x27;uid&#x27;, &#x27;user&#x27;]));\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a4ddb2c-2b3b-4ccf-b58f-c33f861e4b86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a773188e-2f92-4d46-ab3b-5779b8133933&quot;,&quot;1a4ddb2c-2b3b-4ccf-b58f-c33f861e4b86&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:18,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;36091343-bc59-4c2b-8e14-ac3acbed3bd4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\updateUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\updateUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;eb3bf4cc-4ddc-486b-9fa3-68e80551c120&quot;,&quot;title&quot;:&quot;Connection.UpdateUserConnection&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\connection\\updateUserConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\connection\\updateUserConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:158,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        var conndata = _.cloneDeep(connectionData)\n        conndata.user = dummyUser.uid\n        _models.UserConnection.create(conndata, function(err, result) {\n            if (result) {\n                userConnection = result.toJSON()\n            }\n            done()\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e5ba99b-8e73-4058-9359-1032a56e58bb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.UserConnection.remove({ uid: userConnection.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    done(err)\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e56dc91-6091-40df-90b3-166f720b9e49&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + userConnection.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cdfbb30e-0176-43d3-9577-61b9004fef22&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;data\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should get error if \&quot;data\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.clone(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;data&#x27;);\napi.put(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1eb2a5ac-4617-41b3-b59d-ceaa9ec2f3b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;input\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should get error if \&quot;input\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.clone(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;input&#x27;);\napi.put(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c65d7f84-eac5-4603-8c7b-bd83eacd7eb6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should get error if \&quot;name\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.clone(testData.connectionBody);\nconnectionData = _.omit(connectionData, &#x27;name&#x27;);\napi.put(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b8f8474-914f-4f32-ab94-0bd335cf4ed6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user connection not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should get error if user connection not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n// var opt = { path: &#x27;/connection/dummyUser&#x27; };\n// commonMock.connectionGetNotFound(opt);\nvar connectionObj = _.clone(connectionData);\napi.put(apiURL + &#x27;dummyUser&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionObj)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CONNECTION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9bf6f850-fd15-40b0-bae9-3bff454661a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update connection, if connection data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Connection.UpdateUserConnection Should update connection, if connection data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connectionData = _.cloneDeep(testData.connectionBody);\nconnectionData.uid = userConnection.uid;\nconnectionData.label = &#x27;updated connection&#x27;;\nvar opt = { path: &#x27;/connection/&#x27; + userConnection.uid };\ncommonMock.connectionsUpdateSuccess(opt);\napi.put(apiURL + userConnection.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connectionData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userConnection = res.body.output\n            expect(userConnection.label).to.be.equal(&#x27;updated connection&#x27;);\n            expect(userConnection).to.have.any.keys(_.union(_.keys(testData.connectionBody), [&#x27;uid&#x27;, &#x27;user&#x27;]));\n            var opt = { path: getTriggerPath, body: getTriggerPath };\n            commonMock.triggerGetSuccess(opt);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;164aaa27-b166-45f6-b6f3-c93514c4bfe0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cdfbb30e-0176-43d3-9577-61b9004fef22&quot;,&quot;1eb2a5ac-4617-41b3-b59d-ceaa9ec2f3b4&quot;,&quot;c65d7f84-eac5-4603-8c7b-bd83eacd7eb6&quot;,&quot;1b8f8474-914f-4f32-ab94-0bd335cf4ed6&quot;,&quot;9bf6f850-fd15-40b0-bae9-3bff454661a0&quot;,&quot;164aaa27-b166-45f6-b6f3-c93514c4bfe0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:81,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4d40d913-f2fd-4e11-9192-2e08cb0c4286&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\deleteAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteAnnouncement.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;56837d29-8631-475c-8cd0-78a81c5a6c56&quot;,&quot;title&quot;:&quot;contentStack.deleteAnnouncement&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\deleteAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteAnnouncement.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteAnnouncement \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMessage.remove({ title: \&quot;UNIT_TEST_ANNOUNCEMENT\&quot; }, function(error, message) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee7fd3dd-3a45-40d9-98c5-eb368212eeb9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteAnnouncement \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3aed930f-3e7e-46c0-9aff-0f34f1dbf75a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete announcement.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteAnnouncement Should delete announcement.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/announcements\&quot;)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.Announcement.find({ title: \&quot;UNIT_TEST_ANNOUNCEMENT\&quot; },\n                function(error, users) {\n                    var uid = (users || [{ uid: \&quot;\&quot; }])[0].uid || \&quot;\&quot;;\n                    var paramUrl = apiURL + uid;\n                    api.delete(paramUrl)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _models.CmsMessage.find({ title: \&quot;UNIT_TEST_ANNOUNCEMENT\&quot; },\n                                    function(error, users) {\n                                        (error == null &amp;&amp; (users || []).length == 0).should.equal(true);\n                                        done();\n                                    });\n                            }\n                        });\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dce54f03-de5b-40c3-9bb2-e29c652a1058&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dce54f03-de5b-40c3-9bb2-e29c652a1058&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:12,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;30062c69-25bc-4675-9a06-04a0021333e9&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\deleteEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9d01c963-93ca-4118-a1e1-0ccaef31eb8a&quot;,&quot;title&quot;:&quot;contentStack.deleteEmailTemplate&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\deleteEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteEmailTemplate \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMail.remove({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; }, function(error, template) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;379d0dae-b33e-4a2b-99ce-5ebe38c7dcce&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteEmailTemplate \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a85b382-d5ac-4dcc-a936-a41cea4de5a8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete email template.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteEmailTemplate Should delete email template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.CmsMail.find({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; },\n                function(error, templates) {\n                    var uid = (templates || [{ uid: \&quot;\&quot; }])[0].uid || \&quot;\&quot;;\n                    var paramUrl = apiURL + uid;\n                    api.delete(paramUrl)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _models.CmsMail.find({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; },\n                                    function(error, templates) {\n                                        (error == null &amp;&amp; (templates || []).length == 0).should.equal(true);\n                                        done();\n                                    });\n                            }\n                        });\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66e87a02-fc20-46be-ae5a-cb60e106999b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;66e87a02-fc20-46be-ae5a-cb60e106999b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2789f8a0-399e-4707-b5a3-104ed4e4b326&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\deleteMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteMessage.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;324de69c-6f74-4e10-80ef-ea0997494393&quot;,&quot;title&quot;:&quot;contentStack.deleteMessage&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\deleteMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deleteMessage.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteMessage \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMessage.remove({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; }, function(error, message) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4ae3e91-757d-441f-9634-d23bdc794522&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteMessage \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45550d92-d515-42d9-acbd-492c4087ddd8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deleteMessage Should delete message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.CmsMessage.find({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; },\n                function(error, users) {\n                    var uid = (users || [{ uid: \&quot;\&quot; }])[0].uid || \&quot;\&quot;;\n                    var paramUrl = apiURL + uid;\n                    api.delete(paramUrl)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _models.CmsMessage.find({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; },\n                                    function(error, users) {\n                                        (error == null &amp;&amp; (users || []).length == 0).should.equal(true);\n                                        done();\n                                    });\n                            }\n                        });\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a664ae27-36c8-4d74-b44e-07be5b0d7a8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a664ae27-36c8-4d74-b44e-07be5b0d7a8f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:11,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;031327d2-3679-44ab-85ce-23005e150fba&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\deletePlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deletePlansFaq.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;52d73fe6-ad51-43e7-9613-3a3565a80891&quot;,&quot;title&quot;:&quot;contentStack.deletePlansFaq&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\deletePlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\deletePlansFaq.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deletePlansFaq \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.PlansFaq.remove({ question_title: \&quot;UNIT_TEST_QUESTION\&quot; }, function(error, message) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f0125c6-26c9-41d6-a846-d1b900493f29&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deletePlansFaq \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e1d4f70e-4a02-4c5f-b8de-eec9d99249c5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete planfaqs.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.deletePlansFaq Should delete planfaqs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/planfaqs\&quot;)\n    .send(planFaqBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.PlansFaq.find({ question_title: \&quot;UNIT_TEST_QUESTION\&quot; },\n                function(error, planFaqs) {\n                    var uid = (planFaqs || [{ uid: \&quot;\&quot; }])[0].uid || \&quot;\&quot;;\n                    var paramUrl = apiURL + uid;\n                    api.delete(paramUrl)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _models.PlansFaq.find({ question_title: \&quot;UNIT_TEST_QUESTION\&quot; },\n                                    function(error, planFaqs) {\n                                        (error == null &amp;&amp; (planFaqs || []).length == 0).should.equal(true);\n                                        done();\n                                    });\n                            }\n                        });\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3735af7-147b-4b7f-9bd0-d186b9d4de3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c3735af7-147b-4b7f-9bd0-d186b9d4de3f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:11,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bbcc7d76-6369-430f-8b56-c1632e6ff2bb&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\getAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getAnnouncement.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d3afeb37-695a-4e93-9742-f9ed801e7a13&quot;,&quot;title&quot;:&quot;contentStack.getAnnouncement&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\getAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getAnnouncement.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getAnnouncement \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a4751a98-05a2-46e0-9a43-4edc03b993f3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getAnnouncement \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff2fdcfd-948b-482f-9e88-477a53b7c08f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get enterprise announcements.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getAnnouncement Should get enterprise announcements.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/announcements\&quot;)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(apiGetURL)\n                .set(\&quot;authtoken\&quot;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = Array.isArray(res.body.output.objects);\n                        if (isValid) {\n                            _.each(res.body.output.objects, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea72325b-b5eb-4477-bb0e-27315cfec063&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get particular enterprise announcement.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getAnnouncement Should get particular enterprise announcement.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/announcements\&quot;)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(apiGetURL + \&quot;/\&quot; + announcementBody.entry.uid)\n                .set(\&quot;authtoken\&quot;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == announcementBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bbb6c057-65f3-4f12-b1e0-6bb8b95be8e2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ea72325b-b5eb-4477-bb0e-27315cfec063&quot;,&quot;bbb6c057-65f3-4f12-b1e0-6bb8b95be8e2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:36,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e1ee2ca1-a0a7-45c9-a381-42b419187312&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\getEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;64a77314-9613-4dbf-9932-b1d599ff2c09&quot;,&quot;title&quot;:&quot;contentStack.getEmailTemplate&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\getEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6033,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMail.remove({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; }, function(error, template) {\n    _models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        enterpriseAuthToken = res.body.output.authtoken;\n                        var tempRegistrationBody = global.getImmutable(registrationBody);\n                        tempRegistrationBody.email = \&quot;test.user+100000@raweng.com\&quot;;\n                        commonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n                            email: tempRegistrationBody.email\n                        });\n                        api.post(\&quot;/express/v1/signup\&quot;)\n                            .send(tempRegistrationBody)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    expressAuthToken = res.body.output.authtoken;\n                                    done();\n                                }\n                            });\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e45dc0c2-b95e-4013-b04c-700856ae1075&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38cb9901-d4ad-4535-817f-de96a240ea71&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get enterprise email templates.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate Should get enterprise email templates.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nemailTemplateBody.entry.enterprise = true;\nemailTemplateBody.entry.express = false;\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/templates\&quot;)\n                .expect(httpStatus.OK)\n                .set(\&quot;authtoken\&quot;, enterpriseAuthToken)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = Array.isArray(res.body.output);\n                        if (isValid) {\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb12b57d-e28e-4589-8005-17890f0e37ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get specific enterprise email template.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate Should get specific enterprise email template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nemailTemplateBody.entry.enterprise = true;\nemailTemplateBody.entry.express = false;\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/templates/UNIT_TEST_TEMPLATE\&quot;)\n                .expect(httpStatus.OK)\n                .set(\&quot;authtoken\&quot;, enterpriseAuthToken)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == emailTemplateBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c226ff9-024f-483f-9366-ee168009104b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get express email templates.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate Should get express email templates.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nemailTemplateBody.entry.enterprise = false;\nemailTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/express/v1/cms/templates\&quot;)\n                .expect(httpStatus.OK)\n                .set(\&quot;authtoken\&quot;, expressAuthToken)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = Array.isArray(res.body.output);\n                        if (isValid) {\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c104f87b-310e-4506-bba7-5a63a1e2c807&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get specific express email template.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate Should get specific express email template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nemailTemplateBody.entry.enterprise = false;\nemailTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/express/v1/cms/templates/UNIT_TEST_TEMPLATE\&quot;)\n                .expect(httpStatus.OK)\n                .set(\&quot;authtoken\&quot;, expressAuthToken)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == emailTemplateBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1587281-5a3b-463c-9336-037b27169fd5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get template not found error message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getEmailTemplate Should get template not found error message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nemailTemplateBody.entry.enterprise = false;\nemailTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/templates\&quot;)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/express/v1/cms/templates/UNIT_TEST_TEMPLATE0\&quot;)\n                .set(\&quot;authtoken\&quot;, expressAuthToken)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.CMS_EMAIL_TEMPLATE_NOT_FOUND);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e605e3c7-a6ae-45ef-96ce-a7b040f342ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cb12b57d-e28e-4589-8005-17890f0e37ff&quot;,&quot;0c226ff9-024f-483f-9366-ee168009104b&quot;,&quot;c104f87b-310e-4506-bba7-5a63a1e2c807&quot;,&quot;c1587281-5a3b-463c-9336-037b27169fd5&quot;,&quot;e605e3c7-a6ae-45ef-96ce-a7b040f342ce&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:94,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e5b70392-afcf-4cff-9d32-c9ad9ba2e908&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\getLatestAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getLatestAnnouncement.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;379a76b1-a6f8-4011-a6b9-b591918fa922&quot;,&quot;title&quot;:&quot;contentStack.getLatestAnnouncement&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\getLatestAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getLatestAnnouncement.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getLatestAnnouncement \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c073e9d3-fe5f-4123-b907-4a7d883130e9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getLatestAnnouncement \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc408640-df6a-4eb5-a960-53a908227bc3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get latest enterprise announcement.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getLatestAnnouncement Should get latest enterprise announcement.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/announcements\&quot;)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(apiGetURL)\n                .set(\&quot;authtoken\&quot;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.uid.should.not.equal(\&quot;\&quot;);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8d5e531c-44f5-44f7-8cd2-6970426e002a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8d5e531c-44f5-44f7-8cd2-6970426e002a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;28bd7c25-86e7-4db6-a9cb-b27284af7de2&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\getMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getMessage.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2210ac8e-fc95-4ae9-99ad-483fc8c1ec04&quot;,&quot;title&quot;:&quot;contentStack.getMessage&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\getMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getMessage.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4713,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMessage.remove({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; }, function(error, message) {\n    _models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        enterpriseAuthToken = res.body.output.authtoken;\n                        var tempRegistrationBody = global.getImmutable(registrationBody);\n                        tempRegistrationBody.email = \&quot;test.user+100000@raweng.com\&quot;;\n                        commonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n                            email: tempRegistrationBody.email\n                        });\n                        api.post(\&quot;/express/v1/signup\&quot;)\n                            .send(tempRegistrationBody)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    expressAuthToken = res.body.output.authtoken;\n                                    done();\n                                }\n                            });\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f9f0c53-290b-4a4e-a74f-d602192dc1e7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05c1b9e0-9cf7-4e81-86c2-34a0e5e9c453&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get enterprise messages.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage Should get enterprise messages.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nmessageTemplateBody.entry.enterprise = true;\nmessageTemplateBody.entry.express = false;\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/messages\&quot;)\n                .set(\&quot;authtoken\&quot;, enterpriseAuthToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = Array.isArray(res.body.output);\n                        if (isValid) {\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;08675b9f-0bd5-4208-b72c-4edf1e568315&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get specific enterprise message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage Should get specific enterprise message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nmessageTemplateBody.entry.enterprise = true;\nmessageTemplateBody.entry.express = false;\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/messages/UNIT_TEST_MESSAGE\&quot;)\n                .set(\&quot;authtoken\&quot;, enterpriseAuthToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == messageTemplateBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;559dc78c-1ed0-4adf-bc71-d6a61b1e1809&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get express messages.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage Should get express messages.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nmessageTemplateBody.entry.enterprise = false;\nmessageTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/express/v1/cms/messages\&quot;)\n                .set(\&quot;authtoken\&quot;, expressAuthToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n\n                        var isValid = Array.isArray(res.body.output);\n                        if (isValid) {\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8de6be8-582b-47b9-a3a1-0a495c537338&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get specific express message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage Should get specific express message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nmessageTemplateBody.entry.enterprise = false;\nmessageTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/express/v1/cms/messages/UNIT_TEST_MESSAGE\&quot;)\n                .set(\&quot;authtoken\&quot;, expressAuthToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == messageTemplateBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;451556cf-a1c9-499b-87f2-1f89fffe9818&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get message not found error message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getMessage Should get message not found error message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nmessageTemplateBody.entry.enterprise = false;\nmessageTemplateBody.entry.express = true;\napi.post(\&quot;/v1/cms/messages\&quot;)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/messages/UNIT_TEST_MESSAGE0\&quot;)\n                .set(\&quot;authtoken\&quot;, enterpriseAuthToken)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.CMS_MESSAGE_NOT_FOUND);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b5286de-b9ff-4bc8-b520-901ec77e4645&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;08675b9f-0bd5-4208-b72c-4edf1e568315&quot;,&quot;559dc78c-1ed0-4adf-bc71-d6a61b1e1809&quot;,&quot;b8de6be8-582b-47b9-a3a1-0a495c537338&quot;,&quot;451556cf-a1c9-499b-87f2-1f89fffe9818&quot;,&quot;1b5286de-b9ff-4bc8-b520-901ec77e4645&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:92,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6ff7dfd1-34ac-41db-9d47-643b798d3d1c&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\getPlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getPlansFaq.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0e6fba91-76e9-47e6-85e7-c8e10039c0a5&quot;,&quot;title&quot;:&quot;contentStack.getPlansFaq&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\getPlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\getPlansFaq.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getPlansFaq \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20734cf0-48e4-4ea1-be14-28ad5c72c4e5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getPlansFaq \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a371b33-c3e0-45d4-87a3-006d36788703&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get enterprise planfaq.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getPlansFaq Should get enterprise planfaq.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/planfaqs\&quot;)\n    .send(planFaqBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/planfaqs\&quot;)\n                .set(\&quot;authtoken\&quot;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = Array.isArray(res.body.output);\n                        if (isValid) {\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13e8e43a-7709-4875-9c50-47bba5376936&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get particular enterprise planfaq.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.getPlansFaq Should get particular enterprise planfaq.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/v1/cms/planfaqs\&quot;)\n    .send(planFaqBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/cms/planfaqs/\&quot; + planFaqBody.entry.uid)\n                .set(\&quot;authtoken\&quot;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.uid == planFaqBody.entry.uid &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0109471-4a13-4e35-926e-2b83aa1c9b1e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;13e8e43a-7709-4875-9c50-47bba5376936&quot;,&quot;d0109471-4a13-4e35-926e-2b83aa1c9b1e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:47,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9dab90b3-c0dd-4886-b5f6-b20d32417b8c&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\saveAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveAnnouncement.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;48186a4e-d554-4cfb-9cac-5f4ac1977983&quot;,&quot;title&quot;:&quot;contentStack.saveAnnouncement&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\saveAnnouncement.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveAnnouncement.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveAnnouncement \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Announcement.remove({ title: \&quot;UNIT_TEST_ANNOUNCEMENT\&quot; }, function(error, message) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7bb7642a-9879-4d7a-96a6-e9f1c663771d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveAnnouncement \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac6019a9-f415-486c-b1da-6bf038b6660f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create announcement.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveAnnouncement Should create announcement.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.status.should.equal(\&quot;success\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62e805f6-b5cb-4bfe-a5f5-ceb4e9232abd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give require validators errors.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveAnnouncement Should give require validators errors.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;entry.uid\&quot;].message == messageList.CMS_ANNOUNCEMENT_UID_NOT_FOUND;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30427fae-9de3-473c-a681-f83b99fdb88c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update existing announcement.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveAnnouncement Should update existing announcement.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(announcementBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            announcementBody.entry.rich_text_editor = \&quot;UNIT_TEST_ANNOUNCEMENT_BODY_00\&quot;;\n            api.post(apiURL)\n                .send(announcementBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _models.Announcement.find({ title: \&quot;UNIT_TEST_ANNOUNCEMENT\&quot; },\n                            function(error, announcement) {\n                                var isValid =\n                                    (announcement || []).length == 1 &amp;&amp;\n                                    (announcement || [{ raw_html_body: \&quot;\&quot; }])[0].raw_html_body == \&quot;UNIT_TEST_ANNOUNCEMENT_BODY_00\&quot; &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                isValid.should.equal(true);\n                                done();\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44a9da69-6bdd-4de4-8a5d-6ff40f52ca12&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;62e805f6-b5cb-4bfe-a5f5-ceb4e9232abd&quot;,&quot;30427fae-9de3-473c-a681-f83b99fdb88c&quot;,&quot;44a9da69-6bdd-4de4-8a5d-6ff40f52ca12&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7a119a61-bbf2-4508-9e26-749321729d27&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\saveEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b0bcc01c-44f8-4cad-951a-e16c2d662584&quot;,&quot;title&quot;:&quot;contentStack.saveEmailTemplate&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\saveEmailTemplate.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveEmailTemplate.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveEmailTemplate \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMail.remove({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; }, function(error, template) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b944b3e5-af86-40c0-92a0-6b4c61f05253&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveEmailTemplate \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6ddce82c-767b-458c-9b50-78f0858e375f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create email template.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveEmailTemplate Should create email template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.status == \&quot;success\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;94dce11c-9098-4694-a756-bae395f3b66b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give require validators errors.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveEmailTemplate Should give require validators errors.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;entry.uid\&quot;].message == messageList.CMS_EMAIL_UID_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.enterprise\&quot;].message == messageList.CMS_EMAIL_ENTERPRISE_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.express\&quot;].message == messageList.CMS_EMAIL_EXPRESS_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.template_id\&quot;].message == messageList.CMS_EMAIL_TEMPLATES_UID_NOT_FOUND;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82638485-534d-4d3d-a7cf-7e6c29b1c010&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update existing email template.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveEmailTemplate Should update existing email template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(emailTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            emailTemplateBody.entry.title = \&quot;TITLE_GOT_CHANGED\&quot;;\n            api.post(apiURL)\n                .send(emailTemplateBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _models.CmsMail.find({ template_id: \&quot;UNIT_TEST_TEMPLATE\&quot; },\n                            function(error, templates) {\n                                var isValid =\n                                    (templates || []).length == 1 &amp;&amp;\n                                    (templates || [{ title: \&quot;\&quot; }])[0].title == \&quot;TITLE_GOT_CHANGED\&quot; &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                isValid.should.equal(true);\n                                done();\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c619ee79-dd79-4ea7-9959-13bef258843b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;94dce11c-9098-4694-a756-bae395f3b66b&quot;,&quot;82638485-534d-4d3d-a7cf-7e6c29b1c010&quot;,&quot;c619ee79-dd79-4ea7-9959-13bef258843b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b0a99976-aea0-4fc9-9556-d2c23b8b7423&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\saveMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveMessage.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1a8aad7c-ed0e-4d50-8bc0-f58850263e38&quot;,&quot;title&quot;:&quot;contentStack.saveMessage&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\saveMessage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\saveMessage.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveMessage \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.CmsMessage.remove({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; }, function(error, message) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8971eb52-348c-44ee-a1f5-17c7b62acc81&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveMessage \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c27572b-ba7e-4c0b-a737-aede06d40112&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveMessage Should create message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.status == \&quot;success\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;09ff0083-10ae-4aee-8d6a-9cecaef95802&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give require validators errors.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveMessage Should give require validators errors.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;entry.uid\&quot;].message == messageList.CMS_MESSAGE_UID_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.enterprise\&quot;].message == messageList.CMS_MESSAGE_ENTERPRISE_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.express\&quot;].message == messageList.CMS_MESSAGE_EXPRESS_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;entry.message_id\&quot;].message == messageList.CMS_MESSAGE_TEMPLATES_UID_NOT_FOUND;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ffe7a3cf-5296-4019-b66d-f879a7aa05cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update existing message.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.saveMessage Should update existing message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(messageTemplateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            messageTemplateBody.entry.title = \&quot;TITLE_GOT_CHANGED\&quot;;\n            api.post(apiURL)\n                .send(messageTemplateBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _models.CmsMessage.find({ message_id: \&quot;UNIT_TEST_MESSAGE\&quot; },\n                            function(error, messages) {\n                                var isValid =\n                                    (messages || []).length == 1 &amp;&amp;\n                                    (messages || [{ title: \&quot;\&quot; }])[0].title == \&quot;TITLE_GOT_CHANGED\&quot; &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                isValid.should.equal(true);\n                                done();\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0dfdec3d-0d7f-432e-8aa7-88322ddf80f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;09ff0083-10ae-4aee-8d6a-9cecaef95802&quot;,&quot;ffe7a3cf-5296-4019-b66d-f879a7aa05cd&quot;,&quot;0dfdec3d-0d7f-432e-8aa7-88322ddf80f0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a608034e-e94d-4482-8582-4933f6fc99ba&quot;,&quot;title&quot;:&quot;contentStack&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\savePlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\savePlansFaq.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6e9b5e1b-a5fd-4901-b5a7-bacf648f6f6a&quot;,&quot;title&quot;:&quot;contentStack.savePlansFaq&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\contentStack\\savePlansFaq.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\contentStack\\savePlansFaq.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.savePlansFaq \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f57122ef-dc5d-4b60-906e-3523980482d9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.savePlansFaq \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23924c4a-db22-4089-a20c-8a3e803f7394&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should save planfaqs.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.savePlansFaq Should save planfaqs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(planFaqBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.status == \&quot;success\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6ab9a015-db87-4e4e-b367-edabb8789d16&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give require validators errors.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.savePlansFaq Should give require validators errors.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;entry.uid\&quot;].message == messageList.CMS_PLANFAQ_UID_NOT_FOUND &amp;&amp;\n                res.body.error[\&quot;message\&quot;] == messageList.PLEASE_SEND_VALID_PARAMETERS\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69f09fc5-4e2e-472a-b029-33ada0569180&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update existing planfaqs.&quot;,&quot;fullTitle&quot;:&quot;contentStack contentStack.savePlansFaq Should update existing planfaqs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(planFaqBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            planFaqBody.entry.answer = \&quot;UNIT_TEST_ANSWER00\&quot;;\n            api.post(apiURL)\n                .send(planFaqBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _models.PlansFaq.find({ question_title: \&quot;UNIT_TEST_QUESTION\&quot; },\n                            function(error, planFaq) {\n                                var isValid =\n                                    (planFaq || []).length == 1 &amp;&amp;\n                                    (planFaq || [{ question_title: \&quot;\&quot; }])[0].answer == \&quot;UNIT_TEST_ANSWER00\&quot; &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n\n                                isValid.should.equal(true);\n                                done();\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77673946-c53b-4d36-b9da-d6b3209882a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6ab9a015-db87-4e4e-b367-edabb8789d16&quot;,&quot;69f09fc5-4e2e-472a-b029-33ada0569180&quot;,&quot;77673946-c53b-4d36-b9da-d6b3209882a0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f24e4be0-3e98-4545-a5fc-4398926ca202&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\createCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\createCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fe221c9e-4d15-47b1-ae86-698547c77c76&quot;,&quot;title&quot;:&quot;CustomIntegration.Create&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\createCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\createCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3152,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9990d8a2-b322-45d5-976c-78f851ad199b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2c9260b-5945-4216-9a3b-d42ed7a07e70&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a142201-0a86-43b0-a2ad-ab770d084c19&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;label\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;label\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.label = &#x27;&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;70858b1e-72ef-48a0-86dc-353e4bff9804&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;code_template\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;code_template\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.code_template = &#x27;&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84102e9d-15bd-4dd5-8acc-4db685f454bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compile_error\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;compile_error\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.compile_error = &#x27;&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;92acb24c-faf5-4e56-be9f-3da2ccc61b23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compiled_result\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;compiled_result\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.compiled_result = &#x27;&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2829fe12-d1ee-4091-bff6-3c899c720c42&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;code_template\&quot; key is not string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;code_template\&quot; key is not string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCodeTemplate = _.clone(data)\ninvalidCodeTemplate.code_template = {};\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidCodeTemplate)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_PARAM_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;863b98f7-5693-4842-a941-cc60998cc02d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compiled_result\&quot; key is not string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should give error, if \&quot;compiled_result\&quot; key is not string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCompiledResult = _.clone(data)\ninvalidCompiledResult.compiled_result = {};\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidCompiledResult)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_PARAM_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9fb388d6-1612-4315-976e-c0f8b48a0775&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create custom integration if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Create Should create custom integration if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.user_uid).to.be.equal(dummyUser.uid);\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ded1e13-11bd-468c-9623-0a40d15982d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7a142201-0a86-43b0-a2ad-ab770d084c19&quot;,&quot;70858b1e-72ef-48a0-86dc-353e4bff9804&quot;,&quot;84102e9d-15bd-4dd5-8acc-4db685f454bf&quot;,&quot;92acb24c-faf5-4e56-be9f-3da2ccc61b23&quot;,&quot;2829fe12-d1ee-4091-bff6-3c899c720c42&quot;,&quot;863b98f7-5693-4842-a941-cc60998cc02d&quot;,&quot;9fb388d6-1612-4315-976e-c0f8b48a0775&quot;,&quot;1ded1e13-11bd-468c-9623-0a40d15982d2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:101,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;39a10230-8431-46fb-9a03-9311275e5f22&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\deleteCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\deleteCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;036d761c-1a48-444a-939e-24c71a0fa06d&quot;,&quot;title&quot;:&quot;CustomIntegration.Delete&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\deleteCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\deleteCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Delete \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2109,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        customIntegration = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;92677f6e-aff9-4ff1-be8c-7744a6d56b7f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Delete \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;92651907-f54f-4424-97c5-4246bb6bf09e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Delete Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec688ebb-167a-4306-a832-4ea558bf91d9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if integration not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Delete Should give error, if integration not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/dummyIntegration&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79a431e9-bb28-46ec-a5b2-f8cc9795d54f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete custom if integration found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Delete Should delete custom if integration found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.result).to.be.equal(&#x27;success&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7afbbb0-7418-4782-906d-d4d118040969&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ec688ebb-167a-4306-a832-4ea558bf91d9&quot;,&quot;79a431e9-bb28-46ec-a5b2-f8cc9795d54f&quot;,&quot;a7afbbb0-7418-4782-906d-d4d118040969&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;91bb0348-5131-46b9-96ea-95a9720a3176&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\getCompiledCustomIntegrationByUserUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCompiledCustomIntegrationByUserUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4ccfa6a9-8224-411d-bc66-854f229ab84e&quot;,&quot;title&quot;:&quot;CustomIntegration.GetByUserUID&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\getCompiledCustomIntegrationByUserUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCompiledCustomIntegrationByUserUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4013,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        customIntegration = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c718c47-bf2c-4721-8281-ee4ec4199dcd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5255bf02-20ec-46c6-84e4-4d41060bb84d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/compiled&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9ab89aa-1de0-4c23-a43f-435637cc906c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get custom if integration found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID Should get custom if integration found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/compiled&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.a(&#x27;array&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bcfc1313-736d-422d-be3c-2d062e841e95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c9ab89aa-1de0-4c23-a43f-435637cc906c&quot;,&quot;bcfc1313-736d-422d-be3c-2d062e841e95&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:17,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;26ae77f9-d1eb-4492-827a-6580431ac71a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\getCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;126b3c77-b207-4245-800f-94df06151b55&quot;,&quot;title&quot;:&quot;CustomIntegration.Update&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\getCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2462,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        customIntegration = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ae44705f-e2eb-4027-9291-7d96ec4d184e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e045d7a7-762b-488d-982f-cd67ef67692a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/css&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e63f9327-43b4-414c-aacb-3d3ac31a4b92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get custom integration css.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should get custom integration css.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/css&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).to.be.equal(1);\n            expect(_.first(res.body.output).integration_uid).not.to.be.equal(null)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a75d4417-7725-4dd5-879a-acff73756840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e63f9327-43b4-414c-aacb-3d3ac31a4b92&quot;,&quot;a75d4417-7725-4dd5-879a-acff73756840&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;821805fb-af94-4742-b500-7f3c561cd950&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\getCustomIntegrationByUserUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCustomIntegrationByUserUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c1dec1eb-afa1-4c6c-b2ed-180b488a92df&quot;,&quot;title&quot;:&quot;CustomIntegration.GetByUserUID&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\getCustomIntegrationByUserUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getCustomIntegrationByUserUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3280,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        customIntegration = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b7c4bf2-bb50-40b9-b7d3-fb884bbfb03e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3da08b76-dd5d-4267-8667-93121da846c0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;754ad0e5-2b1e-4366-bfd8-0ef3ae14c8c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get custom if integration found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetByUserUID Should get custom if integration found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).to.be.equal(1);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7741d5f5-5320-4293-b9b5-db067ee47e6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;754ad0e5-2b1e-4366-bfd8-0ef3ae14c8c1&quot;,&quot;7741d5f5-5320-4293-b9b5-db067ee47e6f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:17,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;15f86aea-011b-4a1c-87ef-12405e4e55f3&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\getFlowsByCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getFlowsByCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d99602ac-1268-47c1-88b9-caad4f4c43ab&quot;,&quot;title&quot;:&quot;CustomIntegration.GetFlows&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\getFlowsByCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\getFlowsByCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2953,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        customIntegration = result.body.output;\n        flowData.activities[2].uid = customIntegration.uid;\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60c6b808-792c-42ea-ba4e-03d789ad7a9a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0430903e-3dc3-46d1-998d-5813ca2e6566&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/&#x27; + customIntegration.uid + &#x27;/flows&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f8381c3-4f02-4ef0-a18e-55f2b9390053&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows of custom  integrtion.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows Should get list of flows of custom  integrtion.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/&#x27; + customIntegration.uid + &#x27;/flows&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output[0]).to.contain.all.keys([&#x27;uid&#x27;, &#x27;name&#x27;])\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2ee2548-fa0a-4e45-ae8b-9a0fb8f926eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1f8381c3-4f02-4ef0-a18e-55f2b9390053&quot;,&quot;d2ee2548-fa0a-4e45-ae8b-9a0fb8f926eb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;68b97c4f-f008-4c3e-ace1-87cd9347d0c6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\updateCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\updateCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8a856ad9-6ca0-46cb-a41b-f8758a276906&quot;,&quot;title&quot;:&quot;CustomIntegration.Update&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\customeIntegration\\updateCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\customeIntegration\\updateCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2331,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        customIntegration = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98d9b33f-5594-45e2-b32d-28c30483eecb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d7a7ae69-4611-4545-a1e9-88d3492e0133&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;180ccf3d-0c6c-4101-a97e-c59d7c96ca10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;label\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;label\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.label = &#x27;&#x27;;\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3dd37053-aa72-4987-b312-8f3b992dc60d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;code_template\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;code_template\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.code_template = &#x27;&#x27;;\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0ae3bb4-88c6-4def-9160-05d399560efb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compile_error\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;compile_error\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.compile_error = &#x27;&#x27;;\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;205752e4-90b3-4ddb-91c7-b6ee527f504e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compiled_result\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;compiled_result\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingLabelKey = _.clone(data)\nmissingLabelKey.compiled_result = &#x27;&#x27;;\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingLabelKey)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31fc0dcc-68a7-4fa7-999c-4942fbed153c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;code_template\&quot; key is not string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;code_template\&quot; key is not string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCodeTemplate = _.clone(data)\ninvalidCodeTemplate.code_template = {};\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidCodeTemplate)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_PARAM_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6556dd4a-87ca-42d1-a21e-59b5988347d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if \&quot;compiled_result\&quot; key is not string.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if \&quot;compiled_result\&quot; key is not string.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidCompiledResult = _.clone(data)\ninvalidCompiledResult.compiled_result = {};\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidCompiledResult)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_PARAM_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e4d500b-c1b0-4fb7-84e5-ebda0a3a2850&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if integration not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should give error, if integration not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + &#x27;/dummyIntegration&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_INTEGRATION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;71faabe7-6e83-4ce4-8d15-19ab32424026&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update custom integration if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.Update Should update custom integration if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndata.label = &#x27;updated&#x27;;\napi.put(apiURL + &#x27;/&#x27; + customIntegration.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.label).to.be.equal(&#x27;updated&#x27;);\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;548369f7-caf3-4d39-a333-cde801d7e319&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;180ccf3d-0c6c-4101-a97e-c59d7c96ca10&quot;,&quot;3dd37053-aa72-4987-b312-8f3b992dc60d&quot;,&quot;d0ae3bb4-88c6-4def-9160-05d399560efb&quot;,&quot;205752e4-90b3-4ddb-91c7-b6ee527f504e&quot;,&quot;31fc0dcc-68a7-4fa7-999c-4942fbed153c&quot;,&quot;6556dd4a-87ca-42d1-a21e-59b5988347d5&quot;,&quot;2e4d500b-c1b0-4fb7-84e5-ebda0a3a2850&quot;,&quot;71faabe7-6e83-4ce4-8d15-19ab32424026&quot;,&quot;548369f7-caf3-4d39-a333-cde801d7e319&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:110,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;edf349e4-7846-45f4-b9ab-8318963bfbf5&quot;,&quot;title&quot;:&quot;DevOps&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\devOps\\getFlowDetails.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\devOps\\getFlowDetails.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;887391ee-f988-43a6-9a4f-40ed9303bdc1&quot;,&quot;title&quot;:&quot;DevOps.GetFlowDetails&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\devOps\\getFlowDetails.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\devOps\\getFlowDetails.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error ui_admin_key is invalid.&quot;,&quot;fullTitle&quot;:&quot;DevOps DevOps.GetFlowDetails Should give unauthenticated user error ui_admin_key is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Unauthorized&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3630ea50-0762-47a2-a70a-1fc604ca7df2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get data, if valid ui_admin_key sent.&quot;,&quot;fullTitle&quot;:&quot;DevOps DevOps.GetFlowDetails Should get data, if valid ui_admin_key sent.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8a2a56b-da54-4b39-a59c-b9d9e574c4db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3630ea50-0762-47a2-a70a-1fc604ca7df2&quot;,&quot;d8a2a56b-da54-4b39-a59c-b9d9e574c4db&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ddcc1ed4-6d4f-496b-93ee-6e8c70f18665&quot;,&quot;title&quot;:&quot;DevOps&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\devOps\\getUserDetails.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\devOps\\getUserDetails.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;655e04fc-33f4-4ad7-8f8a-bc2e98766627&quot;,&quot;title&quot;:&quot;DevOps.GetUserDetails&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\devOps\\getUserDetails.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\devOps\\getUserDetails.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error ui_admin_key is invalid.&quot;,&quot;fullTitle&quot;:&quot;DevOps DevOps.GetUserDetails Should give unauthenticated user error ui_admin_key is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Unauthorized&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;677842e2-ba99-4994-9bf9-8b83176b85ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get data, if valid ui_admin_key sent.&quot;,&quot;fullTitle&quot;:&quot;DevOps DevOps.GetUserDetails Should get data, if valid ui_admin_key sent.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aac47f36-9e4b-4a44-aeaa-f3f50948cebb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;677842e2-ba99-4994-9bf9-8b83176b85ee&quot;,&quot;aac47f36-9e4b-4a44-aeaa-f3f50948cebb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:6,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;60ee07d5-6909-4633-a65e-e3f35b56ac4b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\environment\\createEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\createEnvironment.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e338237d-c7c3-42ed-8133-ed354bcf0dd3&quot;,&quot;title&quot;:&quot;Environment.Create&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\environment\\createEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\createEnvironment.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Create \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken;\n        done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;341351e1-0bcd-4924-bb57-b1632f2f18b6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Environment.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [env.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;880662a9-3476-46a5-9214-cb960c2dbce8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Create Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a3b8b43-76e4-4472-a0f6-dbcf49889fb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create env, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Create Should create env, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            env = res.body.output\n            expect(env.name).equal(projectData.name);\n            expect(env).to.have.any.keys([&#x27;name&#x27;, &#x27;owner_uid&#x27;]);\n            done()\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;312088b6-a23e-4b71-8a77-dfaf2f5d5d26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if env name is blank.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Create Should get error if env name is blank.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;&#x27;\nprojectData.user_uid = dummyUser.uid\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            expect(res.body.error.name.message).equal(messageList.ENV_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0dee583-afef-434c-9ce3-ff775644c193&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8a3b8b43-76e4-4472-a0f6-dbcf49889fb7&quot;,&quot;312088b6-a23e-4b71-8a77-dfaf2f5d5d26&quot;,&quot;b0dee583-afef-434c-9ce3-ff775644c193&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1be6d595-7f75-4aba-925f-ff45b66a5862&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\environment\\getEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\getEnvironment.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;59dd17cc-d5d9-49fc-8910-be5a4e20ecb8&quot;,&quot;title&quot;:&quot;Environment.Get&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\environment\\getEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\getEnvironment.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Get \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken;\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken })\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    env = res.body.output\n                    done()\n                }\n            });\n   // });\n   // done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b970da1-8890-424a-a3dd-e2c119654b4c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Get \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Environment.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [env.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a06c782-7db3-4a5d-a4aa-7436ddcce9da&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Get Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + env.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a304080b-f29e-4695-9668-22f0dccc4983&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update env, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Get Should update env, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + env.uid)\n    .set({ authtoken: dummyUser.authtoken })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            env = res.body.output\n            expect(env.name).equal(projectData.name);\n            done()\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3c0fbe31-4374-427f-ad41-955fd3a6c9e9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if env not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.Get Should get error if env not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;&#x27;\nprojectData.user_uid = dummyUser.uid\napi.get(apiURL + &#x27;dummyEnv&#x27;)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.ENV_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bf71872d-537a-412d-be25-d23f37906388&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a304080b-f29e-4695-9668-22f0dccc4983&quot;,&quot;3c0fbe31-4374-427f-ad41-955fd3a6c9e9&quot;,&quot;bf71872d-537a-412d-be25-d23f37906388&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:28,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;cf00ac05-d89a-4bfe-be8e-89d21537a78a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\environment\\listEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\listEnvironment.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2e9165ba-4dde-448e-936b-40c28cc3a8c1&quot;,&quot;title&quot;:&quot;Environment.List&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\environment\\listEnvironment.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\environment\\listEnvironment.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.List \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken;\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken })\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    env = res.body.output\n                    done()\n                }\n            });\n   // });\n   // done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12ba4728-3dad-4300-9785-ce2a2ca09bcd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.List \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Environment.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [env.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f19a8447-489b-4500-81ff-90dee473f3e8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.List Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f73ad9a-c8d8-4389-9652-7a9092490125&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update env, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Environment.List Should update env, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            env = res.body.output\n            expect(env.length).gte(1);\n            done()\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f8f1682-f8f9-4c38-a7c5-f7163694e079&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6f73ad9a-c8d8-4389-9652-7a9092490125&quot;,&quot;5f8f1682-f8f9-4c38-a7c5-f7163694e079&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;651d88af-06b8-404f-849f-46473b0a3bbb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\cloneUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\cloneUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2212e1d6-a9e2-4e5f-a901-4eb78931f3af&quot;,&quot;title&quot;:&quot;Flow.CloneUserFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\cloneUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\cloneUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:153,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerCreateSuccess(opt)\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n                function(cbk) {\n                    api.get(&#x27;/enterprise/v1/user&#x27;)\n                        .set(&#x27;authtoken&#x27;, orgData.owner.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                dummyUser = res.body.output;\n                                cbk(err, dummyUser)\n                            }\n                        });\n                },\n                function(dummyUser, cbk) {\n                    testData.mongoUserTriggerObj.user_uid = dummyUser.uid\n                    _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                        cbk(err, userTrigger);\n                    })\n                },\n                function(userTrigger, cbk) {\n                    //var flowData = _.cloneDeep(testData.enterpriseFlowBody)\n                    // _id = dummyUser._id\n                    userTrigger = userTrigger.toJSON()\n                    flowData.trigger.handlers = [userTrigger]\n                    flowData.configurations[0].params = [{\n                        \&quot;key\&quot;: \&quot;1\&quot;,\n                        \&quot;value\&quot;: \&quot;2\&quot;,\n                        \&quot;required\&quot;: true\n                    }, {\n                        \&quot;key\&quot;: \&quot;3\&quot;,\n                        \&quot;value\&quot;: \&quot;2\&quot;,\n                        \&quot;required\&quot;: false\n                    }];\n                    flowData.configurations[0].project_params = [{\n                        \&quot;uid\&quot;: \&quot;random\&quot;,\n                        \&quot;key\&quot;: \&quot;param1\&quot;,\n                        \&quot;value\&quot;: \&quot;parawal\&quot;,\n                        \&quot;required\&quot;: true,\n                        \&quot;isPassword\&quot;: false,\n                        \&quot;hasError\&quot;: false\n                    }]\n                    api.post(flowURL)\n                        .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                        .send(flowData)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            cbk(err, res)\n                        })\n                },\n                function(result, cbk) {\n                    userFlow = result.body.output;\n                    projectData.owner_uid = dummyUser.uid\n                    projectData.env_uid = dummyUser.default_env\n                    api.post(&#x27;/enterprise/v1/projects&#x27;)\n                        .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                        .send(projectData)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, result) {\n                            cbk(err, result);\n                        })\n                }\n            ],\n            function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var query = _models.Project.findOne({ name: config.default_project, owner_uid: dummyUser.uid })\n                    query.lean().exec(function(err, result) {\n                        if (result) {\n                            dummyUser.default_project = result.uid\n                        }\n                        project = res.body.output;\n                        done()\n                    })\n                }\n            })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;459f83a1-4719-41f0-9337-0f5124f0e071&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveFlow(createdFlows.concat([userFlow.uid, clonedFlow.flow.uid]), done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b808d748-d286-4da1-8b91-96d1ef7bcfdb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/clone&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4f4af4a-e066-4e04-992f-4a355128aaed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/dummyFlow/clone&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e7e52f1-63e3-4305-b19e-c57c95afebe3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should clone flow, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should clone flow, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: createTriggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true };\ncommonMock.triggerPushSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/clone&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ \&quot;project_uid\&quot;: userFlow.project_uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            clonedFlow = res.body.output;\n            expect(clonedFlow).to.have.all.keys([&#x27;flow&#x27;, &#x27;page&#x27;]);\n            expect(clonedFlow.flow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5322700a-f188-40b1-88a4-bcd21c76dff5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should clone flow in other project, if user sends \&quot;project_uid\&quot; in body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should clone flow in other project, if user sends \&quot;project_uid\&quot; in body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: createTriggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true };\ncommonMock.triggerPushSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nvar cloneOpt = { path: createTriggerPath, getPath: &#x27;/triggers/clone&#x27;, body: { \&quot;uid\&quot;: [/^fl\\w*/] }, update: true };\ncommonMock.triggerCloneSuccess(cloneOpt);\nvar orgDefaultProj = _.find(orgData.org_projects, { name: config.default_project })\nvar projectParamObj = _.merge(projectParams, { uid: &#x27;random&#x27;, type: &#x27;param&#x27;, project_uid: dummyUser.default_project, user_uid: dummyUser.uid })\nvar projectParams = [{\n    \&quot;uid\&quot;: \&quot;random\&quot;,\n    \&quot;key\&quot;: \&quot;param1\&quot;,\n    \&quot;value\&quot;: \&quot;parawal\&quot;,\n    \&quot;required\&quot;: true,\n    \&quot;isPassword\&quot;: false,\n    \&quot;hasError\&quot;: false\n}, {\n    \&quot;uid\&quot;: \&quot;random1\&quot;,\n    \&quot;key\&quot;: \&quot;param1\&quot;,\n    \&quot;value\&quot;: \&quot;parawal\&quot;,\n    \&quot;required\&quot;: true,\n    \&quot;isPassword\&quot;: false,\n    \&quot;hasError\&quot;: false\n}]\nvar params = [{\n    \&quot;key\&quot;: \&quot;1\&quot;,\n    \&quot;value\&quot;: \&quot;\&quot;,\n    \&quot;required\&quot;: true\n}, {\n    \&quot;key\&quot;: \&quot;3\&quot;,\n    \&quot;value\&quot;: \&quot;\&quot;,\n    \&quot;required\&quot;: false\n}]\n_models.ConfigSchema.create(projectParamObj, function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        projectParam = result.toJSON()\n        api.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/clone&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send({ \&quot;project_uid\&quot;: project.uid, project_params: projectParams, params: params })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    clonedFlow = res.body.output;\n                    expect(clonedFlow).to.have.all.keys([&#x27;flow&#x27;, &#x27;page&#x27;]);\n                    expect(clonedFlow.flow.errors_obj.length).eq(6)\n                    expect(clonedFlow.flow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n                    expect(clonedFlow.flow.project_uid).to.be.equal(project.uid);\n                    _models.ConfigSchema.find({ type: &#x27;param&#x27;, project_uid: project.uid }, function(err, result) {\n                        if (err) {\n                            done(err)\n                        } else {\n                            expect(result.length).eq(2)\n                            expect(_.first(result).project_uid).equal(project.uid)\n                            var query = _models.ConfigData.find({ flow_uid: clonedFlow.flow.uid })\n                            query.lean().exec(function(err, results) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var authData = _.find(results, { type: &#x27;auth&#x27; })\n                                    var connData = _.find(results, { type: &#x27;connection&#x27; })\n                                    expect(!_.has(authData, &#x27;auth&#x27;)).to.be.equal(true)\n                                    expect(!_.has(authData, &#x27;connection&#x27;)).to.be.equal(true)\n                                    expect(_.first(results).project_uid).to.be.equal(project.uid)\n                                    var query = _models.UserConfig.findOne({ project_uid: clonedFlow.flow.project_uid })\n                                    query.lean().exec(function(err, config) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            expect(_.first(results).config_uid).to.be.equal(config.uid)\n                                            done();\n                                        }\n                                    })\n                                }\n                            })\n                        }\n                    })\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4310e762-9d88-41be-80b0-f7d38e92554b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should clone flow in inactive state, if user exceeds active flow limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should clone flow in inactive state, if user exceeds active flow limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: createTriggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true };\ncommonMock.triggerPushSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nasync.waterfall([\n    function(cbk) {\n        var userFlowLimit = (dummyUser.user_plan.flow || {}).active\n        var flowData = _.cloneDeep(testData.enterpriseFlowBody)\n        flowData.owner_uid = dummyUser.uid;\n        flowData.author = [dummyUser.uid];\n        flowData.active = true;\n        async.times(userFlowLimit, function(n, next) {\n            _models.newFlow.create(flowData, function(err, userTrigger) {\n                next(err, userTrigger);\n            })\n        }, function(err, result) {\n            createdFlows = _.map(_.flattenDeep(result), &#x27;uid&#x27;)\n            cbk(err, result)\n        })\n    },\n    function(result, cbk) {\n        api.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/clone&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        clonedFlow = res.body.output;\n        //expect(res.body.output.flow.active).to.be.false;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d932436-2f74-44c8-adbc-e36aeabc4caa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CloneUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/clone&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.FLOW_COPY_USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b02b5114-dd07-45e2-8656-ddf90fcb228a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d4f4af4a-e066-4e04-992f-4a355128aaed&quot;,&quot;8e7e52f1-63e3-4305-b19e-c57c95afebe3&quot;,&quot;5322700a-f188-40b1-88a4-bcd21c76dff5&quot;,&quot;4310e762-9d88-41be-80b0-f7d38e92554b&quot;,&quot;3d932436-2f74-44c8-adbc-e36aeabc4caa&quot;,&quot;b02b5114-dd07-45e2-8656-ddf90fcb228a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:169,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a463ca69-cbb3-4087-9ac9-12b31388cd10&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\createProjectTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createProjectTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0d767c67-c50a-4368-9ca2-6aa62eeaff6b&quot;,&quot;title&quot;:&quot;Project.CreateTemplate&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\createProjectTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createProjectTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:121,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger.toJSON()\n                flowWithAllData.trigger.handlers = []\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowWithAllData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                orgFlow = res.body.output;\n                _models.newFlow._findOneAndUpdate({ uid: orgFlow.uid }, { is_draft: false }, function(err, updateFlow) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        orgFlow = updateFlow\n                        project = dummyUser.default_project\n                        api.get(&#x27;/enterprise/v1/projects/&#x27; + dummyUser.default_project + &#x27;/templateschema&#x27;)\n                            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (res) {\n                                    json_schema = res.body.output\n                                }\n                                done(err)\n                            })\n                    }\n                })\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0455848-3842-4bfc-9c47-b0da66bcb674&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.ProjectTemplate.remove(function(err, deletedFlow) {\n            cb(err, deletedFlow);\n        })\n    },\n    function(cb) {\n        _models.WorkFlowTemplate.remove(function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b2f6dda1-9143-4dda-a2ee-3f6d584d8e89&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + project + &#x27;/templates&#x27;)\n    .send(userFlow)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12e3aea9-30fa-449f-bf91-b073556b958f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project import template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate Should create project import template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:108,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nbody.json_schema = json_schema\napi.post(apiURL + project + &#x27;/templates&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var result = res.body.output\n            expect(result).to.have.any.keys([&#x27;uid&#x27;])\n                // expect(result.workflowTemplates.length).to.equal(1)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04393d18-cc96-4298-b22d-0973b0c8d0dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project share template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate Should create project share template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nbody.json_schema = json_schema\nbody.shared_to = [&#x27;abc@xyz.com&#x27;]\napi.post(apiURL + project + &#x27;/templates&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var result = res.body.output\n            expect(result.published).equal(true)\n            expect(result.shared_to.length).gt(0)\n                //expect(result.projectTemplate.shared_to.length).to.equal(1)\n                //expect(result.workflowTemplates.length).to.equal(1)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8ca87c8-d0f6-4a03-96d0-a1078dab2e77&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error if  project template is not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate Should give error if  project template is not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + &#x27;dummyProject/templates&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7ecaeb7-a4a0-45a8-b9b9-51ec1d2f82b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error if  project template flow is not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.CreateTemplate Should give error if  project template flow is not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.newFlow.remove({ uid: orgFlow.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(apiURL + project + &#x27;/templates&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(body)\n            .expect(httpStatus.NOT_FOUND)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.NO_DATA_FOUND);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e62be438-86e9-44ed-96a0-0d6ef7aeead1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;12e3aea9-30fa-449f-bf91-b073556b958f&quot;,&quot;04393d18-cc96-4298-b22d-0973b0c8d0dd&quot;,&quot;e8ca87c8-d0f6-4a03-96d0-a1078dab2e77&quot;,&quot;c7ecaeb7-a4a0-45a8-b9b9-51ec1d2f82b4&quot;,&quot;e62be438-86e9-44ed-96a0-0d6ef7aeead1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:162,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;24715aae-e651-4728-9e16-3984cfe9b002&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\createTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0c8fceda-601a-471f-a87a-feb129ffdadb&quot;,&quot;title&quot;:&quot;Flow.CreateTemplate&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\createTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3177,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar opt = { path: triggerPath, body: triggerPath, times: 3 };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        var userTriggerObj = userTrigger;\n        var flowData = _.cloneDeep(testData.flowBody);\n        flowData.isExpress = false;\n        async.parallel({\n            triggerFlow: function(cb) {\n                var triggerFlow = _.cloneDeep(flowData)\n                triggerFlow.trigger.handlers = [userTriggerObj.uid]\n                createFlow(flowURL, triggerFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            },\n            draftFlow: function(cb) {\n                var draftFlow = _.cloneDeep(flowData);\n                draftFlow.is_draft = true;\n                createFlow(flowURL, draftFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            },\n            invalidEnvFlow: function(cb) {\n                var IVWHFlow = _.cloneDeep(flowData);\n                IVWHFlow.activities[2].next = [];\n                createFlow(flowURL, IVWHFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            }\n        }, function(err, result) {\n            cbk(err, result)\n        })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userTriggerFlow = res.triggerFlow._doc;\n        userDraftFlow = res.draftFlow;\n        invalidEnvFlow = res.invalidEnvFlow._doc;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e41ef8be-9606-4dba-a9f9-d60e40d71090&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1899,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nvar flowUIDS = [userTriggerFlow.uid, userDraftFlow.uid, invalidEnvFlow.uid];\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: flowUIDS } }, function(err, deletedFlows) {\n            cb(err, deletedFlows)\n        });\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(cb) {\n        _models.Bill.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Payload.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Log.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f22709d-e819-4403-8573-1acddfe3dbfe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00feebb9-7971-4fcd-ae22-cfbc7d8571aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;flow\&quot; key is blank or missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should get error, if \&quot;flow\&quot; key is blank or missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7720d926-cf40-4dd0-aef3-93f8cd9cab1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar dummyFlowData = getExecuteBody(userTriggerFlow)\ndummyFlowData.flow.uid = &#x27;dummyFlow&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(dummyFlowData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c4b0317-9c53-4eca-90a1-7296e9b25b3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(userDraftFlow))\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_DRAFT_STATE_ENTERPRISE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;be8143f3-e109-400a-9e4b-658debd2c668&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if activities are not valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should get error, if activities are not valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerGetSuccess(opt);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(invalidEnvFlow))\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_CONFIGURE_ERROR);\n            done();\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d54c2733-255a-4f7f-883e-26457af5dea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should create template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath, times: 2 };\ncommonMock.triggerGetSuccess(opt);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var template = res.body.output\n            expect(template).to.have.all.keys(responseKeys);\n            expect(template.flow_data).to.have.all.keys([&#x27;lookup&#x27;, &#x27;project_params&#x27;, &#x27;params&#x27;, &#x27;auth&#x27;, &#x27;connection&#x27;, &#x27;trigger&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a10efe9-c2fa-4810-a3d1-ef02d3ff90d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateTemplate Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(getExecuteBody(userTriggerFlow))\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.FLOW_SUBMIT_USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7eab0c65-fe54-4a8a-aa12-92dd3ea8ba0e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;00feebb9-7971-4fcd-ae22-cfbc7d8571aa&quot;,&quot;7720d926-cf40-4dd0-aef3-93f8cd9cab1b&quot;,&quot;6c4b0317-9c53-4eca-90a1-7296e9b25b3a&quot;,&quot;be8143f3-e109-400a-9e4b-658debd2c668&quot;,&quot;d54c2733-255a-4f7f-883e-26457af5dea7&quot;,&quot;1a10efe9-c2fa-4810-a3d1-ef02d3ff90d0&quot;,&quot;7eab0c65-fe54-4a8a-aa12-92dd3ea8ba0e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:99,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c7561f8d-17db-4024-88cf-c6e852c03399&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\createUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7ee76c06-d810-4ee2-9fb5-4de69cd3c603&quot;,&quot;title&quot;:&quot;Flow.CreateUserFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\createUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\createUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1111,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                api.get(&#x27;/enterprise/v1/user&#x27;)\n                    .set(&#x27;authtoken&#x27;, orgData.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            dummyUser = res.body.output;\n                            cbk(err, dummyUser)\n                        }\n                    });\n            },\n            function(dummyUser, cbk) {\n                flowData.owner_uid = dummyUser.uid;\n                flowData.trigger.handlers = [testData.expressTriggerResponse.uid]\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(&#x27;/enterprise/v1/projects&#x27;)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                project = res.body.output;\n                done()\n            }\n        })\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33dd7157-4116-4f7d-a7b3-b85a758354d9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\ncreatedFlows.push(userFlow.uid)\n_models.newFlow.remove({ uid: { $in: createdFlows } }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        clearRecords(function(err, result) {\n            done(err)\n        })\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a165714d-1c27-460b-968e-a5e493ff0392&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL)\n    .send(flowData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b874af81-aac2-45ec-90ca-a5a14708fcf3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidFlowData = _.omit(flowData, &#x27;name&#x27;)\napi.post(flowURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidFlowData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4695889e-ac6c-429d-ac59-c7ad63a42954&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create flow, if flow data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should create flow, if flow data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(flowData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userFlow = res.body.output\n            expect(userFlow).to.contain.all.keys(validKeys)\n            expect(userFlow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            expect(userFlow.version).to.be.equal(1);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9a75df4-48ef-497c-ab40-aff1e9b8592b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create flow in inactive state, if user exceeds active flow limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should create flow in inactive state, if user exceeds active flow limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        var userFlowLimit = (dummyUser.user_plan.flow || {}).active\n        flowData.owner_uid = dummyUser.uid;\n        flowData.author = [dummyUser.uid];\n        async.times(userFlowLimit, function(n, next) {\n            _models.newFlow.create(flowData, function(err, userTrigger) {\n                next(err, userTrigger);\n            })\n        }, function(err, result) {\n            createdFlows = _.map(_.flattenDeep(result), &#x27;uid&#x27;)\n            cbk(err, result)\n        })\n    },\n    function(result, cbk) {\n        var flowObj = _.cloneDeep(testData.enterpriseFlowBody)\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowObj)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        expect(res.body.output.active).to.be.false;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30f30c9f-45b0-4c37-bfb7-e11dc3b5319a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create flow in other project, if user sends \&quot;project_uid\&quot; in body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should create flow in other project, if user sends \&quot;project_uid\&quot; in body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowData2 = _.cloneDeep(flowData)\n    //flowData2.project_uid = project.uid\napi.post(flowURL)\n    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, project_uid: project.uid })\n    .send(flowData2)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output;\n            expect(flow.project_uid).to.be.equal(project.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;813dc2b9-9040-4baf-a697-21c3587065e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create flow within organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should create flow within organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = orgBody;\n// var opt = { path: getTriggerPath, body: getTriggerPath, times: 2 };\n// commonMock.triggerCreateSuccess(opt);\nvar orgFlow = _.cloneDeep(flowData)\napi.post(flowURL)\n    .set({ &#x27;authtoken&#x27;: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .send(orgFlow)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output;\n            expect(flow.org_uid).to.be.equal(orgData.organization.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e159225-15ad-4fa5-936f-664bea7af0c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.CreateUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowData)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ab82fef-866f-4d19-a3a1-0caeee940e76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b874af81-aac2-45ec-90ca-a5a14708fcf3&quot;,&quot;4695889e-ac6c-429d-ac59-c7ad63a42954&quot;,&quot;d9a75df4-48ef-497c-ab40-aff1e9b8592b&quot;,&quot;30f30c9f-45b0-4c37-bfb7-e11dc3b5319a&quot;,&quot;813dc2b9-9040-4baf-a697-21c3587065e3&quot;,&quot;8e159225-15ad-4fa5-936f-664bea7af0c2&quot;,&quot;7ab82fef-866f-4d19-a3a1-0caeee940e76&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:147,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3c6d5a9a-eef2-4778-a0d4-8b59d4484217&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\deleteUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\deleteUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;13968a39-4a24-4248-8ac1-36c2efe13600&quot;,&quot;title&quot;:&quot;Flow.deleteUserFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\deleteUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\deleteUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:121,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(&#x27;/enterprise/v1/projects&#x27;)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            },\n            function(result, cbk) {\n                project = result.body.output;\n                async.parallel([\n                    function(cb) {\n                        saveFlow(flowURL, dummyUser, flowData, function(err, result) {\n                            cb(err, result)\n                        })\n                    },\n                    function(cb) {\n                        var flowData2 = _.cloneDeep(flowData)\n                        api.post(flowURL)\n                            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, project_uid: project.uid })\n                            .send(flowData2)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                cb(err, res)\n                            })\n                    }\n                ], function(err, results) {\n                    cbk(err, results)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res[0].body.output\n                userFlowWithProject = res[1].body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca7dfc48-0f26-446b-8f39-ab2dfd3b16ef&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6bfdc0d4-5843-459e-b051-fc3977a5039a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72be487a-66fb-427d-ab74-dc40cab9e31c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + &#x27;/dummyFlow&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c98e140-5490-4407-a147-c4173c56481d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete flow with trigger, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow Should delete flow with trigger, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = {\n    path: &#x27;/triggers/handlers/pull&#x27;,\n    body: {\n        \&quot;flow_uid\&quot;: userFlow.uid,\n        \&quot;org_uid\&quot;: userFlow.org_uid || null,\n        \&quot;env_uid\&quot;: userFlow.env_uid,\n        \&quot;project_uid\&quot;: userFlow.project_uid\n    }\n};\ncommonMock.flowTriggerDeleteSuccess(opt);\napi.delete(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.notice).to.equal(messageList.FLOW_DELETE_SUCCESS);\n            _models.newFlow.findOne({ uid: userFlow.uid }, function(err, result) {\n                if (err) {\n                    done(err)\n                } else {\n                    expect(result.deleted_at).not.to.be.null\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df7ff455-8f7a-4996-b623-f4bfefd79039&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete flow without trigger, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow Should delete flow without trigger, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = { deleted_at: null, trigger: testData.defaultTriggerObj }\n_models.newFlow.findOneAndUpdate({ uid: userFlow.uid }, data, { new: true }, function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        api.delete(flowURL + &#x27;/&#x27; + userFlow.uid)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(res.body.output.notice).to.equal(messageList.FLOW_DELETE_SUCCESS);\n                    _models.newFlow.findOne({ uid: userFlow.uid }, function(err, result) {\n                        if (err) {\n                            done(err)\n                        } else {\n                            expect(result.deleted_at).not.to.be.null\n                            _models.newFlow.findOne({ uid: userFlow.uid }, function(err, result2) {\n                                expect(result2.deleted_at).not.to.be.null\n                                done();\n                            })\n                        }\n                    })\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20fbc617-a9d3-40ab-9371-4a352e605ad0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete flow other project, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlow Should delete flow other project, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = { deleted_at: null, trigger: testData.defaultTriggerObj }\n_models.newFlow.findOneAndUpdate({ uid: userFlowWithProject.uid }, data, { new: true }, function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        api.delete(flowURL + &#x27;/&#x27; + userFlowWithProject.uid)\n            .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(res.body.output.notice).to.equal(messageList.FLOW_DELETE_SUCCESS);\n                    _models.newFlow.findOne({ uid: userFlowWithProject.uid }, function(err, result) {\n                        if (err) {\n                            done(err)\n                        } else {\n                            expect(result.deleted_at).not.to.be.null\n                            expect(result.project_uid).to.be.equal(project.uid)\n                            done();\n                        }\n                    })\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7368e61f-40e6-4901-bebc-c83a54f63c03&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;72be487a-66fb-427d-ab74-dc40cab9e31c&quot;,&quot;2c98e140-5490-4407-a147-c4173c56481d&quot;,&quot;df7ff455-8f7a-4996-b623-f4bfefd79039&quot;,&quot;20fbc617-a9d3-40ab-9371-4a352e605ad0&quot;,&quot;7368e61f-40e6-4901-bebc-c83a54f63c03&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:102,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5f2773ad-f30f-4fe3-94ae-ed5b5f523589&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\deleteUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\deleteUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8cfd325e-741b-4a9d-83b1-d39586b639df&quot;,&quot;title&quot;:&quot;Flow.deleteUserFlowVersion&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\deleteUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\deleteUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:118,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(&#x27;/enterprise/v1/projects&#x27;)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            },\n            function(result, cbk) {\n                project = result.body.output;\n                async.parallel([\n                    function(cb) {\n                        saveFlow(flowURL, dummyUser, flowData, function(err, result) {\n                            cb(err, result)\n                        })\n                    },\n                    function(cb) {\n                        var flowData2 = _.cloneDeep(flowData)\n                        api.post(flowURL)\n                            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, project_uid: project.uid })\n                            .send(flowData2)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                cb(err, res)\n                            })\n                    }\n                ], function(err, results) {\n                    cbk(err, results)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res[0].body.output\n                userFlowWithProject = res[1].body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba4c6039-930c-4b35-b67d-441f7ea9aa32&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.newFlowVersion.remove({ uid: userFlow.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n            if (err) {\n                done(err)\n            } else {\n                done()\n            }\n        })\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e9c5ceb-cc0e-4392-88f4-421fe6b1ee42&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + userFlow.uid + &#x27;/version/1&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d223b90f-b548-4195-8b92-e38ea598d437&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + &#x27;dummyFlow&#x27; + &#x27;/version/1&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;136deb99-6174-4047-a56a-263eff135095&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow version not found not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion Should get error, if flow version not found not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + userFlow.uid + &#x27;/version/21&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_VERSION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f1c307a-45a0-4d4f-9916-f3baf6513f49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow version not valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion Should get error, if flow version not valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + userFlow.uid + &#x27;/version/dummy&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ae83c60-95fe-47b8-9290-b7d9f8171415&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tried to delete current flow version.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.deleteUserFlowVersion Should get error, if user tried to delete current flow version.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(flowURL + userFlow.uid + &#x27;/version/1&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CURRENT_VERSION_DELETE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d43cee3e-a459-4006-a3e4-19f111369a24&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d223b90f-b548-4195-8b92-e38ea598d437&quot;,&quot;136deb99-6174-4047-a56a-263eff135095&quot;,&quot;9f1c307a-45a0-4d4f-9916-f3baf6513f49&quot;,&quot;8ae83c60-95fe-47b8-9290-b7d9f8171415&quot;,&quot;d43cee3e-a459-4006-a3e4-19f111369a24&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:64,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;92076715-eec9-4fd9-9872-a28184ee8c7f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\executeUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\executeUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b470011c-d8e2-447e-981d-6d781014a249&quot;,&quot;title&quot;:&quot;Flow.ExecuteUserFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\executeUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\executeUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:295,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        customRoleProject = _.find(orgData.org_projects, { name: &#x27;proj2&#x27; })\n        async.waterfall([\n            function(cbk) {\n                var query = _models.newFlow.remove()\n                query.exec(function(err) {\n                    dummyUser = orgData.owner;\n                    dummyUser.authtoken = dummyUser.authtoken;\n                    testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                    _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                        cbk(err, userTrigger);\n                    })\n                })\n            },\n            function(userTrigger, cbk) {\n                var userTriggerObj = userTrigger;\n                var flowData = _.cloneDeep(testData.flowBody);\n                flowData.isExpress = false;\n                flowData.trigger.handlers = [userTriggerObj]\n                async.parallel({\n                    triggerFlow: function(cb) {\n                        createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    inactiveFlow: function(cb) {\n                        var inactiveFlow = _.cloneDeep(flowData);\n                        inactiveFlow.active = false;\n                        createFlow(flowURL, inactiveFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    draftFlow: function(cb) {\n                        var draftFlow = _.cloneDeep(flowData);\n                        draftFlow.is_draft = true;\n                        createFlow(flowURL, draftFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    webHookFlow: function(cb) {\n                        var WHFlow = _.cloneDeep(flowData);\n                        WHFlow.trigger = testData.defaultTriggerObj;\n                        WHFlow.settings = testData.webHookSetting;\n                        WHFlow.active = true;\n                        WHFlow.settings = testData.webHookSetting;\n                        createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    orgFlow: function(cb) {\n                        var WHFlow = _.cloneDeep(flowData);\n                        WHFlow.trigger = testData.defaultTriggerObj;\n                        WHFlow.settings = testData.webHookSetting;\n                        WHFlow.active = true;\n                        WHFlow.settings = testData.webHookSetting;\n                        api.post(flowURL)\n                            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n                            .send(flowData)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                var flow = res.body.output;\n                                if (!flowData.is_draft) {\n                                    _models.newFlow.findOneAndUpdate({ uid: flow.uid }, { is_draft: false, preserve_version: true }, { new: true }, function(err, result) {\n                                        cb(err, result)\n                                    })\n                                } else {\n                                    cb(err, flow)\n                                }\n                            })\n                    },\n                    invalidEnvFlow: function(cb) {\n                        var IVWHFlow = _.cloneDeep(flowData);\n                        IVWHFlow.trigger = testData.defaultTriggerObj;\n                        IVWHFlow.settings = testData.webHookSetting;\n                        IVWHFlow.environment[0].params.push({ key: \&quot;body\&quot;, required: true });\n                        createFlow(flowURL, IVWHFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    }\n                }, function(err, result) {\n                    cbk(err, result)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userTriggerFlow = res.triggerFlow._doc;\n                userDraftFlow = res.draftFlow;\n                userWebHookFlow = res.webHookFlow._doc;\n                orgFlow = res.orgFlow._doc;\n                invalidEnvFlow = res.invalidEnvFlow._doc;\n                inactiveFlow = res.inactiveFlow._doc;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c90d97a-fed8-4cb9-9d5a-9238e908b3bb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nvar flowUIDS = [userTriggerFlow.uid, userDraftFlow.uid, userWebHookFlow.uid, invalidEnvFlow.uid];\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: flowUIDS } }, function(err, deletedFlows) {\n            cb(err, deletedFlows)\n        });\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(cb) {\n        _models.Bill.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Payload.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Log.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        //clearRecords(function(err, result) {\n        done()\n            //})\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;362a36d9-7056-4a9e-a48e-bc762e55dd36&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userTriggerFlow.uid + &#x27;/execute&#x27;)\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b741a9c1-b800-4494-9256-eaadffd9575e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should execute flow with web hook.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should execute flow with web hook.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { user_uid: dummyUser.uid }\ncommonMock.executeFlowTimeOut(opt)\napi.post(flowURL + &#x27;/&#x27; + userTriggerFlow.uid + &#x27;/execute&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(400)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.QMANGER_SERVER_DOWN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c605fe0c-ea03-4205-8713-5889c9555ce3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/dummyFlow/execute&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f08a960d-90c6-4f84-b213-e97bf7481571&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userDraftFlow.uid + &#x27;/execute&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(userDraftFlow))\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PARAM_MISSING_IN_ACTIVITY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d4b261b-b196-400c-b571-a96ba53a0778&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow is inavlid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should get error, if flow is inavlid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + inactiveFlow.uid + &#x27;/execute&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(getExecuteBody(inactiveFlow))\n    .expect(422)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_INACTIVE_STATE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d619707a-8f45-4237-bcb3-23959eb7330e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(flowURL + &#x27;/&#x27; + userWebHookFlow.uid + &#x27;/execute&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.FLOW_RUN_USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4acad96-9317-4808-834b-23b68129b6b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b741a9c1-b800-4494-9256-eaadffd9575e&quot;,&quot;c605fe0c-ea03-4205-8713-5889c9555ce3&quot;,&quot;f08a960d-90c6-4f84-b213-e97bf7481571&quot;,&quot;7d4b261b-b196-400c-b571-a96ba53a0778&quot;,&quot;d619707a-8f45-4237-bcb3-23959eb7330e&quot;,&quot;d4acad96-9317-4808-834b-23b68129b6b9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:82,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;218e2938-c4b2-4788-a0aa-6f478a15df03&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\executeUserTriggerFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\executeUserTriggerFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0beb8392-0e4e-4992-86ee-e222e1b20f51&quot;,&quot;title&quot;:&quot;Flow.ExecuteUserTriggerFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\executeUserTriggerFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\executeUserTriggerFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2807,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        var userTriggerObj = userTrigger;\n        var flowData = _.clone(testData.flowBody);\n        flowData.environment[0].params = []\n        flowData.isExpress = false;\n        flowData.trigger.handlers = [userTriggerObj.uid]\n        async.parallel({\n            triggerFlow: function(cb) {\n                createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            },\n            draftFlow: function(cb) {\n                var draftFlow = _.clone(flowData);\n                draftFlow.is_draft = true;\n                createFlow(flowURL, draftFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            },\n            webHookFlow: function(cb) {\n                var WHFlow = _.clone(flowData);\n                WHFlow.trigger = undefined;\n                WHFlow.settings = testData.webHookSetting;\n                createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            },\n            invalidEnvFlow: function(cb) {\n                var IVWHFlow = _.clone(flowData);\n                IVWHFlow.trigger = undefined;\n                IVWHFlow.settings = testData.webHookSetting;\n                IVWHFlow.environment[0].params.push({ key: \&quot;body\&quot;, required: true });\n                createFlow(flowURL, IVWHFlow, dummyUser, function(err, result) {\n                    cb(err, result);\n                })\n            }\n        }, function(err, result) {\n            cbk(err, result)\n        })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userTriggerFlow = res.triggerFlow._doc;\n        userDraftFlow = res.draftFlow;\n        userWebHookFlow = res.webHookFlow._doc;\n        invalidEnvFlow = res.invalidEnvFlow._doc;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;753ec67a-edd5-4420-84e2-1dce3e4a4be1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowUIDS = [userTriggerFlow.uid];\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: flowUIDS } }, function(err, deletedFlows) {\n            cb(err, deletedFlows)\n        });\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(cb) {\n        _models.Bill.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Payload.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    },\n    function(cb) {\n        _models.Log.remove({ flow_uid: { $in: flowUIDS } }, function(err, bill) {\n            cb(err, bill);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21907412-e0c2-4ed8-af45-0854b80ee012&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + userTriggerFlow.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;Unauthorized&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc456c1f-d60b-4aa9-90d5-d8f14b7bd116&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + &#x27;dummyFlow&#x27;)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7481837b-b3a5-45fb-9f70-0cdcaf729eed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should get error, if is in \&quot;draft\&quot; state.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + userDraftFlow.uid)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PARAM_MISSING_IN_ACTIVITY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f76ac010-5c57-44b4-a919-bf17ca1899c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger not in active state.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should get error, if trigger not in active state.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + userWebHookFlow.uid)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(422)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_ACTIVE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f2e4f2b-34ab-4e37-be93-1824aa6b1be3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger not found in flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should get error, if trigger not found in flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.newFlow.findOneAndUpdate({ uid: invalidEnvFlow.uid }, { trigger: undefined }, { new: true }, function(err, result) {\n    if (!result) {\n        err = err || messageList.FLOW_NOT_FOUND\n        done(err);\n    } else {\n        api.post(apiURL + invalidEnvFlow.uid)\n            .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5040142e-7cd0-457a-9a67-fc446a24ff86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should execute flow with trigger.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should execute flow with trigger.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { user_uid: dummyUser.uid }\ncommonMock.executeFlowSuccess(opt)\napi.post(apiURL + userTriggerFlow.uid)\n    .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body).to.have.all.keys(responseKeys);\n            expect(res.body.response).to.be.equal(messageList.FLOW_ENQUE_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de1ef386-097d-4b42-8ad9-877de7a0ef2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error,if user account has been suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ExecuteUserTriggerFlow Should get error,if user account has been suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        _models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, updatedUser) {\n            cbk(err, updatedUser);\n        })\n    },\n    function(result, cbk) {\n        // var updatedUser = result.body.output;\n        api.post(apiURL + userTriggerFlow.uid)\n            .set(&#x27;ui_admin_key&#x27;, config.UI_ADMIN_KEY)\n            .expect(httpStatus.PAYMENT_REQUIRED)\n            .end(function(err, res) {\n                cbk(err, res);\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        expect(res.body.error.message).to.be.equal(messageList.USER_ACCOUNT_EXPIRED);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c7874b2-528e-4c8a-b265-e4e6801cfe69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cc456c1f-d60b-4aa9-90d5-d8f14b7bd116&quot;,&quot;7481837b-b3a5-45fb-9f70-0cdcaf729eed&quot;,&quot;f76ac010-5c57-44b4-a919-bf17ca1899c0&quot;,&quot;0f2e4f2b-34ab-4e37-be93-1824aa6b1be3&quot;,&quot;5040142e-7cd0-457a-9a67-fc446a24ff86&quot;,&quot;de1ef386-097d-4b42-8ad9-877de7a0ef2e&quot;,&quot;7c7874b2-528e-4c8a-b265-e4e6801cfe69&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;46a4fd3b-e380-41db-a5ce-d3aec84926c4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\generateFlowSID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\generateFlowSID.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;27f69644-6009-40d4-afde-bcdbe5677be2&quot;,&quot;title&quot;:&quot;Flow.generateSID&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\generateFlowSID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\generateFlowSID.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2079,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        testData.mongoUserTriggerObj.user_uid = user.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result, userTriggerObj);\n            })\n    },\n    function(result, userTriggerObj, cbk) {\n        dummyUser = result.body.output;\n        //flowWithAllData.trigger.handlers[0] = userTriggerObj\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowWithAllData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;050508e4-e470-445b-a969-6251c0015dba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n            cb(err, deletedFlow);\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e465285-3fcc-42cd-8e4c-6eb4df1f0c2b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/generatesid&#x27;)\n    .send(userFlow)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a1f131a-f69e-4e46-b09d-ea95a14ff918&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/dummyFlow&#x27; + &#x27;/generatesid&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send()\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce348297-1422-4b45-af0d-0bfd4dd87ae2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should generate SID.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID Should generate SID.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/generatesid&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({})\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output\n            expect(flow.sid).to.not.equal(userFlow.sid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bfbeee83-8706-422d-b2ce-d79051a1efbd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should  get error,  if user sends a valid data which already present.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID Should  get error,  if user sends a valid data which already present.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.newFlow.findOne({uid: userFlow.uid}, function(err, result){\n    api.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/generatesid&#x27;)\n        .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n        .send({sid:result.sid})\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var flow =\n                expect(res.body.error.message).to.equal(messageList.RECORD_ALREADY_EXISTS)\n                done();\n            }\n        });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;92428c2b-8300-44e0-844e-d9a1d79d9ae1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should generate SID,  if user sends a valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateSID Should generate SID,  if user sends a valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\n    api.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/generatesid&#x27;)\n        .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n        .send({sid:&#x27;abc&#x27;})\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var flow = res.body.output\n                expect(flow.sid).to.not.equal(userFlow.sid)\n                done();\n            }\n        });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4aea2242-d04a-41cd-84c7-02614473c4a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3a1f131a-f69e-4e46-b09d-ea95a14ff918&quot;,&quot;ce348297-1422-4b45-af0d-0bfd4dd87ae2&quot;,&quot;bfbeee83-8706-422d-b2ce-d79051a1efbd&quot;,&quot;92428c2b-8300-44e0-844e-d9a1d79d9ae1&quot;,&quot;4aea2242-d04a-41cd-84c7-02614473c4a2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:70,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;93b73862-6825-49d4-9fdf-4dc54ac6862c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\generateWebhookToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\generateWebhookToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2d3fcb41-db81-4388-a80e-5ef325ecee87&quot;,&quot;title&quot;:&quot;Flow.generateWebHookToken&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\generateWebhookToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\generateWebhookToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateWebHookToken \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2233,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a61365b3-2d27-48f5-a66a-4d4302bea112&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateWebHookToken Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6372f016-ae21-44ba-8625-02b735fbe8be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.generateWebHookToken Should get flow, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).not.null\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97121d14-2869-4e5b-9b3b-1a19b9a010de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6372f016-ae21-44ba-8625-02b735fbe8be&quot;,&quot;97121d14-2869-4e5b-9b3b-1a19b9a010de&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:18,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;26e33dfd-2051-4e91-a48d-1e44d604388c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getFlowTestDataByFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getFlowTestDataByFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;41bed9e8-68cf-42e0-bbcb-85ef5da94186&quot;,&quot;title&quot;:&quot;Flows.getFlowTestsDataByFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getFlowTestDataByFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getFlowTestDataByFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner\n                dummyUser.authtoken = dummyUser.authtoken\n                flowTestObj.user_uid = dummyUser.uid\n                flowTestObj.env_uid = dummyUser.default_env\n                _models.FlowTest.create(flowTestObj, function(err, result) {\n                    cbk(err, result);\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                flowTestData = res.toJSON()\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8381c9bf-e963-4ede-b4b4-91c907f793df&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.FlowTest.remove(function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51a92222-ebd9-4900-be49-bd5eb2e6f508&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?flow_uid=&#x27; + flowTestData.flow_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf9404e3-75ae-4e6a-8867-d963afd29f0e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flowTest data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByFlow Should get list of flowTest data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?flow_uid=&#x27; + flowTestData.flow_uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output).flow_uid).to.be.equal(flowTestData.flow_uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eb9b0b19-b393-47ec-aa1c-3f4ad8d0d580&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cf9404e3-75ae-4e6a-8867-d963afd29f0e&quot;,&quot;eb9b0b19-b393-47ec-aa1c-3f4ad8d0d580&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0ee83e20-5e11-404b-ad03-a5c5676a8ada&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getFlowTestDataByUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getFlowTestDataByUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1fbbbfb1-a37c-455b-ae5e-ee716123e57c&quot;,&quot;title&quot;:&quot;Flows.getFlowTestsDataByUID&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getFlowTestDataByUID.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getFlowTestDataByUID.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByUID \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner\n                dummyUser.authtoken = dummyUser.authtoken\n                flowTestObj.user_uid = dummyUser.uid\n                flowTestObj.env_uid = dummyUser.default_env\n                _models.FlowTest.remove(function(err) {\n                    _models.FlowTest.create(flowTestObj, function(err, result) {\n                        cbk(err, result);\n                    })\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                flowTestData = res.toJSON()\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b349bd7-c0a3-46c8-b3cb-a3c3f01032f6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByUID \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.FlowTest.remove(function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55f1e57a-b653-4000-a27e-f2dfc1d578d8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByUID Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + flowTestObj.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b78a5c6-cacc-4149-9f19-c5422b085634&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByUID Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;dummy&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.NO_DATA_FOUND)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1cdad795-30e3-4b6b-a2f6-5a3d1fe931ed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flowTest data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.getFlowTestsDataByUID Should get flowTest data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + flowTestObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.flow_uid).to.be.equal(flowTestObj.flow_uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;731fdaca-d5bd-455e-b689-d685ba8812db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0b78a5c6-cacc-4149-9f19-c5422b085634&quot;,&quot;1cdad795-30e3-4b6b-a2f6-5a3d1fe931ed&quot;,&quot;731fdaca-d5bd-455e-b689-d685ba8812db&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;01f0e2d9-5658-4b2a-80fe-45384b459c38&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3bd8759b-4c83-482c-bbbd-e5b4d5f580f1&quot;,&quot;title&quot;:&quot;Flow.GetUserFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner\n                dummyUser.authtoken = dummyUser.authtoken\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(result, cbk) {\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(testData.enterpriseFlowBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            },\n            function(result, cbk) {\n                userFlow = result.body.output;\n                api.post(flowURL)\n                    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n                    .send(testData.enterpriseFlowBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                orgFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3e22a9d-9025-4b4e-a9d8-36dcfadbdf8d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd96397a-003e-4147-a9e8-1c6233d890a9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4fe16819-7dab-41e3-9c5b-7597445ff9ab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06759e50-0af5-49e4-9e14-227d981e60f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow Should get flow, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerGetSuccess(opt);\napi.get(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.have.property(&#x27;name&#x27;);\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80596933-1b0b-4d8e-b1d8-53aa6979213c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get org flow, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlow Should get org flow, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerGetSuccess(opt);\napi.get(flowURL + &#x27;/&#x27; + orgFlow.uid)\n    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.have.property(&#x27;name&#x27;);\n            expect(res.body.output.org_uid).equal(orgData.organization.uid);\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3b04f81-911b-4cd9-b965-96e5a7455298&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4fe16819-7dab-41e3-9c5b-7597445ff9ab&quot;,&quot;06759e50-0af5-49e4-9e14-227d981e60f4&quot;,&quot;80596933-1b0b-4d8e-b1d8-53aa6979213c&quot;,&quot;a3b04f81-911b-4cd9-b965-96e5a7455298&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:60,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3c2f35e6-1eb9-4ebd-9a1b-d8ef884b4322&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUserFlowLastRun.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserFlowLastRun.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c1047a69-f5ef-41b7-b440-25123b879408&quot;,&quot;title&quot;:&quot;Flow.GetUserFlowLastRun&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUserFlowLastRun.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserFlowLastRun.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlowLastRun \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2088,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        testData.mongoUserTriggerObj.user_uid = user.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.enterpriseFlowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;58dda5d3-6134-4427-85f6-8c6a829586ce&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlowLastRun \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ba39b72-2ef2-441f-a7c0-c660c85735a5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlowLastRun Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6850cd8-9ddc-4fb4-9b68-9a75433dcdda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlowLastRun Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ccf4a9cf-d9eb-49b7-a1ed-fb3c9e0b8f13&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow last run, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.GetUserFlowLastRun Should get flow last run, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/lastrun&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.have.all.keys([&#x27;duration&#x27;, &#x27;credits&#x27;])\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11336878-03b9-46d1-9f3a-3271223d0e45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d6850cd8-9ddc-4fb4-9b68-9a75433dcdda&quot;,&quot;ccf4a9cf-d9eb-49b7-a1ed-fb3c9e0b8f13&quot;,&quot;11336878-03b9-46d1-9f3a-3271223d0e45&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:117,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;af8737f0-8cca-48d8-a14e-5f20250d20a7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;408d94b1-015c-4069-b679-458cdd863020&quot;,&quot;title&quot;:&quot;Flow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ea5eb854-344b-412a-aeed-faa2eafd3ec2&quot;,&quot;title&quot;:&quot;Flow.getUsersDistinctFlowNames&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNames \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4262,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                saveUserFlows({\n                    authtoken: authToken,\n                    user_uid: res.body.output.uid\n                }, function(error, flows) {\n                    saveBillEntries({\n                        authtoken: authToken,\n                        user_uid: res.body.output.uid,\n                        flow_uid: flows[0].uid\n                    }, function(error, billEntries) {\n                        done();\n                    });\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc843f7c-56bd-412e-bedc-3862adca7bf2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNames \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c6a37952-070d-4358-8099-fecee071870c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNames \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;be2350ad-3c85-4c01-b113-ad7957937ee3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user flows.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNames Should get list of user flows.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 5;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d17e1942-6a47-4932-a576-30c7d8ba83a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNames Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4451a86a-2d19-46ad-83de-eff957e067ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d17e1942-6a47-4932-a576-30c7d8ba83a6&quot;,&quot;4451a86a-2d19-46ad-83de-eff957e067ec&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bdf19479-9fa4-4a97-9473-86122ee4dd5a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ab209399-2e61-4afe-a0ef-df4f9204c0b6&quot;,&quot;title&quot;:&quot;Flow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f0fb378d-0d87-496c-9918-61c233d517ac&quot;,&quot;title&quot;:&quot;Flow.getUsersDistinctFlowNamesOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUsersDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNamesOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0549dc1f-5440-4a4e-9a07-59b720e06071&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNamesOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3600872-c28f-48f9-bf3c-0454d078c0ee&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNamesOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7b01ca9f-3211-44c6-9742-ca92e395976c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user flows.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNamesOrg Should get list of user flows.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 5;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;68440ad3-1b4e-49fe-a511-3881374bdae0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow Flow.getUsersDistinctFlowNamesOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7ddf892-2f73-470a-af7b-117e7308594e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;68440ad3-1b4e-49fe-a511-3881374bdae0&quot;,&quot;c7ddf892-2f73-470a-af7b-117e7308594e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ac505959-551f-45e4-b4d8-8e9629f3b8b1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUserTags.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserTags.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3a7b12b2-8de2-4395-828e-754b3c1f59cb&quot;,&quot;title&quot;:&quot;Flows.GetUserTags&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\getUserTags.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\getUserTags.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.GetUserTags \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2784,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7c3a010-b056-436d-9664-e5c5caac2e41&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.GetUserTags Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .send(searchParam)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3aea9bf8-b2b7-43aa-a481-efb89eb8a67f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of tags.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.GetUserTags Should get list of tags.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bf440b50-4843-40f6-9300-bcbe66749b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3aea9bf8-b2b7-43aa-a481-efb89eb8a67f&quot;,&quot;bf440b50-4843-40f6-9300-bcbe66749b09&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;cc4d837d-ade1-4479-8a0d-bc0ff9bca540&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlows.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlows.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;23ee9091-8bea-43f2-af9b-2733b1faad83&quot;,&quot;title&quot;:&quot;Flows.ListFlows&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlows.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlows.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2430,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        testData.mongoUserTriggerObj.user_uid = user.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        testData.flowBody.trigger.handlers = [userTriggerObj.uid]\n        async.times(2, function(n, next) {\n            api.post(flowURL)\n                .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                .send(testData.flowBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (!err) {\n                        res = res.body.output\n                    }\n                    next(err, res)\n                })\n        }, function(err, result) {\n            cbk(err, result)\n        })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlows = res;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8d93ca3f-425f-4043-b1e3-b95535df24b5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: _.map(userFlows, &#x27;uid&#x27;) } }, function(err, deletedFlows) {\n            cb(err, deletedFlows);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7eb42182-69e5-40d0-b2b6-c1be32721b67&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da4d90c8-33ec-4b59-ab4c-604ed3b32fe0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user flows.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of user flows.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.size(res.body.output.objects)).to.be.equal(2)\n            expect(res.body.output.count).to.be.equal(2)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e61dace3-b7fe-4f3b-afbe-d8036586c619&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user flows, when applying filter and tags.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of user flows, when applying filter and tags.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.have.all.keys([&#x27;objects&#x27;, &#x27;count&#x27;])\n            expect(_.first(res.body.output.objects)).to.have.any.keys([&#x27;name&#x27;, &#x27;description&#x27;, &#x27;uid&#x27;, &#x27;updated_at&#x27;, &#x27;sid&#x27;])\n            expect(_.first(res.body.output.objects)).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6d2f6b5-a3a6-448b-9b66-81603e37af61&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of lean flows.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of lean flows.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;?lean=true&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;name&#x27;, &#x27;description&#x27;, &#x27;uid&#x27;, &#x27;updated_at&#x27;, &#x27;sid&#x27;, &#x27;flow_version&#x27;])\n            expect(_.first(res.body.output)).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2997d7a6-627a-41f8-8dfb-1e61ea9c1ec2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of lean flows uids.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of lean flows uids.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;?lean=true&amp;get=flow_uids&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;uid&#x27;])\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd09f306-62de-4a22-af98-a5dfc6cdb7e2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of lean flows excluding flow mentioned in URL.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of lean flows excluding flow mentioned in URL.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;?lean=true&amp;exclude=&#x27; + [_.first(userFlows).uid])\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.map(res.body.output, &#x27;uid&#x27;)).not.to.be.include(_.first(userFlows).uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;702e2ad5-c515-4f82-9026-c6939bfc48ef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows, even if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlows Should get list of flows, even if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.get(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(_.size(res.body.output.objects)).to.be.equal(2)\n                    expect(res.body.output.count).to.be.equal(2)\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62ab1b19-b104-466f-8b29-3947fb1f68c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;da4d90c8-33ec-4b59-ab4c-604ed3b32fe0&quot;,&quot;e61dace3-b7fe-4f3b-afbe-d8036586c619&quot;,&quot;d6d2f6b5-a3a6-448b-9b66-81603e37af61&quot;,&quot;2997d7a6-627a-41f8-8dfb-1e61ea9c1ec2&quot;,&quot;dd09f306-62de-4a22-af98-a5dfc6cdb7e2&quot;,&quot;702e2ad5-c515-4f82-9026-c6939bfc48ef&quot;,&quot;62ab1b19-b104-466f-8b29-3947fb1f68c2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:106,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1840d285-029f-495b-a136-9bbfc97a404c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlowsByAgent.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByAgent.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8309553a-c6fc-41d4-a34a-11923592c36f&quot;,&quot;title&quot;:&quot;Flows.ListFlowsByAgent&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlowsByAgent.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByAgent.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAgent \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2890,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b1bab878-af38-4da5-8e0a-904596e2d50f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAgent Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(searchParam)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;803d7143-8b9f-4717-86a2-ec55ba07aee9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if enterpriseagent UID param is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAgent Should get error, if enterpriseagent UID param is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b71be14a-8d79-48a2-913a-b6892c0cd5d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows by enterpriseagent, if enterpriseagent UID param is passed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAgent Should get list of flows by enterpriseagent, if enterpriseagent UID param is passed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75bbfb04-32e0-4920-bb9b-f67074d76662&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;803d7143-8b9f-4717-86a2-ec55ba07aee9&quot;,&quot;b71be14a-8d79-48a2-913a-b6892c0cd5d6&quot;,&quot;75bbfb04-32e0-4920-bb9b-f67074d76662&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f2c88bd6-8708-4bd4-a752-efb8c8be31cb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlowsByAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dc4e8e75-26f4-45ac-9b22-f05ad5ec4332&quot;,&quot;title&quot;:&quot;Flows.ListFlowsByAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlowsByAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAuth \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5079,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d99f6e77-5ef1-4a37-93b6-58b056ace55c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(searchParam)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b256a17-f8d0-4450-a188-18dbf12c4a7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if auth UID param is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAuth Should get error, if auth UID param is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7620717-70fc-433a-b32f-67e709abc33a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows by auth, if auth UID param is passed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByAuth Should get list of flows by auth, if auth UID param is passed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;766fa2c9-0364-4ba4-9100-fd6eecc41132&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2b256a17-f8d0-4450-a188-18dbf12c4a7f&quot;,&quot;e7620717-70fc-433a-b32f-67e709abc33a&quot;,&quot;766fa2c9-0364-4ba4-9100-fd6eecc41132&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e43f2d6b-ac9e-4a7d-b53b-214159082f3a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlowsByConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bc9c8f51-8515-41af-87bc-5e97e2d62722&quot;,&quot;title&quot;:&quot;Flows.ListFlowsByConnection&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlowsByConnection.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByConnection.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByConnection \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2555,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f55aee89-5c5b-4d01-a1a9-9fba1378a046&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByConnection Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(searchParam)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5125cdf4-8cd3-423a-8dc1-f1fe9b4de03a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if connection UID param is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByConnection Should get error, if connection UID param is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eba92674-f324-45a3-92cb-3af8bd50038b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows by auth, if connection UID param is passed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByConnection Should get list of flows by auth, if connection UID param is passed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b103f83-1913-434f-9627-75dee729d336&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5125cdf4-8cd3-423a-8dc1-f1fe9b4de03a&quot;,&quot;eba92674-f324-45a3-92cb-3af8bd50038b&quot;,&quot;1b103f83-1913-434f-9627-75dee729d336&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;197f4fb3-77fc-41cb-975b-cd7df05cc526&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlowsByCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;873b290c-a93b-4255-ab37-4baf42abd768&quot;,&quot;title&quot;:&quot;CustomIntegration.GetFlows&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlowsByCustomIntegration.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByCustomIntegration.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3483,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(data)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        customIntegration = result.body.output;\n        flowData.activities[2].uid = customIntegration.uid;\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eb771128-ccc7-4b1d-a3bc-da246a5b685b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;_models.CustomIntegration.remove({ user_uid: dummyUser.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f21dd19-fe17-49b8-a2a7-7f5cd46a0476&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/&#x27; + customIntegration.uid + &#x27;/flows&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e22a6b2d-ed8d-4015-86c3-52916a7fe92e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows of custom  integrtion.&quot;,&quot;fullTitle&quot;:&quot;Enterprise CustomIntegration.GetFlows Should get list of flows of custom  integrtion.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/&#x27; + customIntegration.uid + &#x27;/flows&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output[0]).to.contain.all.keys([&#x27;uid&#x27;, &#x27;name&#x27;, &#x27;flow_version&#x27;])\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;699b7455-93b3-41c4-96b8-14f853dbf186&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e22a6b2d-ed8d-4015-86c3-52916a7fe92e&quot;,&quot;699b7455-93b3-41c4-96b8-14f853dbf186&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9dbe3627-a826-46eb-848b-05dc6d7b6a1e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlowsByTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ac501594-06e4-463d-8951-685f10f13ef0&quot;,&quot;title&quot;:&quot;Flows.ListFlowsByTrigger&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\listFlowsByTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\listFlowsByTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3641,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9cc21f1a-0da0-4cec-be12-daf9159d74a1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByTrigger Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(searchParam)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0d23176-6814-42fd-8acf-1ecea734ddcd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger UID param is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByTrigger Should get error, if trigger UID param is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7f3da79-c3e6-4ace-b8ee-c675591615d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flows by auth, if trigger UID param is passed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flows.ListFlowsByTrigger Should get list of flows by auth, if trigger UID param is passed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64402ba0-1184-463a-bc2c-84ab12573e3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c0d23176-6814-42fd-8acf-1ecea734ddcd&quot;,&quot;e7f3da79-c3e6-4ace-b8ee-c675591615d6&quot;,&quot;64402ba0-1184-463a-bc2c-84ab12573e3a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;cec8bee8-f9e2-4521-9b8a-f27022de7e65&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\revertUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\revertUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f62d8193-12ba-4f6a-b815-0820f2f19d6e&quot;,&quot;title&quot;:&quot;Flow.revertUserFlowVersion&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\revertUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\revertUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                testData.mongoUserTriggerObj.uid = &#x27;tg9b42e22c50a119f6729d68&#x27;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(&#x27;/enterprise/v1/projects&#x27;)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            },\n            function(result, cbk) {\n                project = result.body.output;\n                async.parallel([\n                    function(cb) {\n                        saveFlow(flowURL, dummyUser, flowWithAllDataWithoutTrigger, function(err, result) {\n                            cb(err, result)\n                        })\n                    },\n                    function(cb) {\n                        var flowData2 = _.cloneDeep(flowData)\n                        api.post(flowURL)\n                            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, project_uid: project.uid })\n                            .send(flowData2)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                cb(err, res)\n                            })\n                    }\n                ], function(err, results) {\n                    cbk(err, results)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res[0].body.output\n                userFlowWithProject = res[1].body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2432cf7d-bf56-443e-a1e2-cf746137a64f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d71c3bd-9e21-42d3-92a0-763365b249b1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n    .send({ flow_version: 1 })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9ca725f-c3ff-4b3a-bca7-8e7a11213f39&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;dummyFlow&#x27; + &#x27;/revert&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ flow_version: 1 })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6bc9e72a-cdf6-4788-a87a-9305a93058c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow version not found not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should get error, if flow version not found not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ flow_version: 21 })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_VERSION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;915c57ea-3d6c-4ad8-b4c4-1dd6ea8dac90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow version not valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should get error, if flow version not valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ flow_version: &#x27;dummy&#x27; })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88102675-6201-4dbb-9d52-2704db6f5dfd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tried to delete current flow version.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should get error, if user tried to delete current flow version.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\napi.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .send({ flow_version: 1 })\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CURRENT_VERSION_REVERT_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f62dba0e-7d66-4b74-bc3c-5c6186779378&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should revert flow version.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.revertUserFlowVersion Should revert flow version.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:227,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nflowWithAllData.trigger.handlers.uid = flowData.trigger.handlers[0]\napi.put(flowURL + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(flowWithAllData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var opt1 = { path: getTriggerPath, body: getTriggerPath, times: 2 };\n        commonMock.triggerGetSuccess(opt1);\n        opt1.getPath = getTriggerPath + &#x27;/handlers&#x27;;\n        opt1.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\n        commonMock.triggerPullSuccess(opt);\n        opt1.body = { \&quot;push\&quot;: [/^fl\\w*/] };\n        commonMock.triggerPushSuccess(opt);\n        api.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send({ flow_version: 1 })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(res.body.output.flow_version).equal(3);\n                    expect(res.body.output.active).equal(true);\n                    //expect(res.body.output.name).equal(&#x27;dummy flow&#x27;);\n                    //done();\n                    var opt2 = { path: getTriggerPath, body: getTriggerPath, times: 2 };\n                    commonMock.triggerGetSuccess(opt2);\n                    opt2.getPath = getTriggerPath + &#x27;/handlers&#x27;;\n                    opt2.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\n                    commonMock.triggerPullSuccess(opt);\n                    opt2.body = { \&quot;push\&quot;: [/^fl\\w*/] };\n                    commonMock.triggerPushSuccess(opt2);\n                    api.put(flowURL + userFlow.uid + &#x27;/revert&#x27;)\n                        .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                        .send({ flow_version: 2 })\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                expect(res.body.output.flow_version).equal(4);\n                                expect(res.body.output.active).equal(true);\n                                expect(res.body.output.errors_obj.length).equal(0);\n                                expect(res.body.output.trigger.handlers[0].uid).equal(flowWithAllData.trigger.handlers[0].uid);\n                                expect(res.body.output.name).equal(&#x27;Config&#x27;);\n                                done();\n                            }\n                        });\n                }\n            });\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c2e7c599-ddc8-4c5e-a209-83f46d134873&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e9ca725f-c3ff-4b3a-bca7-8e7a11213f39&quot;,&quot;6bc9e72a-cdf6-4788-a87a-9305a93058c5&quot;,&quot;915c57ea-3d6c-4ad8-b4c4-1dd6ea8dac90&quot;,&quot;88102675-6201-4dbb-9d52-2704db6f5dfd&quot;,&quot;f62dba0e-7d66-4b74-bc3c-5c6186779378&quot;,&quot;c2e7c599-ddc8-4c5e-a209-83f46d134873&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:302,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;05c49c6a-4b28-48ba-aecb-74ffa64454bb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\shareUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\shareUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c1158e65-6241-4d10-beb0-6a470b8990c1&quot;,&quot;title&quot;:&quot;Flow.ShareUserFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\shareUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\shareUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:99,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                _id = dummyUser._id\n                flowData.trigger.handlers = [userTriggerObj]\n                    //var flowData = _.clone(testData.flowBody)\n                flowData.environment[0].params = [{\n                    \&quot;key\&quot;: \&quot;1\&quot;,\n                    \&quot;value\&quot;: \&quot;2\&quot;,\n                    \&quot;required\&quot;: true\n                }, {\n                    \&quot;key\&quot;: \&quot;3\&quot;,\n                    \&quot;value\&quot;: \&quot;2\&quot;,\n                    \&quot;required\&quot;: false\n                }];\n                flowData.environment[0].project_params = [{\n                    \&quot;uid\&quot;: \&quot;random\&quot;,\n                    \&quot;key\&quot;: \&quot;param1\&quot;,\n                    \&quot;value\&quot;: \&quot;parawal\&quot;,\n                    \&quot;required\&quot;: true,\n                    \&quot;isPassword\&quot;: false,\n                    \&quot;hasError\&quot;: false\n                }];\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ddc98dfe-ed31-4171-a083-cf32031b42d6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cb) {\n        _models.newFlow.findOne({ owner_uid: shareCriteria.users }, function(err, sharedFlow) {\n            cb(err, sharedFlow);\n        })\n    },\n    function(sharedFlow, cb) {\n        removeFlow([userFlow.uid, (sharedFlow || {}).uid], function(err, deletedFlows) {\n            cb(err, deletedFlows);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6cd99ddd-3146-4f8d-804b-ac4cbe11d8b9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n    .send(shareCriteria)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b530f0c-2579-44e7-961b-7a49d8bc0d7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should share flow, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should share flow, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath }\ncommonMock.triggerCreateSuccess(opt);\nshareCriteria.users = [orgData.role1.email]\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(&#x27;Workflow shared successfully with 1 user(s)&#x27;)\n            var query = _models.UserStream.find({ type: &#x27;share-flow&#x27; })\n            query.lean().exec(function(err, results) {\n                if (err) {\n                    done(err);\n                } else {\n                    var shareTo = _.find(results, { metadata:{to_email: shareCriteria.users[0] }})\n                    var shareFrom = _.find(results, { metadata:{from_email: dummyUser.email }})\n                    if (shareFrom &amp;&amp; shareTo) {\n                        done()\n                    }\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;140f6fdb-14cf-499f-b9eb-66b89f54f990&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/dummyFlow/share&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e72ee59-cb0c-4f90-b3f0-b819ae8521a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;users\&quot; params is missing OR empty.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should get error, if \&quot;users\&quot; params is missing OR empty.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar missingUsers = _.omit(shareCriteria, &#x27;users&#x27;);\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(missingUsers)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3de3710d-3910-4758-aede-4c6904169f0d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should share flow with organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should share flow with organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar projectParams = [{\n    \&quot;uid\&quot;: \&quot;random\&quot;,\n    \&quot;key\&quot;: \&quot;param1\&quot;,\n    \&quot;value\&quot;: \&quot;parawal\&quot;,\n    \&quot;required\&quot;: true,\n    \&quot;isPassword\&quot;: false,\n    \&quot;hasError\&quot;: false\n}, {\n    \&quot;uid\&quot;: \&quot;random1\&quot;,\n    \&quot;key\&quot;: \&quot;param1\&quot;,\n    \&quot;value\&quot;: \&quot;parawal\&quot;,\n    \&quot;required\&quot;: true,\n    \&quot;isPassword\&quot;: false,\n    \&quot;hasError\&quot;: false\n}]\nvar opt = { path: getTriggerPath, body: getTriggerPath, times: 2 };\ncommonMock.triggerCreateSuccess(opt);\nvar orgDefaultProj = _.find(orgData.org_projects, { name: config.default_project })\nvar projectParam = _.merge(projectParams[0], { type: &#x27;param&#x27;, project_uid: orgDefaultProj.uid, user_uid: orgData.organization_account.uid })\n_models.ConfigSchema.create(projectParam, function(err, result) {\n    var shareWithOrgs = _.cloneDeep(shareCriteria)\n    shareWithOrgs.users = &#x27;&#x27;;\n    shareWithOrgs.orgs = [orgData.organization.name]\n    shareWithOrgs.project_params = projectParams\n    shareWithOrgs.params = [{\n        \&quot;key\&quot;: \&quot;3\&quot;,\n        \&quot;value\&quot;: \&quot;2\&quot;,\n        \&quot;required\&quot;: false\n    }]\n    api.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n        .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n        .send(shareWithOrgs)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(&#x27;Workflow shared successfully with 1 organization(s)&#x27;)\n                var query = _models.ConfigSchema.find({ type: &#x27;param&#x27;, project_uid: orgDefaultProj.uid })\n                query.lean().exec(function(err, results) {\n                    if (results) {\n                        var shareProjectParamsUIDS = _.map(results, &#x27;uid&#x27;)\n                        var projectParamsUIDS = _.map(projectParams, &#x27;uid&#x27;)\n                        if (_.isEqual(shareProjectParamsUIDS, projectParamsUIDS)) {\n                            done();\n                        } else {\n                            done(&#x27;PROJECT_PARAMS_MISMATCH&#x27;);\n                        }\n                    }\n                })\n            }\n        });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;db0baf46-8e4c-4b1f-a11a-a59668b6f8fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tries to share flow with himself.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should get error, if user tries to share flow with himself.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nshareCriteria.users = testData.testRegistrationBody.email\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_CANNOT_BE_SHARE_WITH_SAME_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5eea88a3-ea64-4f7b-a679-c88f54438dac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tries to share flow with more than 10 users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should get error, if user tries to share flow with more than 10 users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nshareCriteria.users = [&#x27;1@a.com&#x27;, &#x27;2@a.com&#x27;, &#x27;3@a.com&#x27;, &#x27;4@a.com&#x27;, &#x27;5@a.com&#x27;, &#x27;6@a.com&#x27;, &#x27;7@a.com&#x27;, &#x27;8@a.com&#x27;, &#x27;9@a.com&#x27;, &#x27;10@a.com&#x27;, &#x27;11@a.com&#x27;]\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;The workflow can not be shared with more than 10 users at a time.&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df642deb-c6ee-4364-9d8f-ee93ab4d2b9c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ShareUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/share&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.FLOW_SHARE_USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56a75441-fcc3-460e-9bfd-3d3f2d58b2af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9b530f0c-2579-44e7-961b-7a49d8bc0d7f&quot;,&quot;140f6fdb-14cf-499f-b9eb-66b89f54f990&quot;,&quot;9e72ee59-cb0c-4f90-b3f0-b819ae8521a6&quot;,&quot;3de3710d-3910-4758-aede-4c6904169f0d&quot;,&quot;db0baf46-8e4c-4b1f-a11a-a59668b6f8fd&quot;,&quot;5eea88a3-ea64-4f7b-a679-c88f54438dac&quot;,&quot;df642deb-c6ee-4364-9d8f-ee93ab4d2b9c&quot;,&quot;56a75441-fcc3-460e-9bfd-3d3f2d58b2af&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:133,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4e1accfd-e00a-43b4-b745-7ada4a929252&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\stopUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\stopUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ef83d870-ad68-4db1-9703-5858a20d02fc&quot;,&quot;title&quot;:&quot;Flow.StopUserFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\stopUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\stopUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2081,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        testData.mongoUserTriggerObj.user_uid = user.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        //testData.flowBody.trigger.handlers = [userTriggerObj.uid]\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.flowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        var billBody = {\n            \&quot;flow_uid\&quot;: userFlow.uid,\n            \&quot;billable\&quot;: true,\n            \&quot;user_uid\&quot;: dummyUser.uid,\n            \&quot;flow_name\&quot;: \&quot;dummy flow\&quot;,\n            \&quot;result\&quot;: \&quot;pending\&quot;,\n            \&quot;duration\&quot;: 0,\n            \&quot;manual_run\&quot;: true,\n            \&quot;deleted_at\&quot;: null,\n            \&quot;credits\&quot;: 0,\n            \&quot;__v\&quot;: 0\n        }\n        _models.Bill.create(billBody, function(err, billObj) {\n            flowBill = billObj;\n            stopData.bill_uid = flowBill.uid;\n        })\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;843cf510-4e6b-4575-ae01-e20285378634&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlows) {\n            cb(err, deletedFlows);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.Bill.remove({ uid: flowBill.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06eb9b8c-c146-404a-9224-bd0bb068c15b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/stop&#x27;)\n    .send(stopData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25e432f8-9911-4338-a34b-ab251892d5b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if key \&quot;bill_uid\&quot; is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow Should get error, if key \&quot;bill_uid\&quot; is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.clone(stopData)\ndata.bill_uid = null;\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/stop&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3fe71ea-3734-497f-95a6-250171c27716&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if key \&quot;bill_uid\&quot; is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow Should get error, if key \&quot;bill_uid\&quot; is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.clone(stopData)\ndata.bill_uid = &#x27;ABC&#x27;;\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/stop&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.BILL_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;be5fd4e6-e465-4587-89ff-faf4b6d54fb9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should stop flow, if bill is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.StopUserFlow Should stop flow, if bill is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { bill_uid: stopData.bill_uid, user_uid: dummyUser.uid }\ncommonMock.stopFlowSuccess(opt)\napi.post(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/stop&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(stopData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.result.should.equal(&#x27;OK&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd84d75f-a0d7-4829-8a57-bae1c9b912a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;25e432f8-9911-4338-a34b-ab251892d5b7&quot;,&quot;d3fe71ea-3734-497f-95a6-250171c27716&quot;,&quot;be5fd4e6-e465-4587-89ff-faf4b6d54fb9&quot;,&quot;fd84d75f-a0d7-4829-8a57-bae1c9b912a4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:47,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f16b0e0b-3b6d-499b-acd8-171fae9b91bb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\toggleUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\toggleUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;02188f15-2d89-4823-b88e-24c029367c1b&quot;,&quot;title&quot;:&quot;Flow.ToggleUserFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\toggleUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\toggleUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3535,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        testData.mongoUserTriggerObj.user_uid = user.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        testData.flowBody.trigger.handlers = [userTriggerObj]\n        dummyUser = result.body.output;\n        var flowBody = _.cloneDeep(testData.flowBody);\n        async.parallel({\n            activeFlow: function(cb) {\n                createFlow(dummyUser, flowBody, cb)\n            },\n            inactiveFlow: function(cb) {\n                flowBody.active = false\n                createFlow(dummyUser, flowBody, cb)\n            }\n        }, function(err, result) {\n            cbk(err, result)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err);\n    } else {\n        liveFlow = result.activeFlow.body.output;\n        userFlow = result.inactiveFlow.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d62a0342-42f4-4795-a7e4-aab56f43c019&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: [userFlow.uid, liveFlow.uid] } }, function(err, deletedFlow) {\n            cb(err, deletedFlow);\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7b409253-0418-4bb7-ba47-d0af2cc9e74f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/toggle&#x27;)\n    .send(active)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f50b5000-117f-4a03-b2d5-a01750e4d955&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/dummyFlow/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(active)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b02e43c1-13b5-4eec-9c94-3466adff7e17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;data\&quot; key is missing OR empty.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should get error, if \&quot;data\&quot; key is missing OR empty.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send()\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72e27f11-a2fa-4760-9909-7fc3c21737ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should \&quot;active\&quot; flow, if user sends {data: true}.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should \&quot;active\&quot; flow, if user sends {data: true}.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(active)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.active).to.be.equal(true);\n            //expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f5596d8-3a6a-4fc4-a24e-00f2bd7814fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user sends {data: true} and flow is in active state&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should get error, if user sends {data: true} and flow is in active state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(active)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.FLOW_ALREADY_IN_ACTIVE_STATE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45e78a69-f8a5-4145-ae89-73aa89714df2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should \&quot;de-active\&quot; flow, if user sends {data: false} and config data must have \&quot;trigger\&quot; key&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should \&quot;de-active\&quot; flow, if user sends {data: false} and config data must have \&quot;trigger\&quot; key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;unset\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nactive.data = false;\napi.put(flowURL + &#x27;/&#x27; + liveFlow.uid + &#x27;/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(active)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.active).to.be.equal(false)\n                //expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            var query = _models.ConfigData.findOne({ flow_uid: res.body.output.uid, activity_id: &#x27;start&#x27; })\n            query.lean().exec(function(err, configData) {\n                expect(configData).have.any.keys([&#x27;trigger&#x27;])\n                done();\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d93a125-b14a-49cd-b008-0f0684224bda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should \&quot;de-active\&quot; flow, if user sends {data: false}.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should \&quot;de-active\&quot; flow, if user sends {data: false}.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;unset\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nactive.data = false;\napi.put(flowURL + &#x27;/&#x27; + liveFlow.uid + &#x27;/toggle&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(active)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.FLOW_ALREADY_IN_INACTIVE_STATE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a54a71f-40c3-47c6-b001-8cda4a236d32&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.ToggleUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nthis.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;unset\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nactive.data = false;\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.put(flowURL + &#x27;/&#x27; + liveFlow.uid + &#x27;/toggle&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(active)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3ec41ac-889e-4ea5-81d3-1b800b34f0d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f50b5000-117f-4a03-b2d5-a01750e4d955&quot;,&quot;b02e43c1-13b5-4eec-9c94-3466adff7e17&quot;,&quot;72e27f11-a2fa-4760-9909-7fc3c21737ce&quot;,&quot;2f5596d8-3a6a-4fc4-a24e-00f2bd7814fd&quot;,&quot;45e78a69-f8a5-4145-ae89-73aa89714df2&quot;,&quot;9d93a125-b14a-49cd-b008-0f0684224bda&quot;,&quot;8a54a71f-40c3-47c6-b001-8cda4a236d32&quot;,&quot;c3ec41ac-889e-4ea5-81d3-1b800b34f0d1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:127,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3232fbc7-feac-4340-beed-7eee972b6972&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\updateUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4d6c7ca9-652f-446d-82cc-60488bf69737&quot;,&quot;title&quot;:&quot;Flow.UpdateUserFlow&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\updateUserFlow.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlow.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:157,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger.toJSON()\n                    //flowWithAllData.trigger.handlers[0] = userTriggerObj\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowWithAllData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            },\n            function(res, cbk) {\n                userFlow = res.body.output;\n                //flowWithAllData.trigger.handlers[0] = userTriggerObj\n                api.post(flowURL)\n                    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n                    .send(flowWithAllData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                orgFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;70c84e6f-c85d-423a-9ef9-eba8204f6ee3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n            cb(err, deletedFlow);\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd3e8000-c6d6-4cd7-93ed-3dcb84cf3cec&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .send(userFlow)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52b7d8bf-a8e8-48fe-bdc5-f349a790d14b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/dummyFlow&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38b356dc-babb-472e-bc02-9e9d932d87b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidFlowData = _.omit(flowData, &#x27;name&#x27;)\napi.post(flowURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidFlowData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;168e69f7-180f-4b0f-ad6e-b31a7aa93a53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow activity has no end point.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow activity has no end point.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = flowData.activities;\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_CONNECTION_ERROR)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;43fc0e72-cff6-439e-8448-38f96fa241ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow activities has circular connection.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow activities has circular connection.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nvar invalidFlowActivities = _.clone(testData.invalidFlowActivities)\n_.set(_.first(invalidFlowActivities), &#x27;next&#x27;, [&#x27;start&#x27;])\nuserFlow.activities = JSON.stringify(invalidFlowActivities);\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_LOOP_ERROR)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62a54d70-d449-4616-a7a3-d44ecb8e7da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow activity has no id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow activity has no id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nvar invalidFlowActivities = _.clone(testData.invalidFlowActivities)\n_.set(_.first(invalidFlowActivities), &#x27;id&#x27;, null)\nuserFlow.activities = JSON.stringify(invalidFlowActivities);\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_CHAIN_BREAK)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4e14710-0d89-4f33-a393-5de48b394f16&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow has group activities with no end point.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow has group activities with no end point.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = JSON.stringify(testData.invalidGroupActivities);\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_GROUP_CONNECTION_ERROR)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3065f519-0e21-4385-90e1-797734cd65af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow has group has no activities.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow has group has no activities.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = JSON.stringify(testData.blankGroupActivities);\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_GROUP_BLANK_ERROR)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6a2a6ca2-c57f-4a0a-a630-6836f9257569&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow has group circular connection.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if flow has group circular connection.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = JSON.stringify(testData.GroupActivitiesWithLoopConnection);\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.equal(messageList.INVALID_FLOW_LOOP_ERROR)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6168b8c2-a6f0-4e89-96e4-f9f5c30ea6fa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update flow, if user sends a valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should update flow, if user sends a valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = testData.newAcitivities;\nuserFlow.configurations = flowData.environment;\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output\n            var flowEnv = _.first(JSON.parse(flow.environment))\n            expect(flow.name).to.equal(testFlowName)\n            expect(flow.flow_version).to.equal(2)\n            expect(flow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            expect(flowEnv).to.have.any.keys([&#x27;auth&#x27;, &#x27;connection&#x27;, &#x27;enterpriseagent&#x27;, \&quot;id\&quot;, \&quot;params\&quot;]);\n            expect(flow.trigger.handlers).to.have.length.of.at.least(1)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69381c4e-4fad-43dd-b774-1c439997b26c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update flow in org, if user sends a valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should update flow in org, if user sends a valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\nuserFlow.name = testFlowName\nuserFlow.trigger.handlers[0] = userTriggerObj;\nuserFlow.activities = testData.newAcitivities;\nuserFlow.configurations = flowData.environment;\nuserFlow.preserve_version = true\napi.put(flowURL + &#x27;/&#x27; + orgFlow.uid)\n    .set({ &#x27;authtoken&#x27;: orgData.developer.authtoken, org_uid: orgData.organization.uid })\n    .send(userFlow)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output\n            var flowEnv = _.first(JSON.parse(flow.environment))\n            expect(flow.name).to.equal(testFlowName)\n            expect(flow.updated_by).to.equal(orgData.developer.uid)\n            expect(flow.flow_version).to.equal(1)\n            expect(flow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            expect(flowEnv).to.have.any.keys([&#x27;auth&#x27;, &#x27;connection&#x27;, &#x27;enterpriseagent&#x27;, \&quot;id\&quot;, \&quot;params\&quot;]);\n            expect(flow.trigger.handlers).to.have.length.of.at.least(1)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab48bb6c-2179-4e21-8c75-1d3c6e658527&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update flow, if user sends a valid data with error activity.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should update flow, if user sends a valid data with error activity.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nflowWithErrorAct.uid = userFlow.uid\nflowWithErrorAct.owner_uid = userFlow.owner_uid\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(flowWithErrorAct)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output\n            expect(flow).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d1d0f79-3dfd-40ea-9181-d74fe6f1bc64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user account is suspended.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlow Should get error, if user account is suspended.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: dummyUser.uid }, { force_suspend: true }, { new: true }, function(err, user) {\n    if (err) {\n        done(err)\n    } else {\n        api.put(flowURL + &#x27;/&#x27; + userFlow.uid)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.USER_PLAN_EXPIRE_ERROR);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7dd0b567-e4af-4d64-8c28-2132d4e34330&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;52b7d8bf-a8e8-48fe-bdc5-f349a790d14b&quot;,&quot;38b356dc-babb-472e-bc02-9e9d932d87b5&quot;,&quot;168e69f7-180f-4b0f-ad6e-b31a7aa93a53&quot;,&quot;43fc0e72-cff6-439e-8448-38f96fa241ea&quot;,&quot;62a54d70-d449-4616-a7a3-d44ecb8e7da1&quot;,&quot;d4e14710-0d89-4f33-a393-5de48b394f16&quot;,&quot;3065f519-0e21-4385-90e1-797734cd65af&quot;,&quot;6a2a6ca2-c57f-4a0a-a630-6836f9257569&quot;,&quot;6168b8c2-a6f0-4e89-96e4-f9f5c30ea6fa&quot;,&quot;69381c4e-4fad-43dd-b774-1c439997b26c&quot;,&quot;ab48bb6c-2179-4e21-8c75-1d3c6e658527&quot;,&quot;9d1d0f79-3dfd-40ea-9181-d74fe6f1bc64&quot;,&quot;7dd0b567-e4af-4d64-8c28-2132d4e34330&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:259,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;44eeae4b-7342-4be3-89e6-5fd443d81502&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\updateUserFlowInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlowInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ef9eef55-67f9-48a3-b710-3b7768586d36&quot;,&quot;title&quot;:&quot;Flow.UpdateUserFlowInfo&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\updateUserFlowInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlowInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2746,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd466c59-abbf-4517-9d9d-5c040236bd0d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41ab1d80-e50c-491b-85ef-f5e8b2307813&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + +&#x27;/info&#x27;)\n    .send(userFlow)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5fa8c71f-b5a0-4b19-a055-e0008beb2245&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/dummyFlow/info&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(userFlow)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45f7a6ca-d5c7-4307-ac2f-692d15da01a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo Should get error, if \&quot;name\&quot; key is missing OR empty.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidFlowData = _.pick(userFlow, [&#x27;uid&#x27;, &#x27;description&#x27;, &#x27;tags&#x27;])\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/info&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidFlowData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a9aab1f-6855-4fa3-97ae-67bb4c255d01&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update flow, if user sends a valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowInfo Should update flow, if user sends a valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar validFlowData = _.pick(userFlow, [&#x27;name&#x27;, &#x27;uid&#x27;, &#x27;description&#x27;, &#x27;tags&#x27;])\nvalidFlowData.name = testFlowName\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/info&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(validFlowData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.name).to.equal(testFlowName)\n            expect(res.body.output.flow_version).to.equal(1)\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95e64122-5029-4f35-ba06-86e6be3f3534&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5fa8c71f-b5a0-4b19-a055-e0008beb2245&quot;,&quot;45f7a6ca-d5c7-4307-ac2f-692d15da01a5&quot;,&quot;3a9aab1f-6855-4fa3-97ae-67bb4c255d01&quot;,&quot;95e64122-5029-4f35-ba06-86e6be3f3534&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:53,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;33166962-116f-4b7f-afb3-230ddffc9f63&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\updateUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4340312e-f251-4f63-81a2-3d7529bc5d1f&quot;,&quot;title&quot;:&quot;Flow.UpdateUserFlowVersion&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\updateUserFlowVersion.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateUserFlowVersion.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger.toJSON()\n                    //flowWithAllData.trigger.handlers[0] = userTriggerObj\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowWithAllData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea5f28de-1d49-4e84-a095-62d74aaa6035&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n            cb(err, deletedFlow);\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;93438060-8599-4a85-9ba1-4fb482de524e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/version/&#x27; + userFlow.flow_version)\n    .send(body)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04d04576-8a8e-4bc1-ae2c-7751b38536de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion Should get error, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/dummyFlow&#x27; + &#x27;/version/&#x27; + userFlow.flow_version)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5cf5f97-c504-4efd-abc7-2a561bb96f3e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if flow version not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion Should get error, if flow version not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/version/3&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_VERSION_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;987defbd-349c-4d56-9065-109cca169eef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update flow version, if user sends a valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateUserFlowVersion Should update flow version, if user sends a valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/version/&#x27; + userFlow.flow_version)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(body)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var result = res.body.output\n            expect(_.first(result).flow_version_tag).to.equal(body.flow_version_tag)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8624ca3e-abf2-438b-adb2-e3bd2ede1c03&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;04d04576-8a8e-4bc1-ae2c-7751b38536de&quot;,&quot;f5cf5f97-c504-4efd-abc7-2a561bb96f3e&quot;,&quot;987defbd-349c-4d56-9065-109cca169eef&quot;,&quot;8624ca3e-abf2-438b-adb2-e3bd2ede1c03&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:51,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;26edb125-47d5-49ac-8fbf-29ecd38667e1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\updateWebhook.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateWebhook.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;47fbadb4-953b-4086-b62f-b03cd53b8ec0&quot;,&quot;title&quot;:&quot;Flow.UpdateWebHook&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\updateWebhook.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\updateWebhook.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:103,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                var userTriggerObj = userTrigger;\n                var flowData = _.cloneDeep(testData.flowBody);\n                flowData.isExpress = false;\n                flowData.trigger.handlers = [userTriggerObj]\n                async.parallel({\n                    triggerFlow: function(cb) {\n                        createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    webHookFlow: function(cb) {\n                        var WHFlow = _.cloneDeep(flowData);\n                        WHFlow.trigger = testData.defaultTriggerObj;\n                        WHFlow.settings = testData.webHookSetting;\n                        WHFlow.active = true;\n                        WHFlow.settings = testData.webHookSetting;\n                        createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    }\n                }, function(err, result) {\n                    cbk(err, result)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userTriggerFlow = res.triggerFlow.body.output;\n                userWebHookFlow = res.webHookFlow.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aa5ea16a-0be6-4a79-8230-b3a5b57de197&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nvar flowUIDS = [userWebHookFlow.uid];\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: flowUIDS } }, function(err, deletedFlows) {\n            cb(err, deletedFlows)\n        });\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98c36936-f42f-4fe3-b024-b59ce5de5698&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userWebHookFlow.uid + &#x27;/updatewebhook&#x27;)\n    .send(updateBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a49f55b-953e-4cad-a3b1-fbd8c69bcceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give flow not found error, if user sends an invalid floe uid&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook Should give flow not found error, if user sends an invalid floe uid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/dummyFlow/updatewebhook&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(updateBody)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;306bbef8-bb15-45f7-b2cf-ccd7b25bd7b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update webhook flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook Should update webhook flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(flowURL + &#x27;/&#x27; + userWebHookFlow.uid + &#x27;/updatewebhook&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(updateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.settings.url_execution).to.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de0f58fd-4526-49b7-88b8-2f560fd30498&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update webhook of trigger attched flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UpdateWebHook Should update webhook of trigger attched flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flow_uid = userTriggerFlow.uid\nvar trigger_path = &#x27;/trigger/&#x27; + userTriggerFlow.trigger.handlers[0] + &#x27;/handlers&#x27;;\nvar trigger_body = {\n    \&quot;unset\&quot;: [flow_uid]\n}\nvar opt = { path: trigger_path, body: trigger_body };\ncommonMock.triggerPullSuccess(opt);\napi.post(flowURL + &#x27;/&#x27; + userTriggerFlow.uid + &#x27;/updatewebhook&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(updateBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.settings.url_execution).to.be.equal(true);\n            expect(res.body.output.settings).not.to.have.all.keys([&#x27;authtoken&#x27;]);\n            expect(_.isEmpty(res.body.output.trigger.handlers)).to.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f9b39da1-df73-45a3-b52f-e72e79d38130&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5a49f55b-953e-4cad-a3b1-fbd8c69bcceb&quot;,&quot;306bbef8-bb15-45f7-b2cf-ccd7b25bd7b3&quot;,&quot;de0f58fd-4526-49b7-88b8-2f560fd30498&quot;,&quot;f9b39da1-df73-45a3-b52f-e72e79d38130&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;575b5eeb-445b-4d9d-9749-c1f59ba09a14&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\userFlowExists.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\userFlowExists.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e962bd90-cf6e-47af-b4de-2873a96bab70&quot;,&quot;title&quot;:&quot;Flow.UserFlowExists&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flow\\userFlowExists.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flow\\userFlowExists.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UserFlowExists \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2193,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.enterpriseFlowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;35dc191d-8781-42a2-ba9f-f88ba9cac0f0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UserFlowExists \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.newFlow.remove({ uid: userFlow.uid }, function(err, deletedFlow) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2cc4ea6c-74a8-478a-80f0-342851c0ff48&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UserFlowExists Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/exists&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30f976fe-4803-4a50-a6b5-2113c2af17d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get \&quot;count\&quot; is equal to 0, if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UserFlowExists Should get \&quot;count\&quot; is equal to 0, if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/exists&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.count).to.be.equal(0);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b030ace9-36a7-429d-bb9a-76044b2061c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get \&quot;count\&quot; is equal to 1, if user flow is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Flow.UserFlowExists Should get \&quot;count\&quot; is equal to 1, if user flow is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(flowURL + &#x27;/&#x27; + userFlow.uid + &#x27;/exists&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.count).to.be.equal(1);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3aa04b1b-55bb-4fc1-9254-9bc1dd489f91&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;30f976fe-4803-4a50-a6b5-2113c2af17d5&quot;,&quot;b030ace9-36a7-429d-bb9a-76044b2061c2&quot;,&quot;3aa04b1b-55bb-4fc1-9254-9bc1dd489f91&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:34,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bc9c78f7-064e-42d6-856a-d1cf0515e9a4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;04de9b4c-4269-4711-a1f6-6d7a793761f2&quot;,&quot;title&quot;:&quot;flowOauth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;223c9f78-aebf-4d83-be7d-95a043b5f323&quot;,&quot;title&quot;:&quot;flowOauth.createClient&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\createClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3002,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0d4aed30-368e-4011-9ae7-56fb3551f5f2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;121c0adf-61b9-4520-ba4d-83213b1bc26e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create oauth client.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient Should create oauth client.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b726742a-919c-4251-8617-5b3011d5f7de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create oauth client without redirect_uri.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient Should create oauth client without redirect_uri.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fcf846d1-009a-4556-a85b-c9c04b3a8b70&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to create second oauth client.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient Should not allowed to create second oauth client.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(apiURL)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .send({\n                    \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n                })\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.FLOW_ACCESS_CLIENT_TOKEN_ALREADY_EXISTS);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da79035a-3d7a-4f8b-ad5e-9b6ff04d4ce8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.createClient Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a730863-3455-409b-a099-29a125696806&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b726742a-919c-4251-8617-5b3011d5f7de&quot;,&quot;fcf846d1-009a-4556-a85b-c9c04b3a8b70&quot;,&quot;da79035a-3d7a-4f8b-ad5e-9b6ff04d4ce8&quot;,&quot;0a730863-3455-409b-a099-29a125696806&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;85984805-7ca0-40ea-b623-40e42e1e406c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a6907735-69b8-4269-9625-1132cf092fc8&quot;,&quot;title&quot;:&quot;flowOauth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;126971f8-cbf2-4f29-81fb-63190e67bdf9&quot;,&quot;title&quot;:&quot;flowOauth.deleteClient&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\deleteClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.deleteClient \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2277,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    api.post(apiURL)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .send({\n                            \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n                        })\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _flowAuthUID = res.body.output.uid;\n                                done();\n                            }\n                        });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c905517-96c7-482e-8f13-94e9a0679fda&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.deleteClient \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e39aecb-4ba5-46a3-a7e9-4a026f961ec9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update oauth client.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.deleteClient Should update oauth client.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.FLOW_ACCESS_CLIENT_DELETED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d1a5416-5ae8-47cc-9523-1075acfd51ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give client not register for already un-register client.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.deleteClient Should give client not register for already un-register client.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.delete(apiURL)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.FLOW_ACCESS_CLIENT_NOT_REGISTER);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54d2bb66-b090-4601-814f-3e28d6c87cae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.deleteClient Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4057beb-c1ff-46aa-a150-5ad4ff388e24&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1d1a5416-5ae8-47cc-9523-1075acfd51ff&quot;,&quot;54d2bb66-b090-4601-814f-3e28d6c87cae&quot;,&quot;b4057beb-c1ff-46aa-a150-5ad4ff388e24&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7e460b74-a1ef-4cb3-96cd-96d8e568d702&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;974d43d5-a14a-4b2a-b4f1-22233b1ea5c0&quot;,&quot;title&quot;:&quot;flowOauth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e214926b-aa23-4699-a982-99d21363d0a6&quot;,&quot;title&quot;:&quot;flowOauth.grantToken&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\grantToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5974,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid)\n                    registrationBody1 = global.getImmutable(registrationBody);\n                    registrationBody1.email = \&quot;test.user+1@raweng.com\&quot;;\n                    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                        email: registrationBody1.email\n                    });\n                    api.post(\&quot;/enterprise/v1/signup\&quot;)\n                        .send(registrationBody1)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                authToken2 = res.body.output.authtoken;\n                                done();\n                            }\n                        });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;42c7cc70-0656-420e-93b0-4591bc0ac195&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba3ffa38-acb5-4e1e-b79a-45a2d711dd23&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should allowed to login with oauth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken Should allowed to login with oauth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:156,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/client\&quot;)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            loginWithOauth({\n                client: res.body.output,\n                registrationBody: registrationBody\n            }, done, function(loginUserUid, uid) {\n                loginUserUid.should.equal(uid);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1478235d-1b11-4a55-a8e9-8c162d2b8d5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login other user with oauth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken Should allowed to login other user with oauth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:136,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/client\&quot;)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            loginWithOauth({\n                client: res.body.output,\n                registrationBody: registrationBody1\n            }, done, function(loginUserUid, uid) {\n                loginUserUid.should.equal(uid);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c9a9f37-1699-48b5-b975-bb4d0b8e0506&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login with different client, if multiple clients are available.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken Should allowed to login with different client, if multiple clients are available.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:264,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/client\&quot;)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            loginWithOauth({\n                client: res.body.output,\n                registrationBody: registrationBody1\n            }, done, function(loginUserUid, uid) {\n                if (loginUserUid == uid) {\n                    api.post(\&quot;/enterprise/v1/user/client\&quot;)\n                        .set(&#x27;authtoken&#x27;, authToken2)\n                        .send({\n                            \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n                        })\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                loginWithOauth({\n                                    client: res.body.output,\n                                    registrationBody: registrationBody1\n                                }, done, function(loginUserUid, uid) {\n                                    loginUserUid.should.equal(uid);\n                                    done();\n                                });\n                            }\n                        });\n                } else {\n                    loginUserUid.should.equal(uid);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f4fc9f3-344b-4508-8f73-a61091190e48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.grantToken Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e9ddb95-de5e-4aaa-8bb7-9dd0155fc803&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1478235d-1b11-4a55-a8e9-8c162d2b8d5d&quot;,&quot;5c9a9f37-1699-48b5-b975-bb4d0b8e0506&quot;,&quot;8f4fc9f3-344b-4508-8f73-a61091190e48&quot;,&quot;8e9ddb95-de5e-4aaa-8bb7-9dd0155fc803&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:560,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8af9232e-b0e2-46aa-9b7a-48d6c5e3df6e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ef91166a-85ac-4b31-a1b3-f502db90f975&quot;,&quot;title&quot;:&quot;flowOauth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ab96785d-0f05-484f-999b-883b1a07f42a&quot;,&quot;title&quot;:&quot;flowOauth.loginWithFlowOAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\loginWithFlowOAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.loginWithFlowOAuth \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4139,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid)\n                    registrationBody1 = global.getImmutable(registrationBody);\n                    registrationBody1.email = \&quot;test.user+1@raweng.com\&quot;;\n                    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                        email: registrationBody1.email\n                    });\n                    api.post(\&quot;/enterprise/v1/signup\&quot;)\n                        .send(registrationBody1)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                authToken2 = res.body.output.authtoken;\n                                done();\n                            }\n                        });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6f7bf8d-742d-4ac8-a82b-41666d64bdd7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.loginWithFlowOAuth \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c171639c-d7eb-4585-ae3a-83390496cebe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should allowed to login with access token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.loginWithFlowOAuth Should allowed to login with access token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar accessToken = \&quot;40399f8be4bd5e6df8b1b3a5e8a8dcf61dba4dc6\&quot;;\n_models.OAuthAccessToken.create({\n    \&quot;access_token\&quot;: accessToken,\n    \&quot;client_id\&quot;: \&quot;rp84OfO7CpRrPKaD\&quot;,\n    \&quot;refresh_token\&quot;: \&quot;ea720a80-4b4c-c476-faf5-873b4cfb28df\&quot;,\n    \&quot;user_uid\&quot;: _userUID\n}, function(error, access_token) {\n    if (error) {\n        done(error);\n    } else {\n        api.post(\&quot;/enterprise/v1/oauth/user\&quot;)\n            .send({\n                access_token: accessToken\n            })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.uid.should.not.equal(\&quot;\&quot;);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3da7de4-bdd9-4e46-bb20-6ee08b99d44f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.loginWithFlowOAuth Should give error as unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar accessToken = \&quot;40399f8be4bd5e6df8b1b3a5e8a8dcf61dba4dc6\&quot;;\n_models.OAuthAccessToken.create({\n    \&quot;access_token\&quot;: accessToken + \&quot;DUNPLICATE\&quot;,\n    \&quot;client_id\&quot;: \&quot;rp84OfO7CpRrPKaD\&quot;,\n    \&quot;refresh_token\&quot;: \&quot;ea720a80-4b4c-c476-faf5-873b4cfb28df\&quot;,\n    \&quot;user_uid\&quot;: _userUID\n}, function(error, access_token) {\n    if (error) {\n        done(error);\n    } else {\n        api.post(\&quot;/enterprise/v1/oauth/user\&quot;)\n            .send({\n                access_token: accessToken\n            })\n            .expect(httpStatus.UNAUTHORIZED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.INVALID_FLOW_AUTH_TOKEN);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f10a88b-413b-434e-93ae-4b09f8ae2544&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.loginWithFlowOAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3bcbdb3e-e76e-45ac-a4a0-e6a4f7829e8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c3da7de4-bdd9-4e46-bb20-6ee08b99d44f&quot;,&quot;1f10a88b-413b-434e-93ae-4b09f8ae2544&quot;,&quot;3bcbdb3e-e76e-45ac-a4a0-e6a4f7829e8a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:23,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;cef1c09e-5865-4de2-8062-a498de217dda&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;45f309aa-b3b0-409a-b469-5d0d1d81e027&quot;,&quot;title&quot;:&quot;flowOauth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;41720ada-598c-4ddc-b852-d7a8b23013f0&quot;,&quot;title&quot;:&quot;flowOauth.updateClient&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\flowOauth\\updateClient.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.updateClient \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4224,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    api.post(apiURL)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .send({\n                            \&quot;redirect_uri\&quot;: \&quot;http://demo.example.com/callback\&quot;\n                        })\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _flowAuthUID = res.body.output.uid;\n                                done();\n                            }\n                        });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79490275-39f1-4850-a3b7-2d8c313a63cd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.updateClient \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da155d66-f575-4654-8123-a4b3b8d67b9c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update oauth client.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.updateClient Should update oauth client.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar newUrl = \&quot;http://example.com/callback\&quot;;\napi.put(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: newUrl\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid == _flowAuthUID &amp;&amp;\n                res.body.output.redirect_uri == newUrl).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;462dbe36-ef13-4a0c-8a49-2a2b00dec7d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update oauth client without redirect_uri.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.updateClient Should update oauth client without redirect_uri.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        \&quot;redirect_uri\&quot;: \&quot;\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid == _flowAuthUID &amp;&amp;\n                res.body.output.redirect_uri == \&quot;\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13789e32-6474-47e2-a44b-7f2cab9fbfea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise flowOauth flowOauth.updateClient Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a503de2-c35c-45d0-b93a-0641afeeb2ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;462dbe36-ef13-4a0c-8a49-2a2b00dec7d0&quot;,&quot;13789e32-6474-47e2-a44b-7f2cab9fbfea&quot;,&quot;2a503de2-c35c-45d0-b93a-0641afeeb2ba&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2b7a7021-4201-44ee-95cd-2e59110e5f24&quot;,&quot;title&quot;:&quot;Activity Analytics&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\helpers\\index.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\helpers\\index.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// var p1 = Promise.all([\n//     _models.ActionUsages.remove({})\n//     _models.User.collection.remove({})\n// ]);\n// var p2 = _models.User.collection.insert(mock_users.express.user_one);\n// var p3 = _models.User.collection.insert(mock_users.enterprise.user_one);\n// return Promise.all([p1, p2, p3]);\nreturn _models.ActionUsages.remove({})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a5e19a9-e8c4-4d82-9bb7-80b94d7f5b18&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b91e41f6-3b43-4e20-8c74-06c31a36b872&quot;,&quot;title&quot;:&quot;Common Validation&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\helpers\\index.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\helpers\\index.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should throw error for invalid params&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Common Validation Should throw error for invalid params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(10000);\nreturn activityAnalytics.set().then(function(data) {\n    return data.should.be.undefined;\n}, function(err) {\n    return err.should.be.deep.equal({\n        message: &#x27;Invalid arguments.&#x27;,\n        errors: [\n            &#x27;\&quot;user\&quot; param is mandatory&#x27;,\n            &#x27;\&quot;new_flow\&quot; param is mandatory&#x27;\n        ]\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76d1ec4c-af29-4e2b-9265-8c0adc55c620&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;76d1ec4c-af29-4e2b-9265-8c0adc55c620&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5f6db738-72d2-4175-be1e-cf042f4f48ed&quot;,&quot;title&quot;:&quot;Express&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\helpers\\index.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\helpers\\index.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create new analytic event for \&quot;new flow\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Express Should create new analytic event for \&quot;new flow\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.express.user_one, mock_new_flow.express.new_flow).then(function(data) {\n    data.should.be.deep.equal({ isNew: true, isChanged: true });\n    return _models.ActionUsages.findOne()\n        .lean()\n        .then(function(act) {\n            act.created_at = act.created_at.toISOString()\n            act.updated_at = act.updated_at.toISOString()\n            delete act.triggers[0]._id\n            delete act.activities[0]._id\n            delete act._id\n            delete act.uid\n            act.should.be.deep.equal(mock_new_flow.express.new_flow_analytics)\n        })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;053e1ac1-6299-446c-8533-846a5216a666&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update analytic event for \&quot;existing flow\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Express Should update analytic event for \&quot;existing flow\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.express.user_one, mock_new_flow.express.new_flow)\n    .then(function() {\n        return activityAnalytics.set(mock_users.express.user_one, mock_new_flow.express.existing_flow).then(function(data) {\n            data.should.be.deep.equal({ isNew: false, isChanged: true });\n            return _models.ActionUsages.findOne()\n                .lean()\n                .then(function(act) {\n                    act.created_at = act.created_at.toISOString()\n                    act.updated_at = act.updated_at.toISOString()\n                    act.triggers = remove_id(act.triggers)\n                    act.activities = remove_id(act.activities)\n                    delete act._id\n                    delete act.uid\n                    act.should.be.deep.equal(mock_new_flow.express.existing_flow_analytics)\n                })\n        })\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8f74cf5-f1e1-4cb4-9031-4a237cb8f3d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should be same analytic event for \&quot;existing unchanged\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Express Should be same analytic event for \&quot;existing unchanged\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.express.user_one, mock_new_flow.express.new_flow)\n    .then(function() {\n        return activityAnalytics.set(mock_users.express.user_one, mock_new_flow.express.new_flow).then(function(data) {\n            data.should.be.deep.equal({ isNew: false, isChanged: false });\n            return _models.ActionUsages.findOne()\n                .lean()\n                .then(function(act) {\n                    act.created_at = act.created_at.toISOString()\n                    act.updated_at = act.updated_at.toISOString()\n                    delete act.triggers[0]._id\n                    delete act.activities[0]._id\n                    delete act._id\n                    delete act.uid\n                    act.should.be.deep.equal(mock_new_flow.express.new_flow_analytics)\n                })\n        })\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8d3a2401-c8d6-46bf-9112-828c15365caf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;053e1ac1-6299-446c-8533-846a5216a666&quot;,&quot;e8f74cf5-f1e1-4cb4-9031-4a237cb8f3d6&quot;,&quot;8d3a2401-c8d6-46bf-9112-828c15365caf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ce92e9b6-5635-4e07-90a4-af92cd3df654&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\helpers\\index.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\helpers\\index.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create new analytic event for \&quot;new flow\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Enterprise Should create new analytic event for \&quot;new flow\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.new_flow).then(function(data) {\n    data.should.be.deep.equal({ isNew: true, isChanged: true });\n    return _models.ActionUsages.findOne()\n        .lean()\n        .then(function(act) {\n            act.created_at = act.created_at.toISOString()\n            act.updated_at = act.updated_at.toISOString()\n            delete act.triggers[0]._id\n            delete act.activities[0]._id\n            delete act._id\n            delete act.uid\n            act.should.be.deep.equal(mock_new_flow.enterprise.new_flow_analytics)\n        })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e512ba8-193d-464a-88db-e42a041200b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update analytic event for \&quot;existing flow\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Enterprise Should update analytic event for \&quot;existing flow\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.new_flow).then(function() {\n    return activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.existing_flow).then(function(data) {\n        data.should.be.deep.equal({ isNew: false, isChanged: true });\n        return _models.ActionUsages.findOne()\n            .lean()\n            .then(function(act) {\n                act.created_at = act.created_at.toISOString()\n                act.updated_at = act.updated_at.toISOString()\n                act.triggers = remove_id(act.triggers)\n                act.activities = remove_id(act.activities)\n                delete act._id\n                delete act.uid\n                act.should.be.deep.equal(mock_new_flow.enterprise.existing_flow_analytics)\n            })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17742079-fa34-4cc8-84ff-a35058b74028&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should be same analytic event for \&quot;existing unchanged\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Enterprise Should be same analytic event for \&quot;existing unchanged\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.new_flow)\n    .then(function() {\n        return activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.new_flow).then(function(data) {\n            data.should.be.deep.equal({ isNew: false, isChanged: false });\n            return _models.ActionUsages.findOne()\n                .lean()\n                .then(function(act) {\n                    act.created_at = act.created_at.toISOString()\n                    act.updated_at = act.updated_at.toISOString()\n                    delete act.triggers[0]._id\n                    delete act.activities[0]._id\n                    delete act._id\n                    delete act.uid\n                    act.should.be.deep.equal(mock_new_flow.enterprise.new_flow_analytics)\n                })\n        })\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea5aff09-cf09-416e-81eb-79e15497000d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update analytic event for \&quot;existing flow\&quot; with \&quot;url_execution\&quot; set to \&quot;false\&quot;&quot;,&quot;fullTitle&quot;:&quot;Activity Analytics Enterprise Should update analytic event for \&quot;existing flow\&quot; with \&quot;url_execution\&quot; set to \&quot;false\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(1000)\nreturn activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.existing_flow).then(function() {\n    return activityAnalytics.set(mock_users.enterprise.user_one, mock_new_flow.enterprise.flow_without_trigger_webhook).then(function(data) {\n        data.should.be.deep.equal({ isNew: false, isChanged: true });\n        return _models.ActionUsages.findOne()\n            .lean()\n            .then(function(act) {\n                act.created_at = act.created_at.toISOString()\n                act.updated_at = act.updated_at.toISOString()\n                act.triggers = remove_id(act.triggers)\n                act.activities = remove_id(act.activities)\n                delete act._id\n                delete act.uid\n                act.should.be.deep.equal(mock_new_flow.enterprise.flow_without_trigger_webhook_analytics)\n            })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2429285e-9887-44a1-ae01-11c608bee60a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7e512ba8-193d-464a-88db-e42a041200b1&quot;,&quot;17742079-fa34-4cc8-84ff-a35058b74028&quot;,&quot;ea5aff09-cf09-416e-81eb-79e15497000d&quot;,&quot;2429285e-9887-44a1-ae01-11c608bee60a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6717211d-770e-4c72-82ab-c176fbbcc5bf&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d4eb4634-8437-4d73-a181-89c87f491712&quot;,&quot;title&quot;:&quot;Invoices&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ef033ee7-30d1-4d6f-9b04-6a1971d9f807&quot;,&quot;title&quot;:&quot;invoice.downloadInvoice&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\downloadInvoice.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d7f73713-3896-4776-a58e-76db08d743bc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33716e03-7895-45c2-a92c-7a2136a7bd8c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get invoice by uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Should get invoice by uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:846,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.owner.braintree_customerId || \&quot;\&quot;,\n    uid: _data.owner.uid || \&quot;\&quot;\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            true.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e80679f7-6f8e-4f5c-9d5e-c24ddf3af71c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Admin should get organization invoice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Admin should get organization invoice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:750,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            true.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a47524f-847d-47b3-bc46-721d28b8a5c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Billing manager should get organization invoice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Billing manager should get organization invoice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:819,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            true.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49b90b8e-7868-4d27-9946-4aa9b8ba065f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Developer should not get organization invoice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Developer should not get organization invoice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:98,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.ORG_NO_ACCESS_TO_CHANGE_PLAN);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a01384c2-a3d4-4d8f-a290-35ed2f875453&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get invoice by uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Should not get invoice by uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n//var paramURL = apiURL.replace(\&quot;:uid\&quot;, \&quot;ABC\&quot;);\nvar paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, \&quot;ABC\&quot;);\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.DOWNLOAD_INVOICE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6d1df8f-e692-4744-b3dc-7a8e1fdb5145&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.downloadInvoice Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, \&quot;ABC\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;90457d72-057e-46d2-84d4-fee1cf8a8516&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e80679f7-6f8e-4f5c-9d5e-c24ddf3af71c&quot;,&quot;8a47524f-847d-47b3-bc46-721d28b8a5c4&quot;,&quot;49b90b8e-7868-4d27-9946-4aa9b8ba065f&quot;,&quot;a01384c2-a3d4-4d8f-a290-35ed2f875453&quot;,&quot;a6d1df8f-e692-4744-b3dc-7a8e1fdb5145&quot;,&quot;90457d72-057e-46d2-84d4-fee1cf8a8516&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2531,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b5aea819-f97c-40d2-a805-7f60ab23846e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;38ddfe54-a94d-4625-8db4-23aa7803ec43&quot;,&quot;title&quot;:&quot;Invoices&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b1747aa7-416b-43a9-934c-c339733d47bd&quot;,&quot;title&quot;:&quot;invoice.list&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:143,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6717234c-281b-4b91-817c-d4ce0700afd8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;50014e25-f99f-4d08-9f28-b038010ce7f7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;339f53ca-a38a-48fb-963a-9a628657d4e6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of invoices.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list Should get list of invoices.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.owner.braintree_customerId || \&quot;\&quot;,\n    uid: _data.owner.uid || \&quot;\&quot;\n}, function() {\n    api.get(apiURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = Array.isArray(res.body.output);\n                if (isValid) {\n                    _.each(res.body.output, function(item) {\n                        isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(item.__v) == \&quot;undefined\&quot;;\n                    });\n                }\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;323581cf-eb62-41b1-b267-a876a9464ad5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of organization invoices by Admin.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list Should get list of organization invoices by Admin.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.get(apiURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = Array.isArray(res.body.output);\n                            if (isValid) {\n                                _.each(res.body.output, function(item) {\n                                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(item.__v) == \&quot;undefined\&quot;;\n                                });\n                            }\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dc98dcb9-02e2-47cc-84a1-916968c853de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Billing manager should get organization invoice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list Billing manager should get organization invoice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.get(apiURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = Array.isArray(res.body.output);\n                            if (isValid) {\n                                _.each(res.body.output, function(item) {\n                                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(item.__v) == \&quot;undefined\&quot;;\n                                });\n                            }\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;184b519f-f844-40e6-9472-64b956e25a35&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Developer should not get organization invoice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list Developer should not get organization invoice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.get(apiURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.ORG_NO_ACCESS_TO_CHANGE_PLAN);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8394da2a-1220-4a19-9ee7-9e598eec02e8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.list Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;032502c1-305d-472a-9e9d-2d1188a2f3a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;323581cf-eb62-41b1-b267-a876a9464ad5&quot;,&quot;dc98dcb9-02e2-47cc-84a1-916968c853de&quot;,&quot;184b519f-f844-40e6-9472-64b956e25a35&quot;,&quot;8394da2a-1220-4a19-9ee7-9e598eec02e8&quot;,&quot;032502c1-305d-472a-9e9d-2d1188a2f3a5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:323,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;df910e80-56f6-4168-94e6-a15d3cea76e8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;54564d9d-b8ac-4383-94cb-7f66a427cb0c&quot;,&quot;title&quot;:&quot;Invoices&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a48353bf-289d-4566-be0e-9e2485726a65&quot;,&quot;title&quot;:&quot;invoice.searchByUid&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\invoices\\searchByUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2eb65acb-dd9f-4e30-b5ca-0d6f8323326f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2556ffcd-a0ec-4d5f-8075-9434136890db&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get invoice by uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should get invoice by uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.owner.braintree_customerId || \&quot;\&quot;,\n    uid: _data.owner.uid || \&quot;\&quot;\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid == invoices[0].uid &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;391cd32b-3765-4d00-b2ee-196f3984cf22&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get invoice of organization by Admin.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should get invoice of organization by Admin.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid == invoices[0].uid &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8cffd7de-1515-4e6c-9f4b-ce54324cd084&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get invoice of organization by Billing Manager.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should get invoice of organization by Billing Manager.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid == invoices[0].uid &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;febfd6f5-d2b6-4b3b-a940-decb652ea791&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get invoice of organization by Developer.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should get invoice of organization by Developer.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveInvoices({\n    authToken: authToken,\n    braintree_customerId: _data.organization_account.braintree_customerId || \&quot;\&quot;,\n    uid: _data.organization_account.uid || \&quot;\&quot;,\n    org_uid: org_uid\n}, function() {\n    api.get(\&quot;/enterprise/v1/user/account/invoices\&quot;)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var invoices = res.body.output;\n                var paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, invoices[0].uid);\n                api.get(paramURL)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.ORG_NO_ACCESS_TO_CHANGE_PLAN);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a21cd9a6-e04c-4067-b9db-b69789f3da8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get invoice by uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should not get invoice by uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n//var paramURL = apiURL.replace(\&quot;:uid\&quot;, \&quot;ABC\&quot;);\nvar paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, \&quot;ABC\&quot;);\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.INVOICE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a07853f-1122-4065-8e56-62ff06b77531&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Invoices invoice.searchByUid Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:invoice_uid\&quot;, \&quot;ABC\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;973b07e0-e318-44b1-8759-625efd922ecf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;391cd32b-3765-4d00-b2ee-196f3984cf22&quot;,&quot;8cffd7de-1515-4e6c-9f4b-ce54324cd084&quot;,&quot;febfd6f5-d2b6-4b3b-a940-decb652ea791&quot;,&quot;a21cd9a6-e04c-4067-b9db-b69789f3da8c&quot;,&quot;3a07853f-1122-4065-8e56-62ff06b77531&quot;,&quot;973b07e0-e318-44b1-8759-625efd922ecf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:330,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;69dfa7ec-f689-43fa-bf59-2f3a70b66710&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;976aa93a-c9c9-4dc2-901c-441895d2ac8a&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bf17a17c-e947-4ed0-a202-10fd61ab4903&quot;,&quot;title&quot;:&quot;logs.getOldLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs logs.getOldLogs \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5066,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            saveUserLogs({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                },\n                function(error, userLogs) {\n                    savedUserLogs = userLogs;\n                    done();\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1557d8d2-d69b-4d6d-a896-c1352d3e23f5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs logs.getOldLogs \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Log.remove({ flow_name: new RegExp(&#x27;^utest_cases_&#x27;, \&quot;i\&quot;) }, function(error, user) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a660b41-6dd8-41d4-bd1e-76ffa095244a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs logs.getOldLogs Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.objects.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef5ff7a4-3ebb-4ec8-ba28-0de6e3d3fef9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs logs.getOldLogs Should get limited list of user logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar skipLimitURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(skipLimitURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var validOutput = false;\n            if (res.body.output.count == 5) {\n                validOutput = res.body.output.objects[0].uid == savedUserLogs[2].body.output.uid &amp;&amp;\n                    res.body.output.objects[1].uid == savedUserLogs[1].body.output.uid;\n            }\n            if (validOutput == false) {\n                console.log({\n                    objects: res.body.output.objects,\n                    savedUserLogs: savedUserLogs\n                });\n                logger.error({\n                    objects: res.body.output.objects,\n                    savedUserLogs: savedUserLogs\n                });\n            }\n            validOutput.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84c38833-41e1-4472-b7f6-ac5a881297c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs logs.getOldLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;099f9936-4507-4e6c-86d9-5603a321446b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ef5ff7a4-3ebb-4ec8-ba28-0de6e3d3fef9&quot;,&quot;84c38833-41e1-4472-b7f6-ac5a881297c5&quot;,&quot;099f9936-4507-4e6c-86d9-5603a321446b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;14588b8e-977e-4924-96ff-ba0218420bd4&quot;,&quot;title&quot;:&quot;Express&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d82efc0d-3de0-48b8-8262-66f34a5c5d2a&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d2685e26-2d5f-46b2-91ba-3a8911fc24eb&quot;,&quot;title&quot;:&quot;logs.getOldLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\logs\\getOldLogs.express.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Express UserLogs logs.getOldLogs \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5064,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({\n        express: true\n    }, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            user_uid = user.uid;\n            saveUserLogs({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                },\n                function(error, userLogs) {\n                    savedUserLogs = userLogs;\n                    done();\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83a94eca-8dbe-4819-8f6b-daaaebe17f0f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Express UserLogs logs.getOldLogs \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Log.remove({ flow_name: new RegExp(&#x27;^utest_cases_&#x27;, \&quot;i\&quot;) }, function(error, user) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ecfa103b-6ada-46e6-821a-145ba1f45e9c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Express UserLogs logs.getOldLogs Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.objects.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0565783d-d580-4e89-81b4-c4065e9c29a3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Express UserLogs logs.getOldLogs Should get limited list of user logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar skipLimitURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(skipLimitURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var validOutput = false;\n            if (res.body.output.count == 5) {\n                validOutput = res.body.output.objects[0].uid == savedUserLogs[2].body.output.uid &amp;&amp;\n                    res.body.output.objects[1].uid == savedUserLogs[1].body.output.uid;\n            }\n            if (validOutput == false) {\n                console.log({\n                    objects: res.body.output.objects,\n                    savedUserLogs: savedUserLogs\n                });\n                logger.error({\n                    objects: res.body.output.objects,\n                    savedUserLogs: savedUserLogs\n                });\n            }\n            validOutput.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4b624675-e41f-4823-8122-8b41c494e2da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Express UserLogs logs.getOldLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc9d345c-1503-478c-8f38-c90fc7e329e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0565783d-d580-4e89-81b4-c4065e9c29a3&quot;,&quot;4b624675-e41f-4823-8122-8b41c494e2da&quot;,&quot;cc9d345c-1503-478c-8f38-c90fc7e329e6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ca6bdb61-ef7e-48ad-8868-241327b661df&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getCreditsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getCreditsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f7d09049-a178-4b73-bc26-15a1d9b04b50&quot;,&quot;title&quot;:&quot;Metrics.GetCreditsMetrics&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getCreditsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getCreditsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:231,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.createFlowUser({}, function(error, user) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        cbk(null, user);\n                    }\n                });\n            });\n        },\n        function(user, cbk) {\n            dummyUser = user;\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: dummyUser.authtoken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aadd5424-4369-40ed-8e97-7b32c97e9657&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;953d0a09-3f4d-4712-94dd-cb2f1ac12e8e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52554db1-aa63-46ed-b2e0-75d17488bc97&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of credit metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should get list of credit metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_credits&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02a58261-5b94-45b7-8eef-1ccdcdaec5d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of credit metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should get list of credit metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_credits&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;67dd6377-4de9-455e-b449-b61e7ee64621&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;52554db1-aa63-46ed-b2e0-75d17488bc97&quot;,&quot;02a58261-5b94-45b7-8eef-1ccdcdaec5d6&quot;,&quot;67dd6377-4de9-455e-b449-b61e7ee64621&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2283f481-c0f5-4ff8-9f5c-c4eab7325fb4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getCreditsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getCreditsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2bf84a16-730c-4100-815a-57104afb8c13&quot;,&quot;title&quot;:&quot;Metrics.GetCreditsMetrics&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getCreditsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getCreditsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:300,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.organizationRecordsEntry({}, function(data) {\n                    authToken = data.owner.authtoken;\n                    org_uid = data.organization.uid;\n                    cbk(null, data);\n                });\n            });\n        },\n        function(res, cbk) {\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: authToken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8318ce38-db89-42bc-a698-a0a5cd56cb5e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54f171b5-eff5-438e-b031-7f52bf0d4b3d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e56da13-25b1-4580-86ce-dfe77062a3eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of credit metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should get list of credit metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_credits&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d3628db-fe26-4c18-9354-b8de54c4d267&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of credit metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetCreditsMetrics Should get list of credit metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_credits&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;697579df-b0bb-44cc-90fd-a9b314a5c736&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6e56da13-25b1-4580-86ce-dfe77062a3eb&quot;,&quot;9d3628db-fe26-4c18-9354-b8de54c4d267&quot;,&quot;697579df-b0bb-44cc-90fd-a9b314a5c736&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:41,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2ff74364-31d3-4c26-b47b-5c4ecfd4d9c6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getFlowDetailsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowDetailsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;300d682b-ca91-435a-afc3-9f1336a0bb96&quot;,&quot;title&quot;:&quot;Metrics.GetFlowDetailsMetrics&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getFlowDetailsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowDetailsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetrics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:231,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.createFlowUser({}, function(error, user) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        authToken = user.authtoken;\n                        token = user.activation_token;\n                        _id = user._id;\n                        uid = user.uid;\n                        cbk(null, user);\n                    }\n                });\n            });\n        },\n        function(user, cbk) {\n            dummyUser = user;\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: dummyUser.authtoken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dcf8e3b9-275b-4734-ab26-cc4d45812224&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetrics \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab65d9d6-0e01-42fc-b6df-d68d0170064e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetrics Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + flowUid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3af1570e-fc75-4a4c-bb03-c7b6b1d8585a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow details metrics if valid flow uid provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetrics Should get list of flow details metrics if valid flow uid provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + flowUid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(_.keys(billBody));\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7f52f7f-fe79-47cd-bf0e-f638a3a74ee1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3af1570e-fc75-4a4c-bb03-c7b6b1d8585a&quot;,&quot;c7f52f7f-fe79-47cd-bf0e-f638a3a74ee1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8083f32c-e4a6-4c44-80eb-8253084352c4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getFlowDetailsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowDetailsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d4b8fd58-466b-444a-913e-2ab6b388190c&quot;,&quot;title&quot;:&quot;Metrics.GetFlowDetailsMetricsOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getFlowDetailsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowDetailsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetricsOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:295,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.organizationRecordsEntry({}, function(data) {\n                    authToken = data.owner.authtoken;\n                    org_uid = data.organization.uid;\n                    cbk(null, data);\n                });\n            });\n        },\n        function(res, cbk) {\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: authToken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f14bd95-e771-4a87-9ab2-9ac09206214b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetricsOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f9df4b7b-7c1f-4339-857d-9754883cc4be&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetricsOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + flowUid)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95dd0828-a47f-417b-8c9f-a3172707c4db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow details metrics if valid flow uid provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowDetailsMetricsOrg Should get list of flow details metrics if valid flow uid provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL + flowUid)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(_.keys(billBody));\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b7c4294e-0feb-41cc-bd5d-80a39f111cba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;95dd0828-a47f-417b-8c9f-a3172707c4db&quot;,&quot;b7c4294e-0feb-41cc-bd5d-80a39f111cba&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c0875632-3ae9-4ae2-bc78-6304bae844e8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getFlowsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5bd67a94-4909-43a6-bc4b-5f9a772da138&quot;,&quot;title&quot;:&quot;Metrics.GetFlowsMetrics&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getFlowsMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowsMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetrics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:232,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.createFlowUser({\n                    email: testData.testRegistrationBody.email\n                }, function(error, user) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        authToken = user.authtoken;\n                        token = user.activation_token;\n                        _id = user._id;\n                        uid = user.uid;\n                        cbk(null, user);\n                    }\n                });\n            });\n        },\n        function(user, cbk) {\n            authToken = user.authtoken;\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: authToken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2eb9cadc-fe79-4783-b1ce-dc8f99e0274e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetrics \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Bill.remove({}, function(err) {\n    done(err);\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cabe92a8-ab3e-4722-99ad-ff5475ce12df&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetrics Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d13f62b-1aea-49fe-b0a3-0415e3cb26f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetrics Should get list of flow metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(keySet);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b41f85e1-f07b-42f9-a0bc-a129ff87c89f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetrics Should get list of flow metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(keySet);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dc50049b-1cf8-41a4-be0b-c92646f2412e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9d13f62b-1aea-49fe-b0a3-0415e3cb26f3&quot;,&quot;b41f85e1-f07b-42f9-a0bc-a129ff87c89f&quot;,&quot;dc50049b-1cf8-41a4-be0b-c92646f2412e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9079b4a6-2142-437d-9bbb-57347f9ef366&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getFlowsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5a7cf906-bc0e-4c62-8576-13ac8544295e&quot;,&quot;title&quot;:&quot;Metrics.GetFlowsMetricsOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getFlowsMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getFlowsMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetricsOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:296,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        testCollection.organizationRemoveRecords({}, function() {\n            testCollection.organizationRecordsEntry({}, function(data) {\n                authToken = data.owner.authtoken;\n                org_uid = data.organization.uid;\n                cbk(null, data);\n            });\n        });\n    },\n    function(res, cbk) {\n        saveBillEntries(\n            _.extend(getImmutable(billBody), {\n                authtoken: authToken\n            }),\n            function(error, bills) {\n                savedBills = bills;\n                cbk(null, savedBills);\n            });\n    }\n], function(err, results) {\n    if (err) {\n        done(err);\n    } else {\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3bd84fbf-98ba-44a8-ab9e-149535bd0e37&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetricsOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Bill.remove({}, function(err) {\n    done(err);\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a81443c-7749-40eb-b164-975b38622539&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetricsOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f66eaa5-859c-4d7a-8aab-2b26f55e6984&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetricsOrg Should get list of flow metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(keySet);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0b8d2cd-64c7-47ce-82cc-1bc18f650a6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of flow metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.GetFlowsMetricsOrg Should get list of flow metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys(keySet);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69df13c2-c141-4d7d-9773-823ab7910cd6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7f66eaa5-859c-4d7a-8aab-2b26f55e6984&quot;,&quot;c0b8d2cd-64c7-47ce-82cc-1bc18f650a6f&quot;,&quot;69df13c2-c141-4d7d-9773-823ab7910cd6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3c427fe0-113e-4b77-8294-52f0339ded0f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getGraphData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getGraphData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9360c277-57d1-4c23-b315-6b064273ba2b&quot;,&quot;title&quot;:&quot;Metrics.getGraphData&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getGraphData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getGraphData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7168,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            _models.User.remove({}, function(error, user) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(testData.testRegistrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        authToken = (((res || {}).body || {}).output || {}).authtoken || \&quot;\&quot;;\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                env_uid = (((res || {}).body || {}).output || {}).env_uid;\n                                user_uid = (((res || {}).body || {}).output || {}).uid;\n                                cbk(err, res);\n                            });\n                    });\n            });\n        },\n        function(res, cbk) {\n            saveBillEntries({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserTriggers({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserFlows({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, userFlows) {\n                    cbk(null, userFlows);\n                });\n        }\n    ], function(err, results) {\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;632e619c-ffda-4689-8f29-b0fe6ee605de&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff9219ed-c7b0-4d8e-b5c0-38f46082f45a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8654e29-6d0b-436b-a059-8a059af4db1d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get type bill data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type bill data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill\&quot;;\napi.get(billURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ade11a4-640b-4498-b64d-ff42ad34dd2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type bill data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=daily\&quot;;\napi.get(billURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9def5531-a780-42b2-9e93-dcd7f5251f95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type bill data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=monthly\&quot;;\napi.get(billURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ddc660e5-e776-40a9-889b-632e9303a796&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on yearly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type bill data based on yearly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=weekly\&quot;;\napi.get(billURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f4304e0-4d41-4de9-bcfb-fae70543339c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type trigger data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger\&quot;;\napi.get(triggerURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b238a31c-5de7-4288-a7af-776516220bc7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type trigger data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=daily\&quot;;\napi.get(triggerURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0bf4adbc-9931-43b8-8576-61f0cef02410&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type trigger data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=monthly\&quot;;\napi.get(triggerURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f8264a8-6df5-4b9d-89b8-3b07cf15f886&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type trigger data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=weekly\&quot;;\napi.get(triggerURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6e1138d-bc97-4712-b483-ed189adfb5e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type flowscreated data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated\&quot;;\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0085f03c-279f-4a6b-998b-ecc1e72131e8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type flowscreated data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=daily\&quot;;\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fa4e88e8-e9d3-4e17-a98f-6d475841c1a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type flowscreated data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=monthly\&quot;;\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5a4e354-36d4-49b5-9f99-0e35f577b0f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type flowscreated data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=weekly\&quot;;\napi.get(flowURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dc9fcc94-cadd-40e1-91dc-f95f89118e18&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type credits data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits\&quot;;\napi.get(creditURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate;\n            (res.body.output[0][0]).should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9ef3be5a-10c2-470c-b449-6f51edca99b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type credits data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=daily\&quot;;\napi.get(creditURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate;\n            (res.body.output[0][0]).should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d250281-fbdc-4e26-866e-ba759074f32d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type credits based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=monthly\&quot;;\napi.get(creditURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output[0][0] == currentMonthFormat;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7743e849-9d5e-4bd8-a543-8db3bb617b14&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should get type credits data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=weekly\&quot;;\napi.get(creditURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output[0][0].indexOf(\&quot;week\&quot;) == 0;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19bbe403-efc4-4f84-ad6c-d87330a7713f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid type error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should give invalid type error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar fakeURL = apiURL + \&quot;?type=FAKE\&quot;;\napi.get(fakeURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.GRAPH_TYPE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4deda0e-b35c-4886-9164-62fc664412df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphData Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8ee9c75-28dd-4458-9dcd-281f45eea5fa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7ade11a4-640b-4498-b64d-ff42ad34dd2a&quot;,&quot;9def5531-a780-42b2-9e93-dcd7f5251f95&quot;,&quot;ddc660e5-e776-40a9-889b-632e9303a796&quot;,&quot;9f4304e0-4d41-4de9-bcfb-fae70543339c&quot;,&quot;b238a31c-5de7-4288-a7af-776516220bc7&quot;,&quot;0bf4adbc-9931-43b8-8576-61f0cef02410&quot;,&quot;9f8264a8-6df5-4b9d-89b8-3b07cf15f886&quot;,&quot;a6e1138d-bc97-4712-b483-ed189adfb5e3&quot;,&quot;0085f03c-279f-4a6b-998b-ecc1e72131e8&quot;,&quot;fa4e88e8-e9d3-4e17-a98f-6d475841c1a4&quot;,&quot;c5a4e354-36d4-49b5-9f99-0e35f577b0f7&quot;,&quot;dc9fcc94-cadd-40e1-91dc-f95f89118e18&quot;,&quot;9ef3be5a-10c2-470c-b449-6f51edca99b5&quot;,&quot;5d250281-fbdc-4e26-866e-ba759074f32d&quot;,&quot;7743e849-9d5e-4bd8-a543-8db3bb617b14&quot;,&quot;19bbe403-efc4-4f84-ad6c-d87330a7713f&quot;,&quot;d4deda0e-b35c-4886-9164-62fc664412df&quot;,&quot;b8ee9c75-28dd-4458-9dcd-281f45eea5fa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:225,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f7a928f7-9a9f-4590-8810-613fbf1c4e59&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getGraphDataOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getGraphDataOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4e5d79e4-da36-40f7-936f-a4fd488a7d14&quot;,&quot;title&quot;:&quot;Metrics.getGraphDataOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getGraphDataOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getGraphDataOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1628,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.organizationRecordsEntry({}, function(data) {\n                    authToken = data.owner.authtoken;\n                    org_uid = data.organization.uid;\n                    org_account_uid = data.organization_account.uid;\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(&#x27;org_uid&#x27;, org_uid)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            env_uid = res.body.output.env_uid;\n                            cbk(null, data);\n                        });\n                });\n            });\n        },\n        function(res, cbk) {\n            api.get(\&quot;/enterprise/v1/user\&quot;)\n                .set(&#x27;org_uid&#x27;, org_uid)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    env_uid = res.body.output.env_uid;\n                    cbk(err, res);\n                });\n        },\n        function(res, cbk) {\n            saveBillEntries({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserTriggers({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserFlows({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, userFlows) {\n                    cbk(null, userFlows);\n                });\n        }\n    ], function(err, results) {\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c56273d-2d90-4bdd-854f-cebd1341b1d7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3793ee31-8af3-4704-b303-997cc24139a5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acc2470d-b533-4ad8-bea8-c2346b61d978&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get type bill data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type bill data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill\&quot;;\napi.get(billURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c6dd7cc-8711-4306-8b0f-95f02bd44c81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type bill data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=daily\&quot;;\napi.get(billURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;34ba1c4e-537b-4645-b948-4cc21a28fed4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type bill data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=monthly\&quot;;\napi.get(billURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7628357-94c4-4d0a-8b07-51fad7ecd3a9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type bill data based on yearly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type bill data based on yearly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar billURL = apiURL + \&quot;?type=bill&amp;filter=weekly\&quot;;\napi.get(billURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d786f82-0031-4ae6-b309-72c028e3d3dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type trigger data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger\&quot;;\napi.get(triggerURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23f769bc-add6-4783-92f4-d1176ee46d5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type trigger data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=daily\&quot;;\napi.get(triggerURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b16e4c6-655c-4298-b917-f5bcd04474eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type trigger data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=monthly\&quot;;\napi.get(triggerURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b15e3df-dbe1-4bbb-806a-0e2f2a6e08e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type trigger data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type trigger data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerURL = apiURL + \&quot;?type=trigger&amp;filter=weekly\&quot;;\napi.get(triggerURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] == 10;\n            (res.body.output[1][0] == 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b5d2f05d-03af-4a4e-8869-2f131c381962&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type flowscreated data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated\&quot;;\napi.get(flowURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0834190f-9f75-4f96-8a96-e2ca5bf28da3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type flowscreated data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=daily\&quot;;\napi.get(flowURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eb77f23b-4567-449f-bd41-8c40858109b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type flowscreated data based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=monthly\&quot;;\napi.get(flowURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentMonthFormat &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ceb4e834-e2aa-4166-93d9-830a0e9c8fcc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type flowscreated data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type flowscreated data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar flowURL = apiURL + \&quot;?type=flowscreated&amp;filter=weekly\&quot;;\napi.get(flowURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentWeekFormat &amp;&amp;\n            //    res.body.output[1][0] &gt;= 10;\n            (res.body.output[1][0] &gt;= 10).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0d0db0df-ab7f-472c-b5a5-cb2715f6f34c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type credits data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits\&quot;;\napi.get(creditURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate;\n            (res.body.output[0][0]).should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8aded1a1-cd50-43e9-8577-9b3e5255f158&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data based on daily filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type credits data based on daily filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=daily\&quot;;\napi.get(creditURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //var isValid = res.body.output[0][0] == currentDate;\n            (res.body.output[0][0]).should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5d6156d-68c9-4ac3-8535-8b3451e9f543&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits based on monthly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type credits based on monthly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=monthly\&quot;;\napi.get(creditURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output[0][0] == currentMonthFormat;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f6344b7-f593-4b0f-9f46-ee923fd317f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get type credits data based on weekly filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should get type credits data based on weekly filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar creditURL = apiURL + \&quot;?type=credits&amp;filter=weekly\&quot;;\napi.get(creditURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output[0][0].indexOf(\&quot;week\&quot;) == 0;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;885a7be8-cef1-416d-bfb8-e6aa35cac9e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid type error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should give invalid type error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar fakeURL = apiURL + \&quot;?type=FAKE\&quot;;\napi.get(fakeURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.GRAPH_TYPE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36e6dda8-c007-45d9-bf63-71726086919c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getGraphDataOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37e814d2-d2de-4a5e-b178-c876fc8c4928&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0c6dd7cc-8711-4306-8b0f-95f02bd44c81&quot;,&quot;34ba1c4e-537b-4645-b948-4cc21a28fed4&quot;,&quot;a7628357-94c4-4d0a-8b07-51fad7ecd3a9&quot;,&quot;6d786f82-0031-4ae6-b309-72c028e3d3dd&quot;,&quot;23f769bc-add6-4783-92f4-d1176ee46d5d&quot;,&quot;6b16e4c6-655c-4298-b917-f5bcd04474eb&quot;,&quot;3b15e3df-dbe1-4bbb-806a-0e2f2a6e08e3&quot;,&quot;b5d2f05d-03af-4a4e-8869-2f131c381962&quot;,&quot;0834190f-9f75-4f96-8a96-e2ca5bf28da3&quot;,&quot;eb77f23b-4567-449f-bd41-8c40858109b1&quot;,&quot;ceb4e834-e2aa-4166-93d9-830a0e9c8fcc&quot;,&quot;0d0db0df-ab7f-472c-b5a5-cb2715f6f34c&quot;,&quot;8aded1a1-cd50-43e9-8577-9b3e5255f158&quot;,&quot;a5d6156d-68c9-4ac3-8535-8b3451e9f543&quot;,&quot;3f6344b7-f593-4b0f-9f46-ee923fd317f8&quot;,&quot;885a7be8-cef1-416d-bfb8-e6aa35cac9e4&quot;,&quot;36e6dda8-c007-45d9-bf63-71726086919c&quot;,&quot;37e814d2-d2de-4a5e-b178-c876fc8c4928&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:281,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;58b08605-d217-46b6-9845-d632bde4d0eb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getTransactionMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getTransactionMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;261b307c-c585-4348-94fb-318c334ee0c0&quot;,&quot;title&quot;:&quot;Metrics.getTransactionMetrics&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getTransactionMetrics.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getTransactionMetrics.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetrics \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:227,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.createFlowUser({\n                plan: \&quot;light_transaction\&quot;\n            }, function(error, user) {\n                if (error) {\n                    done(error);\n                } else {\n                    cbk(null, user);\n                }\n            });\n        },\n        function(user, cbk) {\n            dummyUser = user;\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: dummyUser.authToken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9ad36a8e-5f74-4d63-b16f-a94d2bacdcac&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetrics \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e100507d-ad69-43cd-868b-aad9d64189e0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetrics Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d993cfa-170b-45bb-bce6-bed387f70c02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of transactions metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetrics Should get list of transactions metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flag = Array.isArray(res.body.output);\n            var item = (_.first(res.body.output) || {});\n            (typeof(item[&#x27;total_transactions&#x27;]) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(item[&#x27;date&#x27;]) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf293d56-5c00-4e01-aa6d-9b22ddaa9a1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of transactions metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetrics Should get list of transactions metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flag = Array.isArray(res.body.output);\n            var item = (_.first(res.body.output) || {});\n            (typeof(item[&#x27;total_transactions&#x27;]) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(item[&#x27;date&#x27;]) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29fde999-41fe-4e98-89e5-8b4f88401f4a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3d993cfa-170b-45bb-bce6-bed387f70c02&quot;,&quot;cf293d56-5c00-4e01-aa6d-9b22ddaa9a1d&quot;,&quot;29fde999-41fe-4e98-89e5-8b4f88401f4a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a364c846-2809-47bd-94da-ad7db333b4e5&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getTransactionMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getTransactionMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;12a929ab-6562-48eb-8c50-a1aa1ce3c6d2&quot;,&quot;title&quot;:&quot;Metrics.getTransactionMetricsOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\metrics\\getTransactionMetricsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\metrics\\getTransactionMetricsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetricsOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:291,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    async.waterfall([\n        function(cbk) {\n            testCollection.organizationRemoveRecords({}, function() {\n                testCollection.organizationRecordsEntry({}, function(data) {\n                    authToken = data.owner.authtoken;\n                    org_uid = data.organization.uid;\n                    cbk(null, data);\n                });\n            });\n        },\n        function(res, cbk) {\n            saveBillEntries(\n                _.extend(getImmutable(billBody), {\n                    authtoken: authToken\n                }),\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        }\n    ], function(err, results) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ddb9ad85-d80e-4c2a-865c-1746dbe11343&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetricsOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2173579-063a-4e2c-a0cc-13730ae9b108&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetricsOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4836dacd-4dfc-4377-9990-0860c915fcff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of transactions metrics last month from current date if date not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetricsOrg Should get list of transactions metrics last month from current date if date not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_transactions&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7b8eb3e-d612-48b9-8e9f-dbeef50b75f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of transactions metrics if particular date is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Metrics.getTransactionMetricsOrg Should get list of transactions metrics if particular date is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nupdated_at = (new Date()).toISOString();\napi.post(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({ startDate: created_at, endDate: updated_at })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.instanceof(Array);\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;total_transactions&#x27;, &#x27;date&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;93a4e604-15cb-4fb0-9f73-b943d3c45f68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4836dacd-4dfc-4377-9990-0860c915fcff&quot;,&quot;e7b8eb3e-d612-48b9-8e9f-dbeef50b75f5&quot;,&quot;93a4e604-15cb-4fb0-9f73-b943d3c45f68&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:36,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6a41d054-160f-4cb2-a409-5d9a0e5f586d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4b4b5a43-0a73-417e-bbca-006908e2511f&quot;,&quot;title&quot;:&quot;Oauth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7465e7d8-7905-42fb-a5cd-2b1b3ceffb47&quot;,&quot;title&quot;:&quot;oauth.getList&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\oauth\\getList.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Oauth oauth.getList \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2670,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    _userUID = res.body.output.uid;\n                    apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                    saveOAuth({\n                        authToken: authToken,\n                        userUid: _userUID\n                    }, function() {\n                        done();\n                    });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;28c620ab-4d2d-497b-bb75-553e9ca8d2db&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Oauth oauth.getList \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e5efc2bb-897b-4a0d-a4e0-92a49f4817ec&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Oauth oauth.getList \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d55569e-65f9-4838-9e99-f49a07f7c57e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Oauth oauth.getList Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13f6ddff-be04-44dd-9fd0-b38a14e15cad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;13f6ddff-be04-44dd-9fd0-b38a14e15cad&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;88fa5d70-e448-42d4-a8dc-0bee20c4908c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;672f238a-2fb2-4687-9089-d194ca880f79&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;de7574c5-8aa7-42de-818b-853b9a72b5e4&quot;,&quot;title&quot;:&quot;Organization.changePlan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\changePlan.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1aef3eaf-e19f-4326-bbc9-fb9637dbc30e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2627d56f-bb72-4a58-9f69-5b56a5c6956a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4873cf0-b78a-4eca-81d2-6d3866cecb90&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should allowed to change organization plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should allowed to change organization plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_standard_paid\&quot;;\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(org_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d42f0a0-b3a0-42a5-a994-7503709dbc0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to change organization plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should not allowed to change organization plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_standard_paid\&quot;;\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81d4265a-b312-4de0-a302-757854d202f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to change organization plan to another paid plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should allowed to change organization plan to another paid plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_standard_paid\&quot;;\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(org_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a14a78e-4095-4e38-b2e1-a20bd8ba19f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate organization change plan body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should validate organization change plan body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.plan.message == messageList.ORG_PLAN_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.ORG_NONCE_REQUIRED &amp;&amp;\n                res.body.error.billing_address1.message == messageList.ORG_BILLING_ADDR_REQUIRED &amp;&amp;\n                res.body.error.cardholderName.message == messageList.ORG_CARDHOLDER_NAME_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5af81b8-ae4d-4ac1-a7c2-7c7edd64ea3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to change organization plan by owner.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should allowed to change organization plan by owner.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_annual_standard\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(org_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91d16ca5-5ec5-428b-97f4-7259cebc7d2b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to change organization plan by admin role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should allowed to change organization plan by admin role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_annual_standard\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(org_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64be32f7-edab-48c0-ae43-955a62c4d864&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to change organization plan by Billing Manager role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should allowed to change organization plan by Billing Manager role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_annual_standard\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(org_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f3de589-f36e-4e11-8aad-9c796b44ce8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to change organization plan by other role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should not allowed to change organization plan by other role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_annual_standard\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NO_ACCESS_TO_CHANGE_PLAN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8bc3f77a-52c7-4e5e-8504-b40db313d247&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.changePlan Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_annual_standard\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(tempOrgBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a7d7c82-f001-4b6a-93be-25820dd51022&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6d42f0a0-b3a0-42a5-a994-7503709dbc0c&quot;,&quot;81d4265a-b312-4de0-a302-757854d202f3&quot;,&quot;0a14a78e-4095-4e38-b2e1-a20bd8ba19f8&quot;,&quot;f5af81b8-ae4d-4ac1-a7c2-7c7edd64ea3f&quot;,&quot;91d16ca5-5ec5-428b-97f4-7259cebc7d2b&quot;,&quot;64be32f7-edab-48c0-ae43-955a62c4d864&quot;,&quot;7f3de589-f36e-4e11-8aad-9c796b44ce8d&quot;,&quot;8bc3f77a-52c7-4e5e-8504-b40db313d247&quot;,&quot;3a7d7c82-f001-4b6a-93be-25820dd51022&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:239,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;fb8ec5a5-6d55-467b-a2d4-611968b758a2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8d278f13-d5d3-4607-ace2-d164ef496a4d&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d2f51068-e5b9-49b3-955a-2eed83b49800&quot;,&quot;title&quot;:&quot;Organization.checkOrgName&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\checkOrgName.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7e8e5b7-9e62-48aa-8b5a-90603f01260e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d7fd2274-fae5-45b6-a976-3c71248b9a4f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31a316e2-781c-4eec-9dda-2c143040c8fc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should check org name is available or not.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should check org name is available or not.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;org_uid&#x27;: org_uid\n};\napi.post(apiURL)\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.allowed.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81dcea92-a574-4062-b3e7-6764a1141423&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should check org name is available or not without passing org_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should check org name is available or not without passing org_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;\n};\napi.post(apiURL)\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.allowed.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a4873f2-b47f-4609-96e7-4e280e9ccb64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate organization details body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should validate organization details body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.name.message == messageList.ORG_NAME_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a039ad87-8720-495f-aa16-e9369345c4d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update same name in organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should update same name in organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org1&#x27;,\n    &#x27;org_uid&#x27;: org_uid\n};\napi.post(apiURL)\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.allowed.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;668c7d41-299d-4693-a436-f6cf5cd72e45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give false for duplicate name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should give false for duplicate name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org2&#x27;,\n    &#x27;org_uid&#x27;: org_uid\n};\napi.post(apiURL)\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.allowed.should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f7412952-4654-48c5-97e7-bf592b0b71f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give false for same name if org_uid not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should give false for same name if org_uid not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org1&#x27;\n};\napi.post(apiURL)\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.allowed.should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ac2d420-2686-4798-a577-552a447b703e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.checkOrgName Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;org_uid&#x27;: org_uid\n};\napi.post(apiURL)\n    .send(body)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;63933382-26ec-4bc8-ade7-661fff44ea65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;81dcea92-a574-4062-b3e7-6764a1141423&quot;,&quot;5a4873f2-b47f-4609-96e7-4e280e9ccb64&quot;,&quot;a039ad87-8720-495f-aa16-e9369345c4d4&quot;,&quot;668c7d41-299d-4693-a436-f6cf5cd72e45&quot;,&quot;f7412952-4654-48c5-97e7-bf592b0b71f4&quot;,&quot;5ac2d420-2686-4798-a577-552a447b703e&quot;,&quot;63933382-26ec-4bc8-ade7-661fff44ea65&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:62,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e7b40887-c5ec-466d-bd79-fc7f441e4a28&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b0e93bb4-fc21-4b51-9eb6-46c15ad1917d&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e22d9bd9-83ef-4770-8ed2-80c84f479e1f&quot;,&quot;title&quot;:&quot;Organization.create&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2140,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nclearRecords(function() {\n    createOrgPlans(function() {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1691bed8-fd45-4803-be22-f16717374e39&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;clearRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2bfe3e40-744c-49a5-a2af-13d26d2c3307&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86243674-1d6a-41b0-8441-985e69e84c01&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should create organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2162,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: res.body.output.org_account.uid\n            }).lean().exec(function(err, user) {\n                if (user) {\n                    var org_uid = res.body.output.uid;\n                    api.get(\&quot;/enterprise/v1/organizations/\&quot; + org_uid)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            res.body.output.uid.should.equal(org_uid);\n                            done();\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06924387-e68a-435d-8e56-4bacb2ee6a39&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create organization with trial plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should create organization with trial plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2948,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_trial\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: res.body.output.org_account.uid\n            }).lean().exec(function(err, user) {\n                if (user) {\n                    var org_uid = res.body.output.uid;\n                    api.get(\&quot;/enterprise/v1/organizations/\&quot; + org_uid)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            (res.body.output.org_account.subscription.days == 30 &amp;&amp; typeof(res.body.output.org_account.subscription.start_date) != \&quot;undefined\&quot;).should.equal(true);\n                            done();\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;376e008b-9590-45b9-a036-b25f31d519c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create multiple organization with trial plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should create multiple organization with trial plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9678,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar createOrg = function(name, callback) {\n    var tempOrgBody = getImmutable(orgBody);\n    tempOrgBody.plan = \&quot;org_trial\&quot;;\n    tempOrgBody.name = name;\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(apiURL)\n        .send(tempOrgBody)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                _models.User.findOne({\n                    uid: res.body.output.org_account.uid\n                }).lean().exec(function(err, user) {\n                    if (user) {\n                        var org_uid = res.body.output.uid;\n                        api.get(\&quot;/enterprise/v1/organizations/\&quot; + org_uid)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                callback(err, res);\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                });\n            }\n        });\n};\ncreateOrg(\&quot;org1\&quot;, function(err, res) {\n    if (res.body.output.org_account.subscription.days == 30 &amp;&amp;\n        typeof(res.body.output.org_account.subscription.start_date) != \&quot;undefined\&quot;) {\n        createOrg(\&quot;org2\&quot;, function(err, res) {\n            if (res.body.output.org_account.subscription.days == 30 &amp;&amp;\n                typeof(res.body.output.org_account.subscription.start_date) != \&quot;undefined\&quot;) {\n                createOrg(\&quot;org3\&quot;, function(err, res) {\n                    if (res.body.output.org_account.subscription.days == 30 &amp;&amp;\n                        typeof(res.body.output.org_account.subscription.start_date) != \&quot;undefined\&quot;) {\n                        true.should.equal(true);\n                    } else {\n                        true.should.equal(false);\n                    }\n                    done();\n                })\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        })\n    } else {\n        true.should.equal(false);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33bd7b55-9396-400c-af55-845d7ca4aadb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not create duplicate entries.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should not create duplicate entries.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5518,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email\n});\nvar tempLoginBody = global.getImmutable(loginBody);\ntempLoginBody.email = tempRegistrationBody.email;\nvar newSignupUid = \&quot;\&quot;,\n    newUserAuthtoken = \&quot;\&quot;;\nvar doLogin = function(callback) {\n    commonMock.setSignUpMocks(httpmock, \&quot;express\&quot;);\n    commonMock.flowLogin(httpmock, \&quot;express\&quot;);\n    api.post(\&quot;/express/v1/login\&quot;)\n        .send(tempLoginBody)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/login\&quot;)\n                    .send(tempLoginBody)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            callback();\n                        }\n                    });\n            }\n        });\n};\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            newSignupUid = res.body.output.uid;\n            _models.User.findOneAndUpdate({\n                uid: newSignupUid\n            }, {\n                active: true\n            }, { new: true }, function(error, user) {\n                var tempLoginBody = global.getImmutable(loginBody);\n                tempLoginBody.email = tempRegistrationBody.email;\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/login\&quot;)\n                    .send(tempLoginBody)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            newUserAuthtoken = res.body.output.authtoken;\n                            doLogin(function() {\n                                doLogin(function() {\n                                    doLogin(function() {\n                                        doLogin(function() {\n                                            _models.User.find({\n                                                email: tempRegistrationBody.email\n                                            }, function(error, users) {\n                                                users.length.should.equal(2);\n                                                done();\n                                            });\n                                        });\n                                    });\n                                });\n                            });\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fbcfcf17-254b-4945-afd2-c41d7798806a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Default role should not be null.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Default role should not be null.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2344,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.default_project) {\n                _models.User.findOne({\n                    uid: res.body.output.org_account.uid\n                }).lean().exec(function(err, user) {\n                    if (user) {\n                        api.get(\&quot;/enterprise/v1/organizations/\&quot; + res.body.output.uid)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                true.should.equal(true);\n                                done();\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;155ee902-4f50-4eff-888d-db196e64dad2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user record for owner.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should get user record for owner.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send({\n                    email: \&quot;test.user@raweng.com\&quot;,\n                    password: \&quot;Raw@1234\&quot;\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _models.User.findOne({\n                            uid: res.body.output.uid\n                        }).lean().exec(function(err, user) {\n                            (res.body.output.uid != \&quot;\&quot;).should.equal(true);\n                            done();\n                        });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4128360a-61cf-46d8-8cdd-9f7a95fc6fe5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate organization body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should validate organization body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.name.message == messageList.ORG_NAME_REQUIRED &amp;&amp;\n                res.body.error.plan.message == messageList.ORG_PLAN_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.ORG_NONCE_REQUIRED &amp;&amp;\n                res.body.error.billing_address1.message == messageList.ORG_BILLING_ADDR_REQUIRED &amp;&amp;\n                res.body.error.cardholderName.message == messageList.ORG_CARDHOLDER_NAME_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e4a085d-9690-4ba2-b007-1bb0b7a983d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create organization for paid plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should create organization for paid plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2453,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.plan = \&quot;org_standard_paid\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var company = res.body.output.org_account.company || \&quot;\&quot;;\n            if (company == tempOrgBody.company) {\n                _models.User.findOne({\n                    uid: res.body.output.org_account.uid\n                }).lean().exec(function(err, user) {\n                    (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                        user.plan[0].toString() == paidPlan._id.toString()).should.equal(true);\n                    done();\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;71d62cb5-9d61-40a8-9fb6-ad0505c210dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.create Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempOrgBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81523e65-6860-4a68-a739-3292dcb38c89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;06924387-e68a-435d-8e56-4bacb2ee6a39&quot;,&quot;376e008b-9590-45b9-a036-b25f31d519c3&quot;,&quot;33bd7b55-9396-400c-af55-845d7ca4aadb&quot;,&quot;fbcfcf17-254b-4945-afd2-c41d7798806a&quot;,&quot;155ee902-4f50-4eff-888d-db196e64dad2&quot;,&quot;4128360a-61cf-46d8-8cdd-9f7a95fc6fe5&quot;,&quot;6e4a085d-9690-4ba2-b007-1bb0b7a983d8&quot;,&quot;71d62cb5-9d61-40a8-9fb6-ad0505c210dc&quot;,&quot;81523e65-6860-4a68-a739-3292dcb38c89&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27283,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ce562b23-7d98-4e6c-89bd-89ce6e625342&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;92a852ad-c43e-4021-be66-741eefe2b3f3&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;729c2563-3788-4cb9-9b50-5a8068b20971&quot;,&quot;title&quot;:&quot;Organization.disableSSO&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\disableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;675f6228-3e22-4823-b78b-4d401e3859a2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1794ba1-a91e-4701-901b-d901d6e9d693&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0c84370-599e-4383-9f34-230e6898eb17&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should enable SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO Should enable SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.public_cert == config.public_cert &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .send({})\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.enable_sso.should.equal(false);\n                            done();\n                        }\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3fc20d86-16de-4f09-975f-581b7cf4aefe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should enable SSO by admin user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO Should enable SSO by admin user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.public_cert == config.public_cert &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .send({})\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.enable_sso.should.equal(false);\n                            done();\n                        }\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d930a09d-7940-4ec6-a030-69ce8c4314e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not enable SSO by developer user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO Should not enable SSO by developer user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.public_cert == config.public_cert &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .send({})\n                    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n                            done();\n                        }\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;59e3f21b-a81d-4f69-a46d-e5d01a2b203d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid config error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO Should give invalid config error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_SSO_CONFIG_INVALID);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e8d5bdf-6c19-43b1-828a-cfa35be84920&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.disableSSO Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a5a5671-72f3-4b41-9216-ee821884eb7b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3fc20d86-16de-4f09-975f-581b7cf4aefe&quot;,&quot;d930a09d-7940-4ec6-a030-69ce8c4314e6&quot;,&quot;59e3f21b-a81d-4f69-a46d-e5d01a2b203d&quot;,&quot;3e8d5bdf-6c19-43b1-828a-cfa35be84920&quot;,&quot;1a5a5671-72f3-4b41-9216-ee821884eb7b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:96,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ce4444a8-e471-4e7b-9f5d-306a3a2ff416&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8f3aeab8-527f-4a8e-93c0-6fb2beb75ac1&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;15a2836b-699c-4fcc-9a47-3fed3d9a8a64&quot;,&quot;title&quot;:&quot;Organization.enableSSO&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\enableSSO.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f8abcee8-375c-4c04-af0c-1948b9e33109&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bf2c7a75-0b85-46a5-b635-878c8aa301d4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23d313e7-7386-4b9f-abe3-cbac538fca29&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should enable SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO Should enable SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({})\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.enable_sso.should.equal(true);\n                                    done();\n                                }\n                            });\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95c03e3a-4476-41a2-9351-ce8e4bc36bd9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should enable SSO by admin user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO Should enable SSO by admin user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({})\n                            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.enable_sso.should.equal(true);\n                                    done();\n                                }\n                            });\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5b4a45f6-1aef-4fc8-910d-e03d8072f15a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not enable SSO by developer user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO Should not enable SSO by developer user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:118,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.public_cert == config.public_cert &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({})\n                            .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n                                    done();\n                                }\n                            });\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11d0e74b-acff-4bd8-9212-698f0d525cb4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid config error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO Should give invalid config error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_SSO_CONFIG_INVALID);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d7730b27-97c6-4527-ba5c-65af5c47af37&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.enableSSO Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4fcfdda4-4887-4f15-b697-4aa6eba87f4a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;95c03e3a-4476-41a2-9351-ce8e4bc36bd9&quot;,&quot;5b4a45f6-1aef-4fc8-910d-e03d8072f15a&quot;,&quot;11d0e74b-acff-4bd8-9212-698f0d525cb4&quot;,&quot;d7730b27-97c6-4527-ba5c-65af5c47af37&quot;,&quot;4fcfdda4-4887-4f15-b697-4aa6eba87f4a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:300,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d7a83c66-6a7c-4504-a833-f222e05fee58&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;21b63cfe-4047-437e-b005-c689919574f7&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7694d045-74da-484c-afb9-a3e4dee733bd&quot;,&quot;title&quot;:&quot;Organization.getCerts&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d1d0f12-11fb-405f-8a2f-6071e3edcf33&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75fdbdde-574e-40b0-a9f9-78626aa993cf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3d94d90-fdf2-4b84-bb0d-7d1ed0cbf706&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get public SSO cert.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts Should get public SSO cert.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid) + \&quot;?authtoken=\&quot; + authToken)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            if (isValid) {\n                api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;) + \&quot;?authtoken=\&quot; + authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49c54663-2899-4fea-9d08-e0ad418192e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get private SSO cert.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts Should get private SSO cert.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            if (isValid) {\n                api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;private\&quot;) + \&quot;?authtoken=\&quot; + authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51bf5ad6-1bbf-4049-9551-74836da66708&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get SSO certs by Developer.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts Should not get SSO certs by Developer.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;))\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd118952-1bb7-4b9d-8af0-18ede2e58c18&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives invalid file type errors for both files.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts Should gives invalid file type errors for both files.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public1\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.message == messageList.ORG_INVALID_CERT_TYPE;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c0d30ef-af8c-4389-ba5d-8d4c95715023&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getCerts Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54280709-cea0-447c-8ff6-fbe05e9eadc2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;49c54663-2899-4fea-9d08-e0ad418192e0&quot;,&quot;51bf5ad6-1bbf-4049-9551-74836da66708&quot;,&quot;cd118952-1bb7-4b9d-8af0-18ede2e58c18&quot;,&quot;7c0d30ef-af8c-4389-ba5d-8d4c95715023&quot;,&quot;54280709-cea0-447c-8ff6-fbe05e9eadc2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:116,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;809c7989-64e4-49d1-b9c8-b4ceaccbcf93&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e39bcebc-3810-4a55-bb64-aeb1057f2922&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7c681852-3274-4f24-ab3b-df622798fdf9&quot;,&quot;title&quot;:&quot;Organization.getDetails&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        org_user_uid = data.organization.user_uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a35de462-668a-4005-aae3-0ad755bfd415&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8adb1b8-391c-46de-9456-9da9410fd57b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ce641dc-d50e-431b-895d-c166b54a2c77&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails Should get organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.uid) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.name) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.avatar) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.enable_sso) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.org_account) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.default_env) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.default_project) != \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3467b4dc-b722-47dc-8935-edb11b6b0f48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails Should not get organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ uid: org_user_uid }, function() {\n    api.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.NOT_FOUND)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_USER_NOT_FOUND);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;771eef05-6988-4e7c-bc7c-185df2935b3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a6148a9-d597-49e0-81d3-970836406a7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getDetails Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d595624-5a37-4fae-b94b-d4d35c027bbb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3467b4dc-b722-47dc-8935-edb11b6b0f48&quot;,&quot;771eef05-6988-4e7c-bc7c-185df2935b3f&quot;,&quot;9a6148a9-d597-49e0-81d3-970836406a7f&quot;,&quot;1d595624-5a37-4fae-b94b-d4d35c027bbb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;303fae5c-19d7-40d4-bee6-13ca8d6b01f8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a16e37c8-c053-44c4-9922-5e8f79cb14a7&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;09e93e4f-bdb0-40cf-9f37-b257fc1f9552&quot;,&quot;title&quot;:&quot;Organization.getOrgMetadata&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getOrgMetadata \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        org_name = data.organization.name;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b22449d-f6e0-4164-ac42-4490d4bea7cd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getOrgMetadata \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc43bf09-896f-405c-b4b8-e78adc1999b1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getOrgMetadata \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e9c7dc0-6418-47de-b217-b5cad3036b5c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get org metadata.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.getOrgMetadata Should get org metadata.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({})\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    api.get(apiURL.replace(\&quot;:org_name\&quot;, org_name))\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (res.text.indexOf(&#x27;&lt;?xml version=\&quot;1.0\&quot;?&gt;&#x27;) == 0).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef92af7d-d1a9-4e15-97f1-15347548543e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ef92af7d-d1a9-4e15-97f1-15347548543e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:84,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;36f61277-100b-49e2-aba6-bb4c74c00860&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3367f219-d7b8-4571-babf-d6e5e8ec6378&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;24e726b0-4ecf-42ba-92ce-ec027dcd019a&quot;,&quot;title&quot;:&quot;OrganizationUser.getOrgSSOInfo&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\getOrgSSOInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.getOrgSSOInfo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b2864b9-ddef-47df-a7b9-d6be03de4cc7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.getOrgSSOInfo \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;af398f02-d195-4390-906d-6f17462fb9a9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should redirect user to SSO login page.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.getOrgSSOInfo Should redirect user to SSO login page.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var url = \&quot;https://dev-528399.oktapreview.com/app/builtiodev528399_oktasp1_1/exkbbi8vwj2OsHjbE0h7/sso/saml?SAMLRequest=\&quot;;\n                                    (res.headers.location.indexOf(ssoConfig.entry_point) == 0).should.equal(true);\n                                    done();\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a8e72af-26ba-4d18-9d29-b42b0e91f1db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3a8e72af-26ba-4d18-9d29-b42b0e91f1db&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:84,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0757d7f5-8afb-48bb-a8b9-43782b6ba58d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b93a3097-905e-4571-aa89-ff29e269c5a2&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2e50a283-7242-470b-9fd4-2d6f5fc1e066&quot;,&quot;title&quot;:&quot;Organization.invitationAccept&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationAccept.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f8e097fa-5397-4db5-a0e9-3fb4fee456b3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98c74ea2-164a-4909-90c1-9c85125d09d4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9979703-29e1-4885-a3ee-d5d299f4e796&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should accept invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept Should accept invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3179,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    var newUserAuthtoken = res.body.output.authtoken;\n                    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                        .send({})\n                        .set(&#x27;authtoken&#x27;, newUserAuthtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_ACCEPTED) {\n                                api.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                    .set(&#x27;authtoken&#x27;, newUserAuthtoken)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        res.body.output.org_account.email.should.equal(email);\n                                        done();\n                                    });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;629ab7fd-93ed-4b1f-977b-b8feff57efd1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invitation not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept Should give error as invitation not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2766,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    var userAuthtoken = res.body.output.authtoken;\n                    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                        .send({})\n                        .set(&#x27;authtoken&#x27;, userAuthtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_ACCEPTED) {\n                                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                    .send({})\n                                    .set(&#x27;authtoken&#x27;, userAuthtoken)\n                                    .expect(httpStatus.BAD_REQUEST)\n                                    .end(function(err, res) {\n                                        res.body.error.message.should.equal(messageList.ORG_OWNERSHIP_INVITATION_NOT_FOUND);\n                                        done();\n                                    });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9c8616db-7aa0-4d53-a274-749f8e73d276&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should accept invitation by new SSO user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept Should accept invitation by new SSO user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8165,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;amber.more@raweng.com\&quot;;\nvar _ssoConfig = getImmutable(ssoConfig);\nvar firstOwnerAuthtoken = _.first(_data.owner.authtoken);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({\n                                \&quot;email\&quot;: email\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                                        api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                            .expect(httpStatus.MOVED_TEMPORARILY)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                                        var data = usersData.SMALRespWithoutAuthtoken;\n                                                        api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                                                            .send(data)\n                                                            .expect(httpStatus.MOVED_TEMPORARILY)\n                                                            .end(function(err, res) {\n                                                                if (err) {\n                                                                    done(err);\n                                                                } else {\n                                                                    var qs = querystring.parse(res.headers.location);\n                                                                    var newUserAuthToken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                                    api.get(\&quot;/enterprise/v1/organizations/\&quot; + _data.organization.uid)\n                                                                        .set(&#x27;authtoken&#x27;, newUserAuthToken)\n                                                                        .expect(httpStatus.OK)\n                                                                        .end(function(err, res) {\n                                                                            if (err) {\n                                                                                done(err);\n                                                                            } else {\n                                                                                var isValid = typeof(res.body.output.owner_invitation) != \&quot;undefined\&quot;;\n                                                                                if (isValid) {\n                                                                                    _.each(res.body.output.organizations, function(orgItem) {\n                                                                                        isValid = isValid &amp;&amp;\n                                                                                            typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                            typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                            typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                            typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                            typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                                    });\n                                                                                    if (isValid) {\n                                                                                        api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                                                                            .send({})\n                                                                                            .set(&#x27;authtoken&#x27;, newUserAuthToken)\n                                                                                            .expect(httpStatus.OK)\n                                                                                            .end(function(err, res) {\n                                                                                                if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_ACCEPTED) {\n                                                                                                    api.get(\&quot;/enterprise/v1/organizations/\&quot; + _data.organization.uid)\n                                                                                                        .set(&#x27;authtoken&#x27;, newUserAuthToken)\n                                                                                                        .expect(httpStatus.OK)\n                                                                                                        .end(function(err, res) {\n                                                                                                            if (err) {\n                                                                                                                done(err);\n                                                                                                            } else {\n                                                                                                                if (typeof(res.body.output.owner_invitation) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                                                    res.body.output.is_owner &amp;&amp; res.body.output.is_admin &amp;&amp;\n                                                                                                                    res.body.output.is_developer) {\n                                                                                                                    true.should.equal(true);\n                                                                                                                    done();\n                                                                                                                } else {\n                                                                                                                    false.should.equal(true);\n                                                                                                                    done();\n                                                                                                                }\n                                                                                                            }\n                                                                                                        });\n                                                                                                } else {\n                                                                                                    false.should.equal(true);\n                                                                                                    done();\n                                                                                                }\n                                                                                            });\n                                                                                    } else {\n                                                                                        false.should.equal(true);\n                                                                                        done();\n                                                                                    }\n                                                                                } else {\n                                                                                    false.should.equal(true);\n                                                                                    done();\n                                                                                }\n                                                                            }\n                                                                        });\n                                                                }\n                                                            });\n                                                    } else {\n                                                        true.should.equal(false);\n                                                        done();\n                                                    }\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                        done();\n                                    }\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91496a43-7bfd-42e0-abe8-6abe67165649&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as organization not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept Should give error as organization not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fff6ae1b-2691-4841-80cf-bc080d584501&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationAccept Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;85eea41e-8d38-4e7a-bbc9-095d3a67d8e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;629ab7fd-93ed-4b1f-977b-b8feff57efd1&quot;,&quot;9c8616db-7aa0-4d53-a274-749f8e73d276&quot;,&quot;91496a43-7bfd-42e0-abe8-6abe67165649&quot;,&quot;fff6ae1b-2691-4841-80cf-bc080d584501&quot;,&quot;85eea41e-8d38-4e7a-bbc9-095d3a67d8e4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14122,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;08ac1cbc-9fc0-4566-a7b3-d760308d4116&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;53956b25-c4b8-43cb-8730-b3b62dce7c8e&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f7c17926-8e78-4960-8e8e-8d9ada7a9b39&quot;,&quot;title&quot;:&quot;Organization.invitationReject&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invitationReject.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb658d23-5c83-4894-a3ff-3d6adc730cfa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f04ac711-6d72-440a-870a-a386151067d3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a83a36c-b340-4dfb-8917-fa3ae2d488b8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should accept invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject Should accept invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3598,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                        .send({})\n                        .set(&#x27;authtoken&#x27;, res.body.output.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            res.body.output.message.should.equal(messageList.ORG_OWNERSHIP_INVITATION_REJECTED);\n                            done();\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9296b25-2977-4c8a-999a-f66a2ee97e29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invitation not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject Should give error as invitation not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2346,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    var userAuthtoken = res.body.output.authtoken;\n                    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                        .send({})\n                        .set(&#x27;authtoken&#x27;, userAuthtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_REJECTED) {\n                                api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                    .send({})\n                                    .set(&#x27;authtoken&#x27;, userAuthtoken)\n                                    .expect(httpStatus.BAD_REQUEST)\n                                    .end(function(err, res) {\n                                        res.body.error.message.should.equal(messageList.ORG_OWNERSHIP_INVITATION_NOT_FOUND);\n                                        done();\n                                    });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6877430-0210-4db5-8fb1-a5c0944c2019&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as organization not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject Should give error as organization not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/transfer\&quot;.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13f393a7-bc6b-40ff-bfbe-83d2eab6c36f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invitationReject Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ece1526-a68a-4514-a2fe-d410c9a733bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c9296b25-2977-4c8a-999a-f66a2ee97e29&quot;,&quot;f6877430-0210-4db5-8fb1-a5c0944c2019&quot;,&quot;13f393a7-bc6b-40ff-bfbe-83d2eab6c36f&quot;,&quot;8ece1526-a68a-4514-a2fe-d410c9a733bb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5957,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;43ea4acf-6de1-4c44-b540-543492131e69&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0de41a6f-5ad1-46ed-9f60-3f93e21189ee&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;581b9717-59f4-406c-a8d8-686b581b43cd&quot;,&quot;title&quot;:&quot;Organization.invite&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\invite.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;924f3018-bbe3-4985-9cc3-047cf749e3d7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79242780-78a1-47c8-9822-a74246bc6d48&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;489d392c-121e-49bc-beea-1b0317dd68df&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should send invitation to existing flow user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to existing flow user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3482,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nsignUpUser({\n    done: done,\n    email: email\n}, function(res) {\n    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles[\&quot;Developer\&quot;].uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    _models.OrganizationUser.findOne({\n                        email: email,\n                        org_uid: org_uid,\n                        deleted_at: null\n                    }, function(err, orgUser) {\n                        (typeof(orgUser) != \&quot;undefined\&quot;).should.equal(true);\n                        done();\n                    });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b3183dc8-dadb-4880-8fe3-956e5bdedb47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should only invite allowed count users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should only invite allowed count users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3029,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nsignUpUser({\n    done: done,\n    email: email\n}, function(res) {\n    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles[\&quot;Developer\&quot;].uid],\n            \&quot;emails\&quot;: [email, \&quot;test.user+1@raweng.com\&quot;, \&quot;test.user+1@rawenG.com\&quot;, \&quot;test.user+2@raweng.com\&quot;,\n                \&quot;test.user+3@raweng.com\&quot;, \&quot;test.user+4@raweng.com\&quot;, \&quot;test.user+5@raweng.com\&quot;,\n                \&quot;test.user+6@raweng.com\&quot;, \&quot;test.user+7@raweng.com\&quot;\n            ]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var error_message = messageList.ORG_USER_MAX_LIMIT_REACHED;\n                error_message = error_message.replace(\&quot;%%USER_COUNT%%\&quot;, 10);\n                res.body.error.message.should.equal(error_message);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88e6313e-70d7-4cb4-8f74-0b1adbbab8d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list projects of current organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should list projects of current organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2365,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = getImmutable(orgBody);\ntempOrgBody.name = \&quot;Org3\&quot;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/organizations\&quot;)\n    .send(tempOrgBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var org3 = res.body.output;\n            var new_org_uid = org3.uid;\n            var admin_authtoken = _data.admin.authtoken;\n            var role = getImmutable(roleBody);\n            role.name = \&quot;role5\&quot;;\n            role.projects = [];\n            api.post(\&quot;/enterprise/v1/organizations/:org_uid/role\&quot;.replace(\&quot;:org_uid\&quot;, new_org_uid))\n                .send(role)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var orgRole = res.body.output;\n                        api.post(apiURL.replace(\&quot;:org_uid\&quot;, new_org_uid))\n                            .send({\n                                \&quot;org_roles\&quot;: [orgRole.uid],\n                                \&quot;emails\&quot;: [_data.admin.email]\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    api.get(\&quot;/enterprise/v1/projects\&quot;)\n                                        .set(&#x27;org_uid&#x27;, new_org_uid)\n                                        .set(&#x27;authtoken&#x27;, admin_authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = true;\n                                                _.each(res.body.output.projects, function(proj) {\n                                                    if (proj.org_uid != new_org_uid) {\n                                                        isValid = false;\n                                                    }\n                                                });\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2cd84a40-828d-40cb-86ba-cc91b6ac3cad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not send invitation to existing organization user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should not send invitation to existing organization user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = _data.developer.email;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.roles[\&quot;Developer\&quot;].uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                _models.OrganizationUser.find({\n                    email: email,\n                    org_uid: org_uid,\n                    deleted_at: null\n                }, function(err, orgUsers) {\n                    (orgUsers.length == 1).should.equal(true);\n                    done();\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e7ee0f7-a826-406b-80d2-9145e1a21ddf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send invitation to delete user from organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to delete user from organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5838,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar user_uid = \&quot;\&quot;;\nvar email = _data.developer.email;\nvar inviteUser = function(callback) {\n    api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles.Developer.uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    var tempLoginBody = getImmutable(loginBody);\n                    tempLoginBody.email = email;\n                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                        .send(tempLoginBody)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var userAuthToken = res.body.output.authtoken;\n                                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, userAuthToken)\n                                    .set(&#x27;org_uid&#x27;, org_uid)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            user_uid = res.body.output.uid;\n                                            _models.OrganizationUser.findOne({\n                                                user_uid: user_uid,\n                                                org_uid: org_uid,\n                                                deleted_at: null\n                                            }).lean().exec(function(err, orgUser) {\n                                                callback(err, orgUser);\n                                            });\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\n\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid\&quot;\n            .replace(\&quot;:org_uid\&quot;, org_uid)\n            .replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_USER_DELETED_SUCCESS) {\n                    inviteUser(function(error, orgUser) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            (orgUser.uid != \&quot;\&quot; &amp;&amp;\n                                orgUser.user_uid == user_uid &amp;&amp;\n                                orgUser.invitation == null &amp;&amp;\n                                orgUser.org_uid == org_uid\n                            ).should.equal(true);\n                            done();\n                        }\n                    });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1abb630-2564-47a3-8bc8-83b67bf5552a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;edd84594-a149-4c59-adef-52edbe6f402e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send invitation to existing multiple flow users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to existing multiple flow users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4278,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nsignUpUser({\n    done: done,\n    email: email\n}, function(res) {\n    var email = \&quot;test.user+2@raweng.com\&quot;;\n    signUpUser({\n        done: done,\n        email: email\n    }, function(res) {\n        api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n            .send({\n                \&quot;org_roles\&quot;: [_data.developer.uid],\n                \&quot;emails\&quot;: [\&quot;test.user+1@raweng.com\&quot;, \&quot;test.user+2@raweng.com\&quot;]\n            })\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.message.should.equal(messageList.ORG_INVITATION_SEND);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f705c6bc-5252-45a3-b2fe-b309425fe2b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate invitation body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should validate invitation body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.emails.message == messageList.ORG_INVITEE_EMAIL_SET_REQUIRED &amp;&amp;\n                res.body.error.org_roles.message == messageList.ORG_ROLE_SET_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21449dde-f3ed-4cf6-b253-07044bda4728&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate email set.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should validate email set.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [\&quot;test.user+1@raweng.com\&quot;, \&quot;\&quot;]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.emails.message == messageList.ORG_INVITEE_EMAIL_SET_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6b932ef-f312-4794-adf1-866db4f51137&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send invitation to new flow user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to new flow user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2496,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    var userAuthToken = res.body.output.authtoken;\n                    commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(&#x27;authtoken&#x27;, userAuthToken)\n                        .set(&#x27;org_uid&#x27;, org_uid)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                    res.body.output.org_uid == org_uid;\n                                isValid.should.equal(true);\n                                done();\n                            }\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;600f8c96-64a6-47ca-8ba7-7dce1b8752c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give admin role required error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should give admin role required error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [\&quot;test.user+2@raweng.com\&quot;]\n    })\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b28aff0f-c220-4261-9cc3-45d5f28c9893&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send invitation to existing google user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to existing google user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2996,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1000@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: email,\n    access_token: plus1000User.access_token\n});\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n    email: email\n});\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(plus1000User)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                .send({\n                    \&quot;org_roles\&quot;: [_data.developer.uid],\n                    \&quot;emails\&quot;: [email]\n                })\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n                                email: email\n                            });\n                            api.post(\&quot;/enterprise/v1/login/google\&quot;)\n                                .send(plus1000User)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                        if (isValid) {\n                                            var userAuthToken = res.body.output.authtoken;\n                                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                                            api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                .set(&#x27;authtoken&#x27;, userAuthToken)\n                                                .set(&#x27;org_uid&#x27;, org_uid)\n                                                .expect(httpStatus.OK)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                            res.body.output.org_uid == org_uid;\n                                                        isValid.should.equal(true);\n                                                        done();\n                                                    }\n                                                });\n                                        } else {\n                                            true.should.equal(false);\n                                            done();\n                                        }\n                                    }\n                                });\n                        } else {\n                            true.should.equal(false);\n                            done();\n                        }\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;394866c1-836a-45c4-93ef-cb575d752187&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send invitation to new google user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should send invitation to new google user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2748,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1000@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                    email: email,\n                    access_token: plus1000User.access_token\n                });\n                commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n                    email: email\n                });\n                api.post(\&quot;/enterprise/v1/login/google\&quot;)\n                    .send(plus1000User)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                            if (isValid) {\n                                var userAuthToken = res.body.output.authtoken;\n                                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, userAuthToken)\n                                    .set(&#x27;org_uid&#x27;, org_uid)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                res.body.output.org_uid == org_uid;\n                                            isValid.should.equal(true);\n                                            done();\n                                        }\n                                    });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d689cb4-6315-48ea-9022-a7f301438bf1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization plan for login user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should get organization plan for login user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3497,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+03@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                var tempLoginBody = getImmutable(loginBody);\n                tempLoginBody.email = email;\n                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/login\&quot;)\n                    .send(tempLoginBody)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var userAuthToken = res.body.output.authtoken;\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(\&quot;/enterprise/v1/user\&quot;)\n                                .set(&#x27;authtoken&#x27;, userAuthToken)\n                                .set(&#x27;org_uid&#x27;, org_uid)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                            typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                            typeof(res.body.output.user_plan) != \&quot;undefined\&quot; &amp;&amp;\n                                            res.body.output.org_uid == org_uid;\n                                        isValid.should.equal(true);\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;360d33f1-1a3d-47a3-bf21-41bbfded7a4b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.invite Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.developer.uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83815d88-36ec-46a4-992e-b427b863d99a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b3183dc8-dadb-4880-8fe3-956e5bdedb47&quot;,&quot;88e6313e-70d7-4cb4-8f74-0b1adbbab8d8&quot;,&quot;2cd84a40-828d-40cb-86ba-cc91b6ac3cad&quot;,&quot;0e7ee0f7-a826-406b-80d2-9145e1a21ddf&quot;,&quot;f1abb630-2564-47a3-8bc8-83b67bf5552a&quot;,&quot;edd84594-a149-4c59-adef-52edbe6f402e&quot;,&quot;f705c6bc-5252-45a3-b2fe-b309425fe2b8&quot;,&quot;21449dde-f3ed-4cf6-b253-07044bda4728&quot;,&quot;e6b932ef-f312-4794-adf1-866db4f51137&quot;,&quot;600f8c96-64a6-47ca-8ba7-7dce1b8752c4&quot;,&quot;b28aff0f-c220-4261-9cc3-45d5f28c9893&quot;,&quot;394866c1-836a-45c4-93ef-cb575d752187&quot;,&quot;9d689cb4-6315-48ea-9022-a7f301438bf1&quot;,&quot;360d33f1-1a3d-47a3-bf21-41bbfded7a4b&quot;,&quot;83815d88-36ec-46a4-992e-b427b863d99a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30798,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;da8c8c81-871b-4135-8fc2-24b35ab69856&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7d8b471a-4013-4bd7-b34d-bba98282f20b&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;54822b1b-a555-46c6-b8cf-90fd75b78109&quot;,&quot;title&quot;:&quot;OrganizationUser.processSSOLogin&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        _data = data;\n        org_uid = _data.organization.uid;\n        authToken = data.owner.authtoken;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06b02e76-7175-4bfd-bd83-077289c651f1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d68a1750-aa5a-4884-a4ee-c5912db82c1b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should allowed owner without SSO login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should allowed owner without SSO login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                            if (isValid) {\n                                _.each(res.body.output.organizations, function(orgItem) {\n                                    isValid = isValid &amp;&amp;\n                                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                });\n                                isValid.should.equal(true);\n                                done();\n                            } else {\n                                false.should.equal(true);\n                                done();\n                            }\n                        }\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;43c7e5b6-9168-4b50-ab15-dd3f5474105d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should works without relaystate.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should works without relaystate.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:196,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                            var data = getImmutable(usersData.SMALRespWithoutAuthtoken);\n                                            delete data.RelayState;\n                                            api.post(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                                .send(data)\n                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        var qs = querystring.parse(res.headers.location);\n                                                        var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                        var _config = config;\n                                                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                            .set({ &#x27;authtoken&#x27;: authtoken, org_uid: _data.organization.uid })\n                                                            .expect(httpStatus.OK)\n                                                            .end(function(err, res) {\n                                                                if (err) {\n                                                                    done(err);\n                                                                } else {\n                                                                    var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                        typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                        typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                                    if (isValid) {\n                                                                        _.each(res.body.output.organizations, function(orgItem) {\n                                                                            isValid = isValid &amp;&amp;\n                                                                                typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                        });\n                                                                        isValid.should.equal(true);\n                                                                        done();\n                                                                    } else {\n                                                                        false.should.equal(true);\n                                                                        done();\n                                                                    }\n                                                                }\n                                                            });\n                                                    }\n                                                });\n                                        } else {\n                                            true.should.equal(false);\n                                            done();\n                                        }\n                                    }\n                                });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e312e4af-b7d0-4724-9800-07d4f80b33ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give org not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should give org not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:146,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                            var data = getImmutable(usersData.SMALRespWithoutAuthtoken);\n                                            delete data.RelayState;\n                                            api.post(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name + \&quot;abc\&quot;)\n                                                .send(data)\n                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        res.headers.location.should.equal(\&quot;http://localhost:8080/#/sso/error?error=Organization%20not%20found.\&quot;);\n                                                        done();\n                                                    }\n                                                });\n                                        } else {\n                                            true.should.equal(false);\n                                            done();\n                                        }\n                                    }\n                                });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;886f5579-00c7-48ed-8d7d-258fd3966f38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login admin user with SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should login admin user with SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:273,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                            var data = usersData.SMALRespWithoutAuthtoken;\n                                            api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                                                .send(data)\n                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        var qs = querystring.parse(res.headers.location);\n                                                        var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                            .set(&#x27;authtoken&#x27;, authtoken)\n                                                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                                            .expect(httpStatus.OK)\n                                                            .end(function(err, res) {\n                                                                if (err) {\n                                                                    done(err);\n                                                                } else {\n                                                                    var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                        typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                        typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                                    if (isValid) {\n                                                                        _.each(res.body.output.organizations, function(orgItem) {\n                                                                            isValid = isValid &amp;&amp;\n                                                                                typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                        });\n                                                                        isValid.should.equal(true);\n                                                                        done();\n                                                                    } else {\n                                                                        false.should.equal(true);\n                                                                        done();\n                                                                    }\n                                                                }\n                                                            });\n                                                    }\n                                                });\n                                        } else {\n                                            true.should.equal(false);\n                                            done();\n                                        }\n                                    }\n                                });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b5bad9d6-d9fd-4d8c-aaa4-8cd8c9ef0dd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should overwrite user session management timeout.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should overwrite user session management timeout.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:191,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\n_ssoConfig.session_time_out_hours = 5;\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                            var data = usersData.SMALRespWithoutAuthtoken;\n                                            api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                                                .send(data)\n                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        var qs = querystring.parse(res.headers.location);\n                                                        var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                        var date = moment(new Date());\n                                                        date.subtract({ hours: 4, minutes: 5 });\n                                                        _models.UserToken.findOneAndUpdate({\n                                                            authtoken: authtoken\n                                                        }, {\n                                                            idle_valid_till: date\n                                                        }, {\n                                                            new: true\n                                                        }, function(error, user) {\n                                                            api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                                .set(&#x27;authtoken&#x27;, authtoken)\n                                                                .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                                                .expect(httpStatus.OK)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                            typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                            typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                                        if (isValid) {\n                                                                            _.each(res.body.output.organizations, function(orgItem) {\n                                                                                isValid = isValid &amp;&amp;\n                                                                                    typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                    typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                    typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                    typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                    typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                            });\n                                                                            isValid.should.equal(true);\n                                                                            done();\n                                                                        } else {\n                                                                            false.should.equal(true);\n                                                                            done();\n                                                                        }\n                                                                    }\n                                                                });\n                                                        });\n                                                    }\n                                                });\n                                        } else {\n                                            true.should.equal(false);\n                                            done();\n                                        }\n                                    }\n                                });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4829d4a-2d79-4de6-8fd3-3971f2d6d585&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should do test login without enabling SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should do test login without enabling SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2602,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar email = \&quot;amber.more@raweng.com\&quot;;\nsignUpUser({\n    email: email\n}, function(res) {\n    var newUserAuthtoken = res.body.output.authtoken;\n    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles[\&quot;Admin\&quot;].uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    api.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                        .send(_ssoConfig)\n                        .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                            var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                            api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                                .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    /*api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                        .send({})\n                                        .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {*/\n                                    api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name + \&quot;&amp;test=true\&quot;)\n                                        .expect(httpStatus.MOVED_TEMPORARILY)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                                    var data = usersData.SMALRespWithoutAuthtoken;\n                                                    api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                                                        .send(data)\n                                                        .expect(httpStatus.MOVED_TEMPORARILY)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var qs = querystring.parse(res.headers.location);\n                                                                var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessTestURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                                    .set(&#x27;authtoken&#x27;, authtoken)\n                                                                    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                                                    .expect(httpStatus.OK)\n                                                                    .end(function(err, res) {\n                                                                        if (err) {\n                                                                            done(err);\n                                                                        } else {\n                                                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                                            if (isValid) {\n                                                                                _.each(res.body.output.organizations, function(orgItem) {\n                                                                                    isValid = isValid &amp;&amp;\n                                                                                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                                });\n                                                                                isValid.should.equal(true);\n                                                                                done();\n                                                                            } else {\n                                                                                false.should.equal(true);\n                                                                                done();\n                                                                            }\n                                                                        }\n                                                                    });\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                    done();\n                                                }\n                                            }\n                                        });\n\n\n                                    //});\n                                });\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;497f4beb-77ca-4951-94da-c890d905284e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should do other user SSO login without accepting invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should do other user SSO login without accepting invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5082,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar email = \&quot;amber.more@raweng.com\&quot;;\nsignUpUser({\n    email: email\n}, function(res) {\n    var newUserAuthtoken = res.body.output.authtoken;\n    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles[\&quot;Admin\&quot;].uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    api.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                        .send(_ssoConfig)\n                        .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                            var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                            api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                                .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                        .send({})\n                                        .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                                                            var data = usersData.SMALRespWithoutAuthtoken;\n                                                            api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                                                                .send(data)\n                                                                .expect(httpStatus.MOVED_TEMPORARILY)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        var qs = querystring.parse(res.headers.location);\n                                                                        var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                                                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                                                                            .set(&#x27;authtoken&#x27;, authtoken)\n                                                                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                                                            .expect(httpStatus.OK)\n                                                                            .end(function(err, res) {\n                                                                                if (err) {\n                                                                                    done(err);\n                                                                                } else {\n                                                                                    var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                                                    if (isValid) {\n                                                                                        _.each(res.body.output.organizations, function(orgItem) {\n                                                                                            isValid = isValid &amp;&amp;\n                                                                                                typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                                typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                                typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                                typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                                                                typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                                                        });\n                                                                                        isValid.should.equal(true);\n                                                                                        done();\n                                                                                    } else {\n                                                                                        false.should.equal(true);\n                                                                                        done();\n                                                                                    }\n                                                                                }\n                                                                            });\n                                                                    }\n                                                                });\n                                                        } else {\n                                                            true.should.equal(false);\n                                                            done();\n                                                        }\n                                                    }\n                                                });\n                                        });\n                                });\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27e2654d-f0e5-4f56-9bca-9fecb5a057e2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should use same token for secondtime login if validtill satisfies.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should use same token for secondtime login if validtill satisfies.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:226,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar SSOLogin = function(sso_data, cb) {\n    var authtoken = \&quot;\&quot;;\n    var ssoLogin = \&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name;\n    if (sso_data.RelayState) {\n        authtoken = sso_data.authtoken || \&quot;\&quot;;\n        ssoLogin += \&quot;&amp;sid=\&quot; + authtoken\n    }\n    api.get(ssoLogin)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var qs = querystring.parse(res.headers.location);\n                    var rs = utils.getRelayState({\n                        body: {\n                            RelayState: qs.RelayState\n                        }\n                    });\n                    if ((rs.authtoken || \&quot;\&quot;) == authtoken) {\n                        api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                            .send(sso_data)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var qs = querystring.parse(res.headers.location);\n                                    var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                if (isValid) {\n                                                    _.each(res.body.output.organizations, function(orgItem) {\n                                                        isValid = isValid &amp;&amp;\n                                                            typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                    });\n                                                    if (isValid) {\n                                                        cb(isValid, authtoken);\n                                                    } else {\n                                                        false.should.equal(true);\n                                                        done();\n                                                    }\n                                                } else {\n                                                    false.should.equal(true);\n                                                    done();\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            var data = usersData.SMALRespWithoutAuthtoken;\n                            SSOLogin(data, function(isValid, authtoken) {\n                                data.RelayState = encryption.encryptSync(JSON.stringify({\n                                    o: _data.organization.uid,\n                                    a: authtoken\n                                }), encryption.encryptSync());\n                                data.authtoken = authtoken;\n                                SSOLogin(data, function(isValid, authtoken) {\n                                    _models.OrganizationToken.find({}, function(error, tokens) {\n                                        (tokens.length == 1).should.equal(true);\n                                        done();\n                                    });\n                                });\n                            });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;771a5ebb-f474-46ee-8983-9fe200e7ae52&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create another token for secondtime login if validtill not satisfies.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should create another token for secondtime login if validtill not satisfies.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:324,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar last_authtoken = \&quot;\&quot;;\nvar SSOLogin = function(sso_data, cb) {\n    api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                        .send(sso_data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, authtoken)\n                                    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                            if (isValid) {\n                                                _.each(res.body.output.organizations, function(orgItem) {\n                                                    isValid = isValid &amp;&amp;\n                                                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                });\n                                                if (isValid) {\n                                                    cb(isValid, authtoken);\n                                                } else {\n                                                    false.should.equal(true);\n                                                    done();\n                                                }\n                                            } else {\n                                                false.should.equal(true);\n                                                done();\n                                            }\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            var data = usersData.SMALRespWithoutAuthtoken;\n                            SSOLogin(data, function(isValid, authtoken) {\n                                data.RelayState = encryption.encryptSync(JSON.stringify({\n                                    o: _data.organization.uid,\n                                    a: authtoken\n                                }), encryption.encryptSync());\n                                _models.OrganizationToken.findOneAndUpdate({\n                                    org_uid: _data.organization.uid\n                                }, {\n                                    valid_till: new Date(2001, 12, 1)\n                                }, { new: true }, function(error, tokens) {\n                                    SSOLogin(data, function(isValid, authtoken) {\n                                        _models.OrganizationToken.find({}, function(error, tokens) {\n                                            (tokens.length == 2).should.equal(true);\n                                            done();\n                                        });\n                                    });\n                                });\n                            });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e039344-6e28-43d6-ad9b-f6c3b9c1c5be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not do SSO login if SSO is disabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should not do SSO login if SSO is disabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3339,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar email = \&quot;amber.more@raweng.com\&quot;;\nvar loginWithSSO = function(status, callback) {\n    api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(\&quot;error\&quot;) &gt; -1) {\n                    var qs = querystring.parse(res.headers.location);\n                    var error = qs[\&quot;error\&quot;] || qs[config.enterprise.sso.loginErrorURL + \&quot;?error\&quot;] || \&quot;\&quot;;\n                    callback(error, null);\n                } else {\n                    if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                        var data = usersData.SMALRespWithoutAuthtoken;\n                        api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                            .send(data)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var qs = querystring.parse(res.headers.location);\n                                    var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                        .expect(status)\n                                        .end(callback);\n                                }\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                }\n            }\n        });\n};\nsignUpUser({\n    email: email\n}, function(res) {\n    var newUserAuthtoken = res.body.output.authtoken;\n    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles[\&quot;Admin\&quot;].uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    api.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                        .send(_ssoConfig)\n                        .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                            var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                            api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                                .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                        .send({})\n                                        .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            loginWithSSO(httpStatus.OK, function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                                    if (isValid) {\n                                                        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/disable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                                            .send({})\n                                                            .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                                                            .expect(httpStatus.OK)\n                                                            .end(function(err, res) {\n                                                                loginWithSSO(httpStatus.BAD_REQUEST, function(err, res) {\n                                                                    err.should.equal(messageList.ORG_SSO_DISABLE);\n                                                                    done();\n                                                                });\n                                                            });\n                                                    } else {\n                                                        false.should.equal(true);\n                                                        done();\n                                                    }\n                                                }\n                                            });\n                                        });\n                                });\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d6cc621-9e54-4d60-a937-0fe46e8b751f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should logout all tokens.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.processSSOLogin Should logout all tokens.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:245,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar last_authtoken = \&quot;\&quot;;\nvar SSOLogin = function(cb) {\n    api.get(\&quot;/enterprise/v1/login/sso?org=\&quot; + _data.organization.name)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var data = usersData.SMALRespWithoutAuthtoken;\n                    api.post(\&quot;/enterprise/v1/login/sso\&quot;)\n                        .send(data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[config.enterprise.sso.loginSuccessURL + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, authtoken)\n                                    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n                                            if (isValid) {\n                                                _.each(res.body.output.organizations, function(orgItem) {\n                                                    isValid = isValid &amp;&amp;\n                                                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                                                });\n                                                if (isValid) {\n                                                    last_authtoken = authtoken;\n                                                    cb(isValid);\n                                                } else {\n                                                    false.should.equal(true);\n                                                    done();\n                                                }\n                                            } else {\n                                                false.should.equal(true);\n                                                done();\n                                            }\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(_ssoConfig)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        testCollection.createOrgUser({\n                            user: _data.admin,\n                            email: \&quot;amber.more@raweng.com\&quot;,\n                            org_uid: _data.organization.uid,\n                            role: _data.roles[\&quot;Admin\&quot;]\n                        }, function(error, user) {\n                            SSOLogin(function() {\n                                _models.OrganizationToken.findOneAndUpdate({\n                                    org_uid: _data.organization.uid\n                                }, {\n                                    valid_till: new Date(2001, 12, 1)\n                                }, { new: true }, function(error, tokens) {\n                                    SSOLogin(function() {\n                                        api.post(\&quot;/enterprise/v1/logout\&quot;)\n                                            .set(&#x27;authtoken&#x27;, last_authtoken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                _models.OrganizationToken.find({ authtoken: last_authtoken }, function(error, tokens) {\n                                                    var is_valid = true;\n                                                    _.each(tokens, function(item) {\n                                                        is_valid = is_valid &amp;&amp; item.deleted_at != null;\n                                                    });\n                                                    is_valid.should.equal(true);\n                                                    done();\n                                                });\n                                            });\n                                    });\n                                });\n                            });\n                        });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4f39db1-36e4-4005-bd57-14842fb3c926&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;43c7e5b6-9168-4b50-ab15-dd3f5474105d&quot;,&quot;e312e4af-b7d0-4724-9800-07d4f80b33ea&quot;,&quot;886f5579-00c7-48ed-8d7d-258fd3966f38&quot;,&quot;b5bad9d6-d9fd-4d8c-aaa4-8cd8c9ef0dd4&quot;,&quot;f4829d4a-2d79-4de6-8fd3-3971f2d6d585&quot;,&quot;497f4beb-77ca-4951-94da-c890d905284e&quot;,&quot;27e2654d-f0e5-4f56-9bca-9fecb5a057e2&quot;,&quot;771a5ebb-f474-46ee-8983-9fe200e7ae52&quot;,&quot;6e039344-6e28-43d6-ad9b-f6c3b9c1c5be&quot;,&quot;2d6cc621-9e54-4d60-a937-0fe46e8b751f&quot;,&quot;f4f39db1-36e4-4005-bd57-14842fb3c926&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:12676,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6a3b0d0d-2d09-4229-abe0-00666eb13361&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6c067afc-f574-4373-bb92-856738109379&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fdd583ea-9281-4471-9fb5-97dcd1f9b116&quot;,&quot;title&quot;:&quot;Organization.removeCerts&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\removeCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab66fb79-0626-4601-8b55-7e6b19160718&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a9acf42-0e40-4642-a66b-4454d41f5e37&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9b47db3-b0af-4372-852f-dca778f8f6c3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete public SSO cert.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts Should delete public SSO cert.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            if (isValid) {\n                api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.message.should.equal(messageList.ORG_CERT_PUBLIC_DELETED_SUCCESS);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eeb05760-7724-4a07-9b9a-94cc261f697b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete private SSO cert.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts Should delete private SSO cert.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            if (isValid) {\n                api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;private\&quot;))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.message.should.equal(messageList.ORG_CERT_PRIVATE_DELETED_SUCCESS);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a09a6b9-2b87-4b7b-af3a-da40e3e8554f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get SSO certs by Developer.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts Should not get SSO certs by Developer.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;))\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;461d1fa1-00e1-4403-9b27-4c9612f59597&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives invalid file type errors for both files.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts Should gives invalid file type errors for both files.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public1\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.message == messageList.ORG_INVALID_CERT_TYPE;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f0d9725-743c-4e74-8cbb-39bb2ca0b237&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.removeCerts Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:cert_type\&quot;, \&quot;public\&quot;))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;15fde30c-3af4-4b73-9484-1a698126cb1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;eeb05760-7724-4a07-9b9a-94cc261f697b&quot;,&quot;3a09a6b9-2b87-4b7b-af3a-da40e3e8554f&quot;,&quot;461d1fa1-00e1-4403-9b27-4c9612f59597&quot;,&quot;7f0d9725-743c-4e74-8cbb-39bb2ca0b237&quot;,&quot;15fde30c-3af4-4b73-9484-1a698126cb1a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:98,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;794b5063-0af0-4e78-bf3a-c39ae304f97f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;004b649e-2516-4b03-a064-7aa8436a693c&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0dcb4031-c7c7-456d-9cc8-2e70b0569214&quot;,&quot;title&quot;:&quot;Organization.transfer&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\transfer.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;467721a9-0535-4466-8f54-f57ea4803197&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;59af82ee-0eee-411e-b3f5-3e51ea52e471&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;425dfbc3-470f-4409-ad54-ca86b88ef308&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should send ownership invitation to existing flow user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should send ownership invitation to existing flow user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.other_user.email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                _models.OrganizationOwnerInvitation.findOne({ org_uid: org_uid, email: _data.other_user.email }, function(error, orgInvitation) {\n                    if (error || !orgInvitation) {\n                        false.should.equal(true);\n                        done();\n                    } else {\n                        true.should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66d1cc71-5880-42a7-bfcb-873700fc196e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get ownership invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should get ownership invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.other_user.email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                api.get(\&quot;/enterprise/v1/organizations/:org_uid\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.other_user.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.owner_invitation.should.not.equal(undefined);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e5e74ea-487a-46d5-92a8-826ae694b3a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should limit ownership invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should limit ownership invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.roles[\&quot;Developer\&quot;].uid],\n        \&quot;emails\&quot;: [\&quot;test.user+1@raweng.com\&quot;, \&quot;test.user+1@rawenG.com\&quot;, \&quot;test.user+2@raweng.com\&quot;,\n            \&quot;test.user+3@raweng.com\&quot;, \&quot;test.user+4@raweng.com\&quot;, \&quot;test.user+5@raweng.com\&quot;\n        ]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                .send({\n                    \&quot;email\&quot;: \&quot;test.user+6@raweng.com\&quot;\n                })\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var error_message = messageList.ORG_USER_MAX_LIMIT_REACHED;\n                        error_message = error_message.replace(\&quot;%%USER_COUNT%%\&quot;, 10);\n                        res.body.error.message.should.equal(error_message);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cac75db5-93bf-4127-9dd4-d2bf602311bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({\n        \&quot;email\&quot;: _data.other_user.email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cecc4d88-cc04-449b-b5a3-49be983c480d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate ownership invitation body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should validate ownership invitation body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.email.message == messageList.ORG_EMAIL_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3e1c25f-3453-4f1c-b31d-060368a2644b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send ownership invitation to existing organization flow user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should send ownership invitation to existing organization flow user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.developer.email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                _models.OrganizationOwnerInvitation.findOne({ org_uid: org_uid, email: _data.developer.email }, function(error, orgInvitation) {\n                    if (error || !orgInvitation) {\n                        false.should.equal(true);\n                        done();\n                    } else {\n                        true.should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8519dc5-38ed-4ea3-85de-f66111f97625&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send ownership invitation to new flow user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should send ownership invitation to new flow user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1000@raweng.com\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                _models.OrganizationOwnerInvitation.findOne({ org_uid: org_uid, email: email }, function(error, orgInvitation) {\n                    if (error || !orgInvitation) {\n                        false.should.equal(true);\n                        done();\n                    } else {\n                        true.should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0049a63d-3d17-4c8b-8d19-3938be1dab21&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send ownership invitation to existing google user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should send ownership invitation to existing google user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2915,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1000@raweng.com\&quot;;\nsignUpGoogleUser({\n    done: done,\n    email: email\n}, function(res) {\n    var new_user_uid = res.body.output.uid;\n    api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;email\&quot;: email\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                    _models.OrganizationOwnerInvitation.findOne({ org_uid: org_uid, email: email }, function(error, orgInvitation) {\n                        if (error || !orgInvitation) {\n                            false.should.equal(true);\n                            done();\n                        } else {\n                            true.should.equal(true);\n                            done();\n                        }\n                    });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5162062a-ab22-466c-ba20-fbc13c07ae92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send ownership invitation to new google user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should send ownership invitation to new google user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1000@raweng.com\&quot;;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: email\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_OWNERSHIP_INVITATION_SEND) {\n                _models.OrganizationOwnerInvitation.findOne({ org_uid: org_uid, email: email }, function(error, orgInvitation) {\n                    if (error || !orgInvitation) {\n                        false.should.equal(true);\n                        done();\n                    } else {\n                        true.should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aeeaa2c9-f75a-4285-a675-13d17d0f3ced&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give owner required error for admin role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should give owner required error for admin role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.developer.email\n    })\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_OWNER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f1c22eb-493c-40fb-b00c-84f74125ff17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give owner required error for developer role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should give owner required error for developer role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.developer.email\n    })\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_OWNER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23c4af99-00b8-4bf8-91e1-d0c2c104b0b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.transfer Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;email\&quot;: _data.developer.email\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d61f6d4-62b3-44f1-9ff6-4cb25035dbd5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;66d1cc71-5880-42a7-bfcb-873700fc196e&quot;,&quot;2e5e74ea-487a-46d5-92a8-826ae694b3a4&quot;,&quot;cac75db5-93bf-4127-9dd4-d2bf602311bf&quot;,&quot;cecc4d88-cc04-449b-b5a3-49be983c480d&quot;,&quot;e3e1c25f-3453-4f1c-b31d-060368a2644b&quot;,&quot;e8519dc5-38ed-4ea3-85de-f66111f97625&quot;,&quot;0049a63d-3d17-4c8b-8d19-3938be1dab21&quot;,&quot;5162062a-ab22-466c-ba20-fbc13c07ae92&quot;,&quot;aeeaa2c9-f75a-4285-a675-13d17d0f3ced&quot;,&quot;5f1c22eb-493c-40fb-b00c-84f74125ff17&quot;,&quot;23c4af99-00b8-4bf8-91e1-d0c2c104b0b4&quot;,&quot;3d61f6d4-62b3-44f1-9ff6-4cb25035dbd5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3118,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b0035b75-8c3f-455e-a839-5dc4411277cb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;352aeb57-ba87-4461-833b-08d21fd09869&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;adec7dff-399e-49e5-a494-50dcb3817154&quot;,&quot;title&quot;:&quot;Organization.update&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4bd861f1-31bf-4b46-a614-a9782bf93b56&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a0cad1c-fd79-44f2-8bf3-80683c4dfe17&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2766b919-5a80-4ed3-88c9-934724a235a6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should update organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.name == body.name &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c511375-cb10-4c9c-b748-47460cf99025&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b52dd5bb-f907-414a-9514-57275e0523dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update same name in organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should update same name in organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org1&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.name == body.name &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f697b4ff-41e2-4d32-b0a0-5ec0efa2da65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update organization details without name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should update organization details without name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.name != \&quot;\&quot; &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;671b35cd-73f2-4de9-945e-310a63292602&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give duplicate organization name error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should give duplicate organization name error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org2&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DUPLICATE_NAME_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16dcf9b6-929f-4c83-817b-b5dbb6002f8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should only allowed to update org details by owner and admin role user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should only allowed to update org details by owner and admin role user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;db47c598-cd70-4fc7-a535-08c16c365cb1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.update Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;name&#x27;: &#x27;org3&#x27;,\n    &#x27;sso_details&#x27;: {\n        &#x27;name&#x27;: &#x27;sso&#x27;,\n        &#x27;url&#x27;: &#x27;https://example.com&#x27;\n    },\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2581a363-a82f-4bf9-bfb3-bcd059508dbe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2c511375-cb10-4c9c-b748-47460cf99025&quot;,&quot;b52dd5bb-f907-414a-9514-57275e0523dc&quot;,&quot;f697b4ff-41e2-4d32-b0a0-5ec0efa2da65&quot;,&quot;671b35cd-73f2-4de9-945e-310a63292602&quot;,&quot;16dcf9b6-929f-4c83-817b-b5dbb6002f8d&quot;,&quot;db47c598-cd70-4fc7-a535-08c16c365cb1&quot;,&quot;2581a363-a82f-4bf9-bfb3-bcd059508dbe&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:89,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b82ea207-1a31-4e7a-850b-6829462f502d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a30fce2e-3088-41c0-b913-860f0bf30287&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a652c710-63f5-486c-8830-c2245abc2cdf&quot;,&quot;title&quot;:&quot;Organization.updateAvatar&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        _data = data;\n        org_uid = data.organization.uid;\n        user_uid = data.organization.user_uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0ec1553b-0f52-497f-bef5-2a7cefd93614&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df7f6c6b-a01c-4399-9040-74efd4c3256a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97251242-7d47-43ef-83f3-4c9b55c4024f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Owner should update organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar Owner should update organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41f2e499-587b-428b-9c7e-2a2bebe2f4fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Owner should able to remove organization image.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar Owner should able to remove organization image.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;avatar&#x27;: null\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ddc67661-97ef-4b9c-a776-1c93777458ef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Admin should update organization details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar Admin should update organization details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var output = res.body.output || {};\n            (output.uid == org_uid &amp;&amp;\n                output.avatar == body.avatar).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acf46786-d272-4195-8058-5255e9589ec7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Other roles should not update avatar.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar Other roles should not update avatar.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c8f05e7-a3b2-4443-ae38-aa60ca105fe7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateAvatar Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar body = {\n    &#x27;avatar&#x27;: &#x27;https://example.com/img1.png&#x27;\n};\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, body.avatar);\n};\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(body)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20300bd4-b7e7-49d0-a415-8e7ba0f75720&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;41f2e499-587b-428b-9c7e-2a2bebe2f4fc&quot;,&quot;ddc67661-97ef-4b9c-a776-1c93777458ef&quot;,&quot;acf46786-d272-4195-8058-5255e9589ec7&quot;,&quot;1c8f05e7-a3b2-4443-ae38-aa60ca105fe7&quot;,&quot;20300bd4-b7e7-49d0-a415-8e7ba0f75720&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:85,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;847c0428-d7cd-4238-b45b-668be5368890&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c8e4e80a-eedf-4521-b828-7f84167fc403&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8b8746ea-a45c-422e-bfa2-375896bdf01b&quot;,&quot;title&quot;:&quot;Organization.updateSSODetails&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\updateSSODetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3bafe565-94bc-4cb9-ad89-ea639842505a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;74714099-e55f-4931-81c4-f856e694e902&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;03616dcf-18ff-4644-9b53-5ff5ff76af6a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update SSO Config details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should update SSO Config details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours &amp;&amp;\n                res.body.output.sso_details.issuer == config.issuer\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27bf48dc-c469-48bc-972c-acdc86d9a0ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate SSO Config details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should validate SSO Config details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.entry_point.message == messageList.ORG_SSO_ENTRY_POINT_REQUIRED &amp;&amp;\n                res.body.error.algo_type.message == messageList.ORG_SSO_ALGO_TYPE_REQUIRED &amp;&amp;\n                res.body.error.session_time_out_hours.message == messageList.ORG_SSO_SESSION_TIMEOUT_POSITIVE_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;07adf34d-e0f2-4900-ba00-2becedf16ab6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update SSO Config details by admin.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should update SSO Config details by admin.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;973f2ddf-4f13-44e9-b016-f716b1f722ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not update SSO Config details by developer.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should not update SSO Config details by developer.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0045252e-b3a1-4569-94ff-17088a3d555e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({})\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d131c166-f74a-476c-9594-fee9ffcd7383&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.updateSSODetails Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf430db1-afe4-424c-a662-c0018e49bd02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;27bf48dc-c469-48bc-972c-acdc86d9a0ec&quot;,&quot;07adf34d-e0f2-4900-ba00-2becedf16ab6&quot;,&quot;973f2ddf-4f13-44e9-b016-f716b1f722ba&quot;,&quot;0045252e-b3a1-4569-94ff-17088a3d555e&quot;,&quot;d131c166-f74a-476c-9594-fee9ffcd7383&quot;,&quot;cf430db1-afe4-424c-a662-c0018e49bd02&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:83,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;94f5d5e7-47e1-4d0d-a27d-333f22d40ef0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1d9e762b-67ce-49b0-a69b-bc7650b5d7cf&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;12b3de18-84a3-402f-95d4-54fa999f23b9&quot;,&quot;title&quot;:&quot;Organization.uploadCerts&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organization\\uploadCerts.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a96145a-26b5-440b-891a-73e2a13879a9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b29f5ee-d3d5-4a36-9596-c33323d8dafd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4154fdca-0e29-4db6-b26d-fde81ed458e7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should upload SSO certs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should upload SSO certs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1fc8515b-e880-4a84-9707-d53d814a7195&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should upload SSO certs by Admin.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should upload SSO certs by Admin.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aa12f014-b32b-4252-bb54-d00e46a211ae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not upload SSO certs by Billing Manager.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should not upload SSO certs by Billing Manager.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d03a9dd-fde4-466a-b7e8-879bc7e61a78&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not upload SSO certs by Developer.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should not upload SSO certs by Developer.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab067c20-56aa-4da9-9525-0e1a9167eef0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should upload only public key.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should upload only public key.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.signed_public_key != \&quot;\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d9928d4-cfdc-44df-9010-a4b2a95d6959&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should upload only private certificate.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should upload only private certificate.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.enc_private_key != \&quot;\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;048f9e8c-adfa-4239-9185-c881974b4554&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives invalid public key file type error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should gives invalid public key file type error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, privateKeyFile)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.signed_public_key.message == messageList.ORG_SSO_PUBLIC_CERT_FILE_TYPE_ERROR;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b5b9ead-3562-492b-98e0-5a0247c4402b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives invalid private cert file type error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should gives invalid private cert file type error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;enc_private_key&#x27;, publicKeyFile)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.enc_private_key.message == messageList.ORG_SSO_PRIVATE_KEY_FILE_TYPE_ERROR;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d220bf8d-422b-478e-aa14-07f796499e9e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives invalid file type errors for both files.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should gives invalid file type errors for both files.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\nvar privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .attach(&#x27;signed_public_key&#x27;, privateKeyFile)\n    .attach(&#x27;enc_private_key&#x27;, publicKeyFile)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.signed_public_key.message == messageList.ORG_SSO_PUBLIC_CERT_FILE_TYPE_ERROR &amp;&amp;\n                res.body.error.enc_private_key.message == messageList.ORG_SSO_PRIVATE_KEY_FILE_TYPE_ERROR;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b98f85ac-6da2-4577-8bb2-7a6fa99450ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization Organization.uploadCerts Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f97ab4d-2cbb-4e86-ab69-2160463896f6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1fc8515b-e880-4a84-9707-d53d814a7195&quot;,&quot;aa12f014-b32b-4252-bb54-d00e46a211ae&quot;,&quot;1d03a9dd-fde4-466a-b7e8-879bc7e61a78&quot;,&quot;ab067c20-56aa-4da9-9525-0e1a9167eef0&quot;,&quot;6d9928d4-cfdc-44df-9010-a4b2a95d6959&quot;,&quot;048f9e8c-adfa-4239-9185-c881974b4554&quot;,&quot;3b5b9ead-3562-492b-98e0-5a0247c4402b&quot;,&quot;d220bf8d-422b-478e-aa14-07f796499e9e&quot;,&quot;b98f85ac-6da2-4577-8bb2-7a6fa99450ad&quot;,&quot;3f97ab4d-2cbb-4e86-ab69-2160463896f6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:154,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;24921c62-9c9c-4144-9693-340fef90e4ac&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;eb65acf2-6ad6-435b-b05c-28980dee0635&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7510ae60-4926-4ed6-a255-88a7439040d8&quot;,&quot;title&quot;:&quot;OrganizationRole.create&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78e75215-210a-4b7d-85ab-6a73023d69d6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e632ac21-5d56-47ec-90d7-1c334c9f0ccb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create organization role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should create organization role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role5\&quot;;\nrole.projects = [_data.org_projects[0].uid, _data.org_projects[1].uid];\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;479d7009-d6e3-46e0-85b5-1cf1f55645e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role5\&quot;;\nrole.projects = [_data.org_projects[0].uid, _data.org_projects[1].uid];\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c52ff877-ced2-4352-9b89-863770d1e71c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate organization role body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should validate organization role body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.name.message == messageList.ORG_ROLE_NAME_REQUIRED &amp;&amp;\n                res.body.error.projects.message == messageList.ORG_PROJECT_SET_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0d4ae46-38a5-4375-bba0-f9b8e24b0f79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allow to create organization role with duplicate name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should not allow to create organization role with duplicate name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role5\&quot;;\nrole.projects = [_data.org_projects[0].uid, _data.org_projects[1].uid];\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                .send(role)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.ORG_DUPLICATE_ROLE_NAME);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7fb5f07d-ade1-4329-9d2e-0024ff3c8fa7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allow to create organization role to user of other role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should not allow to create organization role to user of other role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role3\&quot;;\nrole.projects = [_data.org_projects[0].uid];\napi.post(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e8d5596-a0f6-4b55-9b93-432b0e600b92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.create Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role3\&quot;;\napi.post(apiURL)\n    .send(role)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f163e5b8-89f5-481d-91e2-039ee7ff4421&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;479d7009-d6e3-46e0-85b5-1cf1f55645e5&quot;,&quot;c52ff877-ced2-4352-9b89-863770d1e71c&quot;,&quot;b0d4ae46-38a5-4375-bba0-f9b8e24b0f79&quot;,&quot;7fb5f07d-ade1-4329-9d2e-0024ff3c8fa7&quot;,&quot;4e8d5596-a0f6-4b55-9b93-432b0e600b92&quot;,&quot;f163e5b8-89f5-481d-91e2-039ee7ff4421&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:79,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4e180a01-9cfc-48a7-a215-8bc0d0d14175&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;784cfd1b-fbf5-43bb-99b5-21a1238b3ba9&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b94bde8f-148c-4976-8851-e60eed9091d5&quot;,&quot;title&quot;:&quot;OrganizationRole.deleteRole&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fdb0e50b-c92c-4ad5-82f7-18842a9bbb08&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25f36c23-0d57-40fb-b6d3-5d30383338b2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete organization role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should delete organization role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;role3\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.ORG_ROLE_DELETED_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f6c7a8d-d22b-4762-a4fc-fcb59d9d528e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;role1\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e2fe9ad9-ec87-49af-8d4b-c5d1cde18332&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete Admin role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should not delete Admin role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;Admin\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_DELETE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;173fea8b-f46c-45de-8f9b-2cd64e3381d9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete Billing Manager role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should not delete Billing Manager role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;Billing Manager\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_DELETE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27583076-d45d-41f3-bce1-3f7db2a313e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete Developer role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should not delete Developer role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;Developer\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_DELETE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0bb969ab-8371-4cc7-8265-9e1657d89262&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete role if it is used.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should not delete role if it is used.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid/roles\&quot;.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role3\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, _data.roles[\&quot;role3\&quot;].uid))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.BAD_REQUEST)\n                    .end(function(err, res) {\n                        res.body.error.message.should.equal(messageList.ORG_ASSIGNED_ROLE_DELETE_ERROR);\n                        done();\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6ffca429-e864-4403-8c80-aa5aa16ad005&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete role if it is unused.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should delete role if it is unused.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid/roles\&quot;.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role3\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, _data.roles[\&quot;role3\&quot;].uid))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.BAD_REQUEST)\n                    .end(function(err, res) {\n                        if (res.body.error.message == messageList.ORG_ASSIGNED_ROLE_DELETE_ERROR) {\n                            api.put(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid/roles\&quot;.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n                                .send({\n                                    org_roles: []\n                                })\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, _data.roles[\&quot;role3\&quot;].uid))\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    res.body.output.message.should.equal(messageList.ORG_ROLE_DELETED_SUCCESS);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                        } else {\n                            true.should.equal(false);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36b11347-7442-4fb8-9c5c-a767a3a20d02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete role if used user is removed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should delete role if used user is removed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid/roles\&quot;.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role3\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, _data.roles[\&quot;role3\&quot;].uid))\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.BAD_REQUEST)\n                    .end(function(err, res) {\n                        if (res.body.error.message == messageList.ORG_ASSIGNED_ROLE_DELETE_ERROR) {\n                            api.delete(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid\&quot;.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n                                .send({})\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, _data.roles[\&quot;role3\&quot;].uid))\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    res.body.output.message.should.equal(messageList.ORG_ROLE_DELETED_SUCCESS);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                        } else {\n                            true.should.equal(false);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c663122f-1caf-45aa-8751-589b16a6ec28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allow to delete organization role to user of other role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should not allow to delete organization role to user of other role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;role1\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b5516f3-2c8f-40e4-b5b8-6a9ff9f59a8e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.deleteRole Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;role1\&quot;].uid;\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05f17fcd-dfa7-4a7a-9aa3-f41fff348c05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2f6c7a8d-d22b-4762-a4fc-fcb59d9d528e&quot;,&quot;e2fe9ad9-ec87-49af-8d4b-c5d1cde18332&quot;,&quot;173fea8b-f46c-45de-8f9b-2cd64e3381d9&quot;,&quot;27583076-d45d-41f3-bce1-3f7db2a313e6&quot;,&quot;0bb969ab-8371-4cc7-8265-9e1657d89262&quot;,&quot;6ffca429-e864-4403-8c80-aa5aa16ad005&quot;,&quot;36b11347-7442-4fb8-9c5c-a767a3a20d02&quot;,&quot;c663122f-1caf-45aa-8751-589b16a6ec28&quot;,&quot;9b5516f3-2c8f-40e4-b5b8-6a9ff9f59a8e&quot;,&quot;05f17fcd-dfa7-4a7a-9aa3-f41fff348c05&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:208,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4b922890-ee9f-4bf7-bb36-e2fcbe8d0189&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8938bcc8-7526-499f-a93d-75977cd609c3&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3f77f9ea-5495-4890-bd98-347e63287c7a&quot;,&quot;title&quot;:&quot;OrganizationRole.list&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a799c399-6c52-40de-acd8-8c37e1a5c595&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;725914ae-769a-4173-9712-8646a57b12b6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should list organization roles.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should list organization roles.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.count != 0 &amp;&amp;\n                    res.body.output.objects.length &gt; 0;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0e3c7b9-39d4-409c-acea-35aa0f51471b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c69a2bbc-7efa-4b50-92a3-d126c7543abe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should sort organization roles.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should sort organization roles.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n    \&quot;?skip=2&amp;limit=2&amp;field=name&amp;direction=desc\&quot;;\napi.get(orgGetUrl)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.count != 0 &amp;&amp;\n                    res.body.output.objects.length == 2;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69368c5e-c349-45b6-9c83-565b764ad40d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list of two organization roles.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should list of two organization roles.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;var orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n    \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(orgGetUrl)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.count != 0 &amp;&amp;\n                    res.body.output.objects.length == 2;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e236853b-0222-4119-983d-772c3a9c983f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list of filter roles.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should list of filter roles.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n    \&quot;?query=role1\&quot;;\napi.get(orgGetUrl)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.count != 0 &amp;&amp;\n                    res.body.output.objects.length == 1;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d1a0989-ea92-47b7-a6fc-11027259ddec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give admin role required error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should give admin role required error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n                api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n                            done();\n                        }\n                    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;feea0d54-26f5-4a21-90d3-4917e88a3812&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.list Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2c78e2e-a45d-4081-a8b1-8c8f699e38ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c0e3c7b9-39d4-409c-acea-35aa0f51471b&quot;,&quot;c69a2bbc-7efa-4b50-92a3-d126c7543abe&quot;,&quot;69368c5e-c349-45b6-9c83-565b764ad40d&quot;,&quot;e236853b-0222-4119-983d-772c3a9c983f&quot;,&quot;3d1a0989-ea92-47b7-a6fc-11027259ddec&quot;,&quot;feea0d54-26f5-4a21-90d3-4917e88a3812&quot;,&quot;d2c78e2e-a45d-4081-a8b1-8c8f699e38ac&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:77,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;36ffc84e-5664-4148-a1bf-95f3bfc0fb7c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e93dbc41-9fec-4d32-b9ac-b9ec480c837f&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4345730f-7989-4e49-ba6d-9a179900013f&quot;,&quot;title&quot;:&quot;OrganizationRole.update&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationRole\\update.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19dcbaa4-f1da-4d6c-b3f9-715885dcaa17&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f166565a-e56a-4b28-a5ac-2302436db5a9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update organization role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should update organization role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;role2\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                res.body.output.name == role.name &amp;&amp;\n                res.body.output.projects.length == 1 &amp;&amp;\n                res.body.output.projects[0] == _data.org_projects[0].uid).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a95ed05-e302-492d-9567-6baef5b086eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give role not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should give role not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;role2\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, \&quot;FAKE_ROLE\&quot;))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_ROLE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e47a41d9-5bcd-40e1-9731-8bcbe6c2cae8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not update Admin role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should not update Admin role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;Admin\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_MODIFY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b46cbc91-40da-4e5a-9232-b0e0a4f4c304&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not update Billing Manager role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should not update Billing Manager role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;Billing Manager\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_MODIFY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c76373c7-8841-42c5-a112-0f1b027713cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not update Developer role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should not update Developer role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;Developer\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_DEFAULT_ROLE_CANNOT_MODIFY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e2b828bc-e4b3-49a7-86ab-1faad8bd1595&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;org2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;role2\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e460cbb6-16ff-44d9-8533-a6658f982b68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should validate organization role body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should validate organization role body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar org_role_uid = _data.roles[\&quot;role2\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.name.message == messageList.ORG_ROLE_NAME_REQUIRED &amp;&amp;\n                res.body.error.projects.message == messageList.ORG_PROJECT_SET_REQUIRED).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b9de2f1-cfd2-4164-9085-81d73d69e025&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update organization projects.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should update organization projects.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nrole.name = \&quot;role2\&quot;;\nrole.projects = [_data.org_projects[0].uid];\nvar org_role_uid = _data.roles[\&quot;role2\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                res.body.output.name == role.name &amp;&amp;\n                res.body.output.projects.length == 1 &amp;&amp;\n                res.body.output.projects[0] == _data.org_projects[0].uid).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0937b6a6-d6ad-4de3-98d2-554262ed08ef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allow to update organization role to user of other role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should not allow to update organization role to user of other role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nvar org_role_uid = _data.roles[\&quot;role1\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;149550aa-b4c4-43f1-90f8-428378ebc5cd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationRole.update Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar role = getImmutable(roleBody);\nvar org_role_uid = _data.roles[\&quot;role1\&quot;].uid;\napi.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_role_uid\&quot;, org_role_uid))\n    .send(role)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;854529fc-825a-498f-96f0-a775b60acffc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8a95ed05-e302-492d-9567-6baef5b086eb&quot;,&quot;e47a41d9-5bcd-40e1-9731-8bcbe6c2cae8&quot;,&quot;b46cbc91-40da-4e5a-9232-b0e0a4f4c304&quot;,&quot;c76373c7-8841-42c5-a112-0f1b027713cb&quot;,&quot;e2b828bc-e4b3-49a7-86ab-1faad8bd1595&quot;,&quot;e460cbb6-16ff-44d9-8533-a6658f982b68&quot;,&quot;8b9de2f1-cfd2-4164-9085-81d73d69e025&quot;,&quot;0937b6a6-d6ad-4de3-98d2-554262ed08ef&quot;,&quot;149550aa-b4c4-43f1-90f8-428378ebc5cd&quot;,&quot;854529fc-825a-498f-96f0-a775b60acffc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:201,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b4639d9a-be46-4d89-afac-3f7e17062347&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;52771e85-cc50-4b68-969a-5020792ced19&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8f82b75b-367c-4122-a89c-b4316ebd4053&quot;,&quot;title&quot;:&quot;OrganizationUser.assignedRoles&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\assignedRoles.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b616fd6-e460-4095-9481-a87caf747350&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e51aa1e-31c8-4c64-aeb7-24f00b83da9f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should assigned default project while assigning billing manger role.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles Should assigned default project while assigning billing manger role.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;Billing Manager\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                (res.body.output.roles[0].name == \&quot;Billing Manager\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c7d3151-2499-4eb8-8672-9b1dcc4fbf24&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should assigned new role to organization user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles Should assigned new role to organization user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role1\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.roles[0].name.should.equal(\&quot;role1\&quot;);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4131de29-3d5e-4167-a5be-f7b479dac287&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update allowed project list of user, if assigned roles changed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles Should update allowed project list of user, if assigned roles changed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role3\&quot;].uid]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.get(\&quot;/enterprise/v1/projects\&quot;)\n                    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        (res.body.output.projects || res.body.output.objects).length.should.equal(2);\n                        done();\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;498c4d8d-cc89-4272-9ec3-c5e2c8cf60c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.assignedRoles Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.put(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({\n            org_roles: [_data.roles[\&quot;role3\&quot;].uid]\n        })\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20ac3910-78fb-4b6a-84fd-06442731a416&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4c7d3151-2499-4eb8-8672-9b1dcc4fbf24&quot;,&quot;4131de29-3d5e-4167-a5be-f7b479dac287&quot;,&quot;498c4d8d-cc89-4272-9ec3-c5e2c8cf60c4&quot;,&quot;20ac3910-78fb-4b6a-84fd-06442731a416&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:64,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c5806c1d-049f-4ca7-9461-f43bc6a18091&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;39ec5a46-8f5c-4ede-8298-139d1ed0814b&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9d3e8b0d-ce26-431c-81ad-2b97cc2a7ef0&quot;,&quot;title&quot;:&quot;OrganizationUser.currentUser&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\currentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f65afecf-e6e7-4822-be0f-09d20c3d9eb2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3759821a-1423-46d6-b4ed-00f710364bad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get owner information in currentuser call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get owner information in currentuser call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ab2b399-64ea-447b-b634-c2d6ddd8f9aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get access for owner if SSO is enabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get access for owner if SSO is enabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                            .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                        typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;928d901a-75b2-4d4e-83b1-a96dbe80903f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get access for admin if SSO is enabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should not get access for admin if SSO is enabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.ACCESS_DENIED);\n                                    done();\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;837cdd1f-e7f0-4bb6-a64a-a5e1da01be31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get access for developer if SSO is enabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should not get access for developer if SSO is enabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                            .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.ACCESS_DENIED);\n                                    done();\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66440b3a-d12d-47e0-a890-0064f43fd757&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get access for role1 if SSO is enabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should not get access for role1 if SSO is enabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n        var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n            .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n            .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, _data.organization.uid))\n                    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;org_uid&#x27;, _data.organization.uid)\n                            .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.ACCESS_DENIED);\n                                    done();\n                                }\n                            });\n                    });\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ccf8a346-c79e-4303-8db0-4c8e3c85bb13&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization owner information in currentuser call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization owner information in currentuser call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;199f1905-a5da-4903-823f-a950a48a075b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization owner and sso information in currentuser call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization owner and sso information in currentuser call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n    .set(&#x27;authtoken&#x27;, _data.owner.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bac4cefa-e1ab-45b1-9497-a08282b8d61d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization information in currentuser call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization information in currentuser call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n            if (isValid) {\n                _.each(res.body.output.organizations, function(orgItem) {\n                    isValid = isValid &amp;&amp;\n                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                });\n                isValid.should.equal(true);\n                done();\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6beaa4b5-e97c-4287-b3c8-e2628f7dc8ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization information in login call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization information in login call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: _data.developer.email,\n        \&quot;password\&quot;: \&quot;Raw@1234\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n            if (isValid) {\n                _.each(res.body.output.organizations, function(orgItem) {\n                    isValid = isValid &amp;&amp;\n                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                });\n                isValid.should.equal(true);\n                done();\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;919a3359-defd-4322-9644-01531071086d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization information in gmail login call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization information in gmail login call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n    \&quot;email\&quot;: _data.developer.email\n});\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send({\n        \&quot;access_token\&quot;: \&quot;ya29.CjaXA59GmnRCMOCYxSm8kPuqY1H4k10wipfcQF6gFxAyAZXaokdxwQTW0ViQ1fG9m7-JVBkaUsM\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n            if (isValid) {\n                _.each(res.body.output.organizations, function(orgItem) {\n                    isValid = isValid &amp;&amp;\n                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                });\n                isValid.should.equal(true);\n                done();\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce0f1b1a-ecbd-4f59-9d6e-e46566b0a191&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization information in currentuser call of organization for Admin.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization information in currentuser call of organization for Admin.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n            if (isValid) {\n                _.each(res.body.output.organizations, function(orgItem) {\n                    isValid = isValid &amp;&amp;\n                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                });\n                isValid.should.equal(true);\n                done();\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;929a73d0-f4cb-4874-8b19-9e00c58cb2a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organization information in currentuser call of organization for Billing Manager.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.currentUser Should get organization information in currentuser call of organization for Billing Manager.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;org_uid&#x27;, _data.organization.uid)\n    .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.organizations) != \&quot;undefined\&quot;;\n            if (isValid) {\n                _.each(res.body.output.organizations, function(orgItem) {\n                    isValid = isValid &amp;&amp;\n                        typeof(orgItem._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_uid) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.org_name) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(orgItem.avatar) != \&quot;undefined\&quot;;\n                });\n                isValid.should.equal(true);\n                done();\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;165b8055-1498-4047-80f1-0175fcdb64e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7ab2b399-64ea-447b-b634-c2d6ddd8f9aa&quot;,&quot;928d901a-75b2-4d4e-83b1-a96dbe80903f&quot;,&quot;837cdd1f-e7f0-4bb6-a64a-a5e1da01be31&quot;,&quot;66440b3a-d12d-47e0-a890-0064f43fd757&quot;,&quot;ccf8a346-c79e-4303-8db0-4c8e3c85bb13&quot;,&quot;199f1905-a5da-4903-823f-a950a48a075b&quot;,&quot;bac4cefa-e1ab-45b1-9497-a08282b8d61d&quot;,&quot;6beaa4b5-e97c-4287-b3c8-e2628f7dc8ba&quot;,&quot;919a3359-defd-4322-9644-01531071086d&quot;,&quot;ce0f1b1a-ecbd-4f59-9d6e-e46566b0a191&quot;,&quot;929a73d0-f4cb-4874-8b19-9e00c58cb2a4&quot;,&quot;165b8055-1498-4047-80f1-0175fcdb64e1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:523,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2b487d58-2b7f-4882-9ffb-48b05cec74bf&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dc195b7a-1de4-4d37-93ea-f775fdb69468&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;29e89146-65ba-446f-b4c9-506223b15aa7&quot;,&quot;title&quot;:&quot;OrganizationUser.deleteOrgUser&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\delete.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b08d0270-60ab-4e52-9ef6-e6b3d9a16aa0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d991a85-293c-4862-894d-cf3474694e42&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete organization user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should delete organization user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.role1.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.ORG_USER_DELETED_SUCCESS);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9ab3bf4-3618-457c-afcd-46d2250aae57&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete organization admin user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should delete organization admin user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.admin.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.ORG_USER_DELETED_SUCCESS);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a314fec-3871-4261-ac92-d9de3a1ebd28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.role1.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.NOT_FOUND)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ece6104-5e60-4b29-aaaf-32db3472166f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete Admin user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should delete Admin user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.admin.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.ORG_USER_DELETED_SUCCESS);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c916cc82-aa3d-4bb8-ab6e-58f60f2a4bf3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete Billing Manager user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should delete Billing Manager user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    user_uid: _data.billing_manager.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.ORG_USER_DELETED_SUCCESS);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a66519a4-9e30-4bbc-8c9f-706c3a8b3341&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete owner.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should not delete owner.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.owner.uid\n}, function(err, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_OWNER_CANNOT_BE_DELETED);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2803c17-2f57-4436-81da-815906de88b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give user not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should give user not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, \&quot;ABC\&quot;))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_USER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9de25642-b0b3-4bc1-9b6f-327cbbbbeccc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to delete user to Developer user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should not allowed to delete user to Developer user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.role1.uid\n}, function(err, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, _data.developer.authtoken)\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;370c6040-6bf0-461f-94ba-b214debf180e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to delete user to Billing Manager user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should not allowed to delete user to Billing Manager user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.role1.uid\n}, function(err, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, _data.billing_manager.authtoken)\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_NOT_ADMIN);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;96bbfa8f-4bc3-486d-9115-811c3480353f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete owner.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should not delete owner.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.owner.uid\n}, function(err, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.ORG_OWNER_CANNOT_BE_DELETED);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8e3c395-a72d-439c-a4ff-15d30b38df2b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.deleteOrgUser Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.owner.uid\n}, function(err, orgUser) {\n    api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid).replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;703e6744-b91a-4376-85ae-9594b1bc41e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b9ab3bf4-3618-457c-afcd-46d2250aae57&quot;,&quot;8a314fec-3871-4261-ac92-d9de3a1ebd28&quot;,&quot;5ece6104-5e60-4b29-aaaf-32db3472166f&quot;,&quot;c916cc82-aa3d-4bb8-ab6e-58f60f2a4bf3&quot;,&quot;a66519a4-9e30-4bbc-8c9f-706c3a8b3341&quot;,&quot;a2803c17-2f57-4436-81da-815906de88b0&quot;,&quot;9de25642-b0b3-4bc1-9b6f-327cbbbbeccc&quot;,&quot;370c6040-6bf0-461f-94ba-b214debf180e&quot;,&quot;96bbfa8f-4bc3-486d-9115-811c3480353f&quot;,&quot;b8e3c395-a72d-439c-a4ff-15d30b38df2b&quot;,&quot;703e6744-b91a-4376-85ae-9594b1bc41e0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:119,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;816d0b48-ce9b-4db3-80a3-5731ba605613&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;db00c4f6-230a-42e3-88e4-89d10e77367b&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;221c7024-32cd-4e61-8dec-562bdb57476a&quot;,&quot;title&quot;:&quot;OrganizationUser.list&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\list.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd7268be-a2b6-47bc-a303-2b66552f48c7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e05a3a3-446d-47ae-a50a-0059d8cf92ae&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should list organization users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should list organization users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.count &gt; 0;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f1ff3ae-4efe-45ab-9234-02c41463b204&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:140,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nfetchRoles({\n    done: done,\n    org_uid: org_uid\n}, function(res) {\n    inviteUsers({\n        roles: res.body.output.objects,\n        user_uid: user_uid,\n        org_uid: org_uid\n    }, function() {\n        api.get(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.NOT_FOUND)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de663fd7-ef55-499f-bf10-1698d22e7174&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should sort organization users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should sort organization users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:146,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nfetchRoles({\n    done: done,\n    org_uid: org_uid\n}, function(res) {\n    inviteUsers({\n        roles: res.body.output.objects,\n        user_uid: user_uid,\n        org_uid: org_uid\n    }, function() {\n        var orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n            \&quot;?skip=2&amp;limit=2&amp;field=email&amp;direction=desc\&quot;;\n        api.get(orgGetUrl)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var isValid = false;\n                    if (Array.isArray(res.body.output.objects)) {\n                        isValid = res.body.output.count != 0 &amp;&amp;\n                            res.body.output.objects.length == 2;\n                        _.each(res.body.output.objects, function(item) {\n                            isValid = isValid &amp;&amp;\n                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(item.__v) == \&quot;undefined\&quot;;\n                        });\n                    }\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;713665b8-e17a-46ef-b620-2ec8d929674f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list two items of organization users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should list two items of organization users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:141,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nfetchRoles({\n    done: done,\n    org_uid: org_uid\n}, function(res) {\n    inviteUsers({\n        roles: res.body.output.objects,\n        user_uid: user_uid,\n        org_uid: org_uid\n    }, function() {\n        var orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n            \&quot;?skip=2&amp;limit=2\&quot;;\n        api.get(orgGetUrl)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var isValid = false;\n                    if (Array.isArray(res.body.output.objects)) {\n                        isValid = res.body.output.count != 0 &amp;&amp;\n                            res.body.output.objects.length == 2;\n                        _.each(res.body.output.objects, function(item) {\n                            isValid = isValid &amp;&amp;\n                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(item.__v) == \&quot;undefined\&quot;;\n                        });\n                    }\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fa295bf-21de-4153-9dcc-ec10a317384d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list of filter users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should list of filter users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:139,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nfetchRoles({\n    done: done,\n    org_uid: org_uid\n}, function(res) {\n    inviteUsers({\n        roles: res.body.output.objects,\n        user_uid: user_uid,\n        org_uid: org_uid\n    }, function() {\n        var orgGetUrl = apiURL.replace(\&quot;:org_uid\&quot;, org_uid) +\n            \&quot;?query=test.user+1\&quot;;\n        api.get(orgGetUrl)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var isValid = false;\n                    if (Array.isArray(res.body.output.objects)) {\n                        isValid = res.body.output.count != 0 &amp;&amp;\n                            res.body.output.objects.length &gt; 0;\n                        _.each(res.body.output.objects, function(item) {\n                            isValid = isValid &amp;&amp;\n                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(item.__v) == \&quot;undefined\&quot;;\n                        });\n                    }\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a546b5da-b104-4f2f-8dad-ea38ff750403&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get invitation object null after accepting invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should get invitation object null after accepting invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:132,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\napi.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({\n        \&quot;org_roles\&quot;: [_data.roles[\&quot;Developer\&quot;].uid],\n        \&quot;emails\&quot;: [email]\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                signUpUser({\n                    done: done,\n                    email: email\n                }, function(res) {\n                    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invitation/accept\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                        .send({})\n                        .set(&#x27;authtoken&#x27;, res.body.output.authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = false;\n                                        if (Array.isArray(res.body.output.objects)) {\n                                            isValid = res.body.output.count &gt; 0;\n                                            _.each(res.body.output.objects, function(item) {\n                                                isValid = isValid &amp;&amp;\n                                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                    item.invitation == null;\n                                            });\n                                        }\n                                        isValid.should.equal(true);\n                                        done();\n                                    }\n                                });\n                        });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;abd2f8a9-cfad-45b5-83d3-1d989fdb9cfd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list re-invited organization user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should list re-invited organization user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:171,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar user_uid = \&quot;\&quot;;\nvar email = _data.developer.email;\nvar inviteUser = function(callback) {\n    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles.Developer.uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    var tempLoginBody = getImmutable(loginBody);\n                    tempLoginBody.email = email;\n                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                        .send(tempLoginBody)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var userAuthToken = res.body.output.authtoken;\n                                api.post(\&quot;/enterprise/v1/organizations/:org_uid/invitation/accept\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                                    .send({})\n                                    .set(&#x27;authtoken&#x27;, userAuthToken)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                                            .set(&#x27;authtoken&#x27;, userAuthToken)\n                                            .set(&#x27;org_uid&#x27;, org_uid)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    user_uid = res.body.output.uid;\n                                                    _models.OrganizationUser.findOne({\n                                                        user_uid: user_uid,\n                                                        org_uid: org_uid,\n                                                        deleted_at: null\n                                                    }).lean().exec(function(err, orgUser) {\n                                                        callback(err, orgUser);\n                                                    });\n                                                }\n                                            });\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\n\n_models.OrganizationUser.findOne({\n    org_uid: org_uid,\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                api.delete(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid\&quot;\n                        .replace(\&quot;:org_uid\&quot;, org_uid)\n                        .replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n                    .send({})\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            if (res.body.output.message == messageList.ORG_USER_DELETED_SUCCESS) {\n                                inviteUser(function(error, orgUser) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = false;\n                                                    if (Array.isArray(res.body.output.objects)) {\n                                                        isValid = res.body.output.count &gt; 0;\n                                                        _.each(res.body.output.objects, function(item) {\n                                                            isValid = isValid &amp;&amp;\n                                                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                typeof(item.__v) == \&quot;undefined\&quot;;\n                                                        });\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4146d5e4-566c-4775-b732-5477b53d6a1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should list re-invited organization user before accepting second invitation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should list re-invited organization user before accepting second invitation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar user_uid = \&quot;\&quot;;\nvar email = _data.developer.email;\nvar inviteUser = function(callback) {\n    api.post(\&quot;/enterprise/v1/organizations/:org_uid/invite\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n        .send({\n            \&quot;org_roles\&quot;: [_data.roles.Developer.uid],\n            \&quot;emails\&quot;: [email]\n        })\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_INVITATION_SEND) {\n                    callback(err, res);\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\n\n_models.OrganizationUser.findOne({\n    user_uid: _data.developer.uid\n}).lean().exec(function(error, orgUser) {\n    api.delete(\&quot;/enterprise/v1/organizations/:org_uid/users/:org_user_uid\&quot;\n            .replace(\&quot;:org_uid\&quot;, org_uid)\n            .replace(\&quot;:org_user_uid\&quot;, orgUser.uid))\n        .send({})\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.body.output.message == messageList.ORG_USER_DELETED_SUCCESS) {\n                    inviteUser(function(error, orgUser) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = false;\n                                        if (Array.isArray(res.body.output.objects)) {\n                                            isValid = res.body.output.count &gt; 0;\n                                            _.each(res.body.output.objects, function(item) {\n                                                isValid = isValid &amp;&amp;\n                                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                                            });\n                                        }\n                                        isValid.should.equal(true);\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e17ed1be-59ad-4903-a930-635942e32dc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.list Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:130,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar email = \&quot;test.user+1@raweng.com\&quot;;\nfetchRoles({\n    done: done,\n    org_uid: org_uid\n}, function(res) {\n    inviteUsers({\n        roles: res.body.output.objects,\n        user_uid: user_uid,\n        org_uid: org_uid\n    }, function() {\n        api.get(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n            .expect(httpStatus.UNAUTHORIZED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e18f449-983d-4e17-91a3-1b1a3346a8e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1f1ff3ae-4efe-45ab-9234-02c41463b204&quot;,&quot;de663fd7-ef55-499f-bf10-1698d22e7174&quot;,&quot;713665b8-e17a-46ef-b620-2ec8d929674f&quot;,&quot;0fa295bf-21de-4153-9dcc-ec10a317384d&quot;,&quot;a546b5da-b104-4f2f-8dad-ea38ff750403&quot;,&quot;abd2f8a9-cfad-45b5-83d3-1d989fdb9cfd&quot;,&quot;4146d5e4-566c-4775-b732-5477b53d6a1a&quot;,&quot;e17ed1be-59ad-4903-a930-635942e32dc6&quot;,&quot;9e18f449-983d-4e17-91a3-1b1a3346a8e5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1060,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9cb1219c-65a4-4353-bb0c-fb1ea860695f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b5f7a174-d65b-4f86-8759-1196d0c4a42e&quot;,&quot;title&quot;:&quot;Organization&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;84874aa2-c2ae-4b21-afd9-d5a83caee4dc&quot;,&quot;title&quot;:&quot;OrganizationUser.removeSelf&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\organizationUser\\removeSelf.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        _data = data;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cfa37176-929c-436d-8a08-b3e90c976557&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;992cbeb3-1237-466d-a85b-d9e89fd68ae0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should left organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf Should left organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.ORG_USER_LEFT_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79bf6d9d-a5c9-41a9-9a54-fb5979097307&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should left organization if SSO is enable.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf Should left organization if SSO is enable.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar config = getImmutable(ssoConfig);\napi.put(\&quot;/enterprise/v1/organizations/:org_uid/ssoconfig\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send(config)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                res.body.output.sso_details.entry_point == config.entry_point &amp;&amp;\n                res.body.output.sso_details.algo_type == config.algo_type &amp;&amp;\n                res.body.output.sso_details.session_time_out_hours == config.session_time_out_hours\n            if (isValid) {\n                var publicKeyFile = __dirname + \&quot;/../../../__cert/okta.cert\&quot;;\n                var privateKeyFile = __dirname + \&quot;/../../../__cert/SP1.pem\&quot;;\n                api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/certs\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                    .set(&#x27;authtoken&#x27;, _data.admin.authtoken)\n                    .attach(&#x27;signed_public_key&#x27;, publicKeyFile)\n                    .attach(&#x27;enc_private_key&#x27;, privateKeyFile)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        api.post(\&quot;/enterprise/v1/organizations/:org_uid/sso/enable\&quot;.replace(\&quot;:org_uid\&quot;, org_uid))\n                            .send({})\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.output.enable_sso) {\n                                        api.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    res.body.output.message.should.equal(messageList.ORG_USER_LEFT_SUCCESS);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                        done();\n                                    }\n                                }\n                            });\n                    });\n            } else {\n                isValid.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0f7a6d6-a90a-4ba0-a171-524a910fd185&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give organization not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf Should give organization not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, \&quot;FAKE_ORG\&quot;))\n    .send({})\n    .set(&#x27;authtoken&#x27;, _data.role1.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;35a6c3e7-a690-4e09-8767-3b58ad3f7072&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Owner sholud not leave organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf Owner sholud not leave organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ORG_OWNER_LEAVE_NOT_ALLOWED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;169448a9-4057-4fad-a3cf-c84aba49edb3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Organization OrganizationUser.removeSelf Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL.replace(\&quot;:org_uid\&quot;, org_uid))\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d76ab4d-f102-4fbe-a809-4ce5baa1bcc1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;79bf6d9d-a5c9-41a9-9a54-fb5979097307&quot;,&quot;f0f7a6d6-a90a-4ba0-a171-524a910fd185&quot;,&quot;35a6c3e7-a690-4e09-8767-3b58ad3f7072&quot;,&quot;169448a9-4057-4fad-a3cf-c84aba49edb3&quot;,&quot;2d76ab4d-f102-4fbe-a809-4ce5baa1bcc1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:120,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b1caffe7-335b-4d92-a215-37ca4cd592ca&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8705a8ee-b843-4a2d-812f-62252f5c668c&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7c90b745-202c-48db-a75f-6e39b48f4b27&quot;,&quot;title&quot;:&quot;Payment.cancelBraintreeSubscription&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\cancelBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.cancelBraintreeSubscription \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:149,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                _braintreeCustId = res.body.output.braintree_customerId;\n                _userUid = res.body.output.uid;\n                subscribedPayload.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                subscribedCanceledPayload.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                //commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                    .send(saveCardBody)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\n                            api.post(\&quot;/v1/webhook/subscription/start\&quot;)\n                                .send(subscribedPayload)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec268f4a-7ede-4634-abb5-d5bb00809cba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.cancelBraintreeSubscription \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7da4b9a6-7088-4e67-b9f0-f2162debde17&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should cancel subscription.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.cancelBraintreeSubscription Should cancel subscription.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscribedCanceledPayload)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            api.get(\&quot;/enterprise/v1/user\&quot;)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    // After cancelation of subcription default plans get set.\n                    commonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\n                    commonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\n                    api.get(\&quot;/enterprise/v1/user/account/subscription\&quot;)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                (res.body.output.billingDetails.firstName ==\n                                    registrationBody.first_name + \&quot; \&quot; + registrationBody.last_name).should.equal(true);\n                                done();\n                            }\n                        });\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5da4ae5-4b8c-4c54-baf4-87154b7a6222&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should cancel subscription org user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.cancelBraintreeSubscription Should cancel subscription org user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n    var temp_subscribedCanceledPayload = getImmutable(subscribedCanceledPayload);\n    temp_subscribedCanceledPayload.options.braintree_customerId = data.organization_account.braintree_customerId;\n    api.post(apiURL)\n        .send(temp_subscribedCanceledPayload)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var org_uid = data.organization.uid;\n                var org_owner_authtoken = data.organization.uid;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ea88bf2-8612-4cd3-8efd-58c73ba2d55d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a5da4ae5-4b8c-4c54-baf4-87154b7a6222&quot;,&quot;8ea88bf2-8612-4cd3-8efd-58c73ba2d55d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:156,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6562f0be-a32e-4c8b-80c3-3d171e1d40f9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c28082b3-1284-404b-973f-e22c7b6e9ea8&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4dca5b9a-5e94-46f4-83fa-6be0746c68ce&quot;,&quot;title&quot;:&quot;Payment.createBraintreeSubscription&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\createBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.createBraintreeSubscription \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:124,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                _braintreeCustId = res.body.output.braintree_customerId;\n                _userUid = res.body.output.uid;\n                subscribedPayload.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                    .send(saveCardBody)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47e4c4d7-9862-41c8-9ca8-c8acc80bac8f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.createBraintreeSubscription \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2bcd09d3-6967-48dd-86f5-e62cc89bbabb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should subscribed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.createBraintreeSubscription Should subscribed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscribedPayload)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            api.get(\&quot;/enterprise/v1/user\&quot;)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    var _userUid = res.body.output.uid;\n                    var braintree_subscriptionId = res.body.output.braintree_subscriptionId;\n                    var isValid = _userUid != \&quot;\&quot; &amp;&amp;\n                        braintree_subscriptionId != \&quot;\&quot;;\n                    isValid.should.equal(true);\n                    done();\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd0515c0-53cd-4a9d-94e1-66762afc10f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should subscribed for org user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.createBraintreeSubscription Should subscribed for org user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n    commonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\n    var temp_subscribedPayload = getImmutable(subscribedPayload);\n    temp_subscribedPayload.options.braintree_customerId = data.organization_account.braintree_customerId;\n    api.post(apiURL)\n        .send(temp_subscribedPayload)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                _models.User.findOne({\n                    braintree_customerId: data.organization_account.braintree_customerId\n                }, function(error, user) {\n                    var braintree_subscriptionId = user.braintree_subscriptionId;\n                    var isValid = braintree_subscriptionId != \&quot;\&quot;;\n                    isValid.should.equal(true);\n                    done();\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f072ffb-998f-49ac-881a-973e8b1b370b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should reset credit limit email flag.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.createBraintreeSubscription Should reset credit limit email flag.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User._findOneAndUpdate({ \&quot;uid\&quot;: _userUid }, { credit_limit_email: true }, function(err, feature) {\n    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n    commonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\n    api.post(apiURL)\n        .send(subscribedPayload)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        var _userUid = res.body.output.uid;\n                        var braintree_subscriptionId = res.body.output.braintree_subscriptionId;\n                        var credit_limit_email = res.body.output.credit_limit_email;\n                        var isValid = _userUid != \&quot;\&quot; &amp;&amp;\n                            braintree_subscriptionId != \&quot;\&quot; &amp;&amp;\n                            credit_limit_email == false;\n                        isValid.should.equal(true);\n                        done();\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f9dda94-7fb0-4692-88e9-c77bc77b39ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cd0515c0-53cd-4a9d-94e1-66762afc10f4&quot;,&quot;4f072ffb-998f-49ac-881a-973e8b1b370b&quot;,&quot;6f9dda94-7fb0-4692-88e9-c77bc77b39ea&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:142,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dbe602db-c951-4ec8-ae95-f08f7a5abcfd&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3670b53d-2c3c-4a15-9b97-e92f0449a500&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;239a9892-2401-4ef5-917f-ef19463d464a&quot;,&quot;title&quot;:&quot;Payment.disableAccount&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\disableAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.disableAccount \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:129,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                    commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                    api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                        .send(saveCardBody)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                done();\n                            }\n                        });\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ab16ad6-de74-4d55-8394-c541a93a6580&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.disableAccount \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1355fb02-3415-4a19-bcea-82ea8398ec1e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should disable register user plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.disableAccount Should disable register user plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.force_suspend == false &amp;&amp;\n                res.body.output.set_disable_status &amp;&amp;\n                typeof(res.body.output.authtoken) == \&quot;string\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e759ecd5-9362-4701-ae47-f4f7c8d55b27&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.disableAccount Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;657e7ea0-a922-44a2-89ba-b8c718dec6ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e759ecd5-9362-4701-ae47-f4f7c8d55b27&quot;,&quot;657e7ea0-a922-44a2-89ba-b8c718dec6ac&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8f08e365-f5c7-4b8d-bcef-c8e81ddfeaed&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e85fa92e-d3af-4ed7-852f-0c42d7cd4030&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ed0cae18-6f3e-4884-be05-748902928f48&quot;,&quot;title&quot;:&quot;Payment.errorWhileBraintreeSubscription&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\errorWhileBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:127,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                _braintreeCustId = res.body.output.braintree_customerId;\n                _userUid = res.body.output.uid;\n                subscriptionError.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                    .send(saveCardBody)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d61b42e4-e536-43ec-b05a-017c7cfa2b4c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57112a36-81b7-41a5-8931-8f46a5baa7c3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should increment subscription failure count&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription Should increment subscription failure count&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscriptionError)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            api.get(\&quot;/enterprise/v1/user\&quot;)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    res.body.output.subscription_failure_count.should.equal(1);\n                    done();\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;527009a0-6b4f-4ca2-8199-6d7e69eb0b15&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should increment subscription failure count for org user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription Should increment subscription failure count for org user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n    var temp_subscriptionError = getImmutable(subscriptionError);\n    temp_subscriptionError.options.braintree_customerId = data.organization_account.braintree_customerId;\n    api.post(apiURL)\n        .send(temp_subscriptionError)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                _models.User.findOne({\n                    uid: data.organization.user_uid\n                }, function(error, user) {\n                    user.subscription_failure_count.should.equal(1);\n                    done();\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;26026e24-0e29-4f4f-98fc-bb37f749f899&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should suspend user, if subscription failure count is greater than two.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription Should suspend user, if subscription failure count is greater than two.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscriptionError)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(subscriptionError)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(subscriptionError)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    _models.User.findOne({\n                                        uid: _userUid\n                                    }, function(error, user) {\n                                        user.force_suspend.should.equal(true);\n                                        done();\n                                    });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c29dc47c-f728-4a46-b658-8a4ebc2a5110&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should suspend user, if subscription failure count is greater than two for org user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.errorWhileBraintreeSubscription Should suspend user, if subscription failure count is greater than two for org user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    var temp_subscriptionError = getImmutable(subscriptionError);\n    temp_subscriptionError.options.braintree_customerId = data.organization_account.braintree_customerId;\n    _models.User.findOneAndUpdate({\n        braintree_customerId: temp_subscriptionError.options.braintree_customerId\n    }, {\n        subscription_failure_count: 5\n    }, { new: true }, function(error, user) {\n        commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n        api.post(apiURL)\n            .send(temp_subscriptionError)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    _models.User.findOne({\n                        uid: data.organization_account.uid\n                    }, function(error, user) {\n                        user.force_suspend.should.equal(true);\n                        done();\n                    });\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0cffb99-95ad-43c1-9794-814ce387afa7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;527009a0-6b4f-4ca2-8199-6d7e69eb0b15&quot;,&quot;26026e24-0e29-4f4f-98fc-bb37f749f899&quot;,&quot;c29dc47c-f728-4a46-b658-8a4ebc2a5110&quot;,&quot;b0cffb99-95ad-43c1-9794-814ce387afa7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:184,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;aaeb36b5-3d4a-4cf7-b2b2-fee9bf1719cb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bec2ea4e-7b16-489f-9530-f5d65100069a&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fad49778-b167-4ef6-9e7d-c1c1dbce7270&quot;,&quot;title&quot;:&quot;Payment.expiredInBraintreeSubscription&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\expiredInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.expiredInBraintreeSubscription \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:138,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                _braintreeCustId = res.body.output.braintree_customerId;\n                _userUid = res.body.output.uid;\n                subscribedPayload.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                subscriptionExpire.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                    .send(saveCardBody)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\n                            api.post(\&quot;/v1/webhook/subscription/start\&quot;)\n                                .send(subscribedPayload)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5210a377-2a5f-45b5-b8d6-34786cbcaaad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.expiredInBraintreeSubscription \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11cbe962-d6e5-4b9b-baeb-cff1f6850754&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should expired subscription.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.expiredInBraintreeSubscription Should expired subscription.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscriptionExpire)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            api.get(\&quot;/enterprise/v1/user\&quot;)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.force_suspend &amp;&amp;\n                            res.body.output.uid == _userUid;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e51f4a14-c3b7-4e0b-961f-c13a6d771f97&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should expired subscription for org user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.expiredInBraintreeSubscription Should expired subscription for org user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n    var temp_subscriptionExpire = getImmutable(subscriptionExpire);\n    temp_subscriptionExpire.options.braintree_customerId = data.organization_account.braintree_customerId;\n    api.post(apiURL)\n        .send(temp_subscriptionExpire)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                _models.User.findOne({\n                    uid: data.organization.user_uid\n                }, function(error, user) {\n                    user.force_suspend.should.equal(true);\n                    done();\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f05fbfde-9a26-4cfa-914b-88555384cb5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e51f4a14-c3b7-4e0b-961f-c13a6d771f97&quot;,&quot;f05fbfde-9a26-4cfa-914b-88555384cb5a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:107,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3a556120-51b8-4eb8-9272-a634d0fc5d3a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;aa36478f-2f75-468b-a2de-bdd142257899&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;19951a49-ce53-40db-b2df-8be779dcf0d3&quot;,&quot;title&quot;:&quot;Payment.getBillByUIDOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillByUIDOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillByUIDOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1235,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/projects\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                project_uid = _.first(res.body.output.projects).uid\n                saveBillEntries(\n                    _.extend(getImmutable(billBody), {\n                        authtoken: authToken\n                    }),\n                    function(error, bills) {\n                        savedBills = bills;\n                        done();\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0106fbe-6bb5-4ad1-badd-836fcc139409&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillByUIDOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f85897f6-4e63-4aa8-8123-124c39922520&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should gives bill on providing bill uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillByUIDOrg Should gives bill on providing bill uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:bill_uid\&quot;, savedBills[0].body.output.uid);\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(savedBills[0].body.output.uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c1510a4-165d-426d-bb4d-b58d37b41ed2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bill on providing wrong bill uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillByUIDOrg Should not gives bill on providing wrong bill uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:bill_uid\&quot;, \&quot;flabc\&quot;);\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;94c20b18-1bb5-41d8-9003-74ad7dca68bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillByUIDOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;61c6f52f-1087-4291-9e1d-a78dc9e0fe30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7c1510a4-165d-426d-bb4d-b58d37b41ed2&quot;,&quot;94c20b18-1bb5-41d8-9003-74ad7dca68bc&quot;,&quot;61c6f52f-1087-4291-9e1d-a78dc9e0fe30&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8922d8ad-9bcc-4bb2-8fee-f21d8ad4f7c1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9835582f-f712-4ca5-9e8a-3dc9032ee40a&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;45ec277e-ad24-451b-ac61-b0d5ceb70f3b&quot;,&quot;title&quot;:&quot;Payment.getBillLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1224,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Bill.remove({ flow_name: new RegExp(&#x27;^utest_cases_&#x27;, \&quot;i\&quot;) }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, uid);\n                        saveBillEntries(\n                            _.extend(getImmutable(billBody), {\n                                authtoken: authToken\n                            }),\n                            function(error, bills) {\n                                savedBills = bills;\n                                done();\n                            });\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b56060d-da6c-441d-b560-da512e28551d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;708655c3-a7b1-4b14-a7e4-454718a5b4f4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should get list of bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) == \&quot;number\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4369c1ab-dfce-4b3c-8ab4-caa35bd8fe54&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bill on filteration.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should gives bill on filteration.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?filter=utest_cases_1\&quot;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 1 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca368c6c-e556-4891-bd65-a6f77999a8a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bill on filteration.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should not gives bill on filteration.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?filter=utest_cases_122\&quot;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7db105fd-8419-4c3a-90ab-a422627c0dc6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bills on respective flow ids selections.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should gives bills on respective flow ids selections.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=fld5aaeb1211f273e3c41f01,fld5aaeb1211f273e3c41f02\&quot;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 2 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;96caa9d4-d7fc-4dcd-aa0b-d20dbac5cf00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bills on wrong flow ids selections.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should not gives bills on wrong flow ids selections.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=fld5aaeb1211f273e3c41f15,fld5aaeb1211f273e3c41f99\&quot;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52c89cab-ed36-43a7-968a-61b6a02bf06b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bill on providing bill id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should gives bill on providing bill id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?bill_uid=\&quot; + savedBills[0].body.output.uid;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 1 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3abc932f-dcf7-46d9-a1d2-cb556c5da923&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bill on providing wrong bill id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should not gives bill on providing wrong bill id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?bill_uid=flabc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73aedc82-7410-4899-8d48-53b42b2c5e20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives 2 bills after skiping 2 bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should gives 2 bills after skiping 2 bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.Bill.find({\n                deleted_at: null,\n                user_uid: uid\n            }).sort({ \&quot;created_at\&quot;: 1 }).lean().exec(function(error, bills) {\n                if (error) {\n                    done(error);\n                } else {\n                    //bills = bills;\n                    //bills = utils.sortBy(bills, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                    var validOutput = false;\n                    if (res.body.output.count == 10) {\n                        validOutput = res.body.output.objects[0].uid == bills[2].uid &amp;&amp;\n                            res.body.output.objects[1].uid == bills[3].uid;\n                        if (validOutput) {\n                            _.each(res.body.output.objects, function(item) {\n                                validOutput = validOutput &amp;&amp;\n                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                    }\n                    validOutput.should.equal(true);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;972cfe23-27b1-4694-b902-243e5bc037e8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bills in ascending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should gives bills in ascending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?field=created_at&amp;order=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.Bill.find({\n                deleted_at: null,\n                user_uid: uid\n            }).sort({ \&quot;created_at\&quot;: 1 }).lean().exec(function(error, bills) {\n                if (error) {\n                    done(error);\n                } else {\n                    //bills = convert.getJSON(bills);\n                    //bills = utils.sortBy(bills, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                    var validOutput = false;\n                    if (res.body.output.count == 10) {\n                        validOutput = res.body.output.objects[0].uid == bills[0].uid &amp;&amp;\n                            res.body.output.objects[9].uid == bills[9].uid;\n                        if (validOutput) {\n                            _.each(res.body.output.objects, function(item) {\n                                validOutput = validOutput &amp;&amp;\n                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                    }\n                    validOutput.should.equal(true);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d556170-8c93-4403-892e-cbb2d611d4b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;adedf64d-7588-45af-a110-c71c9c32ac00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4369c1ab-dfce-4b3c-8ab4-caa35bd8fe54&quot;,&quot;ca368c6c-e556-4891-bd65-a6f77999a8a6&quot;,&quot;7db105fd-8419-4c3a-90ab-a422627c0dc6&quot;,&quot;96caa9d4-d7fc-4dcd-aa0b-d20dbac5cf00&quot;,&quot;52c89cab-ed36-43a7-968a-61b6a02bf06b&quot;,&quot;3abc932f-dcf7-46d9-a1d2-cb556c5da923&quot;,&quot;73aedc82-7410-4899-8d48-53b42b2c5e20&quot;,&quot;972cfe23-27b1-4694-b902-243e5bc037e8&quot;,&quot;4d556170-8c93-4403-892e-cbb2d611d4b8&quot;,&quot;adedf64d-7588-45af-a110-c71c9c32ac00&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:131,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8bf527df-cfa2-40da-86f9-e9f374d6a74d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;77268ed6-8509-4e45-9e52-786f9c477db4&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d58976e7-ddb6-49e8-90f5-b13f900d293d&quot;,&quot;title&quot;:&quot;Payment.getBillLogsOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBillLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1222,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        saveBillEntries(\n            _.extend(getImmutable(billBody), {\n                authtoken: authToken\n            }),\n            function(error, bills) {\n                savedBills = bills;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d993158-05a5-4d54-bbf6-78db41457105&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fac1f513-7168-4d6e-8fc0-05cc62e3b65f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should get list of bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) == \&quot;number\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1364521d-d533-4b0e-a312-7510628a03e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bill on filteration.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should gives bill on filteration.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?filter=utest_cases_1\&quot;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 1 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3dff8b95-a173-448a-8367-7a82580c9036&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bill on filteration.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should not gives bill on filteration.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?filter=utest_cases_122\&quot;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76277332-dbb5-4602-9698-0effefac38be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bills on respective flow ids selections.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should gives bills on respective flow ids selections.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=fld5aaeb1211f273e3c41f01,fld5aaeb1211f273e3c41f02\&quot;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 2 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da474156-33b7-4544-8dd2-a15aeb6b1bf8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bills on wrong flow ids selections.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should not gives bills on wrong flow ids selections.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=fld5aaeb1211f273e3c41f15,fld5aaeb1211f273e3c41f99\&quot;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f548d63-457e-417e-aea2-fcfad6daa847&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bill on providing bill id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should gives bill on providing bill id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?bill_uid=\&quot; + savedBills[0].body.output.uid;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.count == 1 &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e4187150-1310-4e58-a795-3306cdead1b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not gives bill on providing wrong bill id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should not gives bill on providing wrong bill id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?bill_uid=flabc\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_BILLS_NOT_EXISTS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acdbcefa-63e9-4a04-b89e-12e6f8c2bea0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives 2 bills after skiping 2 bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should gives 2 bills after skiping 2 bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.Bill.find({\n                deleted_at: null,\n                user_uid: org_account_uid\n            }).sort({ \&quot;created_at\&quot;: 1 }).lean().exec(function(error, bills) {\n                if (error) {\n                    done(error);\n                } else {\n                    //bills = bills;\n                    //bills = utils.sortBy(bills, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                    var validOutput = false;\n                    if (res.body.output.count == 10) {\n                        validOutput = res.body.output.objects[0].uid == bills[2].uid &amp;&amp;\n                            res.body.output.objects[1].uid == bills[3].uid;\n                        if (validOutput) {\n                            _.each(res.body.output.objects, function(item) {\n                                validOutput = validOutput &amp;&amp;\n                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                    }\n                    validOutput.should.equal(true);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7812915d-3c10-41b8-9e66-8d720beb2b7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives bills in ascending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should gives bills in ascending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?field=created_at&amp;order=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.Bill.find({\n                deleted_at: null,\n                user_uid: org_account_uid\n            }).sort({ \&quot;created_at\&quot;: 1 }).lean().exec(function(error, bills) {\n                if (error) {\n                    done(error);\n                } else {\n                    //bills = convert.getJSON(bills);\n                    //bills = utils.sortBy(bills, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                    var validOutput = false;\n                    if (res.body.output.count == 10) {\n                        validOutput = res.body.output.objects[0].uid == bills[0].uid &amp;&amp;\n                            res.body.output.objects[9].uid == bills[9].uid;\n                        if (validOutput) {\n                            _.each(res.body.output.objects, function(item) {\n                                validOutput = validOutput &amp;&amp;\n                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                    }\n                    validOutput.should.equal(true);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aeecb632-ed96-4e9c-a9a2-3a9bec9ca54d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBillLogsOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a8d8480-6655-482c-aeb5-2b329f9e2a95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1364521d-d533-4b0e-a312-7510628a03e6&quot;,&quot;3dff8b95-a173-448a-8367-7a82580c9036&quot;,&quot;76277332-dbb5-4602-9698-0effefac38be&quot;,&quot;da474156-33b7-4544-8dd2-a15aeb6b1bf8&quot;,&quot;4f548d63-457e-417e-aea2-fcfad6daa847&quot;,&quot;e4187150-1310-4e58-a795-3306cdead1b9&quot;,&quot;acdbcefa-63e9-4a04-b89e-12e6f8c2bea0&quot;,&quot;7812915d-3c10-41b8-9e66-8d720beb2b7f&quot;,&quot;aeecb632-ed96-4e9c-a9a2-3a9bec9ca54d&quot;,&quot;2a8d8480-6655-482c-aeb5-2b329f9e2a95&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:141,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f1183640-6423-491e-b38a-8ce7dfc38b38&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f2d7218e-7140-44ae-8893-b32fc000e133&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;875291c7-ee49-45cd-a792-d5e7b6fe5ea5&quot;,&quot;title&quot;:&quot;Payment.getBraintreeToken&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    user_uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;221106ad-1804-4a97-92f6-ff0b71b9b735&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18b04b21-2883-469e-809d-a9c3281f80f2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get client braintree token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken Should get client braintree token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.token.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46c891fa-6631-4b7b-a0df-b201729c4159&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have braintree id is blank.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken Should get client braintree token, if user have braintree id is blank.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: user_uid\n            }).lean().exec(function(err, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: user_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;\&quot;\n                    }).lean().exec(function(err, user) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: user_uid\n                                        }).lean().exec(function(err, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e18e94d-7c1a-4184-9648-c0d07e7ad7d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have invalid braintree id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken Should get client braintree token, if user have invalid braintree id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: user_uid\n            }).lean().exec(function(error, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: user_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;00000005620\&quot;\n                    }).lean().exec(function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: user_uid\n                                        }).lean().exec(function(error, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2bda09f-f87f-4004-8689-215955282b9e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have default invalid braintree id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken Should get client braintree token, if user have default invalid braintree id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: user_uid\n            }).lean().exec(function(error, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: user_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;210934322\&quot;\n                    }).lean().exec(function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: user_uid\n                                        }).lean().exec(function(error, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;992afc58-4f89-4ccb-9235-6214567f8be9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeToken Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36d080df-9138-45b4-8850-fae827c1e8da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;46c891fa-6631-4b7b-a0df-b201729c4159&quot;,&quot;3e18e94d-7c1a-4184-9648-c0d07e7ad7d8&quot;,&quot;d2bda09f-f87f-4004-8689-215955282b9e&quot;,&quot;992afc58-4f89-4ccb-9235-6214567f8be9&quot;,&quot;36d080df-9138-45b4-8850-fae827c1e8da&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:104,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;95b87c5e-b8d6-4fdb-bed2-24a3fb48ddc8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8ee02ee6-cacc-4a67-998e-70147f90ed64&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;81fa025b-0010-4354-89af-c2b1efc590e7&quot;,&quot;title&quot;:&quot;Payment.getBraintreeTokenOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getBraintreeTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;63eef5f2-eb6f-402f-ab2b-937c93e8e207&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6717398-cb9f-467b-9aec-937f037f082d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get client braintree token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg Should get client braintree token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.token.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1fbe20df-33d6-4b60-a5a1-91f34cbe23fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have braintree id is blank.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg Should get client braintree token, if user have braintree id is blank.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: org_account_uid\n            }).lean().exec(function(err, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: org_account_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;\&quot;\n                    }).lean().exec(function(err, user) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;org_uid&#x27;, org_uid)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: org_account_uid\n                                        }).lean().exec(function(err, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;58987fe2-0dd6-4b43-b2a5-eeccaeb2546e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have invalid braintree id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg Should get client braintree token, if user have invalid braintree id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: org_account_uid\n            }).lean().exec(function(error, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: org_account_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;00000005620\&quot;\n                    }).lean().exec(function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;org_uid&#x27;, org_uid)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: org_account_uid\n                                        }).lean().exec(function(error, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;117100d9-21c8-4b18-acd4-dc414a0c2d03&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get client braintree token, if user have default invalid braintree id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg Should get client braintree token, if user have default invalid braintree id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({\n                uid: org_account_uid\n            }).lean().exec(function(error, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    var braintree_customerId = user.braintree_customerId;\n                    _models.User.findOneAndUpdate({\n                        uid: org_account_uid\n                    }, {\n                        payment_set: \&quot;\&quot;,\n                        braintree_customerId: \&quot;210934322\&quot;\n                    }).lean().exec(function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            commonMock.brainTreeCustomerCreate(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.brainTreeGenerateAuthToken(httpmock, \&quot;enterprise\&quot;);\n                            api.get(apiURL)\n                                .set(&#x27;org_uid&#x27;, org_uid)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        _models.User.findOne({\n                                            uid: org_account_uid\n                                        }).lean().exec(function(error, user) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                (\n                                                    res.body.output.token != \&quot;\&quot; &amp;&amp;\n                                                    user.braintree_customerId != \&quot;\&quot;\n                                                ).should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7b6f21a9-f07d-4d91-8ee9-6b689b7be7e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getBraintreeTokenOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5328595c-b430-4a9a-ae53-2d5d33e8894c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1fbe20df-33d6-4b60-a5a1-91f34cbe23fc&quot;,&quot;58987fe2-0dd6-4b43-b2a5-eeccaeb2546e&quot;,&quot;117100d9-21c8-4b18-acd4-dc414a0c2d03&quot;,&quot;7b6f21a9-f07d-4d91-8ee9-6b689b7be7e6&quot;,&quot;5328595c-b430-4a9a-ae53-2d5d33e8894c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:134,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;64681c66-2169-4ac5-baf4-58da14fd5432&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f35be26d-1389-4905-ae72-c9b596b2b431&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bbc69f5d-1d51-441e-960a-5261eb691b3b&quot;,&quot;title&quot;:&quot;Payment.getCardDetail&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetail.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetail \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77ad2ee0-15d1-422f-9978-ea907ac16aac&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetail \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91679243-1049-4f84-95ab-225a7bcf6359&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get card details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetail Should get card details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.token.should.not.empty;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1198fcf8-85d9-4d6f-a1ee-51e558b1599d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetail Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e2e486b-6b16-4514-8d9a-189ddaf26ef1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1198fcf8-85d9-4d6f-a1ee-51e558b1599d&quot;,&quot;2e2e486b-6b16-4514-8d9a-189ddaf26ef1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;24a5d903-92a7-4d33-a848-557a8e0f9af4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;022a674a-3bd1-48b1-b37f-b55314bbe5be&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;22bdbfe1-a0f5-4334-822a-605b60f1151d&quot;,&quot;title&quot;:&quot;Payment.getCardDetailOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCardDetailOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetailOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b78f933-345f-49f2-a5eb-9d6a95d4ca78&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetailOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4805372c-c560-4db7-95b7-6b20d1825098&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get card details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetailOrg Should get card details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.token.should.not.empty;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5bd565ee-a8e6-4d74-b3e0-027ac2288750&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCardDetailOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ae9de40f-5622-4183-9c81-dedb0a209ede&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5bd565ee-a8e6-4d74-b3e0-027ac2288750&quot;,&quot;ae9de40f-5622-4183-9c81-dedb0a209ede&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9b227a26-3957-4778-816b-661ab07df3b7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;49ad70b0-1c49-45c8-b57d-d1c1a0c5e46d&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b18727a9-8aa6-4163-87eb-c218b03048f9&quot;,&quot;title&quot;:&quot;Payment.getClientTokenOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getClientTokenOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getClientTokenOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6341963-180c-4eb9-ab31-434dec64f5ba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getClientTokenOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f6c8c8a-aa24-4e5b-b625-e385b86d1087&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getClientTokenOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e423d2c-d4d1-4fc8-af8f-173a7002fde4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get current user payment logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getClientTokenOrg Should get current user payment logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                if (res.body.output.length &gt; 0) {\n                    isValid = (_.first(res.body.output) || {}).user_uid == userUid;\n                }\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;15075d00-bffe-453e-9bd1-a37d8ad10a74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getClientTokenOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ce174fd-2176-4b4d-92ff-f076a583c895&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;15075d00-bffe-453e-9bd1-a37d8ad10a74&quot;,&quot;5ce174fd-2176-4b4d-92ff-f076a583c895&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6146e65e-dacf-46f2-9e6a-167e89cdc7d0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1346c207-a1f2-44e3-ae2f-9e30155243d9&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;08db9118-7951-4dce-b27a-ef68789735bb&quot;,&quot;title&quot;:&quot;Payment.getCreditDetails&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getCreditDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:149,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    saveInvoices({\n                        authToken: authToken,\n                        braintree_customerId: res.body.output.braintree_customerId || \&quot;\&quot;,\n                        uid: res.body.output.uid || \&quot;\&quot;\n                    }, function() {\n                        var obj = {\n                            title: \&quot;test1\&quot;,\n                            body_detail: \&quot;test1\&quot;,\n                            email_body: \&quot;test1\&quot;,\n                            agreement_link: \&quot;http://example.com\&quot;,\n                            schedule_link: \&quot;http://example.com\&quot;,\n                            attachment_link: \&quot;http://example.com\&quot;,\n                            message: \&quot;test msg\&quot;,\n                            email: \&quot;test@example.com\&quot;,\n                            subject: \&quot;test\&quot;\n                        }\n                        _models.CreditDetail.create(obj, function(err, detail) {\n                            credit_details_uid = detail.uid;\n                            done();\n                        });\n                    });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3dac98d6-f85c-4dac-a4aa-0e11f2c99829&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;deleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fdf3fea8-74cb-4d48-95ae-4a680cda5f57&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;267b07e8-5106-4cb4-aabe-9a1b79cefbc9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get credit details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails Should get credit details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:uid\&quot;, credit_details_uid))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05b9f310-6f0f-4bfc-8d2c-010f53a7fa5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give credit details not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails Should give credit details not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:uid\&quot;, \&quot;FAKE_UID\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CARD_DETAIL_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ebf1b83-bbc6-4cf0-9d03-c3fba0ee2b8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getCreditDetails Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdateCustomerPaymentDetail(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f1ac01e-3ab6-45ee-a7fc-4e3575776297&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;05b9f310-6f0f-4bfc-8d2c-010f53a7fa5a&quot;,&quot;3ebf1b83-bbc6-4cf0-9d03-c3fba0ee2b8a&quot;,&quot;2f1ac01e-3ab6-45ee-a7fc-4e3575776297&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7e0e2b58-d9d7-49be-8946-b81b9c0e6f07&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f22b160b-4103-408d-8e8e-02d64a79f66f&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e9dab1af-bcd0-4b4c-8b79-9ba63b6b8b68&quot;,&quot;title&quot;:&quot;Payment.getPaymentLog&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLog \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:129,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    userUid = res.body.output.uid;\n                    savePaymentLogs({\n                        authToken: authToken,\n                        braintree_customerId: res.body.output.braintree_customerId || \&quot;\&quot;,\n                        uid: res.body.output.uid || \&quot;\&quot;\n                    }, function() {\n                        done();\n                    });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;628a34f4-835a-4954-93c0-cfef1d86739e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLog \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;deleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33b3fc66-2445-4b73-946b-80862a2a4aff&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLog \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7b2b399-71fa-4e1a-87fd-ad7d99aa297f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get current user payment logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLog Should get current user payment logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                if (res.body.output.length &gt; 0) {\n                    isValid = (_.first(res.body.output) || {}).user_uid == userUid;\n                }\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;96dc6889-9bd5-4363-97c4-97d711358715&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLog Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57d06943-edd7-4c99-8031-f15327f62b1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;96dc6889-9bd5-4363-97c4-97d711358715&quot;,&quot;57d06943-edd7-4c99-8031-f15327f62b1c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:17,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;be81aa02-93b6-4d55-9c68-b3f6ae45be5b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a5698fbf-4a5a-488b-8c12-7299a6b292b8&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4d10328d-d208-4832-b6f1-afbc41f4ecc9&quot;,&quot;title&quot;:&quot;Payment.getPaymentLogOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentLogOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLogOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6084717b-f272-4d30-9372-55ec2fd9a8fe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLogOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;testCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c9845bf-3ae1-4c2d-b0f5-587ff086e7b3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLogOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;509fac0e-c0ec-4668-997e-6225ef9c80ba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get current user payment logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLogOrg Should get current user payment logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                if (res.body.output.length &gt; 0) {\n                    isValid = (_.first(res.body.output) || {}).user_uid == userUid;\n                }\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a0867ee8-60f5-4bc6-839c-c02745ff7324&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentLogOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;50b44257-b88c-4381-b33f-aa60a9518c4a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a0867ee8-60f5-4bc6-839c-c02745ff7324&quot;,&quot;50b44257-b88c-4381-b33f-aa60a9518c4a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c4eeb792-d7c5-43cb-b265-d6b0ff2300b7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;43dd1afe-f2d0-466d-899b-5a98a1e1db66&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d0304a2d-8cce-4860-a36d-05560675858a&quot;,&quot;title&quot;:&quot;Payment.getPaymentSet&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSet \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    var data = res.body.output;\n                    authToken = data.authtoken;\n                    _id = data._id;\n                    payment_set = data.payment_set;\n                    if (error) {\n                        done(error);\n                    } else {\n                        done();\n                    }\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d885562e-082a-4a31-b2bd-9bbb0382235c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSet \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37168077-2ddd-4f82-b4ef-1c0f4d4812e3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get payment_set for user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSet Should get payment_set for user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (res.body.output.payment_set != \&quot;\&quot; &amp;&amp;\n                res.body.output.payment_set != payment_set)\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ddc0862-192f-4922-8c83-6babc05f756e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSet Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb5b404c-76e0-4b54-aabe-fdd8278f7ee6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1ddc0862-192f-4922-8c83-6babc05f756e&quot;,&quot;cb5b404c-76e0-4b54-aabe-fdd8278f7ee6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:16,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d37c6b22-5d79-4fa2-9c71-4af1613f7054&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;822d271c-61f6-43fe-bbd5-dae940f3a25d&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f4100fc1-b3d3-41b4-87bc-2469d0649e49&quot;,&quot;title&quot;:&quot;Payment.getPaymentSetOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getPaymentSetOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSetOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;efb75daf-3c0d-41ec-b11f-a017ca1ab7f8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSetOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c376e6e7-e7fd-49e4-8f86-2bd98edc27fe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get payment_set for user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSetOrg Should get payment_set for user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (res.body.output.payment_set != \&quot;\&quot; &amp;&amp;\n                res.body.output.payment_set != payment_set)\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c8b749fc-fcf8-4771-b357-e88257de94b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getPaymentSetOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1177ea1d-a0c5-407b-aab5-3690c153bfe8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c8b749fc-fcf8-4771-b357-e88257de94b0&quot;,&quot;1177ea1d-a0c5-407b-aab5-3690c153bfe8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6ef54283-0ef3-4f03-b0aa-7c221e237e86&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d700901f-bcdb-4410-a433-5198dd076b68&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d2757235-c1a7-4c89-9139-946bfbd2980a&quot;,&quot;title&quot;:&quot;Payment.getStatistic&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatistic.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:107,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function(error, output) {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                user_uid = res.body.output.uid;\n                email = res.body.output.email;\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(\&quot;authtoken\&quot;, authToken)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        done();\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;99786d17-1386-4370-b6ac-253b3b036a78&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;removeRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c6bd6391-060d-4a37-a35a-5df3036631f6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c031b214-3dab-4603-9294-44befaba7804&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get list of bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3294a91b-4c21-482a-8740-cd404d532ad0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of triggers of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of triggers of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserTriggers(function(error, triggers) {\n    var filterURL = apiURL + \&quot;?get=triggercount\&quot;;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) == 10).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0195f17c-f5be-4341-9d6f-c9a5a33c064a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of triggers of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of triggers of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserTriggers(function(error, triggers) {\n    var frange = triggers[2].toJSON().created_at.toISOString();\n    var srange = triggers[8].toJSON().created_at.toISOString();\n    var filterURL = apiURL + \&quot;?get=triggercount&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt; 0).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05e5542c-c272-4d31-bbca-9596f0b6bbf8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of flows of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:481,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserFlows(done, function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flowcount\&quot;;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 10).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32cb4735-747f-472e-8875-466488e46f2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of flows of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:380,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserFlows(done, function(error, flows) {\n    var frange = new Date((new Date(flows[1].created_at)) - 300000).toISOString();\n    var srange = (new Date(flows[8].created_at)).toISOString();\n    var filterURL = apiURL + \&quot;?get=flowcount&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 9).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eb81ec85-adea-44b7-94bd-0c835b49ccd0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of present flows of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of present flows of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flowspresent\&quot;;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                parseInt(res.body.output.objects).should.not.equal(NaN);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6a1d9444-2751-42fe-ac80-95e9d3706e23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of present flows of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of present flows of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var frange = new Date((new Date(flows[1].created_at.toISOString())) - 300000).toISOString();\n    var srange = flows[8].created_at.toISOString();\n    var filterURL = apiURL + \&quot;?get=flowspresent&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                parseInt(res.body.output.objects).should.not.equal(NaN);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3ab378f-6f97-48a3-93de-3b21a992e681&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count zero credits.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count zero credits.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:106,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1000@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var filterURL = apiURL + \&quot;?get=credits\&quot;;\n            api.get(filterURL)\n                .set(&#x27;authtoken&#x27;, res.body.output.authtoken)\n                .expect(httpStatus.OK)\n                .end(function(error, res) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        (parseInt(res.body.output.objects) == 0).should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6ac2599-c783-43ad-8ac9-8220f8f91e7a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows and triggers of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get count of flows and triggers of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:47,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flow_trigger\&quot;;\n    api.get(filterURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (typeof(res.body.output.trigger) == \&quot;number\&quot; &amp;&amp;\n                    typeof(res.body.output.flows) == \&quot;number\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f15ee98b-43b5-44d8-9d1e-dd7eccbec134&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get userstream count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get userstream count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:122,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n    user_uid: user_uid\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n        user_uid: user_uid\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=librarydownload\&quot;;\n        api.get(filterURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f5258e8-3aba-452d-ad58-c9e2babe79c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get library download count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get library download count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:106,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=librarydownload\&quot;;\n        api.get(filterURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62f011a6-1891-4e5f-bc74-3fd57b069b7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow shared count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get flow shared count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:116,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=flowshared\&quot;;\n        api.get(filterURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d95396d8-26dc-4a10-bc54-6f872919106f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow total run count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should get flow total run count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=totalrun\&quot;;\n        api.get(filterURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91d6c0b5-6775-468d-8822-4f0940b2858d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatistic Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05d65223-acc6-4b20-8a7d-bc348b6c73b6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3294a91b-4c21-482a-8740-cd404d532ad0&quot;,&quot;0195f17c-f5be-4341-9d6f-c9a5a33c064a&quot;,&quot;05e5542c-c272-4d31-bbca-9596f0b6bbf8&quot;,&quot;32cb4735-747f-472e-8875-466488e46f2a&quot;,&quot;eb81ec85-adea-44b7-94bd-0c835b49ccd0&quot;,&quot;6a1d9444-2751-42fe-ac80-95e9d3706e23&quot;,&quot;f3ab378f-6f97-48a3-93de-3b21a992e681&quot;,&quot;e6ac2599-c783-43ad-8ac9-8220f8f91e7a&quot;,&quot;f15ee98b-43b5-44d8-9d1e-dd7eccbec134&quot;,&quot;2f5258e8-3aba-452d-ad58-c9e2babe79c0&quot;,&quot;62f011a6-1891-4e5f-bc74-3fd57b069b7f&quot;,&quot;d95396d8-26dc-4a10-bc54-6f872919106f&quot;,&quot;91d6c0b5-6775-468d-8822-4f0940b2858d&quot;,&quot;05d65223-acc6-4b20-8a7d-bc348b6c73b6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1628,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;95ce6600-7a22-4349-8748-70982a83bfc4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;99847a10-d18b-4fad-8771-7302afb42f04&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c205af2c-fb24-41a5-b674-c93932ce8b4e&quot;,&quot;title&quot;:&quot;Payment.getStatisticMonthWise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWise.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWise \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:192,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nremoveRecords(function() {\n    async.waterfall([\n        function(cbk) {\n            _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n                cbk(err, user);\n            })\n        },\n        function(userTrigger, cbk) {\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(testData.testRegistrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    user_uid = res.body.output.uid;\n                    email = res.body.output.email;\n                    cbk(err, res);\n                })\n        },\n        function(result, cbk) {\n            dummyUser = result.body.output;\n            testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n            _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                cbk(err, userTrigger);\n            })\n        },\n        function(userTrigger, cbk) {\n            var userTriggerObj = userTrigger;\n            var flowData = _.cloneDeep(testData.flowBody);\n            flowData.isExpress = false;\n            flowData.trigger.handlers = [userTriggerObj.uid]\n            async.parallel({\n                triggerFlow: function(cb) {\n                    createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                inactiveFlow: function(cb) {\n                    var inactiveFlow = _.cloneDeep(flowData);\n                    inactiveFlow.active = false;\n                    createFlow(flowURL, inactiveFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                draftFlow: function(cb) {\n                    var draftFlow = _.cloneDeep(flowData);\n                    draftFlow.is_draft = true;\n                    createFlow(flowURL, draftFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                webHookFlow: function(cb) {\n                    var WHFlow = _.cloneDeep(flowData);\n                    WHFlow.trigger = testData.defaultTriggerObj;\n                    WHFlow.settings = testData.webHookSetting;\n                    WHFlow.active = true;\n                    WHFlow.settings = testData.webHookSetting;\n                    createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                invalidEnvFlow: function(cb) {\n                    var IVWHFlow = _.cloneDeep(flowData);\n                    IVWHFlow.trigger = testData.defaultTriggerObj;\n                    IVWHFlow.settings = testData.webHookSetting;\n                    IVWHFlow.environment[0].params.push({ key: \&quot;body\&quot;, required: true });\n                    createFlow(flowURL, IVWHFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                }\n            }, function(err, result) {\n                cbk(err, result)\n            })\n        }\n    ], function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userTriggerFlow = res.triggerFlow.body.output;\n            userDraftFlow = res.draftFlow.body.output;\n            userWebHookFlow = res.webHookFlow.body.output;\n            invalidEnvFlow = res.invalidEnvFlow.body.output;\n            inactiveFlow = res.inactiveFlow.body.output;\n            _models.newFlow.findOneAndUpdate({ uid: userWebHookFlow.uid }, {\n                current_month_run_time: 5,\n                total_run_count: 20\n            }, function(err, deletedFlows) {\n                done();\n            });\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;050be673-e03f-46cc-b0b4-d024a7e6b1e5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWise \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45219103-e7fa-48b0-aff5-adc2d9ff1335&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWise \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;425bb2ef-aea6-4c8c-9866-cd4ae0d6970b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get month wise flow statistic of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWise Should get month wise flow statistic of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (isNaN(parseInt(res.body.output.current_month_run)) == false &amp;&amp;\n                isNaN(parseInt(res.body.output.total_run)) == false) {\n                isValid = parseInt(res.body.output.current_month_run) &gt; 0 &amp;&amp;\n                    parseInt(res.body.output.total_run) &gt; 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75f2813c-4ef6-4e12-9568-7b8a3f93192e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWise Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;35524cb7-fb53-4f8f-ade6-459c13f0b50a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;75f2813c-4ef6-4e12-9568-7b8a3f93192e&quot;,&quot;35524cb7-fb53-4f8f-ade6-459c13f0b50a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:18,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c625138c-11c5-4760-ad37-e732134d61b9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;acd5012f-c4bb-4d3a-bd2a-8ee8449d9c61&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0e3bb6e6-ef35-4968-b0f9-211ea367a912&quot;,&quot;title&quot;:&quot;Payment.getStatisticMonthWiseOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticMonthWiseOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWiseOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:539,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nremoveRecords(function() {\n    async.waterfall([\n        function(cbk) {\n            _models.User.remove({}, function(err, user) {\n                cbk(err, user);\n            })\n        },\n        function(userTrigger, cbk) {\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(testData.testRegistrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    user_uid = res.body.output.uid;\n                    email = res.body.output.email;\n                    createOrgEntries({\n                        done: done\n                    }, function() {\n                        cbk(err, res);\n                    });\n                })\n        },\n        function(result, cbk) {\n            dummyUser = result.body.output;\n            testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n            _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                cbk(err, userTrigger);\n            })\n        },\n        function(userTrigger, cbk) {\n            var userTriggerObj = userTrigger;\n            var flowData = _.cloneDeep(testData.flowBody);\n            flowData.isExpress = false;\n            flowData.trigger.handlers = [userTriggerObj.uid]\n            async.parallel({\n                triggerFlow: function(cb) {\n                    createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                inactiveFlow: function(cb) {\n                    var inactiveFlow = _.cloneDeep(flowData);\n                    inactiveFlow.active = false;\n                    createFlow(flowURL, inactiveFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                draftFlow: function(cb) {\n                    var draftFlow = _.cloneDeep(flowData);\n                    draftFlow.is_draft = true;\n                    createFlow(flowURL, draftFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                webHookFlow: function(cb) {\n                    var WHFlow = _.cloneDeep(flowData);\n                    WHFlow.trigger = testData.defaultTriggerObj;\n                    WHFlow.settings = testData.webHookSetting;\n                    WHFlow.active = true;\n                    WHFlow.settings = testData.webHookSetting;\n                    createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                },\n                invalidEnvFlow: function(cb) {\n                    var IVWHFlow = _.cloneDeep(flowData);\n                    IVWHFlow.trigger = testData.defaultTriggerObj;\n                    IVWHFlow.settings = testData.webHookSetting;\n                    IVWHFlow.environment[0].params.push({ key: \&quot;body\&quot;, required: true });\n                    createFlow(flowURL, IVWHFlow, dummyUser, function(err, result) {\n                        cb(err, result);\n                    })\n                }\n            }, function(err, result) {\n                cbk(err, result)\n            })\n        }\n    ], function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            userTriggerFlow = res.triggerFlow.body.output;\n            userDraftFlow = res.draftFlow.body.output;\n            userWebHookFlow = res.webHookFlow.body.output;\n            invalidEnvFlow = res.invalidEnvFlow.body.output;\n            inactiveFlow = res.inactiveFlow.body.output;\n            _models.newFlow.findOneAndUpdate({ uid: userWebHookFlow.uid }, {\n                current_month_run_time: 5,\n                total_run_count: 20\n            }, function(err, deletedFlows) {\n                done();\n            });\n        }\n    })\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e114b26-b7d7-4507-979e-b2fcc7029bcf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWiseOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87667ef4-22c6-4dc6-9852-b85437808080&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWiseOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f36430a-e703-46aa-83dc-9e58224c31b0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get month wise flow statistic of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWiseOrg Should get month wise flow statistic of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (isNaN(parseInt(res.body.output.current_month_run)) == false &amp;&amp;\n                isNaN(parseInt(res.body.output.total_run)) == false) {\n                isValid = parseInt(res.body.output.current_month_run) &gt; 0 &amp;&amp;\n                    parseInt(res.body.output.total_run) &gt; 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c8577945-aeaa-4a05-b88c-1c0ddf9c851c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticMonthWiseOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ba6b1d2-2036-47fd-a042-64453bf4fa2f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c8577945-aeaa-4a05-b88c-1c0ddf9c851c&quot;,&quot;7ba6b1d2-2036-47fd-a042-64453bf4fa2f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:23,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b56c0dfc-a0a8-4d8c-8e35-9a39c2683ebb&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fefae41a-89ed-41c2-b861-03d4be6b5faa&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4d9ce972-ff9b-4e01-bfd6-eb149a0c1d07&quot;,&quot;title&quot;:&quot;Payment.getStatisticOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getStatisticOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                env_uid = res.body.output.env_uid;\n                api.get(\&quot;/enterprise/v1/projects\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(error, res) {\n                        project_uid = _.first(res.body.output.projects).uid\n                        done();\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;70672a07-3296-4d87-aebf-1542284b6e54&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6943594e-e029-464f-8a13-ea6994c616c0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bills.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get list of bills.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12a7f20c-0875-4dec-89b2-f234d7f1881b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of triggers of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of triggers of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserTriggers({\n    user_uid: org_account_uid,\n    project_uid: project_uid,\n    org_uid: org_uid\n}, function(error, triggers) {\n    var filterURL = apiURL + \&quot;?get=triggercount\&quot;;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) == 10).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;db86228a-0981-4b74-a8d3-3959a914c7e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of triggers of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of triggers of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserTriggers({\n    user_uid: org_account_uid,\n    project_uid: project_uid,\n    org_uid: org_uid\n}, function(error, triggers) {\n    var frange = triggers[2].toJSON().created_at.toISOString();\n    var srange = triggers[8].toJSON().created_at.toISOString();\n    var filterURL = apiURL + \&quot;?get=triggercount&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) == 6).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0cd37799-bfe3-4e12-a36b-a261ee78b702&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of flows of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:362,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserFlows(done, function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flowcount\&quot;;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 10).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d76d8d0c-2641-431a-8672-388a7ec04038&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of flows of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:367,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveUserFlows(done, function(error, flows) {\n    var frange = new Date((new Date(flows[1].created_at)) - 300000).toISOString();\n    var srange = (new Date(flows[8].created_at)).toISOString();\n    var filterURL = apiURL + \&quot;?get=flowcount&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 10).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41edcb2f-9bbc-4838-a1b8-98dab53cbbb5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of present flows of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of present flows of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:366,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flowspresent\&quot;;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 9).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7fca23ee-50e2-46da-a2fb-aa36f3cde8e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of present flows of current user in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of present flows of current user in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:360,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var frange = new Date((new Date(flows[1].created_at)) - 300000).toISOString();\n    var srange = flows[8].created_at;\n    var filterURL = apiURL + \&quot;?get=flowspresent&amp;frange=\&quot; + frange + \&quot;&amp;srange=\&quot; + srange;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (parseInt(res.body.output.objects) &gt;= 9).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eaff7219-0b6c-438c-9b8e-34504f6a7ccd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count zero credits.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count zero credits.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:356,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=credits\&quot;;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (typeof(res.body.output.objects) == \&quot;number\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd9635d3-a989-4dce-bb13-f0aca0a1b485&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get count of flows and triggers of current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get count of flows and triggers of current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:361,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveFlowsPresent(function(error, flows) {\n    var filterURL = apiURL + \&quot;?get=flow_trigger\&quot;;\n    api.get(filterURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                (typeof(res.body.output.trigger) == \&quot;number\&quot; &amp;&amp;\n                    typeof(res.body.output.flows) == \&quot;number\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf9bc251-cde2-431f-bd69-cfa87e2f9180&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get userstream count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get userstream count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n    user_uid: user_uid\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n        user_uid: user_uid\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=librarydownload\&quot;;\n        api.get(filterURL)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d06dc8f0-4acc-4dc7-bebf-987a09c6734e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get library download count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get library download count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=librarydownload\&quot;;\n        api.get(filterURL)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06102967-2200-472a-98a8-ca210b60e975&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow shared count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get flow shared count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=flowshared\&quot;;\n        api.get(filterURL)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acfe2733-eecd-4a0e-a966-d1506c9c8c22&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get flow total run count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should get flow total run count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsaveBillEntries({\n    email: email,\n    authtoken: authToken,\n}, function(options, callback) {\n    saveUserStreamEntries({\n        email: email,\n        authtoken: authToken,\n    }, function(error, flows) {\n        var filterURL = apiURL + \&quot;?get=totalrun\&quot;;\n        api.get(filterURL)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    (typeof(res.body.output.objects) != \&quot;undefined\&quot;).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce7f8ccc-7499-48f3-a0c0-67f2b1dfcdb4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.getStatisticOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c12a21c8-21b2-4ce9-8bad-a95eea000bdc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;12a7f20c-0875-4dec-89b2-f234d7f1881b&quot;,&quot;db86228a-0981-4b74-a8d3-3959a914c7e3&quot;,&quot;0cd37799-bfe3-4e12-a36b-a261ee78b702&quot;,&quot;d76d8d0c-2641-431a-8672-388a7ec04038&quot;,&quot;41edcb2f-9bbc-4838-a1b8-98dab53cbbb5&quot;,&quot;7fca23ee-50e2-46da-a2fb-aa36f3cde8e1&quot;,&quot;eaff7219-0b6c-438c-9b8e-34504f6a7ccd&quot;,&quot;fd9635d3-a989-4dce-bb13-f0aca0a1b485&quot;,&quot;cf9bc251-cde2-431f-bd69-cfa87e2f9180&quot;,&quot;d06dc8f0-4acc-4dc7-bebf-987a09c6734e&quot;,&quot;06102967-2200-472a-98a8-ca210b60e975&quot;,&quot;acfe2733-eecd-4a0e-a966-d1506c9c8c22&quot;,&quot;ce7f8ccc-7499-48f3-a0c0-67f2b1dfcdb4&quot;,&quot;c12a21c8-21b2-4ce9-8bad-a95eea000bdc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2613,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c8cddb8c-4c60-4117-aae2-6eba31ec3190&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;be5b6ef7-31c8-4eab-939d-f085ddaddec8&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7ba18062-ce46-48c7-970d-7e2b4e2109f8&quot;,&quot;title&quot;:&quot;Payment.getSubscriptionDetailFromBraintree&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintree.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintree \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    token = res.body.output.activation_token;\n                    _id = res.body.output._id;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a37f7d5-d870-42da-94a5-b6c174bc0058&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintree \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49f4a439-daae-43ec-91ec-d8e0dafb8e4d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should suspend user account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintree Should suspend user account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: uid }, {\n    braintree_subscriptionId: \&quot;FAKE_SUBSCRIPTION_ID\&quot;,\n    braintree_customerId: \&quot;FAKE_ID\&quot;,\n    merchantid: \&quot;FAKE_MERCHANT_ID\&quot;\n}, function(error, user) {\n    commonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\n    commonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\n    api.get(apiURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                (res.body.output.cardDetails.cardholderName == res.body.output.billingDetails.firstName &amp;&amp; res.body.output.billingDetails.firstName == \&quot;Amber More\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a93a3d9b-8268-408d-9355-922cae61c8d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give card detail not fount error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintree Should give card detail not fount error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CARD_DETAIL_CC_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2ac03693-b879-4190-819c-7585990309d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintree Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e781533f-a4b5-4fb2-98fe-f07e7b04615b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a93a3d9b-8268-408d-9355-922cae61c8d4&quot;,&quot;2ac03693-b879-4190-819c-7585990309d0&quot;,&quot;e781533f-a4b5-4fb2-98fe-f07e7b04615b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;be532bc9-cb2b-473c-88ed-3477334e7b54&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8e7d5695-70fd-405b-b890-a9247eceb29e&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4e6170e0-11e4-41c9-8b06-b6bec82f13e7&quot;,&quot;title&quot;:&quot;Payment.getSubscriptionDetailFromBraintreeOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\getSubscriptionDetailFromBraintreeOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintreeOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;35322640-92fc-4b43-b704-700c4a731959&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintreeOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51c47645-4fd5-45a3-a1ca-380f3f62661f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should suspend user account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintreeOrg Should suspend user account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: org_account_uid }, {\n    braintree_subscriptionId: \&quot;FAKE_SUBSCRIPTION_ID\&quot;,\n    braintree_customerId: \&quot;FAKE_ID\&quot;,\n    merchantid: \&quot;FAKE_MERCHANT_ID\&quot;\n}, function(error, user) {\n    commonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\n    commonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\n    api.get(apiURL)\n        .set(&#x27;org_uid&#x27;, org_uid)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                (res.body.output.cardDetails.cardholderName == res.body.output.billingDetails.firstName &amp;&amp; res.body.output.billingDetails.firstName == \&quot;Amber More\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6622bc35-2ec8-4949-b2ae-e9d7ad8319a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give card detail not fount error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintreeOrg Should give card detail not fount error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4617,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CARD_DETAIL_CC_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f6f2cb9-c8c9-42a3-be48-4206997f6557&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Payment.getSubscriptionDetailFromBraintreeOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeFindCard(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeFindSubscription(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eecc4527-3858-44c5-8019-2ccab7cfbdea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6622bc35-2ec8-4949-b2ae-e9d7ad8319a4&quot;,&quot;9f6f2cb9-c8c9-42a3-be48-4206997f6557&quot;,&quot;eecc4527-3858-44c5-8019-2ccab7cfbdea&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4647,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4586260e-4d2f-4b6e-8f53-a346ca6e2ca1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7c4bfc27-9161-4201-b370-80499532f5f5&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1e2527fb-2c2c-4bac-bfb1-6da2aabcbc6d&quot;,&quot;title&quot;:&quot;Payment.pastDueInBraintreeSubscription&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\pastDueInBraintreeSubscription.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.pastDueInBraintreeSubscription \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:146,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\ntestCollection.organizationRemoveRecords({}, function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                _braintreeCustId = res.body.output.braintree_customerId;\n                _userUid = res.body.output.uid;\n                subscribedPayload.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                subscriptionPastdue.options[\&quot;braintree_customerId\&quot;] = _braintreeCustId;\n                commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                    .send(saveCardBody)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                            commonMock.intercomUserUpdate(httpmock, \&quot;enterprise\&quot;);\n                            api.post(\&quot;/v1/webhook/subscription/start\&quot;)\n                                .send(subscribedPayload)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;214d2712-2d65-4a26-bc03-8ccb470daa68&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.pastDueInBraintreeSubscription \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9bf8e19b-5a6d-4837-910e-abe72ae1e068&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should subscription pastdue.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.pastDueInBraintreeSubscription Should subscription pastdue.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(subscriptionPastdue)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.BRAINTREE_WEBHOOK_NOTED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66bb24f7-291e-45d6-832a-ef4a88d10f5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should subscription pastdue.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.pastDueInBraintreeSubscription Should subscription pastdue.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRecordsEntry({}, function(data) {\n    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n    var temp_subscriptionPastdue = getImmutable(subscriptionPastdue);\n    temp_subscriptionPastdue.options.braintree_customerId = data.organization_account.braintree_customerId;\n    api.post(apiURL)\n        .send(temp_subscriptionPastdue)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.BRAINTREE_WEBHOOK_NOTED);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29c753ad-2983-4014-8621-83c9a8a6ab9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;66bb24f7-291e-45d6-832a-ef4a88d10f5d&quot;,&quot;29c753ad-2983-4014-8621-83c9a8a6ab9b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:81,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bd8ab51c-821a-4d8c-af43-1b6fd3b7380b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;52fec247-9752-4dc3-9a89-4905a12c8c39&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0356e270-e775-4a93-8153-020f34a02272&quot;,&quot;title&quot;:&quot;Payment.SaveCardInBrainTree&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\saveCardInBrainTree.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:108,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    signupUser({}, done, function(res) {\n        authToken = res.body.output.authtoken;\n        _id = res.body.output._id;\n        uid = res.body.output.uid;\n        plan_uid = res.body.output.plan[0].uid;\n        savePlanEntries({\n            count: 5\n        }, function(error, planEntries) {\n            _planEntries = planEntries;\n            done();\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5f22206-81fd-4d9e-b19e-9179480b34ab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e99545ea-361f-4fa7-9335-084deaecc190&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should save credit card.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should save credit card.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flag = (((res.body.output.plan || [{\n                braintree_plan: \&quot;\&quot;\n            }])[0].braintree_plan || \&quot;\&quot;) == saveCardBody.data.selectedPlan.braintree_plan);\n            (flag &amp;&amp; res.body.output.metadata.test_flag).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aaa0aab3-15e2-4e38-9190-6cd8563f4f05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should user save credit card.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should user save credit card.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempSaveCardBody = _.cloneDeep(saveCardBody);\n            tempSaveCardBody.data.use_existing_card = true;\n            commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempSaveCardBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var flag = (((res.body.output.plan || [{\n                            braintree_plan: \&quot;\&quot;\n                        }])[0].braintree_plan || \&quot;\&quot;) == saveCardBody.data.selectedPlan.braintree_plan);\n                        (flag &amp;&amp; res.body.output.metadata.test_flag).should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12021615-16e8-4e93-b75e-1187e23b664e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Apply promocode while saving card in braintree.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Apply promocode while saving card in braintree.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPromoCode({}, done, function(res) {\n    if (((res.body.output.plan[0] || { \&quot;plan_price\&quot;: \&quot;\&quot; }).plan_price || \&quot;\&quot;) == \&quot;\&quot;) {\n        true.should.equal(false);\n        done();\n    } else {\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var user = res.body.output;\n                    var isValid = typeof(user._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(user.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        user.user_plan.reimburse.credits == 100005 &amp;&amp;\n                        user.user_plan.reimburse.period == 30 &amp;&amp;\n                        user.user_plan.trigger.count == 22;\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9aadd87-8456-4185-b501-ed5d6358cea5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid parameters error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should give invalid parameters error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempSaveCardBody = getImmutable(saveCardBody);\ndelete tempSaveCardBody.data.cardholderName;\ndelete tempSaveCardBody.data.selectedPlan;\ndelete tempSaveCardBody.data.nonce;\ndelete tempSaveCardBody.data.company;\ndelete tempSaveCardBody.data.billing_address1;\napi.post(apiURL)\n    .send(tempSaveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.name.message == messageList.SAVE_CARD_CUSTOMER_NAME_RQUIRED &amp;&amp;\n                res.body.error[\&quot;selectedPlan.braintree_plan\&quot;].message == messageList.SAVE_CARD_BRAINTREE_PLAN_REQUIRED &amp;&amp;\n                //res.body.error.nonce.message == messageList.SAVE_CARD_NONCE_RQUIRED &amp;&amp;\n                res.body.error.company.message == messageList.SAVE_CARD_COMPANY_RQUIRED &amp;&amp;\n                res.body.error.billing_address1.message == messageList.SAVE_CARD_STREET_ADDRESS_RQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac3c059e-7a52-4411-869f-f980063f1b86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid parameters error for empty parameters.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should give invalid parameters error for empty parameters.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempSaveCardBody = getImmutable(saveCardBody);\ntempSaveCardBody.data.cardholderName = \&quot; \&quot;;\ntempSaveCardBody.data.selectedPlan.braintree_plan = \&quot; \&quot;;\ntempSaveCardBody.data.nonce = \&quot; \&quot;;\ntempSaveCardBody.data.company = \&quot; \&quot;;\ntempSaveCardBody.data.billing_address1 = \&quot; \&quot;;\napi.post(apiURL)\n    .send(tempSaveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.name.message == messageList.SAVE_CARD_CUSTOMER_NAME_RQUIRED &amp;&amp;\n                res.body.error[\&quot;selectedPlan.braintree_plan\&quot;].message == messageList.SAVE_CARD_BRAINTREE_PLAN_REQUIRED &amp;&amp;\n                //res.body.error.nonce.message == messageList.SAVE_CARD_NONCE_RQUIRED &amp;&amp;\n                res.body.error.company.message == messageList.SAVE_CARD_COMPANY_RQUIRED &amp;&amp;\n                res.body.error.billing_address1.message == messageList.SAVE_CARD_STREET_ADDRESS_RQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c673981d-1cb4-4867-a79e-be4b4117e7b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid parameters error for empty name parameter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should give invalid parameters error for empty name parameter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempSaveCardBody = getImmutable(saveCardBody);\ndelete tempSaveCardBody.data.cardholderName;\ntempSaveCardBody.data.name = \&quot; \&quot;;\ntempSaveCardBody.data.selectedPlan.braintree_plan = \&quot; \&quot;;\ntempSaveCardBody.data.nonce = \&quot; \&quot;;\ntempSaveCardBody.data.company = \&quot; \&quot;;\ntempSaveCardBody.data.billing_address1 = \&quot; \&quot;;\napi.post(apiURL)\n    .send(tempSaveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.name.message == messageList.SAVE_CARD_CUSTOMER_NAME_RQUIRED &amp;&amp;\n                res.body.error[\&quot;selectedPlan.braintree_plan\&quot;].message == messageList.SAVE_CARD_BRAINTREE_PLAN_REQUIRED &amp;&amp;\n                //res.body.error.nonce.message == messageList.SAVE_CARD_NONCE_RQUIRED &amp;&amp;\n                res.body.error.company.message == messageList.SAVE_CARD_COMPANY_RQUIRED &amp;&amp;\n                res.body.error.billing_address1.message == messageList.SAVE_CARD_STREET_ADDRESS_RQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11c07a04-72f4-4a19-82e6-26d8000e6158&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error if wrong promocode is provide.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should give error if wrong promocode is provide.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPromoCode({\n    promo_code: \&quot;FAKE_PROMOCODE\&quot;,\n    status: httpStatus.BAD_REQUEST\n}, done, function(res) {\n    res.body.error.message.should.equal(messageList.PROMOCODE_INVALID);\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;db165f38-bd29-40b0-b6c4-4ee25d4546f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Apply another promocode while saving card in braintree.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Apply another promocode while saving card in braintree.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napplyPromoCodeToAlreadyApplyPromocode({}, done, function(user) {\n    var isValid = typeof(user._id) == \&quot;undefined\&quot; &amp;&amp;\n        typeof(user.__v) == \&quot;undefined\&quot; &amp;&amp;\n        user.user_plan.reimburse.credits == 100005 &amp;&amp;\n        user.user_plan.reimburse.period == 30 &amp;&amp;\n        user.user_plan.trigger.count == 22;\n    isValid.should.equal(true);\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77dada2f-309b-407e-b524-d6be488caeb6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to apply promocode if second time subscribe plan is not allowed.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should not allowed to apply promocode if second time subscribe plan is not allowed.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Plan.findOne({\n    uid: plan_uid\n}, function(error, plan) {\n    addPromcode({\n        count: 2,\n        promo_code: \&quot;PROMO_CODE\&quot;,\n        domain: \&quot;raweng.com\&quot;,\n        redemption_count: 1,\n        redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n        redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n        allowed_plans: [plan],\n        default_plan: null,\n        addon_credits: 5,\n        addon_flows: 2,\n        addon_triggers: 2,\n        addon_trial_days: 10,\n        braintree_discount_id: \&quot;PROMO_CODE\&quot;,\n        promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n    }, function(error, promoCodes) {\n        addPromcodeToUser({\n            promo_code: promoCodes[0].promo_code\n        }, function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var userPromoCode = res.body.output;\n                if (userPromoCode.user_uid == uid &amp;&amp;\n                    userPromoCode.uid != \&quot;\&quot;) {\n                    commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var isValid = res.body.output.uid == uid &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                    res.body.output.subscription.days == 40;\n                                var firstPrommoCode = res.body.output.user_promocode.promo_code;\n                                if (isValid) {\n                                    commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                                    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                                    var tempSaveCardBody = getImmutable(saveCardBody);\n                                    tempSaveCardBody.data.promo_code = promoCodes[1].promo_code;\n                                    api.post(apiURL)\n                                        .send(tempSaveCardBody)\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.BAD_REQUEST)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.error.message.should.equal(messageList.PROMOCODE_NOT_ALLOWED_PLAN);\n                                                done();\n                                            }\n                                        });\n                                } else {\n                                    true.should.equal(false);\n                                    done();\n                                }\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a279abf4-6d73-4680-ba42-c3207bae19de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to apply promocode if second time subscribe plan is not allowed and revoked_promo is set to true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should not allowed to apply promocode if second time subscribe plan is not allowed and revoked_promo is set to true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Plan.findOne({\n    uid: plan_uid\n}, function(error, plan) {\n    addPromcode({\n        count: 2,\n        promo_code: \&quot;PROMO_CODE\&quot;,\n        domain: \&quot;raweng.com\&quot;,\n        redemption_count: 1,\n        redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n        redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n        allowed_plans: [plan],\n        default_plan: null,\n        addon_credits: 5,\n        addon_flows: 2,\n        addon_triggers: 2,\n        addon_trial_days: 10,\n        braintree_discount_id: \&quot;PROMO_CODE\&quot;,\n        promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n    }, function(error, promoCodes) {\n        addPromcodeToUser({\n            promo_code: promoCodes[0].promo_code\n        }, function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var userPromoCode = res.body.output;\n                if (userPromoCode.user_uid == uid &amp;&amp;\n                    userPromoCode.uid != \&quot;\&quot;) {\n                    commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var isValid = res.body.output.uid == uid &amp;&amp;\n                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                    res.body.output.subscription.days == 40;\n                                var firstPrommoCode = res.body.output.user_promocode.promo_code;\n                                if (isValid) {\n                                    commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                                    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                                    var tempSaveCardBody = getImmutable(saveCardBody);\n                                    tempSaveCardBody.data.promo_code = promoCodes[0].promo_code;\n                                    tempSaveCardBody.data.revoked_promo = true;\n                                    api.post(apiURL)\n                                        .send(tempSaveCardBody)\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.BAD_REQUEST)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.error.message.should.equal(messageList.PROMOCODE_NOT_ALLOWED_PLAN);\n                                                done();\n                                            }\n                                        });\n                                } else {\n                                    true.should.equal(false);\n                                    done();\n                                }\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;791ee1ed-cb4a-4364-8c92-77eea3d37e5f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not show empty plan_price on save credit card.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should not show empty plan_price on save credit card.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            ((res.body.output.plan[0] || { \&quot;plan_price\&quot;: \&quot;\&quot; }).plan_price || \&quot;\&quot;)\n            .should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0134df6a-45fd-497e-9197-22158bb9b927&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should save credit card and cancel earlier subscription.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should save credit card and cancel earlier subscription.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n            commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(saveCardBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        ((res.body.output.plan || [{\n                            braintree_plan: \&quot;\&quot;\n                        }])[0].braintree_plan || \&quot;\&quot;).should.equal(saveCardBody.data.selectedPlan.braintree_plan);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86490c61-ebf3-47f2-9482-3bd77c4ab5e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should save credit card and ignore already subscription cancellation error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should save credit card and ignore already subscription cancellation error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:170,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.braintreeAlreadyCancelSubscription(httpmock, \&quot;enterprise\&quot;);\n            commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n            commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(saveCardBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        ((res.body.output.plan || [{\n                            braintree_plan: \&quot;\&quot;\n                        }])[0].braintree_plan || \&quot;\&quot;).should.equal(saveCardBody.data.selectedPlan.braintree_plan);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce4fba1c-313b-4e11-a9ad-f01ea1fab3ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.SaveCardInBrainTree Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeCancelSubscription(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(saveCardBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;deebbc9d-1bb6-4580-b103-095aaf2d70a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;aaa0aab3-15e2-4e38-9190-6cd8563f4f05&quot;,&quot;12021615-16e8-4e93-b75e-1187e23b664e&quot;,&quot;e9aadd87-8456-4185-b501-ed5d6358cea5&quot;,&quot;ac3c059e-7a52-4411-869f-f980063f1b86&quot;,&quot;c673981d-1cb4-4867-a79e-be4b4117e7b8&quot;,&quot;11c07a04-72f4-4a19-82e6-26d8000e6158&quot;,&quot;db165f38-bd29-40b0-b6c4-4ee25d4546f2&quot;,&quot;77dada2f-309b-407e-b524-d6be488caeb6&quot;,&quot;a279abf4-6d73-4680-ba42-c3207bae19de&quot;,&quot;791ee1ed-cb4a-4364-8c92-77eea3d37e5f&quot;,&quot;0134df6a-45fd-497e-9197-22158bb9b927&quot;,&quot;86490c61-ebf3-47f2-9482-3bd77c4ab5e4&quot;,&quot;ce4fba1c-313b-4e11-a9ad-f01ea1fab3ac&quot;,&quot;deebbc9d-1bb6-4580-b103-095aaf2d70a1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:734,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b8c3860b-3ed2-431a-80c2-b72b5027b727&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9fa61950-333e-40e6-bfea-a4fd476b9ec6&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4e893635-a11a-48b6-8b8e-5723003ba888&quot;,&quot;title&quot;:&quot;Payment.updatePaymentDetails&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentDetails.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:139,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var data = res.body.output;\n                    authToken = data.authtoken;\n                    _id = data._id;\n                    //braintreeToken = data.payment_set;\n                    //updatePaymentBody.data.token = braintreeToken;\n                    //done();\n                    commonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\n                    commonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\n                    var userUid = res.body.output.uid;\n                    api.post(\&quot;/enterprise/v1/user/account/creditcards\&quot;)\n                        .send(saveCardBody)\n                        .set(&#x27;authtoken&#x27;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                //updatePaymentBody.data.token = res.body.output.token;\n                                done();\n                            }\n                        });\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6006e08-e530-4acf-a4a6-39df306f514c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd30a8d0-984d-4226-b862-ec94fdae95ea&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update payment method.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails Should update payment method.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentDetail(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(updatePaymentBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output || {}).cardholderName.should.equal(updatePaymentBody.data.billing.cardholderName);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f5ccfee-c4e1-4e28-9eff-afbdd1bb3315&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update payment method with firstName field.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails Should update payment method with firstName field.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentDetail(httpmock, \&quot;enterprise\&quot;);\nvar userDetails = getImmutable(updatePaymentBody);\nuserDetails.data.billing.firstName = userDetails.data.billing.cardholderName;\ndelete userDetails.data.billing.cardholderName;\napi.put(apiURL)\n    .send(updatePaymentBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output || {}).cardholderName.should.equal(updatePaymentBody.data.billing.cardholderName);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eee3b292-f1e2-40e6-90f5-fc61f0a04f22&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid parameters error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails Should give invalid parameters error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempSaveCardBody = getImmutable(saveCardBody);\ndelete tempSaveCardBody.data.cardholderName;\ndelete tempSaveCardBody.data.nonce;\ndelete tempSaveCardBody.data.token;\ndelete tempSaveCardBody.data.company;\ndelete tempSaveCardBody.data.streetAddress;\napi.put(apiURL)\n    .send(tempSaveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;billing.name\&quot;].message == messageList.UPDATE_PAYMENT_BILLING_NAME_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.UPDATE_PAYMENT_NONCE_REQUIRED &amp;&amp;\n                res.body.error.token.message == messageList.UPDATE_PAYMENT_TOKEN_REQUIRED &amp;&amp;\n                res.body.error[\&quot;billing.company\&quot;].message == messageList.UPDATE_PAYMENT_COMPANY_REQUIRED &amp;&amp;\n                res.body.error[\&quot;billing.streetAddress\&quot;].message == messageList.UPDATE_PAYMENT_STREET_ADDRESS_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5896d8f3-5250-44b8-a1fa-da54db5b7c7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid parameters error for empty parameters.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails Should give invalid parameters error for empty parameters.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentMethod(httpmock, \&quot;enterprise\&quot;);\ncommonMock.braintreeSubscription(httpmock, \&quot;enterprise\&quot;);\nvar tempSaveCardBody = getImmutable(saveCardBody);\ntempSaveCardBody.data.cardholderName = \&quot; \&quot;;\ntempSaveCardBody.data.nonce = \&quot; \&quot;;\ntempSaveCardBody.data.token = \&quot; \&quot;;\ntempSaveCardBody.data.company = \&quot; \&quot;;\ntempSaveCardBody.data.streetAddress = \&quot; \&quot;;\napi.put(apiURL)\n    .send(tempSaveCardBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error[\&quot;billing.name\&quot;].message == messageList.UPDATE_PAYMENT_BILLING_NAME_REQUIRED &amp;&amp;\n                res.body.error.nonce.message == messageList.UPDATE_PAYMENT_NONCE_REQUIRED &amp;&amp;\n                res.body.error.token.message == messageList.UPDATE_PAYMENT_TOKEN_REQUIRED &amp;&amp;\n                res.body.error[\&quot;billing.company\&quot;].message == messageList.UPDATE_PAYMENT_COMPANY_REQUIRED &amp;&amp;\n                res.body.error[\&quot;billing.streetAddress\&quot;].message == messageList.UPDATE_PAYMENT_STREET_ADDRESS_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b9aa434-bf13-4708-b836-59c9d9d781b2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.updatePaymentDetails Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdatePaymentDetail(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(updatePaymentBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2b0a77a-d42d-4c3a-bb41-494b738f2881&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9f5ccfee-c4e1-4e28-9eff-afbdd1bb3315&quot;,&quot;eee3b292-f1e2-40e6-90f5-fc61f0a04f22&quot;,&quot;5896d8f3-5250-44b8-a1fa-da54db5b7c7f&quot;,&quot;1b9aa434-bf13-4708-b836-59c9d9d781b2&quot;,&quot;a2b0a77a-d42d-4c3a-bb41-494b738f2881&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:63,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3fb06cad-8ecc-4f23-a66b-46ec798f9ff6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;296b8e2f-7071-4d20-bc41-fc589f032707&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;846ee243-ada9-4e13-9a19-f790194bcdf8&quot;,&quot;title&quot;:&quot;Payment.UpdatePaymentSet&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\updatePaymentSet.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.UpdatePaymentSet \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(error, res) {\n                if (error) {\n                    done(error);\n                } else {\n                    var data = res.body.output;\n                    authToken = data.authtoken;\n                    _id = data._id;\n                    payment_set = data.payment_set;\n                    if (error) {\n                        done(error);\n                    } else {\n                        done();\n                    }\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d457b71-9d50-4acc-8e23-909811c613af&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.UpdatePaymentSet \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19972cb5-2f5e-48fd-ad16-503547c9ac7a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update payment_set for user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.UpdatePaymentSet Should update payment_set for user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send({})\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.payment_set.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;99d080e0-eab9-44f7-ac51-6bea475f1a60&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.UpdatePaymentSet Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;699cf323-ea03-44db-a60c-4f567453b24f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;99d080e0-eab9-44f7-ac51-6bea475f1a60&quot;,&quot;699cf323-ea03-44db-a60c-4f567453b24f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:34,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ed72c297-cb0a-4e66-aeba-570067b71570&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;794d90f6-7df1-4c58-959b-22e7b3011b90&quot;,&quot;title&quot;:&quot;Payment&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6e6f4267-805c-408c-ba3d-ac6acc1e5596&quot;,&quot;title&quot;:&quot;Payment.upgradeAccount&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\payment\\upgradeAccount.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.upgradeAccount \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:155,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndeleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    saveInvoices({\n                        authToken: authToken,\n                        braintree_customerId: res.body.output.braintree_customerId || \&quot;\&quot;,\n                        uid: res.body.output.uid || \&quot;\&quot;\n                    }, function() {\n                        done();\n                    });\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d064eb4-3d86-4ae2-83a5-692ba581c995&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.upgradeAccount \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;deleteAllInsertedRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ef548c9-160d-412d-8d9a-a900366b349b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.upgradeAccount \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7cb2c32f-b38e-4970-af0e-01de3b9e89ea&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update payment method.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.upgradeAccount Should update payment method.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdateCustomerPaymentDetail(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(upgradeAccountBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;baaa2920-82e7-46f9-9f16-89e8d53a3dfc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Payment Payment.upgradeAccount Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.braintreeUpdateCustomerPaymentDetail(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(upgradeAccountBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7140403a-adf1-4125-ad32-0d1a971d09c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;baaa2920-82e7-46f9-9f16-89e8d53a3dfc&quot;,&quot;7140403a-adf1-4125-ad32-0d1a971d09c5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;cc34a541-f807-41f6-b5dc-745cff37b516&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6bb0f876-edcc-4764-a637-7abaf2d84c4b&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;94821948-9b00-48fb-9a45-6e89cd0cf769&quot;,&quot;title&quot;:&quot;Plan.getAllPlanFaq&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getAllPlanFaq.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getAllPlanFaq \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97e36206-9022-49e5-9f46-fe49fd0a03b5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getAllPlanFaq \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nthis.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f749ce89-1ced-4694-9b36-b0d7e0dfce18&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plans faqs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getAllPlanFaq Should get list of plans faqs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4facec27-692b-4deb-aa0a-c0e8c3619497&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4facec27-692b-4deb-aa0a-c0e8c3619497&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;20e2f6c4-b412-4df1-9430-89285e28b7f6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;268e967d-6333-4f8c-827d-c8a55743abf3&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c1cae84a-8d4a-497f-b27a-e26b95a331b7&quot;,&quot;title&quot;:&quot;plans.getFeatures&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeatures.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan plans.getFeatures \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e5bb88d-b9f8-4e87-a75d-da0657d39c96&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan plans.getFeatures \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nthis.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a17f19cd-af7e-47c3-9f1c-0e311e2b75b7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of features.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan plans.getFeatures Should get list of features.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9bae0f2-2917-4902-9287-23d197780217&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of features in specific range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan plans.getFeatures Should get list of features in specific range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(paramURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5683b88f-e8be-4385-8d81-7db157f90867&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of features with query by feature name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan plans.getFeatures Should get list of features with query by feature name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var featureName = ((res.body.output || [])[0] || {}).feature_name || \&quot;\&quot;;\n            var paramURL = apiURL + \&quot;?query=\&quot; + featureName;\n            api.get(paramURL)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = false;\n                        if (Array.isArray(res.body.output)) {\n                            isValid = res.body.output.length &gt;= 1;\n                            _.each(res.body.output, function(item) {\n                                isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                            });\n                        }\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60f9221c-1271-46a6-8b5a-19416966b00b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a9bae0f2-2917-4902-9287-23d197780217&quot;,&quot;5683b88f-e8be-4385-8d81-7db157f90867&quot;,&quot;60f9221c-1271-46a6-8b5a-19416966b00b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:36,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ab0f37d9-b0a2-405c-8e2e-ce077ad51417&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;434c1794-3cd7-43f8-a691-fc3463ea8d6b&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cf1c7a79-188c-4132-9a1d-bfa3524da6e1&quot;,&quot;title&quot;:&quot;Plan.getFeaturesCount&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getFeaturesCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getFeaturesCount \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d346e3f1-b06e-4453-a8a3-bbfbb51e5111&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getFeaturesCount \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88c01071-9505-4556-9206-1180b6cc5491&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get count of features.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getFeaturesCount Should get count of features.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (isNaN(parseInt(res.body.output.count)) == false) {\n                isValid = parseInt(res.body.output.count) &gt; 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91e5ce12-998e-446b-946d-09304552dddf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;91e5ce12-998e-446b-946d-09304552dddf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;64aae142-cfb5-469a-9a1f-8224b8823d53&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;841fdc83-4e40-4dce-8699-de33d110e1d4&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b724e7c8-91d6-41cc-8f6c-fcddcc33bffc&quot;,&quot;title&quot;:&quot;Plan.getOrgPlansData&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getOrgPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:113,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                savePlanEntries({\n                    authtoken: authToken\n                }, function(error, tempPlanEntries) {\n                    savePlanEntries({\n                        authtoken: authToken,\n                        plan_type: \&quot;enterprise_organization\&quot;\n                    }, function(error, planEntries) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            _planEntries = planEntries;\n                            done();\n                        }\n                    });\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aec0bf2e-8386-42b4-96c2-6e13f21642c4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6387b8e4-7839-41e6-8511-0f3c111d7a30&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;054b780f-116d-45e1-bdd5-f65d9a2827b4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get list of plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33c975a9-d7f4-4d93-a9e0-1fdbd4555299&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of organization required plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get list of organization required plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?get=require\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8603134f-ad6e-4ef1-bd0c-6e41f3a46362&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of plans based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get limited list of plans based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd08e444-36fb-47be-ab41-15b66c5efb76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of plans based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get limited list of plans based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c980b3b-7081-4969-a824-a12cc21e7ef7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter list of plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get filter list of plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?query=utest_cases_\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 10;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;181297bd-e7ea-432d-baef-752b850400be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter limited list of plans based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get filter limited list of plans based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;query=utest_cases_\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1847fc3e-ed61-411d-8cda-b9330cff74d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter limited list of plans based on skip/limit and name in descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getOrgPlansData Should get filter limited list of plans based on skip/limit and name in descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;query=utest_cases_&amp;field=name&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output[0].uid == _planEntries[7].uid &amp;&amp;\n                    res.body.output[1].uid == _planEntries[6].uid;\n\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.plan_type == \&quot;enterprise_organization\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;74c01ae8-eab5-4f32-9740-b8c0c4a500fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;33c975a9-d7f4-4d93-a9e0-1fdbd4555299&quot;,&quot;8603134f-ad6e-4ef1-bd0c-6e41f3a46362&quot;,&quot;dd08e444-36fb-47be-ab41-15b66c5efb76&quot;,&quot;5c980b3b-7081-4969-a824-a12cc21e7ef7&quot;,&quot;181297bd-e7ea-432d-baef-752b850400be&quot;,&quot;1847fc3e-ed61-411d-8cda-b9330cff74d7&quot;,&quot;74c01ae8-eab5-4f32-9740-b8c0c4a500fd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:39,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;12c9adfe-7689-4fa0-a979-0ec8207cc9a6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8bbdfc88-c127-41e1-b954-a07ecec40e7b&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4e6ed01d-8d38-487a-b6b2-0ca3b4f6b934&quot;,&quot;title&quot;:&quot;Plan.getPlanById&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlanById.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlanById \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:107,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                //apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                savePlanEntries({\n                    authtoken: authToken\n                }, function(error, planEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _planEntries = planEntries;\n                        done();\n                    }\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1e8604ea-b04b-4051-9775-2f78e861e0e6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlanById \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;07f4ab9f-5456-4007-8bc5-d97274d25ca4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlanById \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2217d37b-252f-4c77-82c1-92f9abc659e8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get plan by id.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlanById Should get plan by id.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:plan_uid\&quot;, _planUid)\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(_planUid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6babaf58-d782-4683-889d-6cf75418ec69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlanById Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:plan_uid\&quot;, _planUid)\napi.get(paramURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;550b58dd-18a6-48ae-9cde-d8553a704caa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6babaf58-d782-4683-889d-6cf75418ec69&quot;,&quot;550b58dd-18a6-48ae-9cde-d8553a704caa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:17,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;02d081ad-aad5-4029-9b01-5af99c9942e2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;effc00c6-f1d9-49f1-a038-feddf8f688fd&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a1737102-b3f5-4732-b0f2-5317a4fb5e8e&quot;,&quot;title&quot;:&quot;Plan.getPlansCount&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansCount \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:106,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                savePlanEntries({\n                    authtoken: authToken\n                }, function(error, planEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _planEntries = planEntries;\n                        done();\n                    }\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44d64965-8709-44fb-9bf5-d57ae66cff7d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansCount \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d5951f6e-c9fd-47ae-8267-06732bf63562&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansCount \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f650b15b-75aa-4cd8-871f-c90b312a66b6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get count of plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansCount Should get count of plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            isNaN(parseInt(res.body.output.count)).should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c217c63b-2a16-43e8-ab18-56dce1734807&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c217c63b-2a16-43e8-ab18-56dce1734807&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4ccc27e4-868d-400a-98db-a5456a5dee72&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5944a906-7aea-4044-9145-92f15f59d6f4&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0c4a0125-0956-4106-95d9-d0c32accdd5b&quot;,&quot;title&quot;:&quot;Plan.getPlansData&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getPlansData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:103,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                savePlanEntries({\n                    authtoken: authToken\n                }, function(error, planEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _planEntries = planEntries;\n                        done();\n                    }\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;040f41b1-9960-44d2-affc-85b1cfc0b68e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;407312a9-d5d1-4964-aae0-2ec5d109ae43&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ae378316-a271-400f-8bed-a452f744acd0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData Should get list of plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc235485-7709-4ff3-8aa2-92037853fe2b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of plans based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData Should get limited list of plans based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab32e39f-3956-4141-bdb5-6adae8d78b90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter list of plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData Should get filter list of plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?query=utest_cases_\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 10;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df3cdb07-69e0-4974-82d3-054f9b0b7437&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter limited list of plans based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData Should get filter limited list of plans based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;query=utest_cases_\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75ae0748-91c7-441c-8729-1382014f0310&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get filter limited list of plans based on skip/limit and name in descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getPlansData Should get filter limited list of plans based on skip/limit and name in descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;query=utest_cases_&amp;field=name&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output[0].uid == _planEntries[7].uid &amp;&amp;\n                    res.body.output[1].uid == _planEntries[6].uid;\n\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp; typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4efc02b9-4454-4a86-8c12-22a9c5e511d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cc235485-7709-4ff3-8aa2-92037853fe2b&quot;,&quot;ab32e39f-3956-4141-bdb5-6adae8d78b90&quot;,&quot;df3cdb07-69e0-4974-82d3-054f9b0b7437&quot;,&quot;75ae0748-91c7-441c-8729-1382014f0310&quot;,&quot;4efc02b9-4454-4a86-8c12-22a9c5e511d7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:44,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ee9dbdda-4226-40e1-b8f5-7bacc581fe43&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ae3c02f5-3281-4bb5-8930-0fce19fdc95a&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;73bcab8f-8662-4184-bbbe-149f7d2f0702&quot;,&quot;title&quot;:&quot;Plan.getRequiredPlans&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getRequiredPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getRequiredPlans \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b12353d-c63f-4bc6-992c-35f0d5f3a99b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getRequiredPlans \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a455432e-bc59-4ac4-95c6-78181191086d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of required plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getRequiredPlans Should get list of required plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6646fe1b-15c3-44cf-9e26-7024d53884aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6646fe1b-15c3-44cf-9e26-7024d53884aa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:86,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;083794ad-1bca-437b-9cad-1b23beef751d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;697326e1-dccb-4656-8377-b9c0ac1a9faf&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;095957fa-3acd-4e97-8d97-1c6fdf1fd0a4&quot;,&quot;title&quot;:&quot;Plan.getViewPlans&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\getViewPlans.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getViewPlans \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8216251d-dfdc-4618-8cd9-16c657727ca0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getViewPlans \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9cf58f4-5130-4136-b543-2ce39f91e3e9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of viewed plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.getViewPlans Should get list of viewed plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output);\n            if (isValid) {\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6cdf411e-027f-493f-a194-92973d43e25a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6cdf411e-027f-493f-a194-92973d43e25a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:82,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1faf4d32-6fc4-4f51-b561-724fc5b04768&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1cc01afa-5444-4e4a-891d-3bd1a6892a80&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ff72c4c9-7d88-47a8-b75b-43a443675240&quot;,&quot;title&quot;:&quot;Plan.planSendMail&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\plans\\planSendMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.planSendMail \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3c6a871f-abac-4544-b5e1-de62b89a7568&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.planSendMail \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;589380aa-e91f-41e3-8a83-4ab1ca3e9023&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of plans faqs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.planSendMail Should get list of plans faqs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.sendMailFlowExecution(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(planSendBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(\&quot;Mail send successfully.\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8430fab3-b5cd-4f6c-ab43-1a63fe70152b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Plan Plan.planSendMail Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(planSendBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b5ff1b06-08b9-46c6-a5cc-60c76d98d8ae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8430fab3-b5cd-4f6c-ab43-1a63fe70152b&quot;,&quot;b5ff1b06-08b9-46c6-a5cc-60c76d98d8ae&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:16,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d1ddbd6f-1d11-4741-8ec0-af12b74f9f80&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\cloneProject.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\cloneProject.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;df69a266-e68a-4a19-9cec-d6014df1c918&quot;,&quot;title&quot;:&quot;Project.Clone&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\cloneProject.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\cloneProject.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Clone \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:109,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        customRoleProject = _.find(orgData.org_projects, { name: &#x27;proj2&#x27; })\n        async.waterfall([\n            function(cbk) {\n                var query = _models.newFlow.remove()\n                query.exec(function(err) {\n                    dummyUser = orgData.owner;\n                    dummyUser.authtoken = dummyUser.authtoken;\n                    testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                    _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                        cbk(err, userTrigger);\n                    })\n                })\n            },\n            function(userTrigger, cbk) {\n                var userTriggerObj = userTrigger;\n                var flowData = _.cloneDeep(testData.flowBody);\n                flowData.isExpress = false;\n                flowData.trigger.handlers = [userTriggerObj]\n                async.parallel({\n                    triggerFlow: function(cb) {\n                        createFlow(flowURL, flowData, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    },\n                    webHookFlow: function(cb) {\n                        var WHFlow = _.cloneDeep(flowData);\n                        WHFlow.trigger = testData.defaultTriggerObj;\n                        WHFlow.settings = testData.webHookSetting;\n                        WHFlow.active = true;\n                        WHFlow.settings = testData.webHookSetting;\n                        createFlow(flowURL, WHFlow, dummyUser, function(err, result) {\n                            cb(err, result);\n                        })\n                    }\n                }, function(err, result) {\n                    cbk(err, result)\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userTriggerFlow = res.triggerFlow._doc;\n                userWebHookFlow = res.webHookFlow._doc;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c473e61f-19e7-4c68-8b49-5afccb0af72b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Clone \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nvar flowUIDS = [userTriggerFlow.uid, userWebHookFlow.uid];\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: { $in: flowUIDS } }, function(err, deletedFlows) {\n            cb(err, deletedFlows)\n        });\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        //clearRecords(function(err, result) {\n        done()\n            //})\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;058c097d-2252-4023-9eab-1f3c86e27112&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Clone Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(_.replace(apiURL, &#x27;:project_uid&#x27;, dummyUser.default_project))\n    .send(getExecuteBody(userTriggerFlow))\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33f99121-c9a6-4999-a0ae-e39e580a1f66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should clone project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Clone Should clone project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { user_uid: dummyUser.uid }\nvar cloneOpt = { path: &#x27;/triggers/clone&#x27;, body: { \&quot;uid\&quot;: &#x27;testUserTrigger&#x27; } };\ncommonMock.projectTriggerCloneSuccess(cloneOpt);\napi.post(_.replace(apiURL, &#x27;:project_uid&#x27;, dummyUser.default_project))\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send()\n    .expect(200)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var newProject = res.body.output\n            expect(newProject).to.have.any.keys([&#x27;uid&#x27;]);\n            _models.newFlow.find({ project_uid: newProject.uid }, function(err, results) {\n                expect(results.length).to.equal(2);\n            })\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;90cde60a-2c6e-4bc6-a88c-870f11fd829c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;33f99121-c9a6-4999-a0ae-e39e580a1f66&quot;,&quot;90cde60a-2c6e-4bc6-a88c-870f11fd829c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1a8c5d4d-8104-4e3d-8c11-3d8d79a71160&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\createProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\createProject.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d3355e86-4e5c-4e29-a566-e739ec842f3a&quot;,&quot;title&quot;:&quot;Project.Create&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\createProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\createProject.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken;\n        done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c47a622c-5279-4b6c-92c0-b8bd04aad546&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Project.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [project.uid, adminOwnProject.uid, developerOwnProject.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d56326c-2a4c-4d7f-a1c8-77493f6c67a0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7fabd02c-85df-4384-84b7-820587976f39&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should create project, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\nprojectData.created_by = dummyUser.uid\nprojectData.updated_by = dummyUser.uid\nprojectData.env_uid = &#x27;flc9f0bbfd3393a79903fda5&#x27;\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            project = res.body.output\n            expect(project.name).equal(projectData.name);\n            expect(project).to.have.any.keys([&#x27;name&#x27;, &#x27;created_by&#x27;, &#x27;flow_count&#x27;, &#x27;icons&#x27;, &#x27;updated_by&#x27;, &#x27;locked_by&#x27;, &#x27;owner_uid&#x27;]);\n            _models.UserConfig.findOne({ project_uid: project.uid, name: &#x27;default&#x27; }, function(err, result) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(result.name).equal(&#x27;default&#x27;);\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc680f62-c2b8-4b09-ac70-9743953c238c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project, if developer tried to create a project in an valid org.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should create project, if developer tried to create a project in an valid org.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar developerProject = _.cloneDeep(projectData)\ndeveloperProject.name = &#x27;developerProject&#x27;\ndeveloperProject.owner_uid = orgData.developer.uid\ndeveloperProject.created_by = orgData.developer.uid\ndeveloperProject.updated_by = orgData.developer.uid\ndeveloperProject.env_uid = &#x27;flc9f0bbfd3393a79903fda5&#x27;\napi.post(apiURL)\n    .set({ authtoken: orgData.developer.authtoken, org_uid: orgData.organization.uid })\n    .send(developerProject)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            developerOwnProject = res.body.output\n            expect(developerOwnProject.name).equal(developerProject.name);\n            expect(developerOwnProject).to.have.any.keys([&#x27;name&#x27;, &#x27;created_by&#x27;, &#x27;flow_count&#x27;, &#x27;icons&#x27;, &#x27;updated_by&#x27;, &#x27;locked_by&#x27;, &#x27;owner_uid&#x27;]);\n            _models.UserConfig.findOne({ project_uid: developerOwnProject.uid, name: config.default_project }, function(err, result) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(result.name).equal(config.default_project);\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f785ead5-bca0-429e-80a5-c0e3d84acc3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project, if admin tried to create a project in an valid org.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should create project, if admin tried to create a project in an valid org.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar adminProject = _.cloneDeep(projectData)\nadminProject.name = &#x27;adminProject&#x27;\nadminProject.owner_uid = dummyUser.uid\nadminProject.created_by = dummyUser.uid\nadminProject.updated_by = dummyUser.uid\nadminProject.env_uid = dummyUser.default_env\napi.post(apiURL)\n    .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n    .send(adminProject)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            adminOwnProject = res.body.output\n            expect(adminOwnProject.name).equal(adminProject.name);\n            expect(adminOwnProject).to.have.all.keys([&#x27;uid&#x27;, &#x27;name&#x27;, &#x27;created_by&#x27;, &#x27;updated_by&#x27;,\n                &#x27;owner_uid&#x27;, &#x27;updated_at&#x27;, &#x27;created_at&#x27;, &#x27;flow_count&#x27;, &#x27;icons&#x27;, &#x27;env_uid&#x27;, &#x27;org_uid&#x27;, &#x27;deleted_at&#x27;\n            ]);\n            _models.UserConfig.findOne({ project_uid: adminOwnProject.uid, name: config.default_project }, function(err, result) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(result.name).equal(config.default_project);\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38d32918-8b56-4c3c-94e0-d44674b3fb1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error,  if billing manger tied to create a project in an org.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should get error,  if billing manger tied to create a project in an org.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\nprojectData.created_by = dummyUser.uid\nprojectData.updated_by = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.post(apiURL)\n    .set({ authtoken: orgData.billing_manager.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;89d1da89-6ae4-46e3-a594-ece62aa6b206&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error,  if normal tied to create a project in an org.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should get error,  if normal tied to create a project in an org.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\nprojectData.created_by = dummyUser.uid\nprojectData.updated_by = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.post(apiURL)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c4d3f857-068d-48d4-b1a5-dda664b04db6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user tried to create project with name already exists in an environment.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should get error if user tried to create project with name already exists in an environment.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.user_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NAME_UNIQUE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1bb64921-d0c3-474f-b497-242f4b9bcaf8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if  project name is blank.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Create Should get error if  project name is blank.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;&#x27;\nprojectData.user_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            expect(res.body.error.name.message).equal(messageList.PROJECT_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e7d0062-a525-46d5-8151-e80bbc86884c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7fabd02c-85df-4384-84b7-820587976f39&quot;,&quot;cc680f62-c2b8-4b09-ac70-9743953c238c&quot;,&quot;f785ead5-bca0-429e-80a5-c0e3d84acc3a&quot;,&quot;38d32918-8b56-4c3c-94e0-d44674b3fb1d&quot;,&quot;89d1da89-6ae4-46e3-a594-ece62aa6b206&quot;,&quot;c4d3f857-068d-48d4-b1a5-dda664b04db6&quot;,&quot;1bb64921-d0c3-474f-b497-242f4b9bcaf8&quot;,&quot;6e7d0062-a525-46d5-8151-e80bbc86884c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:110,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c6e41bb1-f3cb-4300-aae0-5722eb424729&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\createProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\createProjectParam.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0fa3f505-0e1c-44e3-ab5d-36e23bc0134f&quot;,&quot;title&quot;:&quot;ProjectParam.Create&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\createProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\createProjectParam.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(projectURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                project = res.body.output\n                done()\n            }\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;321457a3-1181-4878-85f7-01cd8011d075&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ uid: configSchema.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b84cd764-9298-420b-b7e8-7b255e2b58d6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(paramData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd88ed3d-e987-4a77-86c8-e50f45815ac0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project param, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create Should create project param, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .send(paramData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).equal(2);\n            _models.ConfigSchema.find({ user_uid: dummyUser.uid, type: &#x27;param&#x27; }, function(err, results) {\n                expect(results).length.gt(0);\n                done();\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cebda049-79a9-4ebb-94c1-2e1504068744&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give empty array in response, if user send data which is not in same project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create Should give empty array in response, if user send data which is not in same project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .send([{\n        uid: \&quot;dummy\&quot;,\n        key: \&quot;key\&quot;,\n        value: \&quot;value\&quot;,\n        \&quot;required\&quot;: false,\n        \&quot;isPassword\&quot;: true,\n        \&quot;hasError\&quot;: false\n    }])\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).equal(0);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ed0f8e9-11f2-49f6-be8f-bc477e8a6f79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create project param within an org, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create Should create project param within an org, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n    .send(paramData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).equal(2);\n            _models.ConfigSchema.find({ org_uid: orgData.organization.uid, type: &#x27;param&#x27; }, function(err, results) {\n                expect(results).length.gt(0);\n                done();\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23fab28f-ab40-49c6-a3d2-d0e7b94734bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if project not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Create Should get error, if project not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ authtoken: dummyUser.authtoken, project_uid: &#x27;ABC&#x27; })\n    .send({})\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7894005-a75b-43b4-a939-efbb07d3127a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dd88ed3d-e987-4a77-86c8-e50f45815ac0&quot;,&quot;cebda049-79a9-4ebb-94c1-2e1504068744&quot;,&quot;8ed0f8e9-11f2-49f6-be8f-bc477e8a6f79&quot;,&quot;23fab28f-ab40-49c6-a3d2-d0e7b94734bc&quot;,&quot;a7894005-a75b-43b4-a939-efbb07d3127a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:56,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;60dc5fb7-0ba7-446c-be94-e9e920ff12f4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\deleteProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\deleteProject.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;354d9701-9b68-454e-835e-0dcf828a72b6&quot;,&quot;title&quot;:&quot;Project.Delete&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\deleteProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\deleteProject.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(apiURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                project = res.body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55f127e0-2a17-4add-9868-ab662abc66af&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a93a7c12-00f7-4249-9857-c853a3a65b0c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + project.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31f5bc28-4543-4ad4-b0db-9ddc3ad6c3e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user tried to delete project which is not exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should get error if user tried to delete project which is not exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.user_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.delete(apiURL + &#x27;project.uid&#x27;)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0de5da3b-f539-42c2-9ea6-551eb0257afa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user tried to delete project which is default.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should get error if user tried to delete project which is default.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.user_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.delete(apiURL + dummyUser.default_project)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.DEFAULT_PROJECT_DELETE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c98ab375-a2cb-489d-a66e-60698b2a6ecc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete project, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should delete project, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;updated project&#x27;\napi.delete(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.message).to.be.equal(messageList.PROJECT_DELETE_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f24b42d3-7f1f-4759-9c84-dc1bc8964982&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if normal user tried to delete Project which is allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should get error, if normal user tried to delete Project which is allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.delete(apiURL + proj1.uid)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d6d78653-ccc3-4758-a6d7-a56c9ca861aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if normal user tried to delete Project which allocated to him but org_uid not passed in header.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should get error, if normal user tried to delete Project which allocated to him but org_uid not passed in header.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.delete(apiURL + proj1.uid)\n    .set({ authtoken: orgData.role1.authtoken })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;325637a0-cafb-4d56-a08e-d3672e77d3bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete project, if normal user tried to delete Project which is not allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should not delete project, if normal user tried to delete Project which is not allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj3 = _.find(orgData.org_projects, { name: &#x27;proj3&#x27; })\napi.delete(apiURL + proj3.uid)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23791a9a-23cc-42d0-bf46-eb369f850eea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if billing manager tried to delete Project which is not allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should get error, if billing manager tried to delete Project which is not allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.delete(apiURL + proj1.uid)\n    .set({ authtoken: orgData.billing_manager.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;037025f1-2947-443c-b383-00c619b19e04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete project, if admin of org tried to delete Project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should delete project, if admin of org tried to delete Project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj2 = _.find(orgData.org_projects, { name: &#x27;proj2&#x27; })\ntestData.mongoUserTriggerObj.user_uid = dummyUser.uid;\ntestData.mongoUserTriggerObj.project_uid = proj2.uid\n_models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n    api.delete(apiURL + proj2.uid)\n        .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n        .send(projectData)\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                expect(res.body.error.message).to.be.equal(messageList.PROJECT_HAS_TRIGGER);\n                _models.UserTrigger.remove({uid: userTrigger.uid}, function(err){\n                    done(err);\n                })\n            }\n        });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de7ceaa8-512a-4d1a-8cbe-4b6707ef2bf3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete project, if admin of org tried to delete Project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should delete project, if admin of org tried to delete Project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj2 = _.find(orgData.org_projects, { name: &#x27;proj2&#x27; })\napi.delete(apiURL + proj2.uid)\n    .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.message).to.be.equal(messageList.PROJECT_DELETE_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;35cd2b53-3ee2-4c60-a6e2-922e4a488a5b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete project, if developer of org tried to delete Project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Delete Should delete project, if developer of org tried to delete Project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.delete(apiURL + proj1.uid)\n    .set({ authtoken: orgData.developer.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.message).to.be.equal(messageList.PROJECT_DELETE_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91b452dd-d0f0-4419-b21e-e3f1f454785d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;31f5bc28-4543-4ad4-b0db-9ddc3ad6c3e6&quot;,&quot;0de5da3b-f539-42c2-9ea6-551eb0257afa&quot;,&quot;c98ab375-a2cb-489d-a66e-60698b2a6ecc&quot;,&quot;f24b42d3-7f1f-4759-9c84-dc1bc8964982&quot;,&quot;d6d78653-ccc3-4758-a6d7-a56c9ca861aa&quot;,&quot;325637a0-cafb-4d56-a08e-d3672e77d3bd&quot;,&quot;23791a9a-23cc-42d0-bf46-eb369f850eea&quot;,&quot;037025f1-2947-443c-b383-00c619b19e04&quot;,&quot;de7ceaa8-512a-4d1a-8cbe-4b6707ef2bf3&quot;,&quot;35cd2b53-3ee2-4c60-a6e2-922e4a488a5b&quot;,&quot;91b452dd-d0f0-4419-b21e-e3f1f454785d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:161,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;fb5ade64-a167-4512-91a5-89a63da5995a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\deleteProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\deleteProjectParam.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8b22c719-6922-4b46-8c30-8a01a1462b11&quot;,&quot;title&quot;:&quot;ProjectParam.Delete&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\deleteProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\deleteProjectParam.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:128,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        projectData.owner_uid = dummyUser.uid\n        projectData.env_uid = dummyUser.default_env\n        api.post(projectURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        project = res.body.output\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n            .send(paramData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        configSchema = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5eb4964a-5cbb-450d-9191-18e59603f880&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ uid: configSchema.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e29360b-ca7e-47b8-ba56-faa9b12a9247&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + configSchema.uid)\n    .send(paramData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8737ba2c-aa30-444d-ab20-eae7fad3fbad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete project param, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete Should delete project param, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + configSchema.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.message).equal(messageList.PARAMS_DELETE_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a714a350-ef42-426a-a620-b79de1b6a7a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if project not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete Should get error, if project not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: &#x27;ABC&#x27; })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a7d7e9c-4770-4a11-9bf7-a74bf5dcb34e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if configSchema not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Delete Should get error, if configSchema not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.NO_DATA_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a98fa66e-2f4a-46ba-ba73-bd353a03328b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8737ba2c-aa30-444d-ab20-eae7fad3fbad&quot;,&quot;a714a350-ef42-426a-a620-b79de1b6a7a6&quot;,&quot;5a7d7e9c-4770-4a11-9bf7-a74bf5dcb34e&quot;,&quot;a98fa66e-2f4a-46ba-ba73-bd353a03328b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:51,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e5580df2-3be8-467d-b8c9-c8d57f6017f9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\getProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\getProject.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2bb015c9-e3bb-4489-985d-97e2bcc78b6e&quot;,&quot;title&quot;:&quot;Project.Get&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\getProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\getProject.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner\n                dummyUser.authtoken = dummyUser.authtoken\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(apiURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            },\n            function(res, cbk) {\n                project = res.body.output\n                flowData.created_by = dummyUser.uid\n                flowData.updated_by = dummyUser.uid\n                flowData.project_uid = project.uid\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output\n                done()\n            }\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5b2deb59-f008-41c3-b597-b13c6168b7a9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9511221b-ffc5-4586-b8e6-1595cfcfb03b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + project.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a43f026d-2d70-442e-ba67-63f8451d0065&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tried to get project which not exists in an environment.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get error, if user tried to get project which not exists in an environment.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.get(apiURL + &#x27;project.uid&#x27;)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;971898ad-5967-4fb7-a499-ae692c820321&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get project, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.name).equal(projectData.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;768f0d72-35a4-4b67-8b63-3275c0187194&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project, if normal user tried to get Project which is allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get project, if normal user tried to get Project which is allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.get(apiURL + proj1.uid)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.name).equal(proj1.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f505ce9e-6a90-4a39-a7aa-77a3de95501f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if normal user tried to get Project which is not allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get error, if normal user tried to get Project which is not allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj3 = _.find(orgData.org_projects, { name: &#x27;proj3&#x27; })\napi.get(apiURL + proj3.uid)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8de48c50-d557-4e22-966c-9a723545fc17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if billing manager tried to get Project which is not allocated to him.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get error, if billing manager tried to get Project which is not allocated to him.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.get(apiURL + proj1.uid)\n    .set({ authtoken: orgData.billing_manager.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.error.message).equal(messageList.ACCESS_DENIED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a833cd9-1bda-4f0e-9e67-e9090975a678&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project, if admin of org tried to get Project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get project, if admin of org tried to get Project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.get(apiURL + proj1.uid)\n    .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.name).equal(proj1.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e16b776-0b71-4a7a-b025-afc9e4fcc91c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project, if developer of org tried to get Project.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Get Should get project, if developer of org tried to get Project.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar proj1 = _.find(orgData.org_projects, { name: &#x27;proj1&#x27; })\napi.get(apiURL + proj1.uid)\n    .set({ authtoken: orgData.developer.authtoken, org_uid: orgData.organization.uid })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output).to.have.any.keys([&#x27;project&#x27;, &#x27;flows&#x27;, &#x27;configs&#x27;])\n            expect(res.body.output.name).equal(proj1.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;53dce374-6498-492b-839f-af7075647b58&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a43f026d-2d70-442e-ba67-63f8451d0065&quot;,&quot;971898ad-5967-4fb7-a499-ae692c820321&quot;,&quot;768f0d72-35a4-4b67-8b63-3275c0187194&quot;,&quot;f505ce9e-6a90-4a39-a7aa-77a3de95501f&quot;,&quot;8de48c50-d557-4e22-966c-9a723545fc17&quot;,&quot;7a833cd9-1bda-4f0e-9e67-e9090975a678&quot;,&quot;2e16b776-0b71-4a7a-b025-afc9e4fcc91c&quot;,&quot;53dce374-6498-492b-839f-af7075647b58&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:103,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b60a59f4-ea41-4138-a6e1-a0fe4c45a005&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\getProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\getProjectParam.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;641212a7-4368-434b-b4e6-a9a01b1e2f57&quot;,&quot;title&quot;:&quot;ProjectParam.Get&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\getProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\getProjectParam.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:129,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        projectData.owner_uid = dummyUser.uid\n        projectData.env_uid = dummyUser.default_env\n        api.post(projectURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        project = res.body.output\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n            .send(paramData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        configSchema = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b5a4d4b-d78f-473e-b6b9-022b398330da&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ uid: configSchema.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd23d441-544b-4922-ac9a-69ccbec56859&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + configSchema.uid)\n    .send(paramData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d643a344-fce3-43e7-af5a-3b617343bb8b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project param, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get Should get project param, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + configSchema.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.key).equal(paramData.key);\n            expect(res.body.output.value).equal(paramData.value);\n            expect(res.body.output).not.have.all.keys([&#x27;param&#x27;])\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c4ef660-3139-40aa-8dae-79a95bd88131&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if project not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get Should get error, if project not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: &#x27;ABC&#x27; })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd0249a4-1842-4325-9b0e-90df19493e46&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if configSchema not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Get Should get error, if configSchema not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.NO_DATA_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78aca646-4681-4bd1-a50a-89bea4ff7c4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d643a344-fce3-43e7-af5a-3b617343bb8b&quot;,&quot;2c4ef660-3139-40aa-8dae-79a95bd88131&quot;,&quot;fd0249a4-1842-4325-9b0e-90df19493e46&quot;,&quot;78aca646-4681-4bd1-a50a-89bea4ff7c4d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:50,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;30eddd38-b73b-4e91-9b75-8b5a43691165&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\listProjectParams.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\listProjectParams.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0048e84f-68a9-4063-abba-0ed6ad4ca492&quot;,&quot;title&quot;:&quot;ProjectParam.List&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\listProjectParams.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\listProjectParams.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.List \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:129,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        projectData.owner_uid = dummyUser.uid\n        projectData.env_uid = dummyUser.default_env\n        api.post(projectURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        project = res.body.output\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n            .send(paramData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        configSchema = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ecdc3cf-ca77-4b52-8d7e-a04c96009201&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.List \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ uid: configSchema.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b0a14be-0cfe-4d4d-8110-230b6307f1ee&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.List Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .send(paramData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5bf6d24d-a154-4686-ba23-a856fa0a50e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project params, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.List Should get project params, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).equal(1)\n            expect(_.first(res.body.output)).not.have.all.keys([&#x27;param&#x27;])\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69ec1e78-4840-4617-8522-c18784a698bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5bf6d24d-a154-4686-ba23-a856fa0a50e6&quot;,&quot;69ec1e78-4840-4617-8522-c18784a698bf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f75b746c-1014-40b7-b4f5-068e70ca749a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\listProjects.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\listProjects.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6db8ed68-67a8-4cda-a3ec-7506e8be878a&quot;,&quot;title&quot;:&quot;Project.List&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\listProjects.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\listProjects.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(apiURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                project = res.body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9222acb8-c448-453e-b36c-5e4a1fad5bf7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ad6b433f-b2f9-4dd1-afcc-adb77e42f65c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de618747-0c8c-42c9-bf63-9ca07a345ce1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project list.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List Should get project list.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: dummyUser.authtoken })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.projects.length).equal(2);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36713c40-fa01-4a6c-86b4-7140acc86e54&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get project list.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List Should get project list.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\napi.get(apiURL + &#x27;?q=&#x27; + projectData.name)\n    .set({ authtoken: dummyUser.authtoken })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.projects).name).equal(projectData.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4228a61f-950d-49ac-9a1b-f7c52d05e2a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;billing manager should get defualt project only in list call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List billing manager should get defualt project only in list call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: orgData.billing_manager.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.count).to.be.equal(1)\n            expect(_.first(res.body.output.projects).name).to.be.equal(config.default_project)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ecf72b6f-3a4e-494c-9f17-fc5258a3e05c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;admin should get all projects of an org in list call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List admin should get all projects of an org in list call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: orgData.admin.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.count).to.be.equal(5)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2a82e39-e387-4265-aa36-3d3d10fc9f86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;custom role user should get projects assigned to him in list call.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List custom role user should get projects assigned to him in list call.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: orgData.role1.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.count).to.be.equal(3)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7bbe668-8e18-496c-8424-aa3035a14030&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;owner of org should get all projects of org.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.List owner of org should get all projects of org.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ authtoken: dummyUser.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.projects.length).equal(5);\n            expect(res.body.output.projects[0].org_uid).equal(orgData.organization.uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;747a480b-0074-409e-b58d-150a09fd5d45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;de618747-0c8c-42c9-bf63-9ca07a345ce1&quot;,&quot;36713c40-fa01-4a6c-86b4-7140acc86e54&quot;,&quot;4228a61f-950d-49ac-9a1b-f7c52d05e2a4&quot;,&quot;ecf72b6f-3a4e-494c-9f17-fc5258a3e05c&quot;,&quot;d2a82e39-e387-4265-aa36-3d3d10fc9f86&quot;,&quot;a7bbe668-8e18-496c-8424-aa3035a14030&quot;,&quot;747a480b-0074-409e-b58d-150a09fd5d45&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:95,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;08723853-3dcb-48ec-bb70-561ece8b5015&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\updateProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\updateProject.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;715da809-6963-4630-8d7d-fa5a110cb9ac&quot;,&quot;title&quot;:&quot;Project.Update&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\updateProject.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\updateProject.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        projectData.user_uid = dummyUser.uid\n        projectData.env_uid = dummyUser.default_env\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(projectData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        project = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a3891b6-27db-4c94-9c35-218d01f41832&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82ace8c1-e3e5-4aa6-bbee-d61b7aed9c5a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + project.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95b0e3a4-6571-4368-b2b2-ae24217db332&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user tried to update project which not exists in an environment.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should get error, if user tried to update project which not exists in an environment.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.owner_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.put(apiURL + &#x27;project.uid&#x27;)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;53d036ef-b4f6-4689-9e7a-71986774a79c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user tried to update project with name already exists in an environment.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should get error if user tried to update project with name already exists in an environment.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar project1 = _.cloneDeep(projectData)\nproject1.owner_uid = dummyUser.uid\nproject1.env_uid = dummyUser.default_env\napi.put(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .send(project1)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NAME_UNIQUE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;025682fd-794a-4ff5-bba8-e2be35fc98b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user tried to update project which is default.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should get error if user tried to update project which is default.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar project1 = _.cloneDeep(projectData)\nproject1.owner_uid = dummyUser.uid\nproject1.env_uid = dummyUser.default_env\napi.put(apiURL + dummyUser.default_project)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .send(project1)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.DEFAULT_PROJECT_DELETE_ERROR);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;554b72df-3635-476c-9376-7dd070b2075e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update project, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should update project, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;updated project&#x27;\napi.put(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken })\n    .send(projectData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.name).equal(projectData.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a91a57b2-f487-4a5e-9521-a844b936816b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if  project name is blank.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Project.Update Should get error if  project name is blank.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nprojectData.name = &#x27;&#x27;\nprojectData.owner_uid = dummyUser.uid\nprojectData.env_uid = dummyUser.default_env\napi.put(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, env_uid: dummyUser.env_uid || dummyUser.default_env })\n    .send(projectData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            expect(res.body.error.name.message).equal(messageList.PROJECT_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;239f901b-ec0a-4616-ab31-834dc7737a67&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;95b0e3a4-6571-4368-b2b2-ae24217db332&quot;,&quot;53d036ef-b4f6-4689-9e7a-71986774a79c&quot;,&quot;025682fd-794a-4ff5-bba8-e2be35fc98b7&quot;,&quot;554b72df-3635-476c-9376-7dd070b2075e&quot;,&quot;a91a57b2-f487-4a5e-9521-a844b936816b&quot;,&quot;239f901b-ec0a-4616-ab31-834dc7737a67&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:82,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7e896912-984d-4ba2-a1f0-ed9f1ef7971d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\updateProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\updateProjectParam.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dfb5b430-2bc4-4000-a7ed-eab1e20e05d4&quot;,&quot;title&quot;:&quot;ProjectParam.Update&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\project\\updateProjectParam.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\project\\updateProjectParam.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                projectData.owner_uid = dummyUser.uid\n                projectData.env_uid = dummyUser.default_env\n                api.post(projectURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(projectData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, result) {\n                        cbk(err, result);\n                    })\n            },\n            function(res, cbk) {\n                project = res.body.output\n                api.post(apiURL)\n                    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n                    .send(paramData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                configSchema = res.body.output\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5c4d7c4-25a5-4e96-baf9-c68956cc0887&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.Project.remove({ uid: project.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ uid: configSchema.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27700878-fff4-47ae-aedc-241ddbcea9fd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + configSchema.uid)\n    .send(paramData)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4b1bb2e-9f33-47c9-8759-91269f4e0c70&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update project param, if user send valid data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update Should update project param, if user send valid data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramData2 = {\n    key: \&quot;key2\&quot;,\n    value: \&quot;value2\&quot;,\n    required: false,\n    isPassword: true,\n    hasError: false\n}\nparamData2.key = &#x27;key2&#x27;\napi.put(apiURL + configSchema.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .send(paramData2)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.param.key).equal(paramData2.key);\n            expect(res.body.output.param.value).equal(paramData2.value);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1284ff3-3ea6-4d78-a2aa-59807f6e5b5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if unauthorised user tried to update data of other user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update Should get error, if unauthorised user tried to update data of other user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + project.uid)\n    .set({ authtoken: orgData.role1.authtoken })\n    .send({})\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.NO_DATA_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d232d20a-1b53-47e3-a7d1-c804601d806e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if project not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update Should get error, if project not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: &#x27;ABC&#x27; })\n    .send({})\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PROJECT_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;621ea122-473d-4724-9c13-97ed4c6152d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if configSchema not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ProjectParam.Update Should get error, if configSchema not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramData3 = {\n    key: \&quot;key2\&quot;,\n    value: \&quot;value2\&quot;,\n    required: false,\n    isPassword: true,\n    hasError: false\n}\nparamData3.key = &#x27;key2&#x27;\napi.put(apiURL + project.uid)\n    .set({ authtoken: dummyUser.authtoken, project_uid: project.uid })\n    .send(paramData3)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.NO_DATA_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b675eb5-d9bc-4a10-9a0d-5548005c631e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b4b1bb2e-9f33-47c9-8759-91269f4e0c70&quot;,&quot;c1284ff3-3ea6-4d78-a2aa-59807f6e5b5d&quot;,&quot;d232d20a-1b53-47e3-a7d1-c804601d806e&quot;,&quot;621ea122-473d-4724-9c13-97ed4c6152d4&quot;,&quot;0b675eb5-d9bc-4a10-9a0d-5548005c631e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:47,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dad9af07-5186-4eea-93e4-7736c5f8fde7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c8b68c38-df14-4b11-93fa-8768f1c6467b&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6e8c506a-05b9-4e64-9056-480a16241630&quot;,&quot;title&quot;:&quot;PromoCode.Create&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Plan.remove({ $or: [{ name: new RegExp(&#x27;^RANDOM_PLAN+&#x27;, \&quot;i\&quot;) }, { name: new RegExp(&#x27;^utest_cases_Standard+&#x27;, \&quot;i\&quot;) }] }, function(error, plan) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            _models.Promocode.remove({}, function(error, promo) {\n                _models.UserPromocode.remove({}, function(error, userPromos) {\n                    savePlanEntries({\n                        count: 5\n                    }, function(error, planEntries) {\n                        _planEntries = planEntries;\n                        done();\n                    });\n                });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;763f32ae-9ce7-4070-a3e5-c93f48c72b7f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9cb24a10-b6e4-40ca-9778-b989e43aa4ad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should add only promocode to user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should add only promocode to user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:102,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid != \&quot;\&quot;).should.equal(true);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df75af86-2b06-48eb-9708-ee70304105df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promocode is not allowed for trial plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should give error as promocode is not allowed for trial plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_NOT_ALLOWED_FOR_DEFAULT);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c7e122e-483f-4f2a-ae7e-02d576a94edb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode and its default plan to user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should add promocode and its default plan to user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:99,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                res.body.output.plan[0].uid == _planEntries[0].uid).should.equal(true);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91e417ac-c166-49c3-bd40-a377b182bca1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode to user and return proper user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should add promocode to user and return proper user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:98,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var user = res.body.output;\n            var isValid = typeof(user._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(user.__v) == \&quot;undefined\&quot; &amp;&amp;\n                user.user_plan.reimburse.credits == 2505 &amp;&amp;\n                user.user_plan.reimburse.period == 30 &amp;&amp;\n                user.user_plan.trigger.count == 7;\n            isValid.should.equal(true);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf878f21-814d-495d-9998-9d9131885037&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promocode invalid domain.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should give error as promocode invalid domain.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code,\n        email: \&quot;test.user+1@built.io\&quot;,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_DOMAIN_NOT_ALLOWED);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f44d7d1c-9c41-47bc-a6a7-f92e2566e418&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should give error as invalid promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: \&quot;FAKE_PROMO_CODE\&quot;,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a11f30c-9953-45ff-a7c6-47d51d0126af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid promocode error for future promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should give invalid promocode error for future promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).add(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(3, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5fbbc05e-f0b3-440e-9cfc-ea6e45a14f3d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give promocode expire error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should give promocode expire error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_EXPIRED);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;554f0c0a-958b-4306-b5c0-9e792e067838&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allocate promocode to only two users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should allocate promocode to only two users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:216,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 2,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: _planEntries[0],\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                res.body.output.plan[0].uid == _planEntries[0].uid) {\n                signUpUser({\n                    email: \&quot;test.user+2@raweng.com\&quot;,\n                    promo_code: promoCodes[0].promo_code\n                }, function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                            res.body.output.plan[0].uid == _planEntries[0].uid) {\n                            signUpUser({\n                                email: \&quot;test.user+3@raweng.com\&quot;,\n                                promo_code: promoCodes[0].promo_code,\n                                status: httpStatus.BAD_REQUEST\n                            }, function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    (res.body.error.message).should.equal(messageList.PROMOCODE_OVER_REDEMPT);\n                                    done();\n                                }\n                            });\n                        } else {\n                            true.should.equal(false);\n                            done();\n                        }\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76fabbc2-8665-4357-bf5e-a85e73abe883&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode add signup.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.Create Should add promocode add signup.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;gmail.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    var tempRegistrationBody = getImmutable(registrationBody);\n    tempRegistrationBody.promo_code = promoCodes[0].promo_code;\n    tempRegistrationBody.email = \&quot;test.user@gmail.com\&quot;;\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(tempRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.subscription.days.should.equal(40);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8d657cec-e10d-42e8-815a-33d412a8ed25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;df75af86-2b06-48eb-9708-ee70304105df&quot;,&quot;4c7e122e-483f-4f2a-ae7e-02d576a94edb&quot;,&quot;91e417ac-c166-49c3-bd40-a377b182bca1&quot;,&quot;cf878f21-814d-495d-9998-9d9131885037&quot;,&quot;f44d7d1c-9c41-47bc-a6a7-f92e2566e418&quot;,&quot;5a11f30c-9953-45ff-a7c6-47d51d0126af&quot;,&quot;5fbbc05e-f0b3-440e-9cfc-ea6e45a14f3d&quot;,&quot;554f0c0a-958b-4306-b5c0-9e792e067838&quot;,&quot;76fabbc2-8665-4357-bf5e-a85e73abe883&quot;,&quot;8d657cec-e10d-42e8-815a-33d412a8ed25&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:677,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1d1dd610-3c9c-4933-b94b-6d2b19add8fa&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;39dbdb06-53ab-46b2-9d68-ae456a91e63b&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;add0568c-590b-45e7-8070-3edcf6a932d0&quot;,&quot;title&quot;:&quot;PromoCode.getUserList&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\getUserList.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2939,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    savePlanEntries({\n        count: 5\n    }, function(error, planEntries) {\n        _planEntries = planEntries;\n        addPromcode({\n            count: 1,\n            promo_code: \&quot;PROMO_CODE\&quot;,\n            domain: \&quot;raweng.com\&quot;,\n            redemption_count: 30,\n            redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n            redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n            allowed_plans: [],\n            default_plan: _planEntries[0],\n            addon_credits: 5,\n            addon_flows: 2,\n            addon_active_flows: 2,\n            addon_triggers: 2,\n            addon_trial_days: 10,\n            braintree_discount_id: \&quot;\&quot;,\n            promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n        }, function(error, promoCodes) {\n            addUsersWithPromocode({\n                count: 30,\n                promo_code: promoCodes[0].promo_code\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    done();\n                }\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;638aa500-1545-4c0b-a1d5-2ecc44c84d60&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c63e4b0d-2d1b-4f4b-9ccb-150cd1c26e4f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList Should get list users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isArray = Array.isArray(res.body.output.objects);\n            isArray.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3021dbfe-e680-4f5c-a646-c9edf14009c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode to user and return proper user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList Should add promocode to user and return proper user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:74,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isArray = Array.isArray(res.body.output.objects);\n            if (isArray) {\n                var isValid = true;\n                _.forEach(res.body.output.objects, function(user) {\n                    if (user.plan[0].uid == _planEntries[0].uid) {\n                        isValid = isValid &amp;&amp; user.uid != \&quot;\&quot; &amp;&amp;\n                            typeof(user._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(user.__v) == \&quot;undefined\&quot; &amp;&amp;\n                            user.user_plan.reimburse.credits == 1005 &amp;&amp;\n                            user.user_plan.reimburse.period == 30 &amp;&amp;\n                            user.user_plan.trigger.count == 42 &amp;&amp;\n                            user.user_plan.flow.count == 102;\n                    }\n                });\n                isValid.should.equal(true);\n            } else {\n                true.should.equal(false);\n            }\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c6da68ec-ea73-4a59-a0d4-b9324d6146df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of users by considering skip.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList Should get list of users by considering skip.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:67,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=5\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 25 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e8ea50b-2f56-467f-948c-47901de11a0f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of users by considering limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList Should get list of users by considering limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=5\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 5 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d3b2f32-8bc2-4a50-a629-31e8b8ebda2f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode applied users by considering skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.getUserList Should get list of promocode applied users by considering skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=5&amp;limit=10\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 10 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f1dd53c-1b89-4c01-aa94-f9734faf5ce3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3021dbfe-e680-4f5c-a646-c9edf14009c1&quot;,&quot;c6da68ec-ea73-4a59-a0d4-b9324d6146df&quot;,&quot;3e8ea50b-2f56-467f-948c-47901de11a0f&quot;,&quot;2d3b2f32-8bc2-4a50-a629-31e8b8ebda2f&quot;,&quot;7f1dd53c-1b89-4c01-aa94-f9734faf5ce3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:267,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2088c174-71f0-4360-80c0-73d244c7f999&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;988dfe36-59b7-4d23-8dde-ab5ccd712ae9&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;57c8c844-06f9-4e27-8474-355254388048&quot;,&quot;title&quot;:&quot;PromoCode.userPromocodeAdd&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeAdd.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({}, function(error, user) {\n    _models.Plan.remove({ $or: [{ name: new RegExp(&#x27;^RANDOM_PLAN+&#x27;, \&quot;i\&quot;) }, { name: new RegExp(&#x27;^utest_cases_Standard+&#x27;, \&quot;i\&quot;) }] }, function(error, plan) {\n        _models.Mail.remove({}, function(error, user) {\n            _models.Promocode.remove({}, function(error, promo) {\n                _models.UserPromocode.remove({}, function(error, userPromos) {\n                    signUpUser({}, function(err, res) {\n                        authToken = res.body.output.authtoken;\n                        token = res.body.output.activation_token;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        savePlanEntries({\n                            count: 5\n                        }, function(error, planEntries) {\n                            _planEntries = planEntries;\n                            done();\n                        });\n                    });\n                });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e4e6496c-a6b3-413f-bb7e-791a63848fc4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0bfbe5f-93a0-43b7-a675-0ed679bc8876&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should add promocode to user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should add promocode to user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp;\n                userPromoCode.uid != \&quot;\&quot;) {\n                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.output.uid == uid &amp;&amp;\n                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                res.body.output.subscription.days == 40;\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e415f1d-267c-40d3-8b66-a388edde63bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode to user and return proper user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should add promocode to user and return proper user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:114,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authtoken = res.body.output.authtoken;\n            var user_uid = res.body.output.uid;\n            addPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                user_uid: user_uid,\n                status: httpStatus.OK\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(&#x27;authtoken&#x27;, authtoken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var user = res.body.output;\n                                var isValid = user.uid == user_uid &amp;&amp;\n                                    typeof(user._id) == \&quot;undefined\&quot; &amp;&amp;\n                                    typeof(user.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                    user.user_plan.reimburse.credits == 1005 &amp;&amp;\n                                    user.user_plan.reimburse.period == 30 &amp;&amp;\n                                    user.user_plan.trigger.count == 42 &amp;&amp;\n                                    user.user_plan.flow.count == 102;\n                                isValid.should.equal(true);\n                                done();\n                            }\n                        });\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12cd43fd-b1f6-468c-9590-be67c261c130&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should re-again redempt another promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should re-again redempt another promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 2,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                var promocode_uid = userPromoCode.promocode_uid[0];\n                addPromcodeToUser({\n                    promo_code: promoCodes[1].promo_code\n                }, function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var userPromoCode = res.body.output;\n                        (userPromoCode.user_uid == uid &amp;&amp;\n                            userPromoCode.uid != \&quot;\&quot; &amp;&amp;\n                            userPromoCode.promocode_uid[0] != promocode_uid).should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e933cd83-e5fb-486c-bbf3-535ef8f5558f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allocate promocode to only two users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should allocate promocode to only two users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:210,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 2,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                signUpUser({\n                    email: \&quot;test.user+1@raweng.com\&quot;\n                }, function(err, res) {\n                    var userUID1 = res.body.output.uid;\n                    addPromcodeToUser({\n                        promo_code: promoCodes[0].promo_code,\n                        user_uid: userUID1\n                    }, function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var userPromoCode = res.body.output;\n                            if (userPromoCode.user_uid == userUID1 &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                                signUpUser({\n                                    email: \&quot;test.user+2@raweng.com\&quot;\n                                }, function(err, res) {\n                                    var userUID2 = res.body.output.uid;\n                                    addPromcodeToUser({\n                                        promo_code: promoCodes[0].promo_code,\n                                        status: httpStatus.BAD_REQUEST\n                                    }, function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            (res.body.error.message).should.equal(messageList.PROMOCODE_OVER_REDEMPT);\n                                            done();\n                                        }\n                                    });\n                                });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d5d8136-2a2f-4be3-894a-700b724d6d91&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allocate promocode if user plan is included in allowed_plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should allocate promocode if user plan is included in allowed_plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    var promocode_uid = promoCodes[0].uid;\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            addPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                status: httpStatus.OK,\n                user_uid: res.body.output.uid\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.uid.should.not.equal(\&quot;\&quot;);\n                    done();\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86a92bc6-cae1-4e85-adef-3efd75450cb4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as user is not allowed to redempt promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give error as user is not allowed to redempt promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[1]],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    var promocode_uid = promoCodes[0].uid;\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            addPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                user_uid: res.body.output.uid,\n                status: httpStatus.BAD_REQUEST\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    (res.body.error.message).should.equal(messageList.PROMOCODE_NOT_ALLOWED_PLAN);\n                    done();\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3b37052-2ae8-42c6-aa25-033d57cd5c80&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error if promocode is already reverted.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give error if promocode is already reverted.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:107,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var user_uid = res.body.output.uid;\n            addPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                user_uid: user_uid,\n                status: httpStatus.OK\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    _models.UserPromocode.findOneAndUpdate({\n                        uid: res.body.output.uid\n                    }, {\n                        deleted_at: new Date()\n                    }, function(error, userPromo) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            addPromcodeToUser({\n                                promo_code: promoCodes[0].promo_code,\n                                user_uid: user_uid,\n                                status: httpStatus.BAD_REQUEST\n                            }, function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    (res.body.error.message).should.equal(messageList.PROMOCODE_IS_ALREADY_ALLOCATED);\n                                    done();\n                                }\n                            });\n                        }\n                    })\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a94a593-875a-427c-9be4-46fbc058a395&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give promocode expire error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give promocode expire error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_EXPIRED);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb8dafe7-3cd8-4873-ae80-ded380d5428f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid promocode error for future promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give invalid promocode error for future promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).add(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(3, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8cd32026-0d9e-4624-acdc-cd0549472870&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promo code already redempt.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give error as promo code already redempt.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 2,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                addPromcodeToUser({\n                    promo_code: promoCodes[0].promo_code,\n                    status: httpStatus.BAD_REQUEST\n                }, function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        (res.body.error.message).should.equal(messageList.PROMOCODE_IS_ALREADY_ALLOCATED);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a32ab77c-c28d-466b-9d1a-21a354951648&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give error as invalid promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: \&quot;FAKE_PROMO_CODE\&quot;,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4bc27956-8eb6-43a4-81b7-077f3467dcbf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promocode invalid domain.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeAdd Should give error as promocode invalid domain.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        email: \&quot;test.user@built.io\&quot;\n    }, function(err, res) {\n        addPromcodeToUser({\n            promo_code: promoCodes[0].promo_code,\n            status: httpStatus.BAD_REQUEST,\n            user_uid: res.body.output.uid\n        }, function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                (res.body.error.message).should.equal(messageList.PROMOCODE_DOMAIN_NOT_ALLOWED);\n                done();\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1163061e-d540-4d1c-81fe-a6eddeb6b5b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9e415f1d-267c-40d3-8b66-a388edde63bd&quot;,&quot;12cd43fd-b1f6-468c-9590-be67c261c130&quot;,&quot;e933cd83-e5fb-486c-bbf3-535ef8f5558f&quot;,&quot;7d5d8136-2a2f-4be3-894a-700b724d6d91&quot;,&quot;86a92bc6-cae1-4e85-adef-3efd75450cb4&quot;,&quot;e3b37052-2ae8-42c6-aa25-033d57cd5c80&quot;,&quot;9a94a593-875a-427c-9be4-46fbc058a395&quot;,&quot;bb8dafe7-3cd8-4873-ae80-ded380d5428f&quot;,&quot;8cd32026-0d9e-4624-acdc-cd0549472870&quot;,&quot;a32ab77c-c28d-466b-9d1a-21a354951648&quot;,&quot;4bc27956-8eb6-43a4-81b7-077f3467dcbf&quot;,&quot;1163061e-d540-4d1c-81fe-a6eddeb6b5b3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:810,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;97d74024-9380-4c43-9bf7-1907b76ad931&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c03611a8-0aed-43a2-9a3c-d3074c3f7ac0&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;63b82e29-3c08-4eeb-9327-e93aac13c186&quot;,&quot;title&quot;:&quot;PromoCode.userPromocodeDelete&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeDelete.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeDelete \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Plan.remove({ $or: [{ name: new RegExp(&#x27;^RANDOM_PLAN+&#x27;, \&quot;i\&quot;) }, { name: new RegExp(&#x27;^utest_cases_Standard+&#x27;, \&quot;i\&quot;) }] }, function(error, plan) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            _models.Promocode.remove({}, function(error, promo) {\n                _models.UserPromocode.remove({}, function(error, userPromos) {\n                    signUpUser({}, function(err, res) {\n                        authToken = res.body.output.authtoken;\n                        token = res.body.output.activation_token;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        savePlanEntries({\n                            count: 5\n                        }, function(error, planEntries) {\n                            _planEntries = planEntries;\n                            done();\n                        });\n                    });\n                });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe1b3d6e-255a-40ba-8246-a5a12d52298a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeDelete \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;716a72af-e5d1-46cf-8b1d-4cefc3904367&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete user promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeDelete Should delete user promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            var user_promo_uid = userPromoCode.uid || \&quot;\&quot;;\n            api.delete(apiURL)\n                .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n                .send({\n                    user_promo_uid: user_promo_uid\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        (res.body.output.message).should.equal(messageList.PROMOCODE_REVOKED_SUCCESSFULLY);\n                        done();\n                    }\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;59820bbb-589d-49b5-b599-2c01f9b368d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give promocode already revoked error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeDelete Should give promocode already revoked error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    addPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            var user_promo_uid = userPromoCode.uid || \&quot;\&quot;;\n            _models.UserPromocode.findOneAndUpdate({\n                uid: user_promo_uid\n            }, {\n                deleted_at: new Date()\n            }, function(error, userPromoCode) {\n                if (error) {\n                    done(err);\n                } else {\n                    api.delete(apiURL)\n                        .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n                        .send({\n                            user_promo_uid: user_promo_uid\n                        })\n                        .expect(httpStatus.BAD_REQUEST)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                (res.body.error.message).should.equal(messageList.PROMOCODE_ALREADY_REVOKED);\n                                done();\n                            }\n                        });\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0412ce0-58cc-4c66-a4da-53685fb8fbf8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;59820bbb-589d-49b5-b599-2c01f9b368d4&quot;,&quot;f0412ce0-58cc-4c66-a4da-53685fb8fbf8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:34,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;47537584-418f-4def-ba7b-bbe53be501bc&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4bd68548-16cb-4a26-9295-1bf1a22deaf5&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1bb53361-a475-46b4-88f8-8eaeadbaa9bc&quot;,&quot;title&quot;:&quot;PromoCode.userPromocodeList&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeList.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3045,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    savePlanEntries({\n        count: 5\n    }, function(error, planEntries) {\n        _planEntries = planEntries;\n        addPromcode({\n            count: 1,\n            promo_code: \&quot;PROMO_CODE\&quot;,\n            domain: \&quot;raweng.com\&quot;,\n            redemption_count: 30,\n            redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n            redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n            allowed_plans: [],\n            default_plan: null,\n            addon_credits: 5,\n            addon_flows: 2,\n            addon_triggers: 2,\n            addon_trial_days: 10,\n            braintree_discount_id: \&quot;\&quot;,\n            promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n        }, function(error, promoCodes) {\n            addUsersWithPromocode({\n                count: 30,\n                promo_code: promoCodes[0].promo_code\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    done();\n                }\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14f0fc41-a842-45ad-936f-02d970641437&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;370bad0e-285e-4c2f-944f-16a82843fccf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list promocode applied users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list promocode applied users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.objects).to.be.a(&#x27;array&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;080bec71-0640-407d-b28b-855f47c78b0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode applied users by considering skip.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list of promocode applied users by considering skip.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=5\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 25 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d725b27e-0795-4fbf-9234-d0f18244c4fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode applied users by considering limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list of promocode applied users by considering limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=5\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 5 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80e51ce0-5752-4f75-b30d-26253ef9eeac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode by applying email filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list of promocode by applying email filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=5&amp;email=test.user+1\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 5 &amp;&amp;\n                res.body.output.count == 11) {\n                isValid = true;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp; item.user.email.indexOf(\&quot;test.user+1\&quot;) == 0;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4336c669-b9e8-4414-9230-ba5adca204c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode by applying uid filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list of promocode by applying uid filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=5&amp;uid=\&quot; + user_uid;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 1 &amp;&amp;\n                res.body.output.count == 1) {\n                isValid = true;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp; item.user.uid == user_uid;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;669a1862-f493-4b1a-9e2e-b211a334133d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give first preference to email filter.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should give first preference to email filter.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?limit=5&amp;uid=\&quot; + user_uid + \&quot;&amp;email=test.user+1\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 5 &amp;&amp;\n                res.body.output.count == 11) {\n                isValid = true;\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp; item.user.email.indexOf(\&quot;test.user+1\&quot;) == 0;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c663bd74-aa02-482e-ad51-fc5f2e75ee3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of promocode applied users by considering skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeList Should get list of promocode applied users by considering skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=5&amp;limit=10\&quot;;\napi.get(filterURL)\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (Array.isArray(res.body.output.objects) &amp;&amp;\n                res.body.output.objects.length == 10 &amp;&amp;\n                res.body.output.count == 30).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a1b6d20b-75ea-45ea-bdf2-199e78cdee43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;080bec71-0640-407d-b28b-855f47c78b0c&quot;,&quot;d725b27e-0795-4fbf-9234-d0f18244c4fd&quot;,&quot;80e51ce0-5752-4f75-b30d-26253ef9eeac&quot;,&quot;4336c669-b9e8-4414-9230-ba5adca204c4&quot;,&quot;669a1862-f493-4b1a-9e2e-b211a334133d&quot;,&quot;c663bd74-aa02-482e-ad51-fc5f2e75ee3a&quot;,&quot;a1b6d20b-75ea-45ea-bdf2-199e78cdee43&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:61,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f2669e45-ecdb-4a64-ac8c-79629f9ec911&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2e25008d-7e22-43c3-84fd-3058d7f8c2c6&quot;,&quot;title&quot;:&quot;PromoCode&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ae16e2ca-b85c-4f5b-95ee-458f40d509a6&quot;,&quot;title&quot;:&quot;PromoCode.userPromocodeRedempt&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\promoCode\\userPromocodeRedempt.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Plan.remove({ $or: [{ name: new RegExp(&#x27;^RANDOM_PLAN+&#x27;, \&quot;i\&quot;) }, { name: new RegExp(&#x27;^utest_cases_Standard+&#x27;, \&quot;i\&quot;) }] }, function(error, plan) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            _models.Promocode.remove({}, function(error, promo) {\n                _models.UserPromocode.remove({}, function(error, userPromos) {\n                    signUpUser({}, function(err, res) {\n                        authToken = res.body.output.authtoken;\n                        token = res.body.output.activation_token;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        savePlanEntries({\n                            count: 5\n                        }, function(error, planEntries) {\n                            _planEntries = planEntries;\n                            done();\n                        });\n                    });\n                });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56525a21-8996-4c63-90c2-d01a687b9acb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7837e93b-a1f7-4191-ad3a-ed11d0e4054c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should add promocode to user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should add promocode to user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp;\n                userPromoCode.uid != \&quot;\&quot;) {\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(\&quot;authtoken\&quot;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.subscription.days.should.equal(40);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27a7562a-deef-48f6-a52a-009b6d4c336d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should properly add promocode fatures to standard plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should properly add promocode fatures to standard plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:125,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nsignUpUser({\n    \&quot;email\&quot;: \&quot;test.user+1@raweng.com\&quot;,\n    \&quot;plan\&quot;: \&quot;Standard Plan (Annual)\&quot;\n}, function(err, res) {\n    var userFeatures = {};\n    userFeatures.flow_count = res.body.output.user_plan.flow.count;\n    userFeatures.flow_active = res.body.output.user_plan.flow.active;\n    userFeatures.trigger_count = res.body.output.user_plan.trigger.count;\n    userFeatures.days = (res.body.output.user_plan.reimburse || {}).period || 0;\n    userFeatures.credits = (res.body.output.user_plan.reimburse || {}).credits || 0;\n    authToken = res.body.output.authtoken || \&quot;\&quot;;\n    uid = res.body.output.uid || \&quot;\&quot;;\n    addPromcode({\n        count: 1,\n        promo_code: \&quot;PROMO_CODE\&quot;,\n        domain: \&quot;raweng.com\&quot;,\n        redemption_count: 1,\n        redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n        redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n        allowed_plans: [],\n        default_plan: null,\n        addon_credits: 5,\n        addon_flows: 2,\n        addon_triggers: 2,\n        addon_trial_days: 10,\n        braintree_discount_id: \&quot;\&quot;,\n        promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n    }, function(error, promoCodes) {\n        redemptPromcodeToUser({\n            promo_code: promoCodes[0].promo_code\n        }, function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var userPromoCode = res.body.output;\n                if (userPromoCode.user_uid == uid &amp;&amp;\n                    userPromoCode.uid != \&quot;\&quot;) {\n                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                        .set(\&quot;authtoken\&quot;, authToken)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            var userNewFeatures = {};\n                            userNewFeatures.flow_count = res.body.output.user_plan.flow.count;\n                            userNewFeatures.flow_active = res.body.output.user_plan.flow.active;\n                            userNewFeatures.trigger_count = res.body.output.user_plan.trigger.count;\n                            userNewFeatures.days = (res.body.output.user_plan.reimburse || {}).period || 0;\n                            userNewFeatures.credits = (res.body.output.user_plan.reimburse || {}).credits || 0;\n                            (userFeatures.flow_count == userNewFeatures.flow_count &amp;&amp;\n                                userFeatures.flow_active == userNewFeatures.flow_active &amp;&amp;\n                                (userFeatures.trigger_count + 2) == userNewFeatures.trigger_count &amp;&amp;\n                                userFeatures.days == userNewFeatures.days &amp;&amp;\n                                (userFeatures.credits + 5) == userNewFeatures.credits).should.equal(true);\n                            done();\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;61ccb787-dc47-4482-a57a-397fdcf4549a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should re-again redempt another promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should re-again redempt another promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 2,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                var promocode_uid = userPromoCode.promocode_uid[0];\n                redemptPromcodeToUser({\n                    promo_code: promoCodes[1].promo_code\n                }, function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var userPromoCode = res.body.output;\n                        (userPromoCode.user_uid == uid &amp;&amp;\n                            userPromoCode.uid != \&quot;\&quot; &amp;&amp;\n                            userPromoCode.promocode_uid[0] != promocode_uid).should.equal(true);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb0ca2d4-5dcc-4509-b8f9-eee9caf74294&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allocate promocode to only two users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should allocate promocode to only two users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:232,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 2,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                signUpUser({\n                    email: \&quot;test.user+1@raweng.com\&quot;\n                }, function(err, res) {\n                    var userUID1 = res.body.output.uid;\n                    var authtoken1 = res.body.output.authtoken;\n                    redemptPromcodeToUser({\n                        promo_code: promoCodes[0].promo_code,\n                        authtoken: authtoken1\n                    }, function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var userPromoCode = res.body.output;\n                            if (userPromoCode.user_uid == userUID1 &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                                signUpUser({\n                                    email: \&quot;test.user+2@raweng.com\&quot;\n                                }, function(err, res) {\n                                    var userUID2 = res.body.output.uid;\n                                    var authtoken2 = res.body.output.authtoken;\n                                    redemptPromcodeToUser({\n                                        promo_code: promoCodes[0].promo_code,\n                                        status: httpStatus.BAD_REQUEST,\n                                        authtoken: authtoken2\n                                    }, function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            (res.body.error.message).should.equal(messageList.PROMOCODE_OVER_REDEMPT);\n                                            done();\n                                        }\n                                    });\n                                });\n                            } else {\n                                true.should.equal(false);\n                                done();\n                            }\n                        }\n                    });\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dbe5703b-b799-4e8c-ab62-79057ed9c95b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allocate promocode if user plan is included in allowed_plans.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should allocate promocode if user plan is included in allowed_plans.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[0]],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    var promocode_uid = promoCodes[0].uid;\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authtoken1 = res.body.output.authtoken;\n            redemptPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                status: httpStatus.OK,\n                user_uid: res.body.output.uid,\n                authtoken: authtoken1\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.uid.should.not.equal(\&quot;\&quot;);\n                    done();\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00a948c0-a565-4b1c-8c4c-d6056e0ff292&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as user is not allowed to redempt promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give error as user is not allowed to redempt promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:102,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [_planEntries[1]],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    var promocode_uid = promoCodes[0].uid;\n    signUpUser({\n        email: \&quot;test.user+1@raweng.com\&quot;,\n        plan: _planEntries[0].name\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            redemptPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                user_uid: res.body.output.uid,\n                status: httpStatus.BAD_REQUEST\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    (res.body.error.message).should.equal(messageList.PROMOCODE_NOT_ALLOWED_PLAN);\n                    done();\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75c4342b-d006-4a43-b5c9-2289398e4d8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give promocode expire error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give promocode expire error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_EXPIRED);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;85d9c4fc-e06d-4e5e-b277-d745136b523a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid promocode error for future promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give invalid promocode error for future promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).add(2, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(3, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9c95a9f-2454-4781-ae12-3e4b0a372f02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promo code already redempt.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give error as promo code already redempt.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 2,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: promoCodes[0].promo_code\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userPromoCode = res.body.output;\n            if (userPromoCode.user_uid == uid &amp;&amp; userPromoCode.uid != \&quot;\&quot;) {\n                redemptPromcodeToUser({\n                    promo_code: promoCodes[0].promo_code,\n                    status: httpStatus.BAD_REQUEST\n                }, function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        (res.body.error.message).should.equal(messageList.PROMOCODE_IS_ALREADY_ALLOCATED);\n                        done();\n                    }\n                });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2590248-9b0b-4b0e-87ba-9afe29a16ff8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid promocode.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give error as invalid promocode.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    redemptPromcodeToUser({\n        promo_code: \&quot;FAKE_PROMO_CODE\&quot;,\n        status: httpStatus.BAD_REQUEST\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.error.message).should.equal(messageList.PROMOCODE_INVALID);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a76c089-a5f5-4d4a-8929-a25f0f28142a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as promocode invalid domain.&quot;,&quot;fullTitle&quot;:&quot;Enterprise PromoCode PromoCode.userPromocodeRedempt Should give error as promocode invalid domain.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:104,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;raweng.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    signUpUser({\n        email: \&quot;test.user@built.io\&quot;\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authtoken1 = res.body.output.authtoken;\n            redemptPromcodeToUser({\n                promo_code: promoCodes[0].promo_code,\n                status: httpStatus.BAD_REQUEST,\n                user_uid: res.body.output.uid,\n                authtoken: authtoken1\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    (res.body.error.message).should.equal(messageList.PROMOCODE_DOMAIN_NOT_ALLOWED);\n                    done();\n                }\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c010365a-5e5e-4269-b7b7-eaa5353e1224&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;27a7562a-deef-48f6-a52a-009b6d4c336d&quot;,&quot;61ccb787-dc47-4482-a57a-397fdcf4549a&quot;,&quot;cb0ca2d4-5dcc-4509-b8f9-eee9caf74294&quot;,&quot;dbe5703b-b799-4e8c-ab62-79057ed9c95b&quot;,&quot;00a948c0-a565-4b1c-8c4c-d6056e0ff292&quot;,&quot;75c4342b-d006-4a43-b5c9-2289398e4d8a&quot;,&quot;85d9c4fc-e06d-4e5e-b277-d745136b523a&quot;,&quot;b9c95a9f-2454-4781-ae12-3e4b0a372f02&quot;,&quot;a2590248-9b0b-4b0e-87ba-9afe29a16ff8&quot;,&quot;3a76c089-a5f5-4d4a-8929-a25f0f28142a&quot;,&quot;c010365a-5e5e-4269-b7b7-eaa5353e1224&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:834,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;193faaf2-6b11-456b-8693-b36f0c653194&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\getTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\getTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e9108f4b-83f5-419f-b856-b0e1dfb90e9d&quot;,&quot;title&quot;:&quot;Templates.getTemplate&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\getTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\getTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.getTemplate \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            });\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        var templateBody = testData.templateBody;\n        templateBody.author = dummyUser._id\n        _models.Template.create(templateBody, function(err, res) {\n            cbk(err, res);\n        })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userTemplate = res.toJSON();\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cdc34c16-98e1-433e-84a0-a225897ae63a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.getTemplate \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.User.remove({ uid: dummyUser.uid }, function(err) {\n            cb(err)\n        });\n    },\n    function(cb) {\n        _models.Template.remove({ uid: userTemplate.uid }, function(err) {\n            cb(err)\n        });\n    },\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55f3edcd-e904-47a3-93ee-329a96a64cd7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.getTemplate Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + userTemplate.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eb34291d-73ef-45e6-9b89-b61aa4fa9415&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if template not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.getTemplate Should get error, if template not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;dummyTemplate&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TEMPLATE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0bb6ae33-1455-46b5-8427-0dcf09e74e76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.getTemplate Should get template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + userTemplate.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.name).to.be.equal(testData.templateBody.name);\n            expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b29d2b93-efd5-477e-9b45-254cddbea4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;eb34291d-73ef-45e6-9b89-b61aa4fa9415&quot;,&quot;0bb6ae33-1455-46b5-8427-0dcf09e74e76&quot;,&quot;b29d2b93-efd5-477e-9b45-254cddbea4d1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e4fdc2a9-24d5-4a3c-8d6e-0cf966445192&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\importTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\importTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;54ad0536-627d-43ef-b479-c2dd9160eee8&quot;,&quot;title&quot;:&quot;Templates.importTemplate&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\importTemplate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\importTemplate.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken\n                var templateBody = _.cloneDeep(testData.templateBody);\n                templateBody.author = dummyUser._id\n                _models.Template.create(templateBody, function(err, res) {\n                    cbk(err, res);\n                })\n            },\n            function(result, cbk) {\n                userTemplate = result.toJSON();\n                var templateBodyWithFlowData = _.cloneDeep(testData.templateBodyWithFlowData);\n                var encrypt = encryption.encryptMultipleSync([templateBodyWithFlowData.environment, templateBodyWithFlowData.activities], encryption.getKeySync())\n                templateBodyWithFlowData.author = dummyUser._id\n                templateBodyWithFlowData.environment = encrypt[0]\n                templateBodyWithFlowData.activities = encrypt[1]\n                _models.Template.create(templateBodyWithFlowData, function(err, res) {\n                    cbk(err, res);\n                })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userTemplateWithFlowData = res.toJSON();\n                tempWithFlowData.data.template_uid = userTemplateWithFlowData.uid;\n                done();\n            }\n        })\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a75fbfcd-7fd8-44d2-bc1c-f9191a82cede&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.User.remove({ uid: dummyUser.uid }, function(err) {\n            cb(err)\n        });\n    },\n    function(cb) {\n        _models.Template.remove({ uid: { $in: [userTemplate.uid, userTemplateWithFlowData.uid] } }, function(err) {\n            cb(err)\n        });\n    },\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55b3bbe3-e65b-45da-9f65-0773fef5dbfd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .send(data)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;07e156d7-ecda-4803-92a2-07c8ffc75d8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should import template with flow_data, if template data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate Should import template with flow_data, if template data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(tempWithFlowData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flow = res.body.output\n            expect(flow).to.be.any.keys([&#x27;uid&#x27;]);\n            expect(flow.flow_version).to.be.equal(1);\n            done();\n            //_models.ConfigSchema.find({ type: &#x27;param&#x27;, project_uid: flow.project_uid }, function(err, result) {\n            //    if (err) {\n            //        done(err)\n            //    } else {\n            //        expect(_.first(result).uid).equal(_.first(tempWithFlowData.data.project_params).uid)\n            //        done();\n            //    }\n            //})\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a52f7478-1d30-4e19-b2a4-902e23db3ab3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should import template in org with flow_data, if template data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate Should import template in org with flow_data, if template data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n    .send(tempWithFlowData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.any.keys([&#x27;uid&#x27;]);\n            expect(res.body.output.org_uid).to.be.equal(orgData.organization.uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;547fe6b7-9e2e-4832-94b9-99e9db7458d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should import template without flow_data, if template data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate Should import template without flow_data, if template data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(&#x27;/enterprise/v1/templates/import&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ uid: userTemplate.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.any.keys([&#x27;uid&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c7d65b8-5c16-4956-8ad8-87bfeb9e8cd7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if template not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.importTemplate Should get error, if template not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntempWithFlowData.data.template_uid = &#x27;dummyTemplate&#x27;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(tempWithFlowData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TEMPLATE_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4dec84f0-15bf-4fb4-b040-785b7f5f3f1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;07e156d7-ecda-4803-92a2-07c8ffc75d8a&quot;,&quot;a52f7478-1d30-4e19-b2a4-902e23db3ab3&quot;,&quot;547fe6b7-9e2e-4832-94b9-99e9db7458d6&quot;,&quot;7c7d65b8-5c16-4956-8ad8-87bfeb9e8cd7&quot;,&quot;4dec84f0-15bf-4fb4-b040-785b7f5f3f1c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:107,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6cf011f4-0032-46e7-b19f-30d76751b947&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\listTagsOfTemplates.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTagsOfTemplates.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;157e150c-1dae-44e2-a1ae-9a28610e8d21&quot;,&quot;title&quot;:&quot;Template.ListTagsOfTemplates&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\listTagsOfTemplates.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTagsOfTemplates.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Template.ListTagsOfTemplates \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dc4bc701-d5b5-4981-9117-15d52d584f84&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of templates by Tags.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Template.ListTagsOfTemplates Should get list of templates by Tags.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a94627f-2db5-42cd-ae38-248c563f1690&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1a94627f-2db5-42cd-ae38-248c563f1690&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:9,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c1909211-b14f-478f-84a2-7961c571e9fa&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\listTemplateIcons.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplateIcons.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b9b6b5fd-0901-424b-93c1-58c42f91bff5&quot;,&quot;title&quot;:&quot;Templates.listTemplatesIcon&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\listTemplateIcons.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplateIcons.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplatesIcon \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            });\n    }\n], function(err, result) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = result.body.output;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c61f6be2-80c2-4201-bf0f-770d30168515&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplatesIcon \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.User.remove({ uid: dummyUser.uid }, function(err) {\n            cb(err)\n        });\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d3f2398-7e94-4d03-b2af-15e0bcfb1ca5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplatesIcon Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9520172b-6817-4944-8519-efc835c02a49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of icons of templates.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplatesIcon Should get list of icons of templates.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            expect(_.first(res.body.output)).to.have.all.keys([&#x27;category&#x27;, &#x27;category_icons&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1756b4b8-1d7e-412a-bc74-e6a1d4f8bede&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9520172b-6817-4944-8519-efc835c02a49&quot;,&quot;1756b4b8-1d7e-412a-bc74-e6a1d4f8bede&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;abcab33d-4aba-4faa-9da7-b8262956a9d6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\listTemplates.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplates.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;64456c33-45ca-4e3d-9592-4d3e9bb33d00&quot;,&quot;title&quot;:&quot;Templates.list&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\listTemplates.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplates.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.list \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aa5139a1-6fb9-4f22-8df2-c4f3914d7b35&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.list \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.User.remove({ uid: dummyUser.uid }, function(err) {\n            cb(err)\n        });\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76244b82-e3b4-40ca-ada8-c0103c3fe611&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.list Should get list template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62a80c5c-88e2-455c-b908-a0cc31b62e48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;62a80c5c-88e2-455c-b908-a0cc31b62e48&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:12,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;77d4d24c-b3de-4910-9621-c52ff94c88a5&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\listTemplateServices.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplateServices.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f59169a8-11e9-439b-8b22-df87215544f5&quot;,&quot;title&quot;:&quot;Templates.listTemplateServices&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\templates\\listTemplateServices.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\templates\\listTemplateServices.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplateServices \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:107,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            });\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        api.get(&#x27;/enterprise/v1/templatesicon&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, result) {\n                cbk(err, result);\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        templates = res.body.output;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;63f1454b-e6ac-4075-ad95-1c99d716859a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplateServices \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n    function(cb) {\n        _models.User.remove({ uid: dummyUser.uid }, function(err) {\n            cb(err)\n        });\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3c658e1e-ccb9-479a-979c-399f0682e177&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of services of template.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Templates.listTemplateServices Should get list of services of template.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;/&#x27; + templates[0].category + &#x27;/services&#x27;)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.have.all.keys([&#x27;count&#x27;, &#x27;objects&#x27;]);\n            expect(_.first(_.first(res.body.output.objects).category)).to.be.equal(templates[0].category);\n            expect(_.first(_.first(res.body.output.objects).activities)).to.be.String;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0d14084-3f81-4fd6-bbe1-def91d90671c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f0d14084-3f81-4fd6-bbe1-def91d90671c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a81f8ec8-c5b9-4cd8-afa0-4f7f440daf6a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\createUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\createUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a18827e7-1476-4f8b-9aee-1792fa83b53e&quot;,&quot;title&quot;:&quot;Trigger.CreateUserTrigger&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\createUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\createUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                api.get(&#x27;/enterprise/v1/user&#x27;)\n                    .set(&#x27;authtoken&#x27;, orgData.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            dummyUser = res.body.output;\n                            cbk(err, dummyUser)\n                        }\n                    });\n            },\n            function(dummyUser, cbk) {\n                _models.Project.findOne({\n                    name: config.default_project,\n                    owner_uid: dummyUser.uid\n                }, function(err, project) {\n                    cbk(err, project)\n                })\n            },\n            function(result, cbk) {\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(testData.enterpriseFlowBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5f1e559-631c-48c3-ac4e-a4cae90cff0d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        createdTriggers.push(userTrigger.uid)\n        _models.UserTrigger.remove({ uid: { $in: createdTriggers } }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        clearRecords(function(err, result) {\n            cb(err, result)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;34a214a0-64f1-431a-8109-187f57b6fc3c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;466dd8ef-9253-4d90-b499-f9bb8b41a4a9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.clone(testData.enterpriseFlowBody);\ntriggerData = _.omit(triggerData, &#x27;trigger&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3650b5ce-050d-479b-9da0-1ccab4ec3200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if trigger data is invalid in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should get error if trigger data is invalid in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.clone(testData.triggerBody);\ntriggerData = _.omit(triggerData.trigger, &#x27;name&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6cc922d-90c5-4cf1-af46-ee1f6be1187f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user-auth token is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should get error if user-auth token is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath }\ncommonMock.triggerCreateExchangeTokenError(opt)\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.triggerBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ERROR_WHILE_EXCHANGING_TOKEN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f307faad-450b-4219-98be-51545a16ac74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create trigger, if trigger data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should create trigger, if trigger data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        var trigUID = testData.expressTriggerResponse.uid;\n        // _models.UserTrigger.remove({uid: trigUID}, function(err, ut) {\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, ut) {\n                var data = { uid: trigUID }\n                _models.UserTrigger.findOneAndUpdate({ uid: ut.uid }, data, { new: true }, function(err, userTrig) {\n                    cbk(err, userTrig);\n                })\n            })\n            // })\n    },\n    function(ut, cbk) {\n        var opt = { path: triggerPath, body: triggerPath }\n        commonMock.triggerCreateSuccess(opt);\n        var opt1 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt1);\n        var opt2 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt2);\n        var opt3 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;pull\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt3);\n        var triggerData = _.cloneDeep(testData.triggerEnterpriseBody);\n        triggerData.trigger.flow = userFlow.uid\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(triggerData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userTrigger = res.body.output;\n        expect(userTrigger).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n        expect(userTrigger).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n        _models.UserTrigger.remove({ uid: userTrigger.uid }, function(err) {\n            done(err)\n        })\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c754137b-ac50-4b74-b43d-1a0710e076b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create trigger within organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should create trigger within organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        testData.mongoUserTriggerObj.user_uid = orgData.organization.user_uid;\n        testData.mongoUserTriggerObj.org_uid = orgData.organization.uid;\n        var trigUID = testData.expressTriggerResponse.uid;\n        // _models.UserTrigger.remove({uid: trigUID}, function(err, ut) {\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, ut) {\n            var data = { uid: trigUID }\n            _models.UserTrigger.findOneAndUpdate({ uid: ut.uid }, data, { new: true }, function(err, userTrig) {\n                cbk(err, userTrig);\n            })\n        })\n    },\n    function(userTrig, cbk) {\n        api.post(flowURL)\n            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n            .send(testData.enterpriseFlowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            })\n    },\n    function(res, org, cbk) {\n        orgFlow = res.body.output\n        var opt = { path: triggerPath, body: triggerPath }\n        commonMock.triggerCreateSuccess(opt);\n        var opt1 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] }, update: true };\n        commonMock.triggerPushSuccess(opt1);\n        var opt2 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true };\n        commonMock.triggerPushSuccess(opt2);\n        var opt3 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;pull\&quot;: [/^fl\\w*/] }, update: true };\n        commonMock.triggerPushSuccess(opt3);\n        var triggerData = _.cloneDeep(testData.triggerEnterpriseBody);\n        triggerData.trigger.flow = orgFlow.uid\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken, org_uid: orgData.organization.uid })\n            .send(triggerData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            });\n    }\n], function(err, res, org) {\n    if (err) {\n        done(err);\n    } else {\n        userTrigger = res.body.output;\n        expect(userTrigger).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n        expect(userTrigger).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n        expect(userTrigger.org_uid).to.equal(orgData.organization.uid);\n        expect(userTrigger.user_uid).to.equal(orgData.organization.user_uid);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e07e905-6e47-4eb9-8209-848706b675c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user trigger limit exceeds.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.CreateUserTrigger Should get error, if user trigger limit exceeds.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        userTriggerLimit = (dummyUser.user_plan.trigger || {}).count\n        var triggerData = _.cloneDeep(testData.mongoUserTriggerObj)\n        triggerData.user_uid = dummyUser.uid;\n        async.times(userTriggerLimit, function(n, next) {\n            _models.UserTrigger.create(triggerData, function(err, userTrigger) {\n                next(err, userTrigger);\n            })\n        }, function(err, result) {\n            createdTriggers = _.map(_.flattenDeep(result), &#x27;uid&#x27;)\n            cbk(err, result)\n        })\n    },\n    function(result, cbk) {\n        var triggerData = _.cloneDeep(testData.triggerEnterpriseBody);\n        triggerData.trigger.flow = userFlow.uid\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(triggerData)\n            .expect(httpStatus.BAD_REQUEST)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        var errMSG = \&quot;Your current plan does not allow using more than \&quot; + userTriggerLimit + \&quot; trigger(s) in your workflows. Please delete a trigger or upgrade your account before creating a new one.\&quot;;\n        expect(res.body.error.message).to.be.equal(errMSG);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16425712-b8b6-4901-864b-79ced2d905be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;466dd8ef-9253-4d90-b499-f9bb8b41a4a9&quot;,&quot;3650b5ce-050d-479b-9da0-1ccab4ec3200&quot;,&quot;b6cc922d-90c5-4cf1-af46-ee1f6be1187f&quot;,&quot;f307faad-450b-4219-98be-51545a16ac74&quot;,&quot;c754137b-ac50-4b74-b43d-1a0710e076b9&quot;,&quot;7e07e905-6e47-4eb9-8209-848706b675c9&quot;,&quot;16425712-b8b6-4901-864b-79ced2d905be&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:141,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;66d24a1d-2e13-4b3b-a84b-b052fdcada4a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\deleteUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\deleteUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;78538b28-d169-4ee5-9513-86ae0523b730&quot;,&quot;title&quot;:&quot;Trigger.DeleteUserTrigger&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\deleteUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\deleteUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.DeleteUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8372ec7d-89de-4f5e-a0f5-9763009197da&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.DeleteUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84a0737e-ceef-4259-9905-171f6c43c66f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.DeleteUserTrigger Should get error, if trigger not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerDeleteNotFound(opt);\napi.delete(apiURL404)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n            httpmock.cleanAll();\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b277de82-7866-4078-ae96-730502de9004&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete trigger, if trigger is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.DeleteUserTrigger Should delete trigger, if trigger is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerDeleteSuccess(opt);\ntestData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n//testData.mongoUserTriggerObj.project_uid = project.uid;\ntestData.mongoUserTriggerObj.uid = &#x27;dummyTrigger&#x27;\n_models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, result) {\n    //cbk(err, userTrigger);\n    if (err) {\n        done(err)\n    } else {\n        api.delete(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.message.should.equal(messageList.TRIGGER_DELETED_SUCCESSFULLY);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;969abfae-0239-4a68-bdca-8e881f502f4c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;84a0737e-ceef-4259-9905-171f6c43c66f&quot;,&quot;b277de82-7866-4078-ae96-730502de9004&quot;,&quot;969abfae-0239-4a68-bdca-8e881f502f4c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1ae1d894-b9f7-460d-968c-17dd6c50cc80&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\executeUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\executeUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9b237ab8-6136-4f41-9479-b1e3f348f19e&quot;,&quot;title&quot;:&quot;Trigger.ExecuteUserTrigger&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\executeUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\executeUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ExecuteUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73ada6df-4f40-478f-8a19-ec84d17a675e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ExecuteUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4464cad2-b615-4c91-bac8-f718033c58e8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ExecuteUserTrigger Should get error, if trigger not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:107,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerExecuteNotFound(opt);\napi.get(apiURL404)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c035ed85-4f97-4eb0-af06-dedd84a5c870&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should execute trigger, if trigger is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ExecuteUserTrigger Should execute trigger, if trigger is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerExecuteSuccess(opt);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.TRIGGER_EXECUTED_SUCCESSFULLY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c22ec91-ed97-4557-9abd-5c907cfeedd0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4464cad2-b615-4c91-bac8-f718033c58e8&quot;,&quot;c035ed85-4f97-4eb0-af06-dedd84a5c870&quot;,&quot;2c22ec91-ed97-4557-9abd-5c907cfeedd0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:126,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e170526c-e157-4dac-bf91-0663fcb4481b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\getUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\getUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fd2fa3ed-2163-4fcd-b7ab-6a4179577aa6&quot;,&quot;title&quot;:&quot;Trigger.GetUserTrigger&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\getUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\getUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        _models.Project.findOne({ name: config.default_project, owner_uid: dummyUser.uid }, function(err, project) {\n            cbk(err, project)\n        })\n    },\n    function(project, cbk) {\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        testData.mongoUserTriggerObj.project_uid = project.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    }\n], function(err, userTrigger) {\n    if (err) {\n        done(err);\n    } else {\n        userTriggerObj = userTrigger\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ad66b10-45b2-4e54-854d-f375a16c630c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, userTrigger) {\n    if (err) {\n        done(err)\n    } else {\n        clearRecords(function(err, result) {\n            done(err)\n        })\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;be4d3bbf-fc5d-47d5-829e-e10d2afcc352&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + userTriggerObj.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;276ac4ad-ba48-427e-90db-c2c5c0e15111&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger is not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger Should get error, if trigger is not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL404)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6a22ca30-554b-4bf3-a924-784bdff978a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger server is not responding.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger Should get error, if trigger server is not responding.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerRequestTimeout(opt);\napi.get(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.GATEWAY_TIMEOUT)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.TRIGGER_SERVER_DOWN)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;70a9bde3-2782-4a27-9922-aa3b686f60a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user-trigger, if trigger is found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTrigger Should get user-trigger, if trigger is found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerGetSuccess(opt);\napi.get(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d73e4a1-893d-41ff-9853-745be7709b38&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;276ac4ad-ba48-427e-90db-c2c5c0e15111&quot;,&quot;6a22ca30-554b-4bf3-a924-784bdff978a1&quot;,&quot;70a9bde3-2782-4a27-9922-aa3b686f60a5&quot;,&quot;9d73e4a1-893d-41ff-9853-745be7709b38&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:48,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7f582816-7c91-4ddc-8440-598a07558a00&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\getUserTriggerByAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\getUserTriggerByAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;75b9f074-24d7-42b5-873b-47f71dd2b506&quot;,&quot;title&quot;:&quot;Trigger.GetUserTriggerByAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\getUserTriggerByAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\getUserTriggerByAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTriggerByAuth \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8083eb9-fd0b-4fdd-9700-f4e3f5f1e557&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTriggerByAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;53313546-01bf-418d-bc59-1c45da9b55a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;uid\&quot; param is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTriggerByAuth Should get error, if \&quot;uid\&quot; param is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send()\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1e0bf96f-deec-4417-b2fc-57a50ba35a2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user-triggers, if auth uid is present and valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.GetUserTriggerByAuth Should get user-triggers, if auth uid is present and valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(searchParam)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d23fac5-38f6-4c18-b30f-3a8ac23d57d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;53313546-01bf-418d-bc59-1c45da9b55a6&quot;,&quot;1e0bf96f-deec-4417-b2fc-57a50ba35a2e&quot;,&quot;4d23fac5-38f6-4c18-b30f-3a8ac23d57d2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;81ac6634-7cdd-4325-8a9f-bccbc1d570fa&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\listTriggers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\listTriggers.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0e12dcbf-31e8-4ecc-9068-7d003d51d1e9&quot;,&quot;title&quot;:&quot;Trigger.ListTriggers&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\listTriggers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\listTriggers.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListTriggers \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a8061e9-0b78-459a-b85c-2b41642d16c0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of triggers.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListTriggers Should get list of triggers.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ab48e42-e3c5-4730-90be-3ea18fb51d39&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListTriggers Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e589966-7639-4e04-a23d-f3e6d0c014b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3ab48e42-e3c5-4730-90be-3ea18fb51d39&quot;,&quot;6e589966-7639-4e04-a23d-f3e6d0c014b7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:17,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;71f040e9-6c96-4d7c-a3bb-8ad1539399a8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\listUserTriggers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\listUserTriggers.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;937919d6-f33e-431a-b781-6ffd8eb8fa38&quot;,&quot;title&quot;:&quot;Trigger.ListUserTriggers&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\listUserTriggers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\listUserTriggers.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListUserTriggers \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        _models.Project.findOne({ name: config.default_project, owner_uid: dummyUser.uid }, function(err, project) {\n            cbk(err, project)\n        })\n    },\n    function(project, cbk) {\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        testData.mongoUserTriggerObj.project_uid = project.uid;\n        testData.mongoUserTriggerObj.env_uid = project.env_uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    }\n], function(err, userTrigger) {\n    if (err) {\n        done(err);\n    } else {\n        userTriggerObj = userTrigger\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d8a3388-c382-44db-81dd-f0911b89223c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListUserTriggers \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, userTrigger) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b8d145f-0acf-4a56-848d-873e85dfa233&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of triggers.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListUserTriggers Should get list of triggers.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var response = res.body.output\n            response.should.be.instanceOf(Array);\n            expect(_.first(_.first(response).triggers)).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n            expect(_.first(_.first(response).triggers)).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d833eb3f-132a-4ead-8678-92f179aaefea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.ListUserTriggers Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0b9c4d4-ee0d-4d4f-bf1e-0b5f6ca02b23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d833eb3f-132a-4ead-8678-92f179aaefea&quot;,&quot;f0b9c4d4-ee0d-4d4f-bf1e-0b5f6ca02b23&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;81323c44-7e01-43a8-8b8f-b4e160269bd4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\pullUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\pullUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e5e10764-c691-4883-b487-43c38154c90f&quot;,&quot;title&quot;:&quot;Trigger.PullUserTrigger&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\pullUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\pullUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:123,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    },\n    function(userTrigger, cbk) {\n        userTriggerObj = userTrigger\n        testData.flowBody.trigger.handlers = [userTriggerObj.uid]\n        api.post(flowURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.flowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            })\n    },\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userFlow = res.body.output;\n        pullTriggerData = {\n            \&quot;trigger\&quot;: {\n                \&quot;flow_uid\&quot;: userFlow.uid,\n                \&quot;uid\&quot;: userTriggerObj.uid,\n                \&quot;provider\&quot;: \&quot;clock\&quot;\n            }\n        }\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b66a83ee-495a-4482-a370-69ff0bc2cfde&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e28e0123-019b-4099-ba0f-977a8ccbb50c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e46ad3f9-1427-4507-b68a-84e778bc748e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.clone(pullTriggerData);\ndata = _.omit(data, &#x27;trigger&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a1ab2ff7-f14d-41c6-9b28-6a5edee18da0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;flow_uid\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger Should get error if \&quot;flow_uid\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.clone(pullTriggerData);\ndata = _.omit(data.trigger, &#x27;flow_uid&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76f9b03f-0a45-47d5-ad05-96b14363d431&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should pull trigger, if trigger data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger Should pull trigger, if trigger data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] } };\ncommonMock.triggerPullSuccess(opt);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(pullTriggerData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.flow.trigger.handlers).to.be.empty\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f310e21a-929e-41fe-9ebf-5459f918ba6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if trigger not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.PullUserTrigger Should get error if trigger not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.clone(pullTriggerData);\ndata.trigger.uid = &#x27;dummyTrigger&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45f9477f-22d4-46a9-8893-52d005fc1830&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e46ad3f9-1427-4507-b68a-84e778bc748e&quot;,&quot;a1ab2ff7-f14d-41c6-9b28-6a5edee18da0&quot;,&quot;76f9b03f-0a45-47d5-ad05-96b14363d431&quot;,&quot;f310e21a-929e-41fe-9ebf-5459f918ba6c&quot;,&quot;45f9477f-22d4-46a9-8893-52d005fc1830&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:71,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;77a41c64-8965-4b0e-9a79-6a57f8713ae8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\testUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\testUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;40028780-9f13-4e9c-a47f-f71dfa7d8272&quot;,&quot;title&quot;:&quot;Trigger.TestUserTrigger&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\testUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\testUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:104,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                api.get(&#x27;/enterprise/v1/user&#x27;)\n                    .set(&#x27;authtoken&#x27;, orgData.owner.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            dummyUser = res.body.output;\n                            cbk(err, dummyUser)\n                        }\n                    });\n            },\n            function(dummyUser, cbk) {\n                _models.Project.findOne({\n                    name: config.default_project,\n                    owner_uid: dummyUser.uid\n                }, function(err, project) {\n                    cbk(err, project)\n                })\n            },\n            function(result, cbk) {\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(testData.enterpriseFlowBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32eb2b41-3a9f-4a6e-bfe7-5710290f4f1c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        createdTriggers.push(userTrigger.uid)\n        _models.UserTrigger.remove({ uid: { $in: createdTriggers } }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f527dfc7-d419-43a9-884e-9ae102b193a5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da307e62-04f9-4a95-b6c1-506d96345715&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger Should get error if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.clone(testData.enterpriseFlowBody);\ntriggerData = _.omit(triggerData, &#x27;trigger&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c18873c-aa8c-4864-8200-fc68bc9ab0d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if trigger data is invalid in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger Should get error if trigger data is invalid in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.clone(testData.triggerBody);\ntriggerData = _.omit(triggerData.trigger, &#x27;name&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b24421dc-4e4e-4581-88e3-6ad38f00d786&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if user-auth token is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger Should get error if user-auth token is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath }\ncommonMock.triggerCreateExchangeTokenError(opt)\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.triggerBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ERROR_WHILE_EXCHANGING_TOKEN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5767befd-ac91-428e-9889-f85611b66ffb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should test trigger, if trigger data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.TestUserTrigger Should test trigger, if trigger data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        var trigUID = testData.expressTriggerResponse.uid;\n        // _models.UserTrigger.remove({uid: trigUID}, function(err, ut) {\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, ut) {\n                var data = { uid: trigUID }\n                _models.UserTrigger.findOneAndUpdate({ uid: ut.uid }, data, { new: true }, function(err, userTrig) {\n                    cbk(err, userTrig);\n                })\n            })\n            // })\n    },\n    function(ut, cbk) {\n        var opt = { path: triggerPath, body: triggerPath }\n        commonMock.triggerCreateSuccess(opt);\n        var opt1 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt1);\n        var opt2 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;push\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt2);\n        var opt3 = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;pull\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\n        commonMock.triggerPushSuccess(opt3);\n        var triggerData = _.cloneDeep(testData.triggerEnterpriseBody);\n        triggerData.trigger.flow = userFlow.uid\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(triggerData)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userTrigger = res.body.output;\n        expect(userTrigger).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n        expect(userTrigger).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n        _models.UserTrigger.remove({ uid: userTrigger.uid }, function(err) {\n            done(err)\n        })\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d346d64-340e-4b50-bd69-143744415fd2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;da307e62-04f9-4a95-b6c1-506d96345715&quot;,&quot;7c18873c-aa8c-4864-8200-fc68bc9ab0d1&quot;,&quot;b24421dc-4e4e-4581-88e3-6ad38f00d786&quot;,&quot;5767befd-ac91-428e-9889-f85611b66ffb&quot;,&quot;3d346d64-340e-4b50-bd69-143744415fd2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:50,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;fd732b3b-9d14-4d96-b1c1-6ac785e0ad97&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\updateUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\updateUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d43b6ed3-3401-405a-bbf8-16395cbc0781&quot;,&quot;title&quot;:&quot;Trigger.UpdateUserTrigger&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\updateUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\updateUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(result, cbk) {\n        dummyUser = result.body.output;\n        _models.Project.findOne({ name: config.default_project, owner_uid: dummyUser.uid }, function(err, project) {\n            cbk(err, project)\n        })\n    },\n    function(project, cbk) {\n        testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n        testData.mongoUserTriggerObj.project_uid = project.uid;\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n            cbk(err, userTrigger);\n        })\n    }\n], function(err, userTrigger) {\n    if (err) {\n        done(err);\n    } else {\n        userTriggerObj = userTrigger\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;201eca87-f5fa-4761-9de4-f948afb83fca&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, userTrigger) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b2bd579-e904-405f-8a48-2b2976db11b4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + userTriggerObj.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;426426c4-291a-4f42-b060-bf09a9402100&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should get error, if \&quot;trigger\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.cloneDeep(testData.triggerBody);\ntriggerData = _.omit(triggerData, &#x27;trigger&#x27;);\napi.put(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7b2cf428-a335-4ea2-a4a6-516326b1b7ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger data is invalid in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should get error, if trigger data is invalid in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar triggerData = _.clone(testData.triggerBody);\ntriggerData = _.omit(triggerData.trigger, &#x27;name&#x27;);\napi.put(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(triggerData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9c5505af-d968-4da2-8f58-f3347fd1af62&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user-auth token is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should get error, if user-auth token is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerUpdateExchangeTokenError(opt);\napi.put(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.triggerBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.ERROR_WHILE_EXCHANGING_TOKEN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7be9f809-b785-466c-b1c1-f26de3f6f020&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update trigger, if trigger data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should update trigger, if trigger data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerUpdateSuccess(opt);\napi.put(apiURL + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.triggerBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var userTrigger = res.body.output;\n            expect(userTrigger).to.have.any.keys(_.keys(testData.getUserTriggerResponse))\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97cc56b4-0724-4f6f-836c-640bd9138451&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if trigger not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpdateUserTrigger Should get error, if trigger not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, body: triggerPath };\ncommonMock.triggerUpdateNotFound(opt);\napi.put(apiURL + &#x27;dummyTrigger&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(testData.triggerBody)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.TRIGGER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9ec829f-1bb1-4d5e-bf32-8314de1a70cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;426426c4-291a-4f42-b060-bf09a9402100&quot;,&quot;7b2cf428-a335-4ea2-a4a6-516326b1b7ec&quot;,&quot;9c5505af-d968-4da2-8f58-f3347fd1af62&quot;,&quot;7be9f809-b785-466c-b1c1-f26de3f6f020&quot;,&quot;97cc56b4-0724-4f6f-836c-640bd9138451&quot;,&quot;d9ec829f-1bb1-4d5e-bf32-8314de1a70cf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:82,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;22fe26fe-1745-4769-b1c5-2889f69a372f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\upsertUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\upsertUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;93313c09-288c-46f3-a8a4-d2a968078d36&quot;,&quot;title&quot;:&quot;Trigger.UpsertUserTrigger&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\trigger\\upsertUserTrigger.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\trigger\\upsertUserTrigger.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                _models.Project.findOne({\n                    name: config.default_project,\n                    owner_uid: dummyUser.uid\n                }, function(err, project) {\n                    cbk(err, project)\n                })\n            },\n            function(project, cbk) {\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                testData.mongoUserTriggerObj.project_uid = project.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger;\n                testData.flowBody.trigger.handlers = [userTriggerObj]\n                var flow = _.cloneDeep(testData.flowBody)\n                flow.active = false;\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flow)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                upsertData = { flow_uid: userFlow.uid, trigger_uid: userTriggerObj.uid }\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;675c9016-62d8-4261-978a-3b5384ccb266&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    },\n    function(cb) {\n        clearRecords(function(err, result) {\n            cb(err, result)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;714622d8-9695-4914-a46f-cbe88fe4c565&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;807dc72a-c786-4a89-9ab0-74248f9a5245&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;trigger_uid\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should get error if \&quot;trigger_uid\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.cloneDeep(upsertData);\ndata = _.omit(data, &#x27;trigger_uid&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95a9affb-f04f-476a-a9e9-dc6da1113ca3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if \&quot;flow_uid\&quot; key missing in request body.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should get error if \&quot;flow_uid\&quot; key missing in request body.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.cloneDeep(upsertData);\ndata = _.omit(data, &#x27;flow_uid&#x27;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;847b76aa-0105-4963-90e7-b47cb79a0bf6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if flow not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should get error if flow not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar data = _.cloneDeep(upsertData);\ndata.flow_uid = &#x27;dummyFlow&#x27;;\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.FLOW_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0edc5867-8f8d-4f25-8abb-e5a7c7605250&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should upsert trigger and keep flow in in-active state if plan exceeds and trigger data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should upsert trigger and keep flow in in-active state if plan exceeds and trigger data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:98,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] }, update: true, times: 2 };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] }\ncommonMock.triggerPushSuccess(opt);\nvar flowData = testData.enterpriseFlowBody\nasync.times(5, function(n, next) {\n    createFlow(flowURL, flowData, dummyUser, function(err, flow) {\n        next(err, flow)\n    })\n}, function(err, results) {\n    if (err) {\n        done(err)\n    } else {\n        var triggerData = testData.triggerEnterpriseBody;\n        triggerData.trigger.flow = userFlow.uid\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(upsertData)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(res.body.output.uid).to.be.equal(upsertData.trigger_uid)\n                    expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n                    _models.newFlow.findOne({ uid: userFlow.uid }, function(err, result) {\n                        if (err) {\n                            done(err)\n                        } else {\n                            expect(result.active).to.be.equal(false)\n                            done();\n                        }\n                    })\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7663bb9a-8270-4796-afbb-954a8daf92d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should upsert trigger within organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Trigger.UpsertUserTrigger Should upsert trigger within organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: triggerPath, getPath: getTriggerPath + &#x27;/handlers&#x27;, body: { \&quot;unset\&quot;: [/^fl\\w*/] }, update: true };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] }\ncommonMock.triggerPushSuccess(opt);\nvar tempOrgBody = orgBody;\n// var opt = { path: getTriggerPath, body: getTriggerPath, times: 2 };\n// commonMock.triggerCreateSuccess(opt);\nasync.waterfall([\n    function(cbk) {\n        //dummyUser = result.body.output;\n        _models.Project.findOne({ name: config.default_project, owner_uid: orgData.organization.user_uid }, function(err, project) {\n            cbk(err, project, org)\n        })\n    },\n    function(project, org, cbk) {\n        testData.mongoUserTriggerObj.user_uid = orgData.organization.user_uid;\n        testData.mongoUserTriggerObj.project_uid = project.uid;\n        testData.mongoUserTriggerObj.org_uid = orgData.organization.uid;\n        var trigUID = testData.expressTriggerResponse.uid;\n        // _models.UserTrigger.remove({uid: trigUID}, function(err, ut) {\n        _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, ut) {\n                var data = { uid: trigUID }\n                _models.UserTrigger.findOneAndUpdate({ uid: ut.uid }, data, { new: true }, function(err, userTrig) {\n                    cbk(err, userTrig, org);\n                })\n            })\n            // })\n    },\n    function(userTrig, org, cbk) {\n        api.post(flowURL)\n            .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n            .send(testData.enterpriseFlowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res, org, userTrig)\n            })\n    },\n    function(res, org, userTrig, cbk) {\n        orgFlow = res.body.output\n        upsertData.flow_uid = orgFlow.uid;\n        upsertData.trigger_uid = userTrig.uid;\n        var opt = { path: triggerPath, body: triggerPath }\n        commonMock.triggerCreateSuccess(opt);\n        var triggerData = testData.triggerEnterpriseBody;\n        triggerData.trigger.flow = orgFlow.uid\n        api.post(apiURL)\n            .set({ authtoken: dummyUser.authtoken, org_uid: orgData.organization.uid })\n            .send(upsertData)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            });\n\n    }\n], function(err, res, org) {\n    if (err) {\n        done(err);\n    } else {\n        expect(res.body.output.uid).to.be.equal(upsertData.trigger_uid)\n            // expect(res.body.output.org_uid).to.be.equal(orgData.organization.uid)\n            // expect(res.body.output.user_uid).to.be.equal(orgData.organization.user_uid)\n        expect(res.body.output).not.to.have.all.keys([&#x27;_id&#x27;, &#x27;__v&#x27;]);\n        expect(res.body.output.project_uid).not.to.be.null;\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04da5062-9801-4fd7-b86a-085f2a855aee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;807dc72a-c786-4a89-9ab0-74248f9a5245&quot;,&quot;95a9affb-f04f-476a-a9e9-dc6da1113ca3&quot;,&quot;847b76aa-0105-4963-90e7-b47cb79a0bf6&quot;,&quot;0edc5867-8f8d-4f25-8abb-e5a7c7605250&quot;,&quot;7663bb9a-8270-4796-afbb-954a8daf92d6&quot;,&quot;04da5062-9801-4fd7-b86a-085f2a855aee&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:191,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;78ac4d41-c8f2-4604-b29a-6bba13626563&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;97a537a2-ab78-4e23-b2b1-4f78cedc4775&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d0e99cc9-e435-4377-9b1c-d809e1757b9b&quot;,&quot;title&quot;:&quot;UserAuth.createUserAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\createUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:922,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;42b57261-d4ff-44c5-9597-735b703055f5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\nclearRecords(function(err, result) {\n    done(err);\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;856abbda-0fc9-4a8d-90bb-94902a5ee69e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create user auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should create user auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(userAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f57105ee-a719-4e50-b9b4-ee6629a4723a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create user auth within organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should create user auth within organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5188,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = orgBody;\nasync.waterfall([\n    function(cbk) {\n        createOrgPlans(function() {\n            api.post(&#x27;/enterprise/v1/organizations&#x27;)\n                .send(tempOrgBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var org = res.body.output;\n                        _models.User.findOne({\n                            uid: res.body.output.user_uid\n                        }).lean().exec(function(err, user) {\n                            cbk(err, org)\n                        });\n                    }\n                });\n        });\n    },\n    function(org, cbk) {\n        api.post(apiURL)\n            .send(userAuthyBody)\n            .set({ authtoken: authToken, org_uid: org.uid })\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            });\n    }\n], function(err, res, org) {\n    if (err) {\n        done(err);\n    } else {\n        var userAuth = res.body.output\n        var isValid = userAuth.uid != \&quot;\&quot; &amp;&amp;\n            typeof(userAuth._id) == \&quot;undefined\&quot; &amp;&amp;\n            typeof(userAuth.__v) == \&quot;undefined\&quot;;\n        isValid.should.equal(true);\n        expect(userAuth).to.have.any.keys([&#x27;uid&#x27;, &#x27;org_uid&#x27;, &#x27;env_uid&#x27;, &#x27;project_uid&#x27;]);\n        expect(userAuth.org_uid).equal(org.uid);\n        expect(userAuth.user).equal(org.org_account.uid);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49d2ad76-94f8-48a2-a682-6b5d942561fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as auth name is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should give error as auth name is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(userAuthyBody);\ndelete tempUserAuthyBody.name;\napi.post(apiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.name.message.should.equal(messageList.USER_AUTH_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f650c29-0a83-44cb-b6fc-436e97588208&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create auth when category is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should create auth when category is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(userAuthyBody);\ndelete tempUserAuthyBody.category;\napi.post(apiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e01a97d0-6fd4-4846-a780-be35ac647f7d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as auth data is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should give error as auth data is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(userAuthyBody);\ndelete tempUserAuthyBody.data;\napi.post(apiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.data.message.should.equal(messageList.USER_AUTH_DATA_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f76030f-79ca-4621-8798-583990bc989d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.createUserAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(userAuthyBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;507771f3-b8fd-4393-bc59-d35391462418&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f57105ee-a719-4e50-b9b4-ee6629a4723a&quot;,&quot;49d2ad76-94f8-48a2-a682-6b5d942561fd&quot;,&quot;8f650c29-0a83-44cb-b6fc-436e97588208&quot;,&quot;e01a97d0-6fd4-4846-a780-be35ac647f7d&quot;,&quot;8f76030f-79ca-4621-8798-583990bc989d&quot;,&quot;507771f3-b8fd-4393-bc59-d35391462418&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5235,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ccf800a2-e20e-401a-b499-eb9db8318a95&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bbde3438-0f2c-4d67-bc55-2e59f07d4735&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;11d190bf-eb23-4f55-8ea4-c185029069aa&quot;,&quot;title&quot;:&quot;UserAuth.deleteUserAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\deleteUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.deleteUserAuth \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            apiURL = apiURL.replace(\&quot;:user_uid\&quot;, uid);\n            api.post(apiURL)\n                .send(userAuthyBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _authUid = res.body.output.uid;\n                        done();\n                    }\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21eff91a-b0d3-4aa5-a991-a867723a7d8c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.deleteUserAuth \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;85b2154e-c126-4d45-9745-9986f1683342&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should delete user auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.deleteUserAuth Should delete user auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar deleteAPIURL = apiURL + \&quot;/\&quot; + _authUid;\nvar opt = { path: &#x27;/oauth/&#x27; + _authUid };\ncommonMock.authDeleteSuccess(opt);\napi.delete(deleteAPIURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.USER_AUTH_DELETED_SUCCESSFULLY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca4c83b6-2904-478b-b084-07c3720e4b71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not delete another user&#x27;s auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.deleteUserAuth Should not delete another user&#x27;s auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:104,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: &#x27;/oauth/&#x27; + _authUid };\ncommonMock.authNotFound(opt);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            anotherUserAuthToken = res.body.output.authtoken;\n            anotherUserUid = res.body.output._id;\n            var deleteAPIURL = apiURL + \&quot;/\&quot; + _authUid;\n            api.delete(deleteAPIURL)\n                .set(&#x27;authtoken&#x27;, anotherUserAuthToken)\n                .expect(httpStatus.NOT_FOUND)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.USER_AUTH_NOT_FOUND);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e70ff37-d45d-4d7a-9fd1-2d290010e48b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.deleteUserAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar deleteAPIURL = apiURL + \&quot;/\&quot; + _authUid;\napi.delete(deleteAPIURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4988be89-d4ac-4f3f-acce-20531dd60a85&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ca4c83b6-2904-478b-b084-07c3720e4b71&quot;,&quot;7e70ff37-d45d-4d7a-9fd1-2d290010e48b&quot;,&quot;4988be89-d4ac-4f3f-acce-20531dd60a85&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:122,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;972b2ab2-a3b3-49bf-b628-c6b402dfbcd7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8533f120-85f8-42a8-9183-b4853a7eea0e&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0dbfd74b-66da-4431-8c96-51302b7a93f8&quot;,&quot;title&quot;:&quot;UserAuth.findUserAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\findUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.findUserAuth \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            apiURL = apiURL.replace(\&quot;:user_uid\&quot;, uid);\n            api.post(apiURL)\n                .send(userAuthyBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        _authUid = res.body.output.uid;\n                        done();\n                    }\n                });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62058153-cd76-4553-a7e9-0aa028fcd086&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.findUserAuth \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;217221e3-a6c2-4a66-8d2d-928e29d9fa74&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should find user auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.findUserAuth Should find user auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar getAPIURL = apiURL + \&quot;/\&quot; + _authUid;\napi.get(getAPIURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(_authUid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;db9f9daf-633e-45bb-b17d-998655501f1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if user auth not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.findUserAuth Should give error, if user auth not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar getAPIURL = apiURL + \&quot;/dummyAuth\&quot;;\napi.get(getAPIURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_AUTH_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4655d43d-5905-4db9-bd71-a398f5e37ae9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.findUserAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar getAPIURL = apiURL + \&quot;/\&quot; + _authUid;\napi.get(getAPIURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e8f74b9-61e0-4451-b684-1065ff6284bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;db9f9daf-633e-45bb-b17d-998655501f1d&quot;,&quot;4655d43d-5905-4db9-bd71-a398f5e37ae9&quot;,&quot;8e8f74b9-61e0-4451-b684-1065ff6284bd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1a3314d0-02ee-48ae-b48c-ffdadb5e22a3&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f405f999-9f6a-4d03-add0-8fd1f065dbf1&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7e7d6498-f134-489b-bdc5-017e7af40e51&quot;,&quot;title&quot;:&quot;UserAuth.getUserAuthList&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\getUserAuthList.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:471,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    saveUserAuthForOneUser(\&quot;test.user@raweng.com\&quot;, done, function() {\n        saveUserAuthForOneUser(\&quot;test.user+10@raweng.com\&quot;, done, function() {\n            done();\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b7dd28f0-55e8-4668-8b99-2bf0fd40f854&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c2a2d203-8779-4129-8cf5-83e60846c1e6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get user auths list group by type.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList Should get user auths list group by type.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output[0].userauths.length == 10;\n                _.each(res.body.output[0].userauths, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c33ebda5-6de6-43a4-9395-a82db15c7fc9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user auths.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList Should get list of user auths.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?list=true\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 10;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dc28c035-da2b-49ae-8838-dc4c88949ed3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user auths based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList Should get limited list of user auths based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?list=true&amp;skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76c96a6f-391f-4fc5-aba7-38a9f57c7151&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user auths based on skip/limit in description descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList Should get limited list of user auths based on skip/limit in description descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?list=true&amp;skip=2&amp;limit=2&amp;field=description&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n                _.each(res.body.output, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) != \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c2158549-e8be-4579-9f96-d65d72b0af2d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.getUserAuthList Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75ca1e7e-ca76-4328-a28c-9b9898faab23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c33ebda5-6de6-43a4-9395-a82db15c7fc9&quot;,&quot;dc28c035-da2b-49ae-8838-dc4c88949ed3&quot;,&quot;76c96a6f-391f-4fc5-aba7-38a9f57c7151&quot;,&quot;c2158549-e8be-4579-9f96-d65d72b0af2d&quot;,&quot;75ca1e7e-ca76-4328-a28c-9b9898faab23&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:61,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;fdadd280-3d05-4fee-ae90-2d0316bc03d3&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2d3bfcaa-6246-42ed-a2df-c6f53b117b02&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;900843c5-c139-4c34-9ecd-f44a41421aa4&quot;,&quot;title&quot;:&quot;UserAuth.updateUserAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuth.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:111,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            apiURL = apiURL.replace(\&quot;:uid\&quot;, uid);\n            saveUserAuthEntries({\n                authtoken: authToken\n            }, function(error, userAuthEntries) {\n                _userAuthEntries = userAuthEntries;\n                done();\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;918af42a-7017-4b34-b4da-508500aebd57&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;830f0a6f-63bf-4937-bfff-dceae3c4f89e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee61196b-26ee-4c38-bde8-e4b6f6150eb7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update user auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should update user auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\ntempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38efefb6-0d37-4e1a-b54a-150d81b2d169&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update user auth within organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should update user auth within organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5124,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempOrgBody = orgBody;\nvar userAuth = {\n    \&quot;category\&quot;: \&quot;google\&quot;,\n    \&quot;name\&quot;: \&quot;utest_cases_org\&quot;,\n    \&quot;data\&quot;: {\n        \&quot;code\&quot;: \&quot;o2t:a0738c29-7775-4cbf-88df-d2718b7cbb7d\&quot;,\n        \&quot;keys\&quot;: [\n            \&quot;access_token\&quot;\n        ]\n    },\n    \&quot;description\&quot;: \&quot;google_drive login\&quot;,\n    \&quot;type\&quot;: \&quot;google_drive\&quot;,\n    \&quot;icon\&quot;: \&quot;google-drive\&quot;\n};\nasync.waterfall([\n    function(cbk) {\n        createOrgPlans(function() {\n            api.post(&#x27;/enterprise/v1/organizations&#x27;)\n                .send(tempOrgBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var org = res.body.output;\n                        _models.User.findOne({\n                            uid: res.body.output.user_uid\n                        }).lean().exec(function(err, user) {\n                            cbk(err, org)\n                        });\n                    }\n                });\n        });\n    },\n    function(org, cbk) {\n        api.post(&#x27;/enterprise/v1/user/auths&#x27;)\n            .send(userAuth)\n            .set({ authtoken: authToken, org_uid: org.uid })\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            });\n    },\n    function(res, org, cbk) {\n        var tempUserAuthyBody = res.body.output\n        tempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\n        paramURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\n        api.put(paramURL)\n            .send(tempUserAuthyBody)\n            .set({ authtoken: authToken, org_uid: org.uid })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                cbk(err, res, org)\n            });\n    }\n], function(err, res, org) {\n    if (err) {\n        done(err);\n    } else {\n        var userAuth = res.body.output\n        var isValid = userAuth.uid != \&quot;\&quot; &amp;&amp;\n            typeof(userAuth._id) == \&quot;undefined\&quot; &amp;&amp;\n            typeof(userAuth.__v) == \&quot;undefined\&quot;;\n        isValid.should.equal(true);\n        expect(userAuth).to.have.any.keys([&#x27;uid&#x27;, &#x27;org_uid&#x27;, &#x27;env_uid&#x27;, &#x27;project_uid&#x27;]);\n        expect(userAuth.org_uid).equal(org.uid);\n        expect(userAuth.user).equal(org.org_account.uid);\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;197de2bc-6af0-4f0e-9074-6a8fadcfe201&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as auth name is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should give error as auth name is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\ndelete tempUserAuthyBody.name;\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.name.message.should.equal(messageList.USER_AUTH_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c5e63b1-d24e-4049-af13-0527979d79be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if user auth not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should give error, if user auth not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, \&quot;dummyAuth\&quot;);\ntempUserAuthyBody.uid = \&quot;dummyAuth\&quot;\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_AUTH_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95bf6960-2262-4932-9460-7a870c39acaa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as auth data is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should give error as auth data is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\ndelete tempUserAuthyBody.data;\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.data.message.should.equal(messageList.USER_AUTH_DATA_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;772163e8-d6c9-441a-8e9b-2d9e936fb82f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error, if user auth not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should give error, if user auth not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, \&quot;dummyAuth\&quot;);\ntempUserAuthyBody.uid = \&quot;dummyAuth\&quot;\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_AUTH_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0ff429d8-757f-4b8d-8b80-db78c0328cc1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuth Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries[0].body.output);\ntempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\nparamURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramURL)\n    .send(tempUserAuthyBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ede40679-734a-40cc-8f5b-a83fe04a048a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;38efefb6-0d37-4e1a-b54a-150d81b2d169&quot;,&quot;197de2bc-6af0-4f0e-9074-6a8fadcfe201&quot;,&quot;2c5e63b1-d24e-4049-af13-0527979d79be&quot;,&quot;95bf6960-2262-4932-9460-7a870c39acaa&quot;,&quot;772163e8-d6c9-441a-8e9b-2d9e936fb82f&quot;,&quot;0ff429d8-757f-4b8d-8b80-db78c0328cc1&quot;,&quot;ede40679-734a-40cc-8f5b-a83fe04a048a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5180,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;66dc76a7-0973-4f6f-a2dd-bcbb0f9f486b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;87d33676-55d8-4dd1-a1e1-9807d06ad1a5&quot;,&quot;title&quot;:&quot;UserAuth&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e1d0b295-3d65-419c-8dc5-3a923610d95a&quot;,&quot;title&quot;:&quot;UserAuth.updateUserAuthName&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userAuth\\updateUserAuthName.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:490,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                saveUserAuthEntries({\n                    authtoken: res.body.output.authtoken\n                }, function(error, userAuthEntries) {\n                    _userAuthEntries0 = userAuthEntries;\n                    var tempRegistrationBody = global.getImmutable(registrationBody);\n                    tempRegistrationBody.email = \&quot;test.user+101@raweng.com\&quot;;\n                    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                    api.post(\&quot;/enterprise/v1/signup\&quot;)\n                        .send(tempRegistrationBody)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                authToken = res.body.output.authtoken;\n                                _id = res.body.output._id;\n\n                                saveUserAuthEntries({\n                                    authtoken: authToken\n                                }, function(error, userAuthEntries) {\n                                    _userAuthEntries1 = userAuthEntries;\n                                    done();\n                                });\n                            }\n                        });\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d8a681d-b32d-4868-8d74-8d05ef0b5740&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78f8295f-3c6c-4511-8650-8abd192b08c1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c8c1247-9ef4-49bc-958e-7aea16324800&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update user auth.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName Should update user auth.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries1[0].body.output);\ntempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\nvar paramApiURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramApiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.name.should.equal(\&quot;utest_cases_MODIFIED\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a86425c8-f0e9-4693-8082-7284028f0307&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as authname is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName Should give error as authname is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries0[0].body.output);\ntempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\nvar paramApiURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramApiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_AUTH_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8edf81ca-e495-4190-bdea-013124977434&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as authname is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName Should give error as authname is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries1[0].body.output);\ndelete tempUserAuthyBody.name;\nvar paramApiURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramApiURL)\n    .send(tempUserAuthyBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.name.message.should.equal(messageList.USER_AUTH_NAME_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1236238b-9f49-4049-89bf-84f7ea7cc015&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserAuth UserAuth.updateUserAuthName Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserAuthyBody = global.getImmutable(_userAuthEntries1[0].body.output);\ntempUserAuthyBody.name = \&quot;utest_cases_MODIFIED\&quot;;\nvar paramApiURL = apiURL.replace(\&quot;:auth_uid\&quot;, tempUserAuthyBody.uid);\napi.put(paramApiURL)\n    .send(tempUserAuthyBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;506cfe59-f285-45be-bfd6-9bb5a2ec85f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a86425c8-f0e9-4693-8082-7284028f0307&quot;,&quot;8edf81ca-e495-4190-bdea-013124977434&quot;,&quot;1236238b-9f49-4049-89bf-84f7ea7cc015&quot;,&quot;506cfe59-f285-45be-bfd6-9bb5a2ec85f1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:49,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b68eb0b6-25b2-4495-8bb1-015a825df0aa&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userConfig\\getConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\getConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e26232ee-a4ed-4e2e-82ff-651886c929a8&quot;,&quot;title&quot;:&quot;UserConfig.GetConfigData&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userConfig\\getConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\getConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.GetConfigData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                _id = dummyUser._id\n                flowData.trigger.handlers = [userTriggerObj]\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                var query = _models.ConfigData.find({ flow_uid: userFlow.uid })\n                query.lean().exec(function(err, results) {\n                    if (err) {\n                        done(err)\n                    } else {\n                        configData = results\n                        done()\n                    }\n                })\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d2e8714-5703-4411-84ea-b368d4203314&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.GetConfigData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.ConfigData.remove({ uid: { $in: _.map(configData, &#x27;uid&#x27;) } }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c632d00-4e2e-4236-9862-b5d19a4c8f78&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.GetConfigData Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndata.active_config = &#x27;default&#x27;\nvar triggerConfigData = _.find(configData, { activity_id: &#x27;start&#x27; })\napi.get(apiURL + dummyUser.default_config + &#x27;/configdata&#x27;)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb03a5e4-ea76-4729-961c-c6bbb84a2751&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user config uid is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.GetConfigData Should get error, if user config uid is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;dummyUser.default_config/configdata&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_CONFIG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88c70e79-1f38-48d8-b0bc-fc00e4f9a038&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get config data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.GetConfigData Should get config data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + dummyUser.default_config + &#x27;/configdata&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.length).to.be.above(1);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;be1f36bd-afbb-4603-8f3e-8856b1ddc8f8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cb03a5e4-ea76-4729-961c-c6bbb84a2751&quot;,&quot;88c70e79-1f38-48d8-b0bc-fc00e4f9a038&quot;,&quot;be1f36bd-afbb-4603-8f3e-8856b1ddc8f8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:34,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f7035508-54c6-4ddf-99be-848ec5a942b8&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userConfig\\getUsage.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\getUsage.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;aa6b598c-159e-4a8d-931b-6604f7f0fb88&quot;,&quot;title&quot;:&quot;ConfigData.getUsage&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userConfig\\getUsage.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\getUsage.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:130,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        dummyUser = res.body.output;\n        var opt = { path: getTriggerPath, body: getTriggerPath };\n        commonMock.triggerGetSuccess(opt);\n        opt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\n        opt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\n        commonMock.triggerPullSuccess(opt);\n        opt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\n        commonMock.triggerPushSuccess(opt);\n\n        api.post(&#x27;/enterprise/v1/flows&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(flowWithAllData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userConfig = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66dc49bb-e041-45be-a48d-89a1ffb7042c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.ConfigData.remove({ user_uid: dummyUser.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;adbfe66f-0da3-4167-8e91-b20e2fa32b84&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72b5827d-65be-4af2-a5b8-27918c9c32d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of auth usage, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should get list of auth usage, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?auth=fl05b96ad7388b364a4d1f7c&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;activities&#x27;, &#x27;name&#x27;, &#x27;uid&#x27;, &#x27;flow_version&#x27;]);;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a81f2894-4482-4c16-a67f-08c2f851282a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of trigger usage, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should get list of trigger usage, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nopt.getPath = getTriggerPath + &#x27;/handlers&#x27;;\nopt.body = { \&quot;pull\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPullSuccess(opt);\nopt.body = { \&quot;push\&quot;: [/^fl\\w*/] };\ncommonMock.triggerPushSuccess(opt);\n\napi.put(&#x27;/enterprise/v1/flows/&#x27; + userConfig.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(flowWithAllData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        //cbk(err, res)\n        api.get(apiURL + &#x27;?trigger=tgb00434df13b4b8564796af&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    expect(_.first(res.body.output)).to.have.any.keys([&#x27;name&#x27;, &#x27;uid&#x27;, &#x27;flow_version&#x27;]);;\n                    done();\n                }\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6208a2ff-fac1-4175-a93e-49431989c1a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of connection usage, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should get list of connection usage, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?connection=fl3ade9788e74f0554ec1852&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;activities&#x27;, &#x27;name&#x27;, &#x27;uid&#x27;, &#x27;flow_version&#x27;]);;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9975827-5815-4bb0-9278-856db0fd1e09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of agent usage, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should get list of agent usage, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?agent=ega6fdbacca405caf12f0c15f&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;activities&#x27;, &#x27;name&#x27;, &#x27;uid&#x27;, &#x27;flow_version&#x27;]);;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;248270c3-c5ef-44df-a5ab-525f1b609fea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of agent usage, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.getUsage Should get list of agent usage, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?param=random&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output)).to.have.any.keys([&#x27;activities&#x27;, &#x27;name&#x27;, &#x27;uid&#x27;, &#x27;flow_version&#x27;]);;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79723200-dfd0-4647-82b0-a10e7135d3d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;72b5827d-65be-4af2-a5b8-27918c9c32d1&quot;,&quot;a81f2894-4482-4c16-a67f-08c2f851282a&quot;,&quot;6208a2ff-fac1-4175-a93e-49431989c1a1&quot;,&quot;d9975827-5815-4bb0-9278-856db0fd1e09&quot;,&quot;248270c3-c5ef-44df-a5ab-525f1b609fea&quot;,&quot;79723200-dfd0-4647-82b0-a10e7135d3d6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:133,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0cbd8697-c08a-4e3b-87d2-34ed1ccbe5c0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userConfig\\listConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\listConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;96c41fc6-7aff-4483-8653-a8b099a2c011&quot;,&quot;title&quot;:&quot;ConfigData.List&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userConfig\\listConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\listConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.List \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:123,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        dummyUser = res.body.output;\n        api.post(&#x27;/enterprise/v1/flows&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.flowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userConfig = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;07ba6716-d24c-4aa2-a9c1-05bcf57f396b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.List \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.ConfigData.remove({ user_uid: dummyUser.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3d0677d-0f9b-413f-80f3-5f8eabac4759&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.List Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;373c70fe-b057-4c43-b40e-d5fb709d1eef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user configs, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigData.List Should get list of user configs, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.array;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56ec03c6-2c97-4c94-a35e-03023fe4e42a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;373c70fe-b057-4c43-b40e-d5fb709d1eef&quot;,&quot;56ec03c6-2c97-4c94-a35e-03023fe4e42a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1ecdbaf9-0c65-45b7-a93c-13d239237b40&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userConfig\\listConfigSchema.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\listConfigSchema.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;973c8497-3201-4e22-89fd-0cf337d001a3&quot;,&quot;title&quot;:&quot;ConfigSchema.List&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userConfig\\listConfigSchema.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\listConfigSchema.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigSchema.List \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:125,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    },\n    function(res, cbk) {\n        dummyUser = res.body.output;\n        api.post(&#x27;/enterprise/v1/flows&#x27;)\n            .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n            .send(testData.flowBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                cbk(err, res)\n            });\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        userConfig = res.body.output\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8045ba4f-5332-40af-9334-97492eaf9039&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigSchema.List \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\n_models.ConfigSchema.remove({ uid: dummyUser.uid }, function(err) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;42ee18a9-e585-4bb2-ab57-d63b746b260c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigSchema.List Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7bd2557-e4fd-4248-9fda-74248dd6ed1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user configs, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise ConfigSchema.List Should get list of user configs, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.be.array;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8c45243-3ed8-47f3-b420-f3c086053f42&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c7bd2557-e4fd-4248-9fda-74248dd6ed1d&quot;,&quot;d8c45243-3ed8-47f3-b420-f3c086053f42&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dc583163-612b-47ad-b803-daf1dd8fddf2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userConfig\\updateConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\updateConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b9dce3dd-b750-485d-8031-55b1249bd783&quot;,&quot;title&quot;:&quot;UserConfig.UpdateConfigData&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userConfig\\updateConfigData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userConfig\\updateConfigData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                _id = dummyUser._id\n                flowData.trigger.handlers = [userTriggerObj]\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                var query = _models.ConfigData.find({ flow_uid: userFlow.uid })\n                query.lean().exec(function(err, results) {\n                    if (err) {\n                        done(err)\n                    } else {\n                        configData = results\n                        done()\n                    }\n                })\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0d675537-d2ab-40b1-9394-3d07a649fb2e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nasync.parallel([\n    function(cb) {\n        _models.ConfigData.remove({ uid: { $in: _.map(configData, &#x27;uid&#x27;) } }, function(err) {\n            cb(err)\n        })\n    },\n    function(cb) {\n        _models.newFlow.remove({ uid: userFlow.uid }, function(err) {\n            cb(err)\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1521a19e-d2ba-4912-92ff-6b0cea52a218&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndata.active_config = &#x27;default&#x27;\nvar triggerConfigData = _.find(configData, { activity_id: &#x27;start&#x27; })\napi.put(apiURL + triggerConfigData.uid)\n    .send(data)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd7a2147-037a-4f07-9bba-292afdeba1bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user config uid is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should get error, if user config uid is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndata.config_uid = &#x27;dummyConfig&#x27;\napi.put(apiURL + configData.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_CONFIG_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;697958b1-d43b-484a-873f-9c976fdff42c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if same record already present.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should get error, if same record already present.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar authConfigData = _.find(configData, { activity_id: &#x27;a0&#x27; })\nvar connConfigData = _.find(configData, { activity_id: &#x27;a1&#x27; })\napi.put(apiURL + authConfigData.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connConfigData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.RECORD_ALREADY_PRESENT);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;daf9457a-f6e5-441d-a736-7eda164a3101&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update config data and update flow for auth remove.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should update config data and update flow for auth remove.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nvar authConfigData = _.find(configData, { activity_id: &#x27;a0&#x27; })\ndelete authConfigData.auth\n    //authConfigData.auth = &#x27;dummyAuth&#x27;\napi.put(apiURL + authConfigData.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(authConfigData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flowConfigData = res.body.output\n            expect(flowConfigData.auth).to.be.equal(undefined);\n            var query = _models.newFlow.findOne({ uid: flowConfigData.flow_uid })\n            query.lean().exec(function(err, flow) {\n                if (err) {\n                    done(err)\n                } else {\n                    expect(flow.is_draft).to.be.equal(true);\n                    expect(flow.trigger.handlers.length).to.be.equal(1);\n                    var error = _.filter(flow.errors_obj, { id: &#x27;a0-token&#x27; })\n                    expect(error.length).to.be.gte(1);\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;951f6541-ef6c-44ae-98a7-d699e06175ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update config data and update flow for connection remove.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should update config data and update flow for connection remove.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nvar connConfigData = _.find(configData, { activity_id: &#x27;a1&#x27; })\ndelete connConfigData.connection\napi.put(apiURL + connConfigData.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connConfigData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flowConfigData = res.body.output\n            expect(flowConfigData.connection).to.be.equal(undefined);\n            var query = _models.newFlow.findOne({ uid: flowConfigData.flow_uid })\n            query.lean().exec(function(err, flow) {\n                if (err) {\n                    done(err)\n                } else {\n                    expect(flow.is_draft).to.be.equal(true);\n                    var error = _.filter(flow.errors_obj, { id: &#x27;a1-connection&#x27; })\n                    expect(error.length).to.be.gte(1);\n                    done();\n                }\n            })\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2887522d-d617-4fff-97df-9495ef538380&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update config data and update flow for agent remove.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should update config data and update flow for agent remove.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar opt = { path: getTriggerPath, body: getTriggerPath };\ncommonMock.triggerGetSuccess(opt);\nvar agentConfigData = _.find(configData, { activity_id: &#x27;a2&#x27; })\ndelete agentConfigData.agent\napi.put(apiURL + agentConfigData.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(agentConfigData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var flowConfigData = res.body.output\n            expect(flowConfigData.agent).to.be.equal(undefined);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e22028cd-83db-487e-b7d1-5502205897bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if config data uid is invalid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserConfig.UpdateConfigData Should get error, if config data uid is invalid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar connConfigData = _.find(configData, { activity_id: &#x27;a1&#x27; })\nconnConfigData.flow_uid = &#x27;abc&#x27;\napi.put(apiURL + &#x27;dummyConfigData&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(connConfigData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.RECORD_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76f0268c-e8d4-40af-ac01-ac6f2d20d905&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dd7a2147-037a-4f07-9bba-292afdeba1bb&quot;,&quot;697958b1-d43b-484a-873f-9c976fdff42c&quot;,&quot;daf9457a-f6e5-441d-a736-7eda164a3101&quot;,&quot;951f6541-ef6c-44ae-98a7-d699e06175ba&quot;,&quot;2887522d-d617-4fff-97df-9495ef538380&quot;,&quot;e22028cd-83db-487e-b7d1-5502205897bf&quot;,&quot;76f0268c-e8d4-40af-ac01-ac6f2d20d905&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:111,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;46a426dc-1484-4064-a90a-b30687fe2064&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;505f7aa0-05ee-4901-862d-35bfc504b6d1&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f041022a-ed32-4250-b7ee-cbce9300ab35&quot;,&quot;title&quot;:&quot;UserLogs.downloadLogsBasedOnBillUid&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUid \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1108,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                fillEntries(res.body.output.uid, res.body.output.authtoken, function(error, result) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        var tempImmutableSignupObject = getImmutable(registrationBody);\n                        tempImmutableSignupObject.email = \&quot;test.user+101@raweng.com\&quot;;\n                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                            email: tempImmutableSignupObject.email\n                        });\n                        api.post(\&quot;/enterprise/v1/signup\&quot;)\n                            .send(tempImmutableSignupObject)\n                            .expect(httpStatus.CREATED)\n                            .end(function(error, res) {\n                                if (error) {\n                                    done(error);\n                                } else {\n                                    authToken = res.body.output.authtoken;\n                                    user_uid = res.body.output.uid;\n                                    fillEntries(res.body.output.uid, res.body.output.authtoken, function(error, result) {\n                                        if (error) {\n                                            done(error);\n                                        } else {\n                                            done();\n                                        }\n                                    });\n                                }\n                            });\n                    }\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd01bb32-62e7-4a42-b9d5-5d3ef9ba4402&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUid \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e1804614-27fd-4fdb-af3a-0b78d01d566c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bill logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUid Should get list of bill logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?authtoken=\&quot; + authToken;\napi.get(paramURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;01d0d2f9-0bed-48ce-a520-413f7295e6a9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUid Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;288f7083-1c44-4c55-b1f1-dd71208f75f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;01d0d2f9-0bed-48ce-a520-413f7295e6a9&quot;,&quot;288f7083-1c44-4c55-b1f1-dd71208f75f7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;722267ad-a895-4b3e-9339-db619574f1dc&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;236a2b8f-2382-4ab7-92fe-02ffe874f28b&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;56d645c5-9213-42a7-b923-40d3bb77d35f&quot;,&quot;title&quot;:&quot;UserLogs.downloadLogsBasedOnBillUidOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\downloadLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUidOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:537,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/projects\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                project_uid = _.first(res.body.output.projects).uid\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        fillEntries(user_uid, authToken, function(error, result) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                done();\n                            }\n                        });\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;179c678b-851b-4ddc-b0d1-3933861dc8a4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUidOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a97e9e04-0ce5-4efe-a658-4765c9194548&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bill logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUidOrg Should get list of bill logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?authtoken=\&quot; + authToken;\napi.get(paramURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .set(\&quot;project_uid\&quot;, project_uid)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9543b823-dbdc-4a80-be10-f7d8faed5158&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.downloadLogsBasedOnBillUidOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .set(\&quot;org_uid\&quot;, org_uid)\n    .set(\&quot;project_uid\&quot;, project_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a4f337f-5a58-41d5-969e-b59694c7fc3a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9543b823-dbdc-4a80-be10-f7d8faed5158&quot;,&quot;5a4f337f-5a58-41d5-969e-b59694c7fc3a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:23,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;df54fea3-2c1a-4935-8487-4c8d8a8456c3&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7456b341-3461-4db6-96c9-0164bae89809&quot;,&quot;title&quot;:&quot;logs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;62062812-ec47-474b-8e26-164e6c7f9f22&quot;,&quot;title&quot;:&quot;UserLogs.getDebugMessage&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessage.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessage \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:179,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nclearRecords(function() {\n    _models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            _models.Log.remove({ flow_name: new RegExp(&#x27;^utest_cases_&#x27;, \&quot;i\&quot;) }, function(error, user) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(registrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            authToken = res.body.output.authtoken;\n                            api.get(\&quot;/enterprise/v1/user\&quot;)\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    user_uid = res.body.output.uid;\n                                    env_uid = res.body.output.env_uid;\n                                    saveUserLogs({\n                                            authtoken: authToken,\n                                            user_uid: user_uid\n                                        },\n                                        function(error, userLogs) {\n                                            _userLogs = userLogs;\n                                            done();\n                                        });\n                                });\n                        }\n                    });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8fed884a-0d0a-4677-9c43-e68e5fbb12b4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessage \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Log.remove({ flow_name: new RegExp(&#x27;^utest_cases_&#x27;, \&quot;i\&quot;) }, function(error, user) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c59d4b0-e1d3-46ae-97e1-17a617de116a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessage Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar log_uid = _userLogs[0].body.output.uid;\nvar paramURL = apiURL.replace(\&quot;:log_uid\&quot;, log_uid);\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(log_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a1b7c4a5-4854-456d-8621-a313a82f66c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessage Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c52326cf-7b07-4a7a-82de-cad40d708696&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a1b7c4a5-4854-456d-8621-a313a82f66c4&quot;,&quot;c52326cf-7b07-4a7a-82de-cad40d708696&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:18,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;044cc937-b022-4f13-bd8e-e5062e9eaf71&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e38e638a-7e96-4c49-9928-30834983c87c&quot;,&quot;title&quot;:&quot;logs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e0c8845e-087f-413b-a9cb-6e2324459f2a&quot;,&quot;title&quot;:&quot;UserLogs.getDebugMessageOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getDebugMessageOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessageOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:165,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/projects\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                project_uid = _.first(res.body.output.projects).uid\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        saveUserLogs({\n                                authtoken: authToken,\n                                user_uid: user_uid\n                            },\n                            function(error, userLogs) {\n                                _userLogs = userLogs;\n                                done();\n                            });\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec4bac3e-5f3a-4a77-a1eb-2395f59778ad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessageOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;865a67df-d1a0-4577-9222-4134bff2b741&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessageOrg Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar log_uid = _userLogs[0].body.output.uid;\nvar paramURL = apiURL.replace(\&quot;:log_uid\&quot;, log_uid);\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(log_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a20b659f-9035-45e2-83d2-848cf3ca9e04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getDebugMessageOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b600700b-59f4-42d9-82bb-dbdd8c556d91&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a20b659f-9035-45e2-83d2-848cf3ca9e04&quot;,&quot;b600700b-59f4-42d9-82bb-dbdd8c556d91&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:18,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;fde9cc59-77d5-4172-bab3-0cfa8cd495a3&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5fb92c5c-0a3f-45b3-b7d1-fd8515a450a0&quot;,&quot;title&quot;:&quot;logs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a8711599-df82-4490-b01a-32df42e99e21&quot;,&quot;title&quot;:&quot;UserLogs.getLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogs.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:115,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                saveUserLogs({\n                        authtoken: authToken,\n                        user_uid: user_uid\n                    },\n                    function(error, userLogs) {\n                        savedUserLogs = userLogs;\n                        done();\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37a8220e-78eb-49b1-af96-5e307518368c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c83da62d-dfbc-400d-92b5-cf88fbd3785f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77b29b6b-fbb9-400e-b613-d8ac9318e4bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should get limited list of user logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar skipLimitURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(skipLimitURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.count == 5) {\n                isValid = Array.isArray(res.body.output.objects) &amp;&amp;\n                    res.body.output.objects.length == 2;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6906d4b8-dcee-4346-a184-d115373bf418&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6e3e64e-8181-43ef-a8a2-8f75ae2bc90c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;77b29b6b-fbb9-400e-b613-d8ac9318e4bb&quot;,&quot;6906d4b8-dcee-4346-a184-d115373bf418&quot;,&quot;f6e3e64e-8181-43ef-a8a2-8f75ae2bc90c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5a5f68d0-2833-40db-a051-6f3ec85598c9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4b0f5193-7587-4e3b-863a-6a8472f6d8d4&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;01d89872-1bbb-452d-b91c-373c30ced7c5&quot;,&quot;title&quot;:&quot;UserLogs.getLogsBasedOnBillUid&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUid.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:527,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        user_uid = res.body.output.uid;\n                        env_uid = res.body.output.env_uid;\n                        fillEntries(res.body.output.uid, res.body.output.authtoken, function(error, result) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                done();\n                            }\n                        });\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49b9a678-9aa5-4f3d-9b75-d58a4a976c02&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60768996-5d7c-499f-ba57-134bdff179b4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bill logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get list of bill logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 10;\n                if (isValid) {\n                    _.each(res.body.output.objects, function(item) {\n                        isValid = isValid &amp;&amp;\n                            item.user_uid == user_uid &amp;&amp;\n                            typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(item.__v) == \&quot;undefined\&quot;;\n                    });\n                }\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10e0b6a1-27b7-45cc-ad1c-648d851b5235&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get limited list of bill logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0122226d-2541-47c6-b0bb-da206233440a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill logs based on skip/limit in descending order of message.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get limited list of bill logs based on skip/limit in descending order of message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?skip=2&amp;limit=2&amp;field=message&amp;direction=asc\&quot;;\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d5b052cb-8d76-4820-a145-d98f517a6b3c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of bill old logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get list of bill old logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                //isValid = res.body.output.objects.length == 10;\n                isValid = true; //res.body.output.objects.length == 10;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bff90155-b619-484f-ac9b-b5f65ecad084&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill old logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get limited list of bill old logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, firstBillUid) + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                /*\n                isValid = res.body.output.objects[0].uid == _oldLogEntries[7].body.output.uid &amp;&amp;\n                    res.body.output.objects[1].uid == _oldLogEntries[6].body.output.uid;\n                */\n                isValid = true; //res.body.output.objects.length == 2;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f0555ac-b028-487a-bd0d-36a73401cf2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill old logs based on skip/limit in descending order of message.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should get limited list of bill old logs based on skip/limit in descending order of message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, firstBillUid) + \&quot;?skip=2&amp;limit=2&amp;field=message&amp;direction=asc\&quot;;\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = true; //res.body.output.objects.length == 2;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;feacc196-2066-4849-87d4-a29724b52671&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUid Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62510113-10b6-4705-9266-ed2d7f2cf564&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;10e0b6a1-27b7-45cc-ad1c-648d851b5235&quot;,&quot;0122226d-2541-47c6-b0bb-da206233440a&quot;,&quot;d5b052cb-8d76-4820-a145-d98f517a6b3c&quot;,&quot;bff90155-b619-484f-ac9b-b5f65ecad084&quot;,&quot;1f0555ac-b028-487a-bd0d-36a73401cf2e&quot;,&quot;feacc196-2066-4849-87d4-a29724b52671&quot;,&quot;62510113-10b6-4705-9266-ed2d7f2cf564&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:103,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;50cee407-1282-4bd0-b729-0df21928d01a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7e58cfda-00d5-44fb-a48d-449d4eeae8af&quot;,&quot;title&quot;:&quot;UserLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3ea819d6-0a43-40bc-9022-d064009d90a7&quot;,&quot;title&quot;:&quot;UserLogs.getLogsBasedOnBillUidOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsBasedOnBillUidOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:531,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/projects\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                project_uid = _.first(res.body.output.projects).uid\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        fillEntries(user_uid, authToken, function(error, result) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                done();\n                            }\n                        });\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;632b66c8-dff8-4e23-87e5-6b9bf440ef18&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f28ad02-84c1-4a80-b0ce-709233b4159d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of bill logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get list of bill logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 10;\n                if (isValid) {\n                    _.each(res.body.output.objects, function(item) {\n                        isValid = isValid &amp;&amp;\n                            item.user_uid == org_account_uid &amp;&amp;\n                            typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(item.__v) == \&quot;undefined\&quot;;\n                    });\n                }\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b42ba353-2d3c-43d1-96b7-11064fcdde07&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get limited list of bill logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2cad9276-4936-4192-a74e-863eb133a28c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill logs based on skip/limit in descending order of message.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get limited list of bill logs based on skip/limit in descending order of message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid) + \&quot;?skip=2&amp;limit=2&amp;field=message&amp;direction=asc\&quot;;\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38670b03-a523-44da-ad61-2c9c0912de71&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of bill old logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get list of bill old logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, firstBillUid);\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                //isValid = res.body.output.objects.length == 10;\n                isValid = res.body.output.objects.length == 10;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1633d495-2941-4daa-931e-9078811cdf7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill old logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get limited list of bill old logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, firstBillUid) + \&quot;?skip=2&amp;limit=2\&quot;;\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                /*\n                isValid = res.body.output.objects[0].uid == _oldLogEntries[7].body.output.uid &amp;&amp;\n                    res.body.output.objects[1].uid == _oldLogEntries[6].body.output.uid;\n                */\n                isValid = res.body.output.objects.length == 2;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c51f66c6-f999-403b-8dd3-86601691eec1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of bill old logs based on skip/limit in descending order of message.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should get limited list of bill old logs based on skip/limit in descending order of message.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, firstBillUid) + \&quot;?skip=2&amp;limit=2&amp;field=message&amp;direction=asc\&quot;;\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output.objects)) {\n                /*\n                isValid = res.body.output.objects[0].uid == _oldLogEntries[2].body.output.uid &amp;&amp;\n                    res.body.output.objects[1].uid == _oldLogEntries[3].body.output.uid;\n                */\n                isValid = res.body.output.objects.length == 2;\n            }\n            isValid.should.be.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e490902a-3d90-44e4-b4a5-ad615011999f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise UserLogs UserLogs.getLogsBasedOnBillUidOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL.replace(\&quot;:bill_uid\&quot;, secondBillUid);\napi.get(paramURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;190c9249-2c98-4ae9-8efd-6da729b11c9a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b42ba353-2d3c-43d1-96b7-11064fcdde07&quot;,&quot;2cad9276-4936-4192-a74e-863eb133a28c&quot;,&quot;38670b03-a523-44da-ad61-2c9c0912de71&quot;,&quot;1633d495-2941-4daa-931e-9078811cdf7f&quot;,&quot;c51f66c6-f999-403b-8dd3-86601691eec1&quot;,&quot;e490902a-3d90-44e4-b4a5-ad615011999f&quot;,&quot;190c9249-2c98-4ae9-8efd-6da729b11c9a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:97,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3b8f634e-b579-446f-99b2-8f069e85e650&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;aec59731-18a7-4c33-b052-75d6c0df573c&quot;,&quot;title&quot;:&quot;logs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;34b0747a-d14a-46e8-ac49-990b40b9f567&quot;,&quot;title&quot;:&quot;UserLogs.getLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\userLogs\\getLogsOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:137,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/projects\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                project_uid = _.first(res.body.output.projects).uid\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        saveUserLogs({\n                                authtoken: authToken,\n                                user_uid: user_uid\n                            },\n                            function(error, userLogs) {\n                                savedUserLogs = userLogs;\n                                done();\n                            });\n                    });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;016d0a3f-88b6-4d67-b14a-d13617ce8197&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c95e718f-2e71-4a84-9302-2c65d4b0d1ae&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should get list of user logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e173d3a-9bf8-4370-8c32-d601a4e1e4db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user logs based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should get limited list of user logs based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar skipLimitURL = apiURL + \&quot;?limit=2&amp;skip=2\&quot;;\napi.get(skipLimitURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77208f58-3652-4840-978f-6e105f89bb90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise logs UserLogs.getLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5871bd1c-7a88-4358-8d25-0885f5536360&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6e173d3a-9bf8-4370-8c32-d601a4e1e4db&quot;,&quot;77208f58-3652-4840-978f-6e105f89bb90&quot;,&quot;5871bd1c-7a88-4358-8d25-0885f5536360&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:36,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c7ecb7b9-31ba-4cef-a3df-bc72bdf232a4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f9ce7e21-58be-4edc-a882-c3d5d56967c3&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3cbe2a7f-0953-4186-80ea-43697756ff23&quot;,&quot;title&quot;:&quot;User.activate&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\activate.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b870c0c-7a79-4637-a230-9932b212bb7c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;554908e9-b6e1-40a8-9144-6dfe6beb1542&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should activate account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate Should activate account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        user_uid: uid,\n        token: token\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.USER_ACTIVATION_ACTIVATED_SUCCESSFULLY);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4b4f8431-c615-4e2f-b03f-a309b1fa5b60&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should activate account after activation_expired gets false.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate Should activate account after activation_expired gets false.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({\n    uid: uid\n}, {\n    activation_expired: true,\n    active: false\n}, function(error, result) {\n    api.post(apiURL)\n        .send({\n            user_uid: uid,\n            token: token\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                _models.User.findOne({\n                    uid: uid\n                }).lean().exec(function(error, user) {\n                    (user.activation_expired == false &amp;&amp; user.active).should.equal(true);\n                    done();\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97660b89-8498-4033-b917-2b1d3fd4d3df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should activate account, when user is lock.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate Should activate account, when user is lock.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n    failed_login_count: 7\n}, { new: true }, function(err, user) {\n    api.post(\&quot;/enterprise/v1/user/activate\&quot;)\n        .send({\n            user_uid: uid,\n            token: token\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.USER_ACTIVATION_ACTIVATED_SUCCESSFULLY);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12886bf6-ec82-445c-8205-aaaa77a22146&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to raised forgot password request, for 5 times invalid login attempt user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate Should allowed to raised forgot password request, for 5 times invalid login attempt user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\nvar loginCount = [];\n_models.User.findOneAndUpdate({\n    uid: uid\n}, {\n    failed_login_count: 5\n}, { new: true }, function(error, result) {\n    if (error) {\n        done(error);\n    } else {\n        api.post(\&quot;/enterprise/v1/user/activate\&quot;)\n            .send({\n                user_uid: uid,\n                token: token\n            })\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.message.should.equal(messageList.USER_ACTIVATION_ACTIVATED_SUCCESSFULLY);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e23f6f9-714d-471a-8a15-86868ac7aff5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as email not register.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.activate Should give error as email not register.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        user_uid: uid,\n        token: \&quot;FAKE_CODE\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_ACTIVATION_INCORRECT_CODE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f348e50-35d6-43f4-ba5f-2c8d62f801c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4b4f8431-c615-4e2f-b03f-a309b1fa5b60&quot;,&quot;97660b89-8498-4033-b917-2b1d3fd4d3df&quot;,&quot;12886bf6-ec82-445c-8205-aaaa77a22146&quot;,&quot;5e23f6f9-714d-471a-8a15-86868ac7aff5&quot;,&quot;5f348e50-35d6-43f4-ba5f-2c8d62f801c4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:23,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;74450b9c-a9ac-4c5c-a79c-28d73ab422f7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b4754871-2c1a-426c-b52d-71e173e58c61&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f83de40f-f819-4e15-9859-cae205892a2c&quot;,&quot;title&quot;:&quot;User.authyContact&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\authyContact.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ deleted_at: null }, function(error, user) {\n    _models.Mail.remove({ deleted_at: null }, function(error, user) {\n        _models.Authy.remove({ deleted_at: null }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ad2a658-9a2f-41e6-acfc-4bfb89007ad3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7602f8b4-ee22-40a2-adda-70381e6fdbfd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get error, if user is unauthorised.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should get error, if user is unauthorised.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;)\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48aff840-37c0-44f4-af4f-2b8d47171b2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should register phone number with authy.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should register phone number with authy.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.authy_number == tempRegistrationBody.authy_number &amp;&amp;\n                res.body.output.enable_twofa == \&quot;enable\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3238e6d2-5ac0-46eb-a279-1c7d45b8f08c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should get default plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                    //return (plan || {}).enterprise_plan || false;\n                    return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                })) || {};\n                defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79403d0d-9e56-4cdc-87b1-7245bbe324e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should get default attributes.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                isValid = utils.isHaveKeyVals(res.body.output, [\n                        \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                        \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                    ]) &amp;&amp;\n                    res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                    moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                    moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c51c10f-93df-46c8-896f-e15fbd25664c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as authy number is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should give error as authy number is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\n//tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.authy_number.message == messageList.AUTHY_NUMBER_IS_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;65658b52-0423-450c-a77a-c736bb64be5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as authy country code is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should give error as authy country code is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n//tempRegistrationBody.country_code = \&quot;91\&quot;;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.country_code.message == messageList.AUTHY_COUNTRY_CODE_IS_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f366d0b2-2692-4658-9764-41fcacc63a31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should de-register and then register same phone number with authy.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.authyContact Should de-register and then register same phone number with authy.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\n\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var oldAuthyUserID = res.body.output.authy_user_uid;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(apiURL)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid =\n                            res.body.output.authy_user_uid == oldAuthyUserID &amp;&amp;\n                            (res.body.output.authy_user_uid || \&quot;\&quot;) != \&quot;\&quot; &amp;&amp;\n                            (oldAuthyUserID || \&quot;\&quot;) != \&quot;\&quot; &amp;&amp;\n                            res.body.output.enable_twofa == \&quot;enable\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;971315b8-7f45-4f07-bab3-aa0ab06b2b65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;48aff840-37c0-44f4-af4f-2b8d47171b2c&quot;,&quot;3238e6d2-5ac0-46eb-a279-1c7d45b8f08c&quot;,&quot;79403d0d-9e56-4cdc-87b1-7245bbe324e6&quot;,&quot;6c51c10f-93df-46c8-896f-e15fbd25664c&quot;,&quot;65658b52-0423-450c-a77a-c736bb64be5e&quot;,&quot;f366d0b2-2692-4658-9764-41fcacc63a31&quot;,&quot;971315b8-7f45-4f07-bab3-aa0ab06b2b65&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:175,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4c440cb3-7a6f-4742-82d6-02feed080e09&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c7b7b282-7678-4140-8ae3-97b105050278&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7e1dc89a-0dd4-459f-8d97-8e750680288b&quot;,&quot;title&quot;:&quot;User.cancelTwoFA&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\cancelTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ deleted_at: null }, function(error, user) {\n    _models.Mail.remove({ deleted_at: null }, function(error, user) {\n        _models.Authy.remove({ deleted_at: null }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17486dbc-cfa7-4a1c-b7cb-856db0c577bb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c42be19e-0ed3-412a-9d67-94c3ba6b11c3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should cancel twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should cancel twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid =\n                                                        res.body.output.enable_twofa == \&quot;disable\&quot; &amp;&amp;\n                                                        res.body.output.authy_user_uid == \&quot;\&quot; &amp;&amp;\n                                                        res.body.output.is_twofa_sms_enabled == false;\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b0103f6-9273-4476-9b18-b72af852de44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should cancel twofa if same email account exists in express.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should cancel twofa if same email account exists in express.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2804,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;);\napi.post(\&quot;/express/v1/login\&quot;)\n    .send({\n        email: registrationBody.email,\n        password: registrationBody.password\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid =\n                                                                    res.body.output.enable_twofa == \&quot;disable\&quot; &amp;&amp;\n                                                                    res.body.output.authy_user_uid == \&quot;\&quot; &amp;&amp;\n                                                                    res.body.output.is_twofa_sms_enabled == false;\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7f9aa44-7c14-49c9-8c28-d017ff9a647d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for cancel twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should get default plan for cancel twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = false;\n                                                    if (res.body.output.plan.length == 1) {\n                                                        var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                            //return (plan || {}).express_plan || false;\n                                                            return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                        })) || {};\n                                                        defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                        isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;03f78b64-57c8-4a8d-91aa-66bab992da9e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for cancel twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should get default attributes for cancel twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = false;\n                                                    if (res.body.output.plan.length == 1) {\n                                                        isValid = utils.isHaveKeyVals(res.body.output, [\n                                                                \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                                \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                            ]) &amp;&amp;\n                                                            res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                            moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                            moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3b5ab9c-e497-4b16-8e8e-ee19af408307&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should cancel twofa for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should cancel twofa for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid =\n                                                                    res.body.output.enable_twofa == \&quot;disable\&quot; &amp;&amp;\n                                                                    res.body.output.authy_user_uid == \&quot;\&quot; &amp;&amp;\n                                                                    res.body.output.is_twofa_sms_enabled == false;\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dea5efca-c235-453c-8cc1-a71a2ea7f48d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for cancel twofa with google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should get default plan for cancel twofa with google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:100,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid = false;\n                                                                if (res.body.output.plan.length == 1) {\n                                                                    var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                                        //return (plan || {}).express_plan || false;\n                                                                        return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                                    })) || {};\n                                                                    defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                                    isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                                }\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05337818-b71e-4615-a014-1b54afd91cc7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for cancel twofa with google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should get default attributes for cancel twofa with google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:103,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid = false;\n                                                                if (res.body.output.plan.length == 1) {\n                                                                    isValid = utils.isHaveKeyVals(res.body.output, [\n                                                                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                                        ]) &amp;&amp;\n                                                                        res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                                }\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;34dd1c16-5809-4b75-8d29-5a47ee3046be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.cancelTwoFA Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0baecfa-6c2b-48db-8b77-b2c6d62dc91a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1b0103f6-9273-4476-9b18-b72af852de44&quot;,&quot;c7f9aa44-7c14-49c9-8c28-d017ff9a647d&quot;,&quot;03f78b64-57c8-4a8d-91aa-66bab992da9e&quot;,&quot;f3b5ab9c-e497-4b16-8e8e-ee19af408307&quot;,&quot;dea5efca-c235-453c-8cc1-a71a2ea7f48d&quot;,&quot;05337818-b71e-4615-a014-1b54afd91cc7&quot;,&quot;34dd1c16-5809-4b75-8d29-5a47ee3046be&quot;,&quot;b0baecfa-6c2b-48db-8b77-b2c6d62dc91a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3375,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;75c72f22-59a7-4cce-900b-2209cd894cf0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ec1fea7b-68ef-40bd-b453-883b96f2b55e&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6381bfa4-48f8-454f-8d3b-fd9f890b80ea&quot;,&quot;title&quot;:&quot;User.changeFirstTime&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changeFirstTime.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3276ba3b-22ed-4970-8b4f-0d282a0b535e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a0c68f23-44d3-4fe8-9479-e69ed0065562&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should set first time login false.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime Should set first time login false.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.first_login.should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b2cf4f95-8280-429e-b171-268f02fc9bb9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get organizations details for firsttime login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime Should get organizations details for firsttime login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        api.put(apiURL)\n            .set(&#x27;authtoken&#x27;, data.role1.authtoken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.organizations.length == 1;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f85e69f2-a279-4b1b-a89c-43304672c009&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set first time login false if user is expired.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime Should set first time login false if user is expired.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({\n    uid: uid\n}, {\n    activation_token: \&quot;fl554d45sfdsfdsf54554\&quot;,\n    activation_expired: true,\n    active: false,\n    created_at: new Date(2017, 00, 01),\n    subscription: {\n        \&quot;start_date\&quot;: new Date(2017, 00, 01),\n        \&quot;hasUnlimitedPlan\&quot;: false,\n        \&quot;days\&quot;: 30,\n        \&quot;expired\&quot;: false\n    }\n}, { new: true }, function(err, activity) {\n    if (err) {\n        done(err);\n    } else {\n        api.put(apiURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.first_login.should.equal(false);\n                    done();\n                }\n            });\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5812f2c-1817-4bdc-bf30-39870b07bd10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changeFirstTime Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd01b1cb-7ec8-4a1a-a04d-1e49a433291c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b2cf4f95-8280-429e-b171-268f02fc9bb9&quot;,&quot;f85e69f2-a279-4b1b-a89c-43304672c009&quot;,&quot;a5812f2c-1817-4bdc-bf30-39870b07bd10&quot;,&quot;cd01b1cb-7ec8-4a1a-a04d-1e49a433291c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:141,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bc2261bf-6ede-4cba-b021-9a8557a51fde&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;86a3c2d6-6cee-4897-b605-50e2797a2db1&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c7b88bae-28ad-4049-b701-ba77952a9dc5&quot;,&quot;title&quot;:&quot;User.changePassword&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\changePassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b83ec14c-ba28-4612-a6c3-882df51daf81&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32e451c8-4b93-4337-aba0-bbf270d699d3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update new password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should update new password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:140,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.not.equal(\&quot;\&quot;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b140cf08-4c3c-441a-bfd1-8bb60b412428&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid password format.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give error as invalid password format.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.password.message.should.equal(messageList.USER_REG_INVALID_PASSWORD);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;499a52ce-c3e6-4bf1-b660-096d95bcb3be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as password is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give error as password is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\n//tempRegistrationBody.password = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.password.message.should.equal(messageList.USER_REG_INVALID_PASSWORD);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5c58122-d796-43a7-94ff-af3c8bfd68ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as confirm password is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give error as confirm password is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw@1235\&quot;;\n//tempRegistrationBody.password_confirmation = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.password_confirmation.message.should.equal(messageList.USER_PASS_NOT_MATCH_WITH_CONFIRM_PASS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d1c25a9-5f33-445a-b47c-bc5829c54918&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as old password is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give error as old password is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1235\&quot;;\n//tempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.oldpassword.message.should.equal(messageList.USER_CHANGE_PASSWARD_OLD_PASSWORD_REQUIRED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2b1d7bc-f6f6-4e5c-8a28-7a8b892e17fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as password and confirm passwords are different.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give error as password and confirm passwords are different.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1236\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.password_confirmation.message.should.equal(messageList.USER_PASS_NOT_MATCH_WITH_CONFIRM_PASS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b62a5f61-ccff-4566-944f-f3d74ddf9e40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.changePassword Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = {};\ntempRegistrationBody.password = \&quot;Raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1236\&quot;;\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c42ef6de-0fc8-41e4-9c1c-835c7ad08f2d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b140cf08-4c3c-441a-bfd1-8bb60b412428&quot;,&quot;499a52ce-c3e6-4bf1-b660-096d95bcb3be&quot;,&quot;c5c58122-d796-43a7-94ff-af3c8bfd68ce&quot;,&quot;2d1c25a9-5f33-445a-b47c-bc5829c54918&quot;,&quot;d2b1d7bc-f6f6-4e5c-8a28-7a8b892e17fe&quot;,&quot;b62a5f61-ccff-4566-944f-f3d74ddf9e40&quot;,&quot;c42ef6de-0fc8-41e4-9c1c-835c7ad08f2d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:216,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f7086600-87f3-4c6e-98d7-bc14dbbe4ecd&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;64fa1c56-3d82-41ad-9e18-67d7b28e46d6&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;040a7855-220d-43bd-b0ca-6d499ad0aa6a&quot;,&quot;title&quot;:&quot;User.checkMyEmail&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\checkMyEmail.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9752cefe-5460-40d9-855a-ed309f7a1692&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d94d6ff9-946f-4fc9-b909-1ad3e9a2db5a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give false for block status after first fail login attempt.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail Should give false for block status after first fail login attempt.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL + \&quot;?email=test.user@raweng.com\&quot;;\napi.get(paramURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.block.should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0f3dce9-23ef-4a88-87db-ba747daa52a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give true for show_captcha status for user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail Should give true for show_captcha status for user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:248,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send({\n                    \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                    \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                })\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send({\n                                \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                            })\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var paramURL = apiURL + \&quot;?email=test.user@raweng.com\&quot;;\n                                    api.get(paramURL)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.output.show_captcha.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;257b69f2-ebb9-4a76-bb00-ef829876dd2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give false for show_captcha status after two fail login attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail Should give false for show_captcha status after two fail login attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send({\n                    \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                    \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                })\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var paramURL = apiURL + \&quot;?email=test.user@raweng.com\&quot;;\n                        api.get(paramURL)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.show_captcha.should.equal(false);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72bc6747-6232-4d81-bd29-a9dcb7a49fb9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give true block status for user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail Should give true block status for user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:489,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send({\n                    \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                    \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                })\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send({\n                                \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                            })\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n\n                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                        .send({\n                                            \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                            \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                                        })\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n\n                                                api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                    .send({\n                                                        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                                        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                                                    })\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                                .send({\n                                                                    \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                                                    \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                                                                })\n                                                                .expect(httpStatus.UNAUTHORIZED)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        var paramURL = apiURL + \&quot;?email=test.user@raweng.com\&quot;;\n                                                                        api.get(paramURL)\n                                                                            .expect(httpStatus.OK)\n                                                                            .end(function(err, res) {\n                                                                                if (err) {\n                                                                                    done(err);\n                                                                                } else {\n                                                                                    res.body.output.block.should.equal(true);\n                                                                                    done();\n                                                                                }\n                                                                            });\n\n\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b5249506-8f68-4fae-a369-746f65786649&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give false for block status after fifth fail login attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.checkMyEmail Should give false for block status after fifth fail login attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:408,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send({\n                    \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                    \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                })\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send({\n                                \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                            })\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n\n                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                        .send({\n                                            \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                            \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                                        })\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n\n                                                api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                    .send({\n                                                        \&quot;email\&quot;: \&quot;test.user@raweng.com\&quot;,\n                                                        \&quot;password\&quot;: \&quot;Raw@123456\&quot;\n                                                    })\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n\n                                                            var paramURL = apiURL + \&quot;?email=test.user@raweng.com\&quot;;\n                                                            api.get(paramURL)\n                                                                .expect(httpStatus.OK)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        res.body.output.block.should.equal(false);\n                                                                        done();\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;628547ab-854b-47dc-b6cd-0407140d5c4b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f0f3dce9-23ef-4a88-87db-ba747daa52a2&quot;,&quot;257b69f2-ebb9-4a76-bb00-ef829876dd2c&quot;,&quot;72bc6747-6232-4d81-bd29-a9dcb7a49fb9&quot;,&quot;b5249506-8f68-4fae-a369-746f65786649&quot;,&quot;628547ab-854b-47dc-b6cd-0407140d5c4b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1314,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;306f6e83-0289-4100-9a1a-40fb10e40d7f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9453d6f9-a64d-4dfc-a319-dc36cd50405d&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f725de09-dab4-4621-9ac6-38a83154b019&quot;,&quot;title&quot;:&quot;User.clearPendingUserStream&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\clearPendingUserStream.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.clearPendingUserStream \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:778,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                saveBillEntries({\n                    user_uid: user_uid,\n                    authtoken: authToken,\n                    email: res.body.output.email\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        saveUserStreamEntries({\n                            user_uid: user_uid,\n                            authtoken: authToken,\n                            email: res.body.output.email\n                        }, function(error, userStreamEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _userStreamEntries = userStreamEntries;\n                                done();\n                            }\n                        });\n                    }\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78374377-9f27-4c90-a027-4cb4daa51bc6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.clearPendingUserStream \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nhttpmock.cleanAll();\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f514e771-7fba-4133-a9c2-128b033681f6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should clear pending stream of user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.clearPendingUserStream Should clear pending stream of user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        stream_ids: [userStreamIDs[0], userStreamIDs[1]]\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.UserStream.find({ user_uid: user_uid }, function(error, userStreams) {\n                var isValid01 = true,\n                    isValid02 = true;\n                _.each(userStreams, function(item) {\n                    if (item.uid == userStreamIDs[0] || item.uid == userStreamIDs[1]) {\n                        isValid01 = isValid01 &amp;&amp; item.pending_view == false;\n                    } else {\n                        isValid02 = isValid02 &amp;&amp; item.pending_view;\n                    }\n                });\n                (isValid01 &amp;&amp; isValid02).should.equal(true);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab716625-5e99-48e0-9b3d-3639a42a43c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give ids required error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.clearPendingUserStream Should give ids required error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_STREAM_REQUIRED_IDS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9467fb29-7889-45c6-b36b-6a4b7f3ea277&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.clearPendingUserStream Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        stream_ids: [userStreamIDs[0], userStreamIDs[1]]\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97b8ab7d-26cc-4b57-9100-76cca8850dec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ab716625-5e99-48e0-9b3d-3639a42a43c9&quot;,&quot;9467fb29-7889-45c6-b36b-6a4b7f3ea277&quot;,&quot;97b8ab7d-26cc-4b57-9100-76cca8850dec&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:36,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e4c64a02-b4c4-4f63-a51a-3580ebd71d10&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b5b4970c-6480-47f0-9d79-471f404652d9&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a15f6fd7-e655-4dda-beda-2a943d2114b6&quot;,&quot;title&quot;:&quot;User.Create&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\create.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;removeRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ec4a3ff-017a-46f8-a7b0-0896070f7c76&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;removeRecords(function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;652b9240-abb4-4c34-a54f-2a430159b0a7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should return success output on pass of valid parameters.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return success output on pass of valid parameters.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (res.body.output.email == registrationBody.email &amp;&amp;\n                res.body.output.marketo_lead_id != \&quot;\&quot; &amp;&amp;\n                (res.body.output.authtoken || \&quot;\&quot;) != \&quot;\&quot; &amp;&amp;\n                res.body.output.flow_uid != \&quot;\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;95eaa711-fe6b-4a9f-ab72-7bfe76bac158&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode add signup.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should add promocode add signup.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naddPromcode({\n    count: 1,\n    promo_code: \&quot;PROMO_CODE\&quot;,\n    domain: \&quot;gmail.com\&quot;,\n    redemption_count: 1,\n    redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n    redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n    allowed_plans: [],\n    default_plan: null,\n    addon_credits: 5,\n    addon_flows: 2,\n    addon_triggers: 2,\n    addon_trial_days: 10,\n    braintree_discount_id: \&quot;\&quot;,\n    promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n}, function(error, promoCodes) {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    var tempRegistrationBody = getImmutable(registrationBody);\n    tempRegistrationBody.promo_code = promoCodes[0].promo_code;\n    api.post(apiURL)\n        .send(tempRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.subscription.days.should.equal(40);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b32d7d9-fa65-4323-b4c9-5b10b6ad5520&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should add promocode fatures with default plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should add promocode fatures with default plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.Plan.findOne({ \&quot;uid\&quot;: \&quot;fl6f0c5a598b56e5e4e3fbf5\&quot; }, function(error, plan) {\n    var plan_id = null;\n    if (plan) {\n        plan_id = plan._id;\n    }\n    addPromcode({\n        count: 1,\n        promo_code: \&quot;PROMO_CODE\&quot;,\n        domain: \&quot;gmail.com\&quot;,\n        redemption_count: 1,\n        redemption_start: moment(new Date()).subtract(1, &#x27;days&#x27;),\n        redemption_end: moment(new Date()).add(1, &#x27;days&#x27;),\n        allowed_plans: [],\n        default_plan: plan_id,\n        addon_credits: 5,\n        addon_flows: 2,\n        addon_triggers: 2,\n        addon_trial_days: 10,\n        braintree_discount_id: \&quot;\&quot;,\n        promo_features_expiration: moment(new Date()).add(10, &#x27;days&#x27;)\n    }, function(error, promoCodes) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        var tempRegistrationBody = getImmutable(registrationBody);\n        tempRegistrationBody.promo_code = promoCodes[0].promo_code;\n        api.post(apiURL)\n            .send(tempRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var userNewFeatures = {};\n                    userNewFeatures.flow_count = res.body.output.user_plan.flow.count;\n                    userNewFeatures.flow_active = res.body.output.user_plan.flow.active;\n                    userNewFeatures.trigger_count = res.body.output.user_plan.trigger.count;\n                    userNewFeatures.days = (res.body.output.user_plan.reimburse || {}).period || 0;\n                    userNewFeatures.credits = (res.body.output.user_plan.reimburse || {}).credits || 0;\n                    (userNewFeatures.credits == 10005 &amp;&amp; userNewFeatures.days == 30 &amp;&amp;\n                        userNewFeatures.trigger_count == 12).should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a68626d-6537-4a6d-921b-e1c38c2d7cd2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return success output for intercom error output.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return success output for intercom error output.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar service = \&quot;enterprise\&quot;;\nvar options = {\n};\ncommonMock.brainTreeCustomerCreate(httpmock, service, {\n    email: options.email,\n    access_token: options.access_token\n});\ncommonMock.brainTreeClientToken(httpmock, service, {\n    email: options.email,\n    access_token: options.access_token\n});\ncommonMock.brainTreeGenerateAuthToken(httpmock, service, {\n    email: options.email,\n    access_token: options.access_token\n});\ncommonMock.intercomUserError(httpmock, service, {\n    email: options.email,\n    access_token: options.access_token,\n    times: 2\n});\ncommonMock.marketoGetToken(httpmock, service, {});\ncommonMock.marketoCreateLead(httpmock, service, {});\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.email.should.equal(registrationBody.email);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f83c29b-8d1a-4cfe-b15a-574293208a3b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return success output if same user with blank user_type exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return success output if same user with blank user_type exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:174,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOneAndUpdate({\n                uid: res.body.output.uid\n            }, {\n                user_type: null\n            }, { new: true }, function(error, user) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send(registrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.email.should.equal(registrationBody.email);\n                            done();\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb0a797f-0000-4485-80e9-1d187fb66e2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to create enterprise account, if express account exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should not allowed to create enterprise account, if express account exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2382,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;);\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.EXPRESS_ACCOUNT_ALREADY_EXISTS);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87378f18-526e-44ae-bcca-cbadac4b7005&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to create enterprise account, if other partner account exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should allowed to create enterprise account, if other partner account exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3390,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;);\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOneAndUpdate({\n                uid: res.body.output.uid\n            }, {\n                user_type: \&quot;box\&quot;\n            }, {\n                new: true\n            }, function(error, result) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(registrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.email.should.equal(registrationBody.email);\n                            done();\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66ca1d90-2797-4154-8c32-1fa624d2f365&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give user already exists error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should give user already exists error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2345,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempLoginBody = {\n                email: tempRegistrationBody.email,\n                password: tempRegistrationBody.password,\n            };\n            commonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n                email: tempRegistrationBody.email\n            });\n            commonMock.flowLogin(httpmock, \&quot;express\&quot;, {\n                email: tempRegistrationBody.email\n            });\n            api.post(\&quot;/express/v1/login\&quot;)\n                .send(tempLoginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        api.post(\&quot;/enterprise/v1/signup\&quot;)\n                            .send(tempRegistrationBody)\n                            .expect(httpStatus.BAD_REQUEST)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.USER_ALREADY_EXISTS);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0da8fd8-69f3-41c2-b483-0c16963992f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to create user for invalid password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should not allowed to create user for invalid password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.password = \&quot;built@12\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;built@12\&quot;;\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.password.message ==\n                messageList.USER_REG_INVALID_PASSWORD;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;61391061-214d-4b3c-b848-a0658d2ba99b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get default plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                    //return (plan || {}).express_plan || false;\n                    return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                })) || {};\n                defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d5a37485-36ce-48ca-91eb-bb4a092b0809&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get default attributes.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                isValid = utils.isHaveKeyVals(res.body.output, [\n                        \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                        \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                    ]) &amp;&amp;\n                    res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                    moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                    moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4176dfee-10f9-4a55-9204-4286364345b2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give check valid country name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should give check valid country name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar tmpRegBody = getImmutable(registrationBody);\ntmpRegBody.country = \&quot;ABC_XYZ\&quot;;\napi.post(apiURL)\n    .send(tmpRegBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;faed3e49-a1c3-4d13-a110-6bdd8ae44c30&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get plan provided trial days.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get plan provided trial days.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncreatePlan(0, function(trialPeriodPlan) {\n    var tmpRegBody = getImmutable(registrationBody);\n    tmpRegBody.plan = trialPeriodPlan.name;\n    api.post(apiURL)\n        .send(tmpRegBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = false;\n                if (res.body.output.plan.length == 1) {\n                    isValid = utils.isHaveKeyVals(res.body.output, [\n                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                        ]) &amp;&amp;\n                        res.body.output.subscription.days == 180 &amp;&amp;\n                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                }\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36acf5ec-c2f8-4929-992c-7cb9173811ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get enterprise default trial days.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get enterprise default trial days.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncreatePlan(1, function(trialPeriodPlan) {\n    var tmpRegBody = getImmutable(registrationBody);\n    tmpRegBody.plan = trialPeriodPlan.name;\n    api.post(apiURL)\n        .send(tmpRegBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = false;\n                if (res.body.output.plan.length == 1) {\n                    isValid = utils.isHaveKeyVals(res.body.output, [\n                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                        ]) &amp;&amp;\n                        res.body.output.subscription.days ==\n                        config.service_types.enterprise.default_trial_days &amp;&amp;\n                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                }\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;528250f7-e876-4112-b139-6d4e3e2cb2ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get plan provided trial days for days as false.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get plan provided trial days for days as false.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncreatePlan(2, function(trialPeriodPlan) {\n    var tmpRegBody = getImmutable(registrationBody);\n    tmpRegBody.plan = trialPeriodPlan.name;\n    api.post(apiURL)\n        .send(tmpRegBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = false;\n                if (res.body.output.plan.length == 1) {\n                    isValid = utils.isHaveKeyVals(res.body.output, [\n                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                        ]) &amp;&amp;\n                        res.body.output.subscription.days == 90 &amp;&amp;\n                        typeof(res.body.output.subscription.start_date) == \&quot;undefined\&quot;;\n                }\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25e45315-edc9-4aef-82e6-9a4f848bbe7c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get zero trial days for days as false.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should get zero trial days for days as false.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncreatePlan(3, function(trialPeriodPlan) {\n    var tmpRegBody = getImmutable(registrationBody);\n    tmpRegBody.plan = trialPeriodPlan.name;\n    api.post(apiURL)\n        .send(tmpRegBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = false;\n                if (res.body.output.plan.length == 1) {\n                    isValid = utils.isHaveKeyVals(res.body.output, [\n                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                        ]) &amp;&amp;\n                        res.body.output.subscription.days == 0 &amp;&amp;\n                        typeof(res.body.output.subscription.start_date) == \&quot;undefined\&quot;;\n                }\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8b7d02e-82b6-4a1f-b8a0-18491504b487&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not copy authtoken from request header.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should not copy authtoken from request header.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, \&quot;TEST_TEST\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.email = registrationBody.email;\n            if (isValid) {\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, \&quot;TEST_TEST\&quot;)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3ee285e-e2b8-4c0f-bd86-323aa9c0d981&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create braintree user on successfull registration of user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should create braintree user on successfull registration of user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.email.should.equal(registrationBody.email);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14b1a9f1-efd0-43f9-8485-ccc610bc0d9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for invalid email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for invalid email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;ambermore\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.email.message ==\n                messageList.USER_REG_EMAIL_NOT_VALID;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dc726793-60ec-4898-bf7f-ee12891b61b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for empty first_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for empty first_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.first_name;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.first_name.message ==\n                messageList.USER_REG_FIRST_NAME_EMPTY;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b2ee870d-355f-4577-bf12-629653e9e02f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for empty last_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for empty last_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.last_name;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.last_name.message ==\n                messageList.USER_REG_LAST_NAME_EMPTY;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff3d5d48-7efc-49d7-a7d8-062ceeeacd8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not accepting terms.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for not accepting terms.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.terms;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.terms.message ==\n                messageList.USER_REG_TERMS_NOT_ACCEPTED;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6fdfeaa1-fd1b-47e9-bf1a-d28929c26a2d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not providing invalid terms.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for not providing invalid terms.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.terms = \&quot;true123\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.terms.message ==\n                messageList.USER_REG_TERMS_NOT_ACCEPTED;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b02a3a8-c34b-448c-9ca7-a244ee47c947&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not passing password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for not passing password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.password;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.password.message ==\n                messageList.USER_REG_INVALID_PASSWORD;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f02a139b-3611-4491-8057-40e0abc2c85a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not passing valid password accordingly to criteria.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for not passing valid password accordingly to criteria.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.password = \&quot;raw\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.password.message ==\n                messageList.USER_REG_INVALID_PASSWORD;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba7ebe6e-4db0-470b-a4af-f960abf60ced&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not passing confirm password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for not passing confirm password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.password_confirmation;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.password_confirmation.message ==\n                messageList.USER_REG_MATCHED_CONFIRM_PASSWORD;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fdc04210-bdc0-4a5e-8f01-a13060bbb1fa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for passing different confirm password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error for passing different confirm password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.password_confirmation = \&quot;a\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValidError = res.body.error.password_confirmation.message ==\n                messageList.USER_REG_MATCHED_CONFIRM_PASSWORD;\n            isValidError.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b99a5245-4303-4806-9c65-3fca3ee7b306&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Register user should be enterprise user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Register user should be enterprise user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.user_type.should.equal(config.service_types.enterprise.name);\n            expect(res.body.output.prod_env).is.not.null\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dca42fe0-ffe0-49be-82d3-280030b46d0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set braintree_customerId.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should set braintree_customerId.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.braintree_customerId.should.not.empty;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4cf14450-d565-46b0-8b96-62600bb2c832&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set merchantid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should set merchantid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.merchantid.should.not.empty;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83e1b2ae-d1ed-4cf4-a07d-cb8308ed2908&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed user to register with same email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should not allowed user to register with same email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(registrationBody)\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.USER_ALREADY_EXISTS);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c2353458-7e8c-43d0-aada-01f91e3cd8e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update profile fields properly.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should update profile fields properly.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar jobTitle = \&quot;Tech Architect\&quot;;\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.job_title = jobTitle;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.job_title.should.equal(jobTitle);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;962350e7-251b-4a65-b85b-a16083f9be88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return success on valid plan selected.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return success on valid plan selected.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar jobTitle = \&quot;Tech Architect\&quot;;\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.plan = \&quot;ciscosparkvip2017\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var plan = res.body.output.plan[0] || {};\n            var isValid = (plan.name == tempRegistrationBody.plan ||\n                    plan.braintree_plan == tempRegistrationBody.plan) &amp;&amp;\n                plan.plan_type == \&quot;enterprise\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f480974c-f177-4203-bc17-2ff50eed3a4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error on invalid plan selection.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should return error on invalid plan selection.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar jobTitle = \&quot;Tech Architect\&quot;;\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.plan = \&quot;ABC Plan\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.INVALID_PLAN_SELECTED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7dc36bc8-d80c-4a89-be98-fe5c9cfb9b85&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set default plan, if plan is not provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should set default plan, if plan is not provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var plan = res.body.output.plan[0] || {};\n            var isValid = plan.name == server.plan.enterprise.name &amp;&amp;\n                plan.braintree_plan == server.plan.enterprise.braintree_plan;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80478039-0b8e-484b-8fc8-91512706d9f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should send welcome email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Create Should send welcome email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n///global.isTestSuit = false;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar expectedEmail = {\n    \&quot;to\&quot;: \&quot;test.user@raweng.com\&quot;,\n    \&quot;from\&quot;: \&quot;Built.io Flow Enterprise Support &lt;noreply-flowdev@raweng.com&gt;\&quot;,\n    \&quot;title\&quot;: \&quot;No Title\&quot;,\n    \&quot;subject\&quot;: \&quot;Activate Your Account\&quot;,\n    \&quot;html\&quot;: \&quot;\&quot;\n};\nmockMailer.expectEmail(5, function(sentEmail) {\n    return expectedEmail.to == sentEmail.to &amp;&amp;\n        expectedEmail.from == sentEmail.from &amp;&amp;\n        expectedEmail.title == sentEmail.title &amp;&amp;\n        expectedEmail.subject == sentEmail.subject;\n}, done);\napi.post(apiURL)\n    .send(registrationBody)\n    .end(function(err, res) {\n        done();\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7b75ce0d-9dcf-4084-961a-2a474980538f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;95eaa711-fe6b-4a9f-ab72-7bfe76bac158&quot;,&quot;8b32d7d9-fa65-4323-b4c9-5b10b6ad5520&quot;,&quot;2a68626d-6537-4a6d-921b-e1c38c2d7cd2&quot;,&quot;0f83c29b-8d1a-4cfe-b15a-574293208a3b&quot;,&quot;cb0a797f-0000-4485-80e9-1d187fb66e2c&quot;,&quot;87378f18-526e-44ae-bcca-cbadac4b7005&quot;,&quot;66ca1d90-2797-4154-8c32-1fa624d2f365&quot;,&quot;f0da8fd8-69f3-41c2-b483-0c16963992f4&quot;,&quot;61391061-214d-4b3c-b848-a0658d2ba99b&quot;,&quot;d5a37485-36ce-48ca-91eb-bb4a092b0809&quot;,&quot;4176dfee-10f9-4a55-9204-4286364345b2&quot;,&quot;faed3e49-a1c3-4d13-a110-6bdd8ae44c30&quot;,&quot;36acf5ec-c2f8-4929-992c-7cb9173811ee&quot;,&quot;528250f7-e876-4112-b139-6d4e3e2cb2ce&quot;,&quot;25e45315-edc9-4aef-82e6-9a4f848bbe7c&quot;,&quot;d8b7d02e-82b6-4a1f-b8a0-18491504b487&quot;,&quot;f3ee285e-e2b8-4c0f-bd86-323aa9c0d981&quot;,&quot;14b1a9f1-efd0-43f9-8485-ccc610bc0d9b&quot;,&quot;dc726793-60ec-4898-bf7f-ee12891b61b5&quot;,&quot;b2ee870d-355f-4577-bf12-629653e9e02f&quot;,&quot;ff3d5d48-7efc-49d7-a7d8-062ceeeacd8f&quot;,&quot;6fdfeaa1-fd1b-47e9-bf1a-d28929c26a2d&quot;,&quot;0b02a3a8-c34b-448c-9ca7-a244ee47c947&quot;,&quot;f02a139b-3611-4491-8057-40e0abc2c85a&quot;,&quot;ba7ebe6e-4db0-470b-a4af-f960abf60ced&quot;,&quot;fdc04210-bdc0-4a5e-8f01-a13060bbb1fa&quot;,&quot;b99a5245-4303-4806-9c65-3fca3ee7b306&quot;,&quot;dca42fe0-ffe0-49be-82d3-280030b46d0c&quot;,&quot;4cf14450-d565-46b0-8b96-62600bb2c832&quot;,&quot;83e1b2ae-d1ed-4cf4-a07d-cb8308ed2908&quot;,&quot;c2353458-7e8c-43d0-aada-01f91e3cd8e0&quot;,&quot;962350e7-251b-4a65-b85b-a16083f9be88&quot;,&quot;f480974c-f177-4203-bc17-2ff50eed3a4f&quot;,&quot;7dc36bc8-d80c-4a89-be98-fe5c9cfb9b85&quot;,&quot;80478039-0b8e-484b-8fc8-91512706d9f1&quot;,&quot;7b75ce0d-9dcf-4084-961a-2a474980538f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10153,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1911b72e-13bb-47c2-8b03-a9cfcb129f73&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2993b393-45c4-49e0-b791-858e8a19d2b0&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;157fffb0-756e-405f-9703-9d604c7ce42c&quot;,&quot;title&quot;:&quot;User.creditOverLimitMail&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\creditOverLimitMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.creditOverLimitMail \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nclearRecords(function() {\n    _models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(registrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            authToken = res.body.output.authtoken;\n                            _id = res.body.output._id;\n                            uid = res.body.output.uid;\n                            apiURL = apiURL.replace(\&quot;:uid\&quot;, uid);\n                            done();\n                        }\n                    });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;423cd428-03de-4077-b865-4a2b0011d994&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.creditOverLimitMail \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;056c8e38-9e93-4244-9133-e12a0b9851a3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should process credit over limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.creditOverLimitMail Should process credit over limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        user_uid: uid,\n        percent_used: 90\n    })\n    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.message == \&quot;done\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e399b111-3c6c-4e46-8b23-22eb244361c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should process credit over limit for organizations.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.creditOverLimitMail Should process credit over limit for organizations.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:589,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncreateOrgPlans(function() {\n    createOrg({\n        done: done\n    }, function(org) {\n        var email = \&quot;test.user+1@raweng.com\&quot;;\n        fetchRoles({\n            done: done,\n            org_uid: org.uid\n        }, function(res) {\n            inviteUsers({\n                roles: res.body.output.objects,\n                user_uid: \&quot;\&quot;,\n                org_uid: org.uid\n            }, function() {\n                api.post(apiURL)\n                    .send({\n                        user_uid: org.org_account.uid,\n                        percent_used: 90\n                    })\n                    .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            var isValid = res.body.message == \&quot;done\&quot;;\n                            isValid.should.equal(true);\n                            done();\n                        }\n                    });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;176b8d59-6b46-4dcf-80f1-4666797b2ae3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should skip credit over limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.creditOverLimitMail Should skip credit over limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({\n        \&quot;uid\&quot;: uid\n    }, {\n        credit_limit_email: true\n    },\n    function(err, updatedUser) {\n        api.post(apiURL)\n            .send({\n                user_uid: uid,\n                percent_used: 90\n            })\n            .set(\&quot;ui_admin_key\&quot;, config.UI_ADMIN_KEY)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var isValid = res.body.message == \&quot;skipped\&quot;;\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c950297-1c06-44c3-b0a1-a798760896de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e399b111-3c6c-4e46-8b23-22eb244361c4&quot;,&quot;176b8d59-6b46-4dcf-80f1-4666797b2ae3&quot;,&quot;4c950297-1c06-44c3-b0a1-a798760896de&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:607,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4904faa9-4e99-41fc-a669-1911fe4ad806&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8ced368d-5301-487b-8e04-ae3fe3c7a9c5&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e3936b3e-18eb-4535-8cc1-ab76ec78212b&quot;,&quot;title&quot;:&quot;User.disableTwoFA&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\disableTwoFA.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ deleted_at: null }, function(error, user) {\n    _models.Mail.remove({ deleted_at: null }, function(error, user) {\n        _models.Authy.remove({ deleted_at: null }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9fce9a4b-d8ae-4e73-a7e1-55d69c695ea8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dabcd45c-cb5b-4509-85aa-8b89edb8711d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should disable twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should disable twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:74,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid =\n                                                        res.body.output.enable_twofa == \&quot;disable\&quot; &amp;&amp;\n                                                        res.body.output.authy_user_uid == \&quot;\&quot; &amp;&amp;\n                                                        res.body.output.is_twofa_sms_enabled == false;\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27afa4bc-5fc4-4f1e-9ea9-625f4d39371d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for disable twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should get default plan for disable twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = false;\n                                                    if (res.body.output.plan.length == 1) {\n                                                        var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                            //return (plan || {}).enterprise_plan || false;\n                                                            return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                        })) || {};\n                                                        defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                        isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;90dc6cb7-eb8d-49e7-83bf-a7e6327553ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for disable twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should get default attributes for disable twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var enable_twofa = res.body.output.enable_twofa;\n                                    if (enable_twofa == \&quot;verified\&quot;) {\n                                        api.post(apiURL)\n                                            .send({})\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = false;\n                                                    if (res.body.output.plan.length == 1) {\n                                                        isValid = utils.isHaveKeyVals(res.body.output, [\n                                                                \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                                \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                            ]) &amp;&amp;\n                                                            res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                            moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                            moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    } else {\n                                        true.should.equal(false);\n                                    }\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11c3dcd7-ce53-419a-8d77-db5b60eaaf16&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should disable twofa for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should disable twofa for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:111,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid =\n                                                                    res.body.output.enable_twofa == \&quot;disable\&quot; &amp;&amp;\n                                                                    res.body.output.authy_user_uid == \&quot;\&quot; &amp;&amp;\n                                                                    res.body.output.is_twofa_sms_enabled == false;\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2614d64b-e7b4-4b0b-ad7f-415cd84a3917&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should get default plan for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:202,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid = false;\n                                                                if (res.body.output.plan.length == 1) {\n                                                                    var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                                        //return (plan || {}).enterprise_plan || false;\n                                                                        return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                                    })) || {};\n                                                                    defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                                    isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                                }\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dedd2c2f-79c6-4adc-8e7d-8086d82ab6f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should get default attributes for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:116,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/login/google\&quot;)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            authToken = res.body.output.authtoken;\n            _id = res.body.output._id;\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var authy_userId = res.body.output.authy_user_uid;\n                        commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                            .send({\n                                authy_id: authy_userId\n                            })\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token,\n                                            option_selected: \&quot;otp\&quot;\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var enable_twofa = res.body.output.enable_twofa;\n                                                if (enable_twofa == \&quot;verified\&quot;) {\n                                                    api.post(apiURL)\n                                                        .send({})\n                                                        .set(&#x27;authtoken&#x27;, authToken)\n                                                        .expect(httpStatus.OK)\n                                                        .end(function(err, res) {\n                                                            if (err) {\n                                                                done(err);\n                                                            } else {\n                                                                var isValid = false;\n                                                                if (res.body.output.plan.length == 1) {\n                                                                    isValid = utils.isHaveKeyVals(res.body.output, [\n                                                                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                                        ]) &amp;&amp;\n                                                                        res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                                }\n                                                                isValid.should.equal(true);\n                                                                done();\n                                                            }\n                                                        });\n                                                } else {\n                                                    true.should.equal(false);\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ccb6ceaa-ec60-4942-adac-3369d66e8801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.disableTwoFA Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72b21138-07ae-4b54-9535-9e828b0ba708&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;27afa4bc-5fc4-4f1e-9ea9-625f4d39371d&quot;,&quot;90dc6cb7-eb8d-49e7-83bf-a7e6327553ad&quot;,&quot;11c3dcd7-ce53-419a-8d77-db5b60eaaf16&quot;,&quot;2614d64b-e7b4-4b0b-ad7f-415cd84a3917&quot;,&quot;dedd2c2f-79c6-4adc-8e7d-8086d82ab6f2&quot;,&quot;ccb6ceaa-ec60-4942-adac-3369d66e8801&quot;,&quot;72b21138-07ae-4b54-9535-9e828b0ba708&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:661,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9c8a7695-ccee-46d8-a676-e4894fe6bb83&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1c28f49c-03ac-4780-9c9f-1926deececce&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ec0e3386-5c0d-4aa6-ad37-d5ef253cb2e7&quot;,&quot;title&quot;:&quot;User.forceSuspendUser&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forceSuspendUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forceSuspendUser \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    token = res.body.output.activation_token;\n                    _id = res.body.output._id;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef22d9b6-9b53-4d82-bece-1b8e46f083a8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forceSuspendUser \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eacdad40-0283-4762-a1b1-a192518f5fec&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should suspend user account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forceSuspendUser Should suspend user account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({})\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.force_suspend.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cac5853d-f10a-4310-a8f3-4c1c1982389c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forceSuspendUser Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;59e6b0f9-ce0f-4425-b39f-92f2c6622447&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cac5853d-f10a-4310-a8f3-4c1c1982389c&quot;,&quot;59e6b0f9-ce0f-4425-b39f-92f2c6622447&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dd2c4056-4802-429f-b453-bce74fd5e3cf&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;050158e5-f2ce-4af4-a534-da24f6e2c757&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;06d87e79-af12-49e1-844b-ba5e0e911cfd&quot;,&quot;title&quot;:&quot;User.forgotPassword&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\forgotPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    activationToken = res.body.output.activation_token;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23d59418-edd7-42e9-a1aa-33105863f246&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48b3ec7f-7b80-4003-9fde-d6ff5144ffa3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should send forgot password email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should send forgot password email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/activate\&quot;)\n    .send({\n        user_uid: uid,\n        token: activationToken\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send({\n                    email: registrationBody.email,\n                    captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.message.should.equal(messageList.USER_FP_USER_SENT_MAIL);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5502ae7b-ec39-4b29-8af6-7cd499115044&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error for account activation.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should give error for account activation.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        email: registrationBody.email,\n        captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_FP_ACTIVATE_YOUR_ACCOUNT);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5544fc75-048d-4799-8ae7-96d452c7b064&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as email not register.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should give error as email not register.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        email: \&quot;test.user.example.unit.test@example.com\&quot;,\n        captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_FP_USER_NOT_REGISTER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4b12dfa4-ba81-4f66-845e-a9643cac8db8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to raised forgot password request, when user is locked.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should allowed to raised forgot password request, when user is locked.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n    failed_login_count: 7\n}, { new: true }, function(err, user) {\n    api.post(\&quot;/enterprise/v1/user/activate\&quot;)\n        .send({\n            user_uid: uid,\n            token: activationToken\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send({\n                        email: registrationBody.email,\n                        captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.message.should.equal(messageList.USER_FP_USER_SENT_MAIL);\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c4da2010-3e75-4b86-b5e6-6c4059dc3221&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to raised forgot password request, for 5 times invalid login attempt user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should allowed to raised forgot password request, for 5 times invalid login attempt user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:411,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\nvar loginCount = [];\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                loginCount.push(res.body.error.failed_login_count);\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                            loginCount.push(res.body.error.failed_login_count);\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                        loginCount.push(res.body.error.failed_login_count);\n                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                    loginCount.push(res.body.error.failed_login_count);\n                                                api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                                loginCount.push(res.body.error.failed_login_count);\n                                                            var isValid =\n                                                                loginCount[0] == 1 &amp;&amp;\n                                                                loginCount[1] == 2 &amp;&amp;\n                                                                loginCount[2] == 3 &amp;&amp;\n                                                                loginCount[3] == 4 &amp;&amp;\n                                                                loginCount[4] == 5;\n                                                            if (isValid) {\n                                                                _models.User.findOneAndUpdate({ uid: uid }, {\n                                                                        active: true\n                                                                    },\n                                                                    function(error, user) {\n                                                                        commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                                                        api.post(apiURL)\n                                                                            .send({\n                                                                                email: registrationBody.email,\n                                                                                captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n                                                                            })\n                                                                            .expect(httpStatus.OK)\n                                                                            .end(function(err, res) {\n                                                                                if (err) {\n                                                                                    done(err);\n                                                                                } else {\n                                                                                    res.body.output.message.should.equal(messageList.USER_FP_USER_SENT_MAIL);\n                                                                                    done();\n                                                                                }\n                                                                            });\n                                                                    });\n                                                            } else {\n                                                                false.should.equal(true);\n                                                            }\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0d8a5394-1a5f-49a7-ae65-1e5eb8f379dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give captcha verification fail error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.forgotPassword Should give captcha verification fail error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        email: \&quot;test.user.example.unit.test@example.com\&quot;,\n        captcha_code: \&quot;\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CAPTCHA_VERIFICATION_FAIL);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8cc70957-4dbf-4df6-bd0e-ba3f5f92a58c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5502ae7b-ec39-4b29-8af6-7cd499115044&quot;,&quot;5544fc75-048d-4799-8ae7-96d452c7b064&quot;,&quot;4b12dfa4-ba81-4f66-845e-a9643cac8db8&quot;,&quot;c4da2010-3e75-4b86-b5e6-6c4059dc3221&quot;,&quot;0d8a5394-1a5f-49a7-ae65-1e5eb8f379dd&quot;,&quot;8cc70957-4dbf-4df6-bd0e-ba3f5f92a58c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:447,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d1aa95af-3278-434b-b119-675fdef7c07e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;771b3e33-8072-4f26-9127-42a71034e3fe&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;227468a2-a8fb-489d-af65-3cb5537c0b31&quot;,&quot;title&quot;:&quot;User.generateSupportKey&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\generateSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    token = res.body.output.activation_token;\n                    _id = res.body.output._id;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10d436f4-842e-4a3d-8c0d-241f0e6cc963&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aa95df5d-2e88-4b44-ba92-e4ae5bd883da&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should generate support key.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey Should generate support key.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncheckSupportKey(done, function(isValid) {\n    isValid.should.equal(true);\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;53424af1-04c1-4e86-96f7-0285b2852e58&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should generate support key for second time.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey Should generate support key for second time.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:217,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncheckSupportKey(done, function(isValid) {\n    var firstTime = isValid;\n    api.post(\&quot;/enterprise/v1/login\&quot;)\n        .send({\n            email: registrationBody.email,\n            password: registrationBody.password\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                checkSupportKey(done, function(isValid) {\n                    var secondTime = isValid;\n                    (firstTime &amp;&amp; secondTime).should.equal(true);\n                    done();\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64826325-b771-46af-a9ed-60df8f2f0b2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should generate support key for third time.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey Should generate support key for third time.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:372,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncheckSupportKey(done, function(isValid) {\n    var firstTime = isValid;\n    api.post(\&quot;/enterprise/v1/login\&quot;)\n        .send({\n            email: registrationBody.email,\n            password: registrationBody.password\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                checkSupportKey(done, function(isValid) {\n                    var secondTime = isValid;\n                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                        .send({\n                            email: registrationBody.email,\n                            password: registrationBody.password\n                        })\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                authToken = res.body.output.authtoken;\n                                checkSupportKey(done, function(isValid) {\n                                    var thirdTime = isValid;\n                                    (firstTime &amp;&amp; secondTime &amp;&amp; thirdTime).should.equal(true);\n                                    done();\n                                });\n                            }\n                        });\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;93e2b835-39e5-48ad-8834-821f079d58d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should person should not be generating suport key.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey Should person should not be generating suport key.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncheckSupportKey(done, function(isValid, user) {\n    api.post(apiURL)\n        .set(&#x27;authtoken&#x27;, user.authtoken)\n        .send({})\n        .expect(httpStatus.BAD_REQUEST)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.SUPPORT_PERSON_SUPPORT_KEY_GENERATION_ERROR);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;567a3c05-ba4e-46ca-b967-a7a4b2f39c28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.generateSupportKey Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2a62ac2-ca3e-4070-853b-3034882e1ce6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;53424af1-04c1-4e86-96f7-0285b2852e58&quot;,&quot;64826325-b771-46af-a9ed-60df8f2f0b2c&quot;,&quot;93e2b835-39e5-48ad-8834-821f079d58d5&quot;,&quot;567a3c05-ba4e-46ca-b967-a7a4b2f39c28&quot;,&quot;a2a62ac2-ca3e-4070-853b-3034882e1ce6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:743,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7ec29932-a2b0-4e8e-b9fc-cae1a54d52d7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;308bdab9-a81c-4bcc-aa5c-e6635c3ba1aa&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;34281b0c-83f3-4c82-bf6d-9251c7a574bc&quot;,&quot;title&quot;:&quot;User.getAutoRefresh&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAutoRefresh \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        token = res.body.output.activation_token;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0266a72-b1cf-4ecc-a15a-e924cfbe732f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAutoRefresh \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;67b363d3-6ee8-4cd4-a7ec-bce1526ed334&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get auto_refresh to true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAutoRefresh Should get auto_refresh to true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(\&quot;/enterprise/v1/user/autorefresh\&quot;)\n    .send({\n        auto_refresh: true\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(\&quot;/enterprise/v1/user/autorefresh\&quot;)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.auto_refresh.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3eb254d5-d2d8-4a7e-8f5e-ba41c858d79d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should gives error as valid parameters required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAutoRefresh Should gives error as valid parameters required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(\&quot;/enterprise/v1/user/autorefresh\&quot;)\n    .send({\n        auto_refresh: \&quot;true1\&quot;\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00e4e026-f63d-421e-84b4-ab1d861f0b50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAutoRefresh Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(\&quot;/enterprise/v1/user/autorefresh\&quot;)\n    .send({\n        auto_refresh: true\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73208f18-9990-419e-a578-d17463f8d6b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3eb254d5-d2d8-4a7e-8f5e-ba41c858d79d&quot;,&quot;00e4e026-f63d-421e-84b4-ab1d861f0b50&quot;,&quot;73208f18-9990-419e-a578-d17463f8d6b5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:45,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;aa7e32e5-674a-46b8-9e26-f26d5ba21c71&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;55c5ef65-f57c-4bc9-b9c0-2fdd55470e48&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2e1dbe50-33c5-4b51-91ac-099efd52591e&quot;,&quot;title&quot;:&quot;User.getAvatar&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAvatar \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    user_uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d86a63c-ba3c-40cf-88ec-c8b695aeaa03&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAvatar \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1e4d9dc3-18ad-45a3-b6be-ef347eedcf85&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get avatar.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAvatar Should get avatar.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.myCroppedImage = \&quot;https://example.com/region/fl3769c85311cc403d31ff45\&quot;;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, tempRegistrationBody.myCroppedImage);\n};\ncommonMock.avatarGetURL(httpmock, \&quot;enterprise\&quot;, {});\napi.put(\&quot;/enterprise/v1/user/avatar\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            api.get(apiURL.replace(\&quot;:user_uid\&quot;, user_uid))\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.length.should.equal(2114);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f1e61cd-6574-4b5b-bc96-6b3cff334564&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default avatar.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getAvatar Should get default avatar.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, \&quot;https://example.com/region/fl3769c85311cc403d31ff45\&quot;);\n};\ncommonMock.avatarGetURL(httpmock, \&quot;enterprise\&quot;, {});\napi.get(apiURL.replace(\&quot;:user_uid\&quot;, \&quot;default\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.length.should.equal(2114);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df4a3236-7868-4815-a380-7418f4531fce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7f1e61cd-6574-4b5b-bc96-6b3cff334564&quot;,&quot;df4a3236-7868-4815-a380-7418f4531fce&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3e75ee49-bb73-454e-933a-821903523a5f&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;74d5f174-4d1f-4700-b43c-1036e78b8ddd&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e7f12b78-f916-49d2-99d8-63ca3a0b862b&quot;,&quot;title&quot;:&quot;User.getCreditInfo&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:163,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                userPlan = res.body.output.user_plan;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f09a001-9c96-4870-b727-31ef3349084a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfo \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2aa9670c-d8c0-446c-ac77-4f5b55169513&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get credits info of authenticated user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfo Should get credits info of authenticated user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (typeof(res.body.output.available) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e5089dd-47a0-48d2-91ce-e3b3922a6bc1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfo Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d06910b2-e58b-42e6-9147-832efa1cadfd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9e5089dd-47a0-48d2-91ce-e3b3922a6bc1&quot;,&quot;d06910b2-e58b-42e6-9147-832efa1cadfd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a37d51e8-5483-41d1-9ad1-4c3dbfbc3af7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3a6940fa-d08a-45ec-ad17-41e93f82bf51&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ad52cda2-eaeb-4a63-870d-1260b8bc934e&quot;,&quot;title&quot;:&quot;User.getCreditInfoOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCreditInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfoOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        userPlan = data.owner.user_plan;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a484176-e8e3-464e-917b-cf25480e2f8c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfoOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ffd0a08b-89ea-4158-8cf6-c8999159575c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get credit info of organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfoOrg Should get credit info of organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        //console.log(err, res.body.error);\n        if (err) {\n            done(err);\n        } else {\n            (typeof(res.body.output.available) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d19a157-b869-41ba-bbb9-5639bc73d72e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCreditInfoOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37cc8021-0b29-499e-b941-7fa1f55f737b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9d19a157-b869-41ba-bbb9-5639bc73d72e&quot;,&quot;37cc8021-0b29-499e-b941-7fa1f55f737b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;fe9c4ac3-ed08-41f3-a410-37c4e7262131&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8ea74230-f803-453b-a8d8-857b1d94e250&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;27aa894e-6747-4a8d-8ef7-84b63ae1f2b3&quot;,&quot;title&quot;:&quot;User.getCurrentUser&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getCurrentUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        _models.Sessions.remove({}, function(error, user) {\n            _models.User.remove({}, function(error, user) {\n                _models.UserToken.remove({}, function(error, user) {\n                    _models.Mail.remove({}, function(error, user) {\n                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/signup\&quot;)\n                            .send(registrationBody)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                authToken = res.body.output.authtoken;\n                                cbk(err, res)\n                            });\n                    });\n                });\n            });\n        });\n    }\n], function(err, result) {\n    if (err) {\n        done(err);\n    } else {\n        done();\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80fe9b17-9361-41fa-99e1-b9752d39e47c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;59be4f73-e0be-4d32-a76d-bfd7c0ddbbb6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e39348f-3c75-4869-830c-4d5f4494685e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should unauthenticate session after 4 hours.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser Should unauthenticate session after 4 hours.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var date = moment(new Date());\n            date.subtract({ hours: 4, minutes: 5 });\n            _models.UserToken.findOneAndUpdate({\n                authtoken: authToken\n            }, {\n                idle_valid_till: date\n            }, {\n                new: true\n            }, function(error, user) {\n                api.get(apiURL)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n                            done();\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7718d6a7-ab9c-4aca-9677-e7c981a8ec09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get current user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser Should get current user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;edb447df-ea28-417d-b03e-81e77f5e049a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getCurrentUser Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5fb3984b-722c-475c-8bfe-a4dae2b0257e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7718d6a7-ab9c-4aca-9677-e7c981a8ec09&quot;,&quot;edb447df-ea28-417d-b03e-81e77f5e049a&quot;,&quot;5fb3984b-722c-475c-8bfe-a4dae2b0257e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:41,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d25f7de0-f596-4a68-88fb-8773d6672ca0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3349d724-1be4-47f0-ba78-376a26f4cba0&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cbaabc6e-e06c-45b7-a9f1-e13d58a29c04&quot;,&quot;title&quot;:&quot;User.getUserStreamDistinctFlowNamesOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getDistinctNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:564,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                env_uid = res.body.output.env_uid;\n                saveBillEntries({\n                    user_uid: user_uid,\n                    authtoken: authToken,\n                    email: data.owner.email\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        saveUserStreamEntries({\n                            user_uid: user_uid,\n                            authtoken: authToken,\n                            email: data.owner.email\n                        }, function(error, userStreamEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _userStreamEntries = userStreamEntries;\n                                done();\n                            }\n                        });\n                    }\n                });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d1bf3c4b-ceef-409c-a746-e2ee4b1d4de5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10ed4fb9-1aca-4083-a49b-3f1255c8c994&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get distinct list of flow names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of flow names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;workflows\&quot;))\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;091c3bd4-b407-4bc7-b0b1-ada06ca1451e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of flow based on projects.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of flow based on projects.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar userStreamURL = apiURL.replace(\&quot;{type}\&quot;, \&quot;workflows\&quot;) + \&quot;&amp;project_uid=\&quot; + project_uids[0] + \&quot;,\&quot; + project_uids[1];\napi.get(userStreamURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca2eebca-415b-4dfb-8447-c9045ce67a00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of projects names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of projects names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;projects\&quot;))\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;af088a09-47b3-4e3e-bc31-f6f6759d21cc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6fadb245-d216-4f3a-932d-1723ac8d0b92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;091c3bd4-b407-4bc7-b0b1-ada06ca1451e&quot;,&quot;ca2eebca-415b-4dfb-8447-c9045ce67a00&quot;,&quot;af088a09-47b3-4e3e-bc31-f6f6759d21cc&quot;,&quot;6fadb245-d216-4f3a-932d-1723ac8d0b92&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:52,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2ceb28fc-7bef-43c7-98f7-7561b5d2e3fd&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8a1b4988-1dfb-4e88-aa05-38ca41336e8d&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c1a1993f-019e-4733-aa84-f8f774e4ee9b&quot;,&quot;title&quot;:&quot;User.getPlanUsesCheck&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheck.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheck \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1644,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    async.waterfall([\n        function(cbk) {\n            _models.User.remove({}, function(error, user) {\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(testData.testRegistrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        authToken = res.body.output.authtoken;\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                env_uid = res.body.output.env_uid;\n                                user_uid = res.body.output.uid;\n                                cbk(err, res);\n                            });\n                    });\n            });\n        },\n        function(res, cbk) {\n            saveBillEntries({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserTriggers({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, bills) {\n                    savedBills = bills;\n                    cbk(null, savedBills);\n                });\n        },\n        function(res, cbk) {\n            saveUserFlows({\n                    done: done,\n                    authtoken: authToken\n                },\n                function(error, userFlows) {\n                    cbk(null, userFlows);\n                });\n        }\n    ], function(err, results) {\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44d44aab-da40-4019-a78f-891c3d1e53b0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheck \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05ce6d19-1447-4e73-9d98-8263e7bae003&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheck \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e7b14b7-debc-44ab-87ac-dbe609e5daae&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get plan uses stats.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheck Should get plan uses stats.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = isNaN(parseInt(res.body.output.trigger_count)) == false &amp;&amp;\n                isNaN(parseInt(res.body.output.flow_count)) == false &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;989ace33-7815-460e-9214-b6513fd9ad3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;989ace33-7815-460e-9214-b6513fd9ad3f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;971c8b22-898b-4554-a3d4-3cb17bf84e4d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;20c7f3c6-408c-4c70-826a-028d02279998&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cb5cc92b-0d4e-4356-b585-c91394ae701c&quot;,&quot;title&quot;:&quot;User.getPlanUsesCheckOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getPlanUsesCheckOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheckOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1547,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        testCollection.organizationRemoveRecords({}, function() {\n            testCollection.organizationRecordsEntry({}, function(data) {\n                authToken = data.owner.authtoken;\n                user_uid = data.organization_account.uid;\n                org_acc_authToken = _.first(data.organization_account.authtoken);\n                org_account_uid = data.organization_account.uid;\n                org_uid = data.organization.uid;\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        env_uid = res.body.output.env_uid;\n                        user_uid = res.body.output.uid;\n                        cbk(null, res);\n                    });\n            });\n        });\n    },\n    function(res, cbk) {\n        saveBillEntries({\n                done: done,\n                authtoken: authToken\n            },\n            function(error, bills) {\n                savedBills = bills;\n                cbk(null, savedBills);\n            });\n    },\n    function(res, cbk) {\n        saveUserTriggers({\n                done: done,\n                authtoken: authToken\n            },\n            function(error, bills) {\n                savedBills = bills;\n                cbk(null, savedBills);\n            });\n    },\n    function(res, cbk) {\n        saveUserFlows({\n                done: done,\n                authtoken: authToken\n            },\n            function(error, userFlows) {\n                cbk(null, userFlows);\n            });\n    }\n], function(err, results) {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cca439a9-0261-4d08-9fa9-9238e6298530&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheckOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f0e12d3-9d30-4346-ae0c-8bd4f4601bac&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheckOrg \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23cf700d-2387-4eaa-ac7a-233d53366532&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get plan uses stats.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getPlanUsesCheckOrg Should get plan uses stats.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = isNaN(parseInt(res.body.output.trigger_count)) == false &amp;&amp;\n                isNaN(parseInt(res.body.output.flow_count)) == false &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27649c02-9d46-46f8-a14a-b7736d094b4c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;27649c02-9d46-46f8-a14a-b7736d094b4c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b9321af8-0021-49a2-9341-04a7f345fdb2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;45b63635-893e-40a1-95fa-52d51995855f&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;72280044-1950-46d9-b427-e5b2c0ddf0f5&quot;,&quot;title&quot;:&quot;User.getSupportKey&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getSupportKey.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getSupportKey \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    token = res.body.output.activation_token;\n                    _id = res.body.output._id;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d518089-3a97-4b15-921f-795fe2d221b5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getSupportKey \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;465400a4-68fc-40f4-aa6f-865c0bc539fb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get support key.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getSupportKey Should get support key.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({})\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        api.get(apiURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.supportKey.should.not.equal(\&quot;\&quot;);\n                    done();\n                }\n            });\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4e2233f-37dc-428e-bff2-030a28e5e3e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getSupportKey Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ecaac97-6899-4355-a554-3a6ab3459c23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d4e2233f-37dc-428e-bff2-030a28e5e3e0&quot;,&quot;8ecaac97-6899-4355-a554-3a6ab3459c23&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:32,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7c09d31e-21c1-42c2-be48-b51ceb64e6c7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;43e7fc02-4436-4463-9721-19df992486c1&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4ee33fe3-0535-40c5-a142-104c01a46b93&quot;,&quot;title&quot;:&quot;User.getTransactionsInfo&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfo.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_acc_authToken = _.first(data.organization_account.authtoken);\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                userPlan = res.body.output.user_plan;\n                done();\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;038199d1-5e05-404c-8f16-bb73ec05562f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfo \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ff046cb-db2e-4902-a8c8-1f2138b4eea3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get transactions info of authenticated user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfo Should get transactions info of authenticated user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            (typeof(res.body.output.available) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8fa33c5f-0b30-425c-a55e-9d7c46114fb8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfo Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f1c5372-e23a-4603-b1b0-6aa9b52adb61&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8fa33c5f-0b30-425c-a55e-9d7c46114fb8&quot;,&quot;3f1c5372-e23a-4603-b1b0-6aa9b52adb61&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9212122d-b939-43df-97db-eed4281380bc&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7b4cc645-6465-4526-ab31-3b2b1deae28e&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3f23dfcc-f0f3-47e2-8ac2-8072de8c558c&quot;,&quot;title&quot;:&quot;User.getTransactionsInfoOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getTransactionsInfoOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfoOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        userPlan = data.owner.user_plan;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86d78f73-ae34-4524-ad30-29d15f9cef96&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfoOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b8cf5c7-c82f-4ef5-b5f5-10fa79dfa50d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get transactions info of organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfoOrg Should get transactions info of organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        //console.log(err, res.body.error);\n        if (err) {\n            done(err);\n        } else {\n            (typeof(res.body.output.available) != \&quot;undefined\&quot;).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f409d61-067c-4107-bbf3-4614083fa078&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getTransactionsInfoOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;400c7ba8-50db-4a84-bad5-4ab1caea52d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0f409d61-067c-4107-bbf3-4614083fa078&quot;,&quot;400c7ba8-50db-4a84-bad5-4ab1caea52d2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f2553e9d-207e-49b2-8618-7366e1ac8cd3&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;27fad599-df47-482a-8928-9074988318b0&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b30c6a00-206c-4ca6-8d58-0240ae8a5b47&quot;,&quot;title&quot;:&quot;User.getUserById&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserById.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:175,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                var tempRegistrationBody = global.getImmutable(registrationBody);\n                tempRegistrationBody.email = \&quot;test.user+2@raweng.com\&quot;;\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/signup\&quot;)\n                    .send(tempRegistrationBody)\n                    .expect(httpStatus.CREATED)\n                    .end(function(error, res) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            other_user_uid = res.body.output.uid;\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e728b530-02ba-484e-97ef-4561a3d02a71&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16026ed0-8245-41d3-954f-3f18c27561b0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a43dd74-b958-4233-ab1c-246cfe6f3779&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get user based on user uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById Should get user based on user uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar apiURLWithID = apiURL.replace(\&quot;:user_uid\&quot;, other_user_uid);\napi.get(apiURLWithID)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.equal(other_user_uid);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d189dfe6-d40c-4485-821d-9a14b5fb185d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user not found error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById Should get user not found error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar apiURLWithID = apiURL.replace(\&quot;:user_uid\&quot;, \&quot;ABC\&quot;);\napi.get(apiURLWithID)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd93c440-15cb-40f5-af3b-7c0a9daca6f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserById Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar apiURLWithID = apiURL.replace(\&quot;:user_uid\&quot;, other_user_uid);\napi.get(apiURLWithID)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc8bbcf5-8953-45de-a09d-73358c3e59b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d189dfe6-d40c-4485-821d-9a14b5fb185d&quot;,&quot;cd93c440-15cb-40f5-af3b-7c0a9daca6f9&quot;,&quot;bc8bbcf5-8953-45de-a09d-73358c3e59b4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;47d3573a-8e97-4275-8fe8-4fd1dd823b4d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a68e4db9-921c-4420-9f17-b0796e513c47&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c378f155-ac77-47d3-84b2-80d69ec792c9&quot;,&quot;title&quot;:&quot;User.getUserCount&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserCount.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserCount \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed2d62ba-3432-4c0e-adde-c38496e6a16e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserCount \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2331a16d-d856-4739-9ffe-36ae386ffcb6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserCount \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9de8c5be-f0b0-441b-a3eb-15d776f5f900&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get register user count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserCount Should get register user count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            isNaN(parseInt(res.body.output.count)).should.equal(false);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a169e82e-f17e-4655-94ca-19662632378a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserCount Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aad35fa0-3cb9-44cc-99ab-791880daac47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a169e82e-f17e-4655-94ca-19662632378a&quot;,&quot;aad35fa0-3cb9-44cc-99ab-791880daac47&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:16,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;715e9b6d-a1ea-49da-9e0c-6b3346ddf173&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dc3da3a6-1234-4d51-bbb1-003587d6ae1a&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6dd547c7-caa5-48c5-9123-d473dde60340&quot;,&quot;title&quot;:&quot;Users.getUserFlowExecutionList&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionList.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionList \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:264,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_org_uid = utils.generateUID();\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(error, res) {\n                        _env_uid = res.body.output.env_uid;\n                        saveBillEntries({\n                            org_uid: _org_uid,\n                            user_uid: user_uid,\n                            env_uid: _env_uid,\n                            authtoken: authToken,\n                            email: res.body.output.email\n                        }, function(error, billEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _billEntries = billEntries;\n                                done();\n                            }\n                        });\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;939e101a-2d16-468f-80b1-7c6c871b5710&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionList \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6891f1d3-e297-48d5-a0f0-934153ceaa01&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionList Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid);\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.flow_uid == flow_uid;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;85e5d250-82d7-428b-898c-6b9b331ce259&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionList Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid) + \&quot;?skip=1&amp;limit=1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;186a41f3-9ab3-4338-ac71-0ab96cb5aef6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionList Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9369ec84-9c6a-4dc4-b3ab-4e9b3a3f5d3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;85e5d250-82d7-428b-898c-6b9b331ce259&quot;,&quot;186a41f3-9ab3-4338-ac71-0ab96cb5aef6&quot;,&quot;9369ec84-9c6a-4dc4-b3ab-4e9b3a3f5d3f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0d952ff5-ecc0-4aaa-9afa-5aaf41a2f826&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;9991eecc-483c-4381-8849-1c3447417c7f&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7c6d9d78-2bbb-4ec1-8cc0-5ff853445ddf&quot;,&quot;title&quot;:&quot;Users.getUserFlowExecutionListOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionListOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionListOrg \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:122,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n//_org_uid = utils.generateUID();\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                _env_uid = res.body.output.env_uid;\n                saveBillEntries({\n                    org_uid: _org_uid,\n                    user_uid: user_uid,\n                    env_uid: _env_uid,\n                    authtoken: authToken,\n                    email: res.body.output.email\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        done();\n                    }\n                });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe268762-c0cd-4558-81b8-8e01ff0f1d7e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionListOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee24267f-7bf5-49c9-8d39-73ae1fad3158&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionListOrg Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid);\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.flow_uid == flow_uid;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2da64907-5f05-45e6-b9db-ef829ad0af0f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionListOrg Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid) + \&quot;?skip=1&amp;limit=1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc5b7686-3285-4cd7-a90c-af02ef75a0c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionListOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL.replace(\&quot;:flow_uid\&quot;, flow_uid);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7b46a66d-506e-4429-97d9-c196ed61a6b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2da64907-5f05-45e6-b9db-ef829ad0af0f&quot;,&quot;fc5b7686-3285-4cd7-a90c-af02ef75a0c1&quot;,&quot;7b46a66d-506e-4429-97d9-c196ed61a6b0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;09e12bd4-d194-43d0-839c-9d254d155d62&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserFlowExecutionLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e6bb7154-8274-409b-b66d-ed7706cce002&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserFlowExecutionLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0dc06bb3-ece6-405b-8802-4cf2ff71da01&quot;,&quot;title&quot;:&quot;Users.getUserFlowExecutionLog&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserFlowExecutionLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserFlowExecutionLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:765,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_org_uid = utils.generateUID();\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(error, res) {\n                        _env_uid = res.body.output.env_uid;\n                        saveBillEntries({\n                            org_uid: _org_uid,\n                            user_uid: user_uid,\n                            env_uid: _env_uid,\n                            authtoken: authToken,\n                            email: res.body.output.email\n                        }, function(error, billEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _billEntries = billEntries;\n                                saveUserStreamEntries({\n                                    org_uid: _org_uid,\n                                    user_uid: user_uid,\n                                    env_uid: _env_uid,\n                                    authtoken: authToken,\n                                    email: res.body.output.email\n                                }, function(error, userStreamEntries) {\n                                    if (error) {\n                                        done(error);\n                                    } else {\n                                        _userStreamEntries = userStreamEntries;\n                                        done();\n                                    }\n                                });\n                            }\n                        });\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d81a0d1-3077-42a4-ab18-a897df57af72&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4de7f8a7-7cc5-4fef-92aa-55fbbf5a38f7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;430b1a5b-3fec-4614-bcd6-e71129587fdf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular flow uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user stream for particular flow uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3396fe61-4ec3-4bab-a4b9-f76b457963b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular project uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user stream for particular project uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?project_uid=\&quot; + project_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2fa2055f-6588-4742-8696-a9edbf4bb196&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular flow uid and project uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user stream for particular flow uid and project uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[3] + \&quot;&amp;project_uid=\&quot; + project_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9818d799-812a-4113-9b8f-cfd8f4265825&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user stream based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get limited list of user stream based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff049aa4-02d9-44cc-b973-d53fdd5587d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user stream based on skip/limit for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get limited list of user stream based on skip/limit for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d48bb921-6a6d-4f6c-9a9c-67ae1ca6dc56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams based on skip/limit in title descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get limited list of user streams based on skip/limit in title descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=title&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ae2c95cf-067b-450d-aae4-32ea7d57738d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams based on skip/limit in title descending order for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get limited list of user streams based on skip/limit in title descending order for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=title&amp;direction=desc&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2fca5cf7-4ad0-4e40-a170-24df9fcad6f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;85bb3726-bb53-4534-aedd-54bd9ff2734f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=1&amp;limit=1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2bfc8a7-354e-4877-bd7f-2d229524a69a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get limited list of user streams of flow-execution based on skip/limit for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=1&amp;limit=1&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51b6f9f7-8865-47f4-b7c2-8dbf3ba9bf24&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user streams of flow-execution for specific flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?name=utest_cases_01\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f35aa04-1676-4690-b93d-8caab7119c06&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific flow for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user streams of flow-execution for specific flow for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?name=utest_cases_01&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1463b23-fd40-43fe-93fd-06b38477087a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user streams of flow-execution for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;99ea79bd-1af4-418d-b281-8dfe14b7a03d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ca6a22de-2c63-4580-b3b0-6f528f6c9738&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of flow-execution for specific details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should not get list of user streams of flow-execution for specific details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3fd24fdd-a709-4133-8299-a1b2b39eeb48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should not get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6e7ee61-3dd0-4ee1-a631-206867b0bc44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of result from date range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of result from date range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?from=\&quot; + from_date + \&quot;&amp;to=\&quot; + to_date + &#x27;&amp;authtoken=&#x27; + authToken;\napi.get(filterURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0859f79a-26f8-4a71-bdea-34225fa7c97e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user streams of flow-execution for bill status success.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?status=success\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6bda86fc-0893-4b71-911c-5e9bf7c5e4df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?status=success&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c295aac9-3926-4bb7-85b2-4c1888346880&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user streams of flow-execution for bill status success.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?status=success\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e24e9bd-83aa-4a18-9ea6-316b164b803d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?status=success&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            true.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d3cf3bd-b427-4a5a-9bef-e5cca5f457b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserFlowExecutionLog Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da2e028c-98b4-4bcf-a825-a54ad1791c7a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;430b1a5b-3fec-4614-bcd6-e71129587fdf&quot;,&quot;3396fe61-4ec3-4bab-a4b9-f76b457963b1&quot;,&quot;2fa2055f-6588-4742-8696-a9edbf4bb196&quot;,&quot;9818d799-812a-4113-9b8f-cfd8f4265825&quot;,&quot;ff049aa4-02d9-44cc-b973-d53fdd5587d2&quot;,&quot;d48bb921-6a6d-4f6c-9a9c-67ae1ca6dc56&quot;,&quot;ae2c95cf-067b-450d-aae4-32ea7d57738d&quot;,&quot;2fca5cf7-4ad0-4e40-a170-24df9fcad6f0&quot;,&quot;85bb3726-bb53-4534-aedd-54bd9ff2734f&quot;,&quot;a2bfc8a7-354e-4877-bd7f-2d229524a69a&quot;,&quot;51b6f9f7-8865-47f4-b7c2-8dbf3ba9bf24&quot;,&quot;0f35aa04-1676-4690-b93d-8caab7119c06&quot;,&quot;c1463b23-fd40-43fe-93fd-06b38477087a&quot;,&quot;99ea79bd-1af4-418d-b281-8dfe14b7a03d&quot;,&quot;ca6a22de-2c63-4580-b3b0-6f528f6c9738&quot;,&quot;3fd24fdd-a709-4133-8299-a1b2b39eeb48&quot;,&quot;f6e7ee61-3dd0-4ee1-a631-206867b0bc44&quot;,&quot;0859f79a-26f8-4a71-bdea-34225fa7c97e&quot;,&quot;6bda86fc-0893-4b71-911c-5e9bf7c5e4df&quot;,&quot;c295aac9-3926-4bb7-85b2-4c1888346880&quot;,&quot;9e24e9bd-83aa-4a18-9ea6-316b164b803d&quot;,&quot;5d3cf3bd-b427-4a5a-9bef-e5cca5f457b4&quot;,&quot;da2e028c-98b4-4bcf-a825-a54ad1791c7a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:473,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e5324452-c31a-4eab-8557-afdd3e90da75&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c76d3fca-f4cd-404b-a184-b05f326a58a2&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7eec680a-4700-44dc-b215-b1dc725a0449&quot;,&quot;title&quot;:&quot;Users.getUserStreamData&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamData.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:730,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_org_uid = utils.generateUID();\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                user_uid = res.body.output.uid;\n                _id = res.body.output._id;\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(error, res) {\n                        _env_uid = res.body.output.env_uid;\n                        saveBillEntries({\n                            org_uid: _org_uid,\n                            user_uid: user_uid,\n                            env_uid: _env_uid,\n                            authtoken: authToken,\n                            email: res.body.output.email\n                        }, function(error, billEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _billEntries = billEntries;\n                                saveUserStreamEntries({\n                                    org_uid: _org_uid,\n                                    user_uid: user_uid,\n                                    env_uid: _env_uid,\n                                    authtoken: authToken,\n                                    email: res.body.output.email\n                                }, function(error, userStreamEntries) {\n                                    if (error) {\n                                        done(error);\n                                    } else {\n                                        _userStreamEntries = userStreamEntries;\n                                        done();\n                                    }\n                                });\n                            }\n                        });\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d01119c-49c0-4a1b-8d9d-ddb0ea03f408&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;08bec341-4ac8-40a2-b0bd-e66500a98fd3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        (typeof(item.env_uid) == \&quot;undefined\&quot; ||\n                            item.env_uid == _env_uid ||\n                            item.env_uid == null)\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b2d5bd6f-0f8e-4d1c-86a9-8ab38379e8f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular flow uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user stream for particular flow uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b3eed4fa-bfc4-475f-a854-7a5386f2089d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular project uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user stream for particular project uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?project_uid=\&quot; + project_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.project_uid == project_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a37c0b1-09dd-4c99-a6dd-e168e0f68fff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular flow uid and project uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user stream for particular flow uid and project uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[3] + \&quot;&amp;project_uid=\&quot; + project_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3] &amp;&amp;\n                        item.metadata.project_uid == project_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bfbfb7fa-40c6-4025-9e94-18a938b83fa0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user stream based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user stream based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.UserStream.find({\n                \&quot;deleted_at\&quot;: null,\n                \&quot;user_uid\&quot;: user_uid\n            }, function(error, userStreams) {\n                var isValid = false;\n                if (!error) {\n                    if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                        Array.isArray(res.body.output.objects)) {\n                        userStreams = utils.sortBy(userStreams, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                        isValid = res.body.output.objects.length == 2;\n                    }\n                }\n                isValid.should.equal(true);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b1b9a259-c016-4dfa-8b68-99f2a0379eb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user stream based on skip/limit for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user stream based on skip/limit for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.UserStream.find({\n                \&quot;deleted_at\&quot;: null,\n                \&quot;user_uid\&quot;: user_uid,\n                \&quot;metadata.flow_uid\&quot;: flow_uids[3]\n            }, function(error, userStreams) {\n                var isValid = false;\n                if (!error) {\n                    if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                        Array.isArray(res.body.output.objects)) {\n                        isValid = res.body.output.objects.length == 2;\n                    }\n                    if (isValid) {\n                        _.each(res.body.output.objects, function(item) {\n                            isValid = isValid &amp;&amp;\n                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                item.metadata.flow_uid == flow_uids[3];\n                        });\n                    }\n                }\n                isValid.should.equal(true);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe04047e-572f-4388-82fa-3f48249cbf1e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams based on skip/limit in title descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user streams based on skip/limit in title descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=title&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21d42793-63a2-4dfd-8f1c-dc4c0764aba6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams based on skip/limit in title descending order for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user streams based on skip/limit in title descending order for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=title&amp;direction=desc&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 2;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a4ca21d3-5b06-4787-9d2d-bbed6aa396d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a123ea19-8d60-4752-a341-12a5b57f4365&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[0];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aa19be8d-f5de-4b19-b56f-ad8303117481&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=1&amp;limit=1&amp;flow=flow-execution\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3d450bb-6d65-4797-a473-efaf375becf7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get limited list of user streams of flow-execution based on skip/limit for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=1&amp;limit=1&amp;flow=flow-execution&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b5575d7-8229-405c-8f42-7a9f5cd58ca8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of publish-flow-downloaded.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a4e50830-9aba-4caf-a2a5-58c4f817a8af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of publish-flow-downloaded.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1fe18cd2-13bd-4b36-81a5-840da9c86ee1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of share-flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d90e04e-e64c-4829-bf33-fc252586f3ed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of share-flow for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;flow_uid=\&quot; + flow_uids[2];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6528a83b-9ce7-4b5a-bdbf-31d6c82db57d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of credits.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of credits.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=credits\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c4a097a8-d8d1-43eb-95b9-2fa446fb83fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of credits for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of credits for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=credits&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0483804b-ba1d-41a9-bab9-aeebc6e4d930&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for specific flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;name=utest_cases_01\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d56110fd-4c05-4f13-9d8e-56e5f08f806a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific flow for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for specific flow for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;name=utest_cases_01&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;35825734-1ee8-4564-9fae-70874bbe041f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf731e41-2723-42ec-a0da-1065782dd80c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;857ee636-8669-4990-86c6-fc17d57b5856&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of flow-execution for specific details.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of flow-execution for specific details.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64a72285-9e0c-45ec-b747-f59cfa16318c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a91c4ee-d7cb-4811-afe4-a8679c69fa49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5a322a7-2152-4aa1-9a15-67ec598cc57c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0ed181f-db06-4848-a750-0b37bb0f345b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5185f097-313d-4977-ab82-aa24766a8e61&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41d1b5ba-e28e-48e5-9fdf-1f3ef12ba50d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of share-flow for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19bb7b11-ed8b-468c-92bc-83269702ad1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[1];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66215e0b-57c5-4196-a9f3-8d399e2b7942&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of share-flow for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of share-flow for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb7effe1-f60b-45d7-a8cb-35fee78df39c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of result from date range.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of result from date range.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:115,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;from=\&quot; + from_date + \&quot;&amp;to=\&quot; + to_date;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 4 &amp;&amp;\n                    res.body.output.count == 4;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d02c73b9-e142-4a94-9797-b230ff0cae0b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should not get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;368199e7-3bed-436d-81cc-6ff9cf2002b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for bill status success.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df849ac6-a8d3-4281-95aa-bb2fe64a066c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[0];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;078eeb91-2ac0-49a5-8a6e-e64b872bc7d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for bill status success.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success\&quot;;\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18d5109b-9a66-4195-901a-ec3396190314&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6ede177-bd22-4327-820d-de467587c98e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamData Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;08734c6b-a8fa-44d4-a626-b84908d9fa39&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b2d5bd6f-0f8e-4d1c-86a9-8ab38379e8f0&quot;,&quot;b3eed4fa-bfc4-475f-a854-7a5386f2089d&quot;,&quot;1a37c0b1-09dd-4c99-a6dd-e168e0f68fff&quot;,&quot;bfbfb7fa-40c6-4025-9e94-18a938b83fa0&quot;,&quot;b1b9a259-c016-4dfa-8b68-99f2a0379eb7&quot;,&quot;fe04047e-572f-4388-82fa-3f48249cbf1e&quot;,&quot;21d42793-63a2-4dfd-8f1c-dc4c0764aba6&quot;,&quot;a4ca21d3-5b06-4787-9d2d-bbed6aa396d6&quot;,&quot;a123ea19-8d60-4752-a341-12a5b57f4365&quot;,&quot;aa19be8d-f5de-4b19-b56f-ad8303117481&quot;,&quot;d3d450bb-6d65-4797-a473-efaf375becf7&quot;,&quot;9b5575d7-8229-405c-8f42-7a9f5cd58ca8&quot;,&quot;a4e50830-9aba-4caf-a2a5-58c4f817a8af&quot;,&quot;1fe18cd2-13bd-4b36-81a5-840da9c86ee1&quot;,&quot;9d90e04e-e64c-4829-bf33-fc252586f3ed&quot;,&quot;6528a83b-9ce7-4b5a-bdbf-31d6c82db57d&quot;,&quot;c4a097a8-d8d1-43eb-95b9-2fa446fb83fc&quot;,&quot;0483804b-ba1d-41a9-bab9-aeebc6e4d930&quot;,&quot;d56110fd-4c05-4f13-9d8e-56e5f08f806a&quot;,&quot;35825734-1ee8-4564-9fae-70874bbe041f&quot;,&quot;cf731e41-2723-42ec-a0da-1065782dd80c&quot;,&quot;857ee636-8669-4990-86c6-fc17d57b5856&quot;,&quot;64a72285-9e0c-45ec-b747-f59cfa16318c&quot;,&quot;4a91c4ee-d7cb-4811-afe4-a8679c69fa49&quot;,&quot;a5a322a7-2152-4aa1-9a15-67ec598cc57c&quot;,&quot;f0ed181f-db06-4848-a750-0b37bb0f345b&quot;,&quot;5185f097-313d-4977-ab82-aa24766a8e61&quot;,&quot;41d1b5ba-e28e-48e5-9fdf-1f3ef12ba50d&quot;,&quot;19bb7b11-ed8b-468c-92bc-83269702ad1b&quot;,&quot;66215e0b-57c5-4196-a9f3-8d399e2b7942&quot;,&quot;bb7effe1-f60b-45d7-a8cb-35fee78df39c&quot;,&quot;d02c73b9-e142-4a94-9797-b230ff0cae0b&quot;,&quot;368199e7-3bed-436d-81cc-6ff9cf2002b1&quot;,&quot;df849ac6-a8d3-4281-95aa-bb2fe64a066c&quot;,&quot;078eeb91-2ac0-49a5-8a6e-e64b872bc7d7&quot;,&quot;18d5109b-9a66-4195-901a-ec3396190314&quot;,&quot;e6ede177-bd22-4327-820d-de467587c98e&quot;,&quot;08734c6b-a8fa-44d4-a626-b84908d9fa39&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:946,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a04264d9-c4a1-4000-995f-284bcd992dd0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;33fb1726-c31a-4e16-9be0-ce40ce03f602&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1a064e6e-8ca3-466e-a569-78907ba5d3b0&quot;,&quot;title&quot;:&quot;Users.getUserStreamDataOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDataOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:760,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .expect(httpStatus.OK)\n            .end(function(error, res) {\n                var env_uid = res.body.output.env_uid;\n                saveBillEntries({\n                    user_uid: user_uid,\n                    authtoken: authToken,\n                    email: data.owner.email,\n                    env_uid: env_uid\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        saveUserStreamEntries({\n                            user_uid: user_uid,\n                            authtoken: authToken,\n                            email: data.owner.email,\n                            env_uid: env_uid\n                        }, function(error, userStreamEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _userStreamEntries = userStreamEntries;\n                                done();\n                            }\n                        });\n                    }\n                });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9920afc5-d46f-487e-bf46-e9af2e0d5867&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84ce0c30-c024-462a-9d88-8805c338bd24&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot;;\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;372d7704-4b82-467f-8543-8887f0fd9c53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular flow uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user stream for particular flow uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b2c4b87d-ffb7-4a01-b2db-bdafa9630958&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular project uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user stream for particular project uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?project_uid=\&quot; + project_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.project_uid == project_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c770027-cdb3-4653-8bf6-3a5aef2a4cd6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user stream for particular flow uid and project uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user stream for particular flow uid and project uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow_uid=\&quot; + flow_uids[3] + \&quot;&amp;project_uid=\&quot; + project_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects);\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3] &amp;&amp;\n                        item.metadata.project_uid == project_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fa82cde5-f96b-4d19-a7a7-9cf2ad269033&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user stream based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user stream based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.UserStream.find({\n                \&quot;deleted_at\&quot;: null,\n                \&quot;user_uid\&quot;: user_uid\n            }, function(error, userStreams) {\n                var isValid = false;\n                if (!error) {\n                    if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                        Array.isArray(res.body.output.objects)) {\n                        userStreams = utils.sortBy(userStreams, \&quot;created_at\&quot;, \&quot;date\&quot;);\n                        isValid = res.body.output.objects.length == 2;\n                    }\n                }\n                isValid.should.equal(true);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4f74fdd-fbe6-40f0-bb72-0b0761a831fb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user stream based on skip/limit for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user stream based on skip/limit for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=created_at&amp;direction=asc&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.UserStream.find({\n                \&quot;deleted_at\&quot;: null,\n                \&quot;user_uid\&quot;: user_uid,\n                \&quot;metadata.flow_uid\&quot;: flow_uids[3]\n            }, function(error, userStreams) {\n                var isValid = false;\n                if (!error) {\n                    if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                        Array.isArray(res.body.output.objects)) {\n                        isValid = res.body.output.objects.length == 2;\n                    }\n                    if (isValid) {\n                        _.each(res.body.output.objects, function(item) {\n                            isValid = isValid &amp;&amp;\n                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                item.metadata.flow_uid == flow_uids[3];\n                        });\n                    }\n                }\n                isValid.should.equal(true);\n                done();\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a54298d-944f-4274-b345-89cf35433e7c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams based on skip/limit in title descending order.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user streams based on skip/limit in title descending order.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=title&amp;direction=desc\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13f660dc-e31b-428b-a015-63f875966ad1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams based on skip/limit in title descending order for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user streams based on skip/limit in title descending order for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=2&amp;limit=2&amp;field=title&amp;direction=desc&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _userStreamEntries = utils.sortBy(_userStreamEntries, \&quot;body.output.title\&quot;);\n                isValid = res.body.output.objects.length == 2 &amp;&amp;\n                    res.body.output.objects[0].metadata.flow_uid == flow_uids[3] &amp;&amp;\n                    res.body.output.objects[1].metadata.flow_uid == flow_uids[3];\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;af2bce26-cd53-4a11-a3d8-4db636360ee1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9505367d-aae1-44c3-b4b5-23c87234cd6c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[0];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;07fae45f-5f63-46e5-8be0-976dbb4e8dcb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user streams of flow-execution based on skip/limit.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=1&amp;limit=1&amp;flow=flow-execution\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;785cb840-4906-4cb1-8723-344b2ce0444a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get limited list of user streams of flow-execution based on skip/limit for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get limited list of user streams of flow-execution based on skip/limit for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?skip=1&amp;limit=1&amp;flow=flow-execution&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 1 &amp;&amp;\n                    res.body.output.objects[0].metadata.flow_uid == flow_uids[0];\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd810a4c-940a-44fe-9758-2363a64dc5b6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of publish-flow-downloaded.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee163bba-edf6-491b-b683-00c5f8438ae7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of publish-flow-downloaded.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b2c82d2-1bb9-4b66-905f-56149d14f0a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of share-flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4d734af-7415-438c-8884-9480b98fc5dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of share-flow for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;flow_uid=\&quot; + flow_uids[2];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[2];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f121c258-0068-455d-b1aa-f5c87693cf08&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of credits.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of credits.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=credits\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ac7b05c-2988-4500-990a-226d966b3fb9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of credits for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of credits for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=credits&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49b17ee8-d453-4435-86d9-c27f69eacf17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific flow.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for specific flow.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;name=utest_cases_01\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29ce06aa-61bc-43cd-8450-382116cd1948&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific flow for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for specific flow for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;name=utest_cases_01&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b77f6a0d-bc45-4eec-b926-c7b23b0c1c18&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;564bea00-6cdc-4101-ac3d-f562436fec60&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[1];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;139ee3c4-45eb-464a-8a5f-24e43a4ef523&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of flow-execution for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of flow-execution for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b68b318-cf0c-476a-a94f-7c175f232db5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of flow-execution for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df4c1f31-d693-4f10-8a2c-b202989742dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9c69aae3-13e1-4cce-bcd6-8f7b5cf5c5c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[1];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13dc5744-087e-46ee-b805-17340493ad6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of publish-flow-downloaded for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;765c8c87-fa58-42e8-ba74-5d072d47c37c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of publish-flow-downloaded for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=publish-flow-downloaded&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e415a7c-efa1-4cfa-b379-56a21874e7ef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of share-flow for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=command,enabled\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects));\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d72ec834-3fe9-42a8-9e43-4041e5016cf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=command,enabled&amp;flow_uid=\&quot; + flow_uids[1];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = true;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[1];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c07ca41-9e79-45b9-ac4a-3e5f323be942&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of share-flow for specific detail.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of share-flow for specific detail.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=enabled1\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e98a18d8-2b37-4639-a84c-43d7131d26f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should not get list of user streams of share-flow for specific detail for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=share-flow&amp;detail=enabled1&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                isValid = res.body.output.objects.length == 0 &amp;&amp;\n                    res.body.output.count == 0;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;053e2c5a-3afd-4d68-8b3f-e2fb74d83125&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for bill status success.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a073a363-ba5d-40a6-807c-4580734b83c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success&amp;flow_uid=\&quot; + flow_uids[0];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[0];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf5e57e2-8e44-4c22-831e-491757abb890&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for bill status success.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success\&quot;;\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eab9fd7f-1d85-4226-beb3-ca867bd8bba0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should get list of user streams of flow-execution for bill status success for particular flow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar filterURL = apiURL + \&quot;?flow=flow-execution&amp;status=success&amp;flow_uid=\&quot; + flow_uids[3];\napi.get(filterURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            var successCount = 0;\n            if (typeof(res.body.output.count) != \&quot;undefined\&quot; &amp;&amp;\n                Array.isArray(res.body.output.objects)) {\n                _.map(res.body.output.objects, function(item) {\n                    var failCount = 0;\n                    _.each(_.filter(_billEntries, { \&quot;_id\&quot;: item._id }), function(eachItem) {\n                        if (eachItem.result = \&quot;fail\&quot;) {\n                            failCount++;\n                        }\n                    });\n                    if (failCount == 0) {\n                        successCount++;\n                    }\n                });\n                isValid = successCount == res.body.output.count;\n            }\n            if (isValid) {\n                _.each(res.body.output.objects, function(item) {\n                    isValid = isValid &amp;&amp;\n                        typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(item.__v) == \&quot;undefined\&quot; &amp;&amp;\n                        item.metadata.flow_uid == flow_uids[3];\n                });\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39ff15c1-d6c2-4fd6-95bd-824d51381c3d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User Users.getUserStreamDataOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6a2f6afe-17c4-4abe-a6ba-f7cd61ecea9b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;372d7704-4b82-467f-8543-8887f0fd9c53&quot;,&quot;b2c4b87d-ffb7-4a01-b2db-bdafa9630958&quot;,&quot;6c770027-cdb3-4653-8bf6-3a5aef2a4cd6&quot;,&quot;fa82cde5-f96b-4d19-a7a7-9cf2ad269033&quot;,&quot;f4f74fdd-fbe6-40f0-bb72-0b0761a831fb&quot;,&quot;3a54298d-944f-4274-b345-89cf35433e7c&quot;,&quot;13f660dc-e31b-428b-a015-63f875966ad1&quot;,&quot;af2bce26-cd53-4a11-a3d8-4db636360ee1&quot;,&quot;9505367d-aae1-44c3-b4b5-23c87234cd6c&quot;,&quot;07fae45f-5f63-46e5-8be0-976dbb4e8dcb&quot;,&quot;785cb840-4906-4cb1-8723-344b2ce0444a&quot;,&quot;cd810a4c-940a-44fe-9758-2363a64dc5b6&quot;,&quot;ee163bba-edf6-491b-b683-00c5f8438ae7&quot;,&quot;6b2c82d2-1bb9-4b66-905f-56149d14f0a2&quot;,&quot;f4d734af-7415-438c-8884-9480b98fc5dd&quot;,&quot;f121c258-0068-455d-b1aa-f5c87693cf08&quot;,&quot;7ac7b05c-2988-4500-990a-226d966b3fb9&quot;,&quot;49b17ee8-d453-4435-86d9-c27f69eacf17&quot;,&quot;29ce06aa-61bc-43cd-8450-382116cd1948&quot;,&quot;b77f6a0d-bc45-4eec-b926-c7b23b0c1c18&quot;,&quot;564bea00-6cdc-4101-ac3d-f562436fec60&quot;,&quot;139ee3c4-45eb-464a-8a5f-24e43a4ef523&quot;,&quot;3b68b318-cf0c-476a-a94f-7c175f232db5&quot;,&quot;df4c1f31-d693-4f10-8a2c-b202989742dd&quot;,&quot;9c69aae3-13e1-4cce-bcd6-8f7b5cf5c5c7&quot;,&quot;13dc5744-087e-46ee-b805-17340493ad6e&quot;,&quot;765c8c87-fa58-42e8-ba74-5d072d47c37c&quot;,&quot;9e415a7c-efa1-4cfa-b379-56a21874e7ef&quot;,&quot;d72ec834-3fe9-42a8-9e43-4041e5016cf5&quot;,&quot;2c07ca41-9e79-45b9-ac4a-3e5f323be942&quot;,&quot;e98a18d8-2b37-4639-a84c-43d7131d26f1&quot;,&quot;053e2c5a-3afd-4d68-8b3f-e2fb74d83125&quot;,&quot;a073a363-ba5d-40a6-807c-4580734b83c3&quot;,&quot;cf5e57e2-8e44-4c22-831e-491757abb890&quot;,&quot;eab9fd7f-1d85-4226-beb3-ca867bd8bba0&quot;,&quot;39ff15c1-d6c2-4fd6-95bd-824d51381c3d&quot;,&quot;6a2f6afe-17c4-4abe-a6ba-f7cd61ecea9b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:819,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e1cdb681-31e7-40cb-8a4e-48da70c3d3b6&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f2cfc6ca-759a-4b6d-b851-9291d8d1e184&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b0f12db2-79fb-4039-8855-303ede098e0e&quot;,&quot;title&quot;:&quot;User.getUserStreamDistinctFlowNames&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNames.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNames \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:913,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(error, res) {\n            if (error) {\n                done(error);\n            } else {\n                authToken = res.body.output.authtoken;\n                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                api.get(\&quot;/enterprise/v1/user\&quot;)\n                    .set(&#x27;authtoken&#x27;, authToken)\n                    .expect(httpStatus.OK)\n                    .end(function(error, res) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            user_uid = res.body.output.uid;\n                            env_uid = res.body.output.env_uid;\n                            _id = res.body.output._id;\n                            saveBillEntries({\n                                user_uid: user_uid,\n                                authtoken: authToken,\n                                email: res.body.output.email\n                            }, function(error, billEntries) {\n                                if (error) {\n                                    done(error);\n                                } else {\n                                    _billEntries = billEntries;\n                                    saveUserStreamEntries({\n                                        user_uid: user_uid,\n                                        authtoken: authToken,\n                                        email: res.body.output.email\n                                    }, function(error, userStreamEntries) {\n                                        if (error) {\n                                            done(error);\n                                        } else {\n                                            _userStreamEntries = userStreamEntries;\n                                            done();\n                                        }\n                                    });\n                                }\n                            });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;09f09c83-d776-4ec3-9b3f-8a6edfd0faf6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNames \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f8db43ce-0233-460a-8685-3fba8b1a3cc1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get distinct list of flow names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNames Should get distinct list of flow names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;flows\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02fec8c5-dab9-4842-8c7d-5949c45243b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of projects names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNames Should get distinct list of projects names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;projects\&quot;))\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b732223-6de8-4b7e-820c-87bdbfcb8274&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNames Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed82c5f0-18da-4a98-8971-10d8885db8dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;02fec8c5-dab9-4842-8c7d-5949c45243b4&quot;,&quot;0b732223-6de8-4b7e-820c-87bdbfcb8274&quot;,&quot;ed82c5f0-18da-4a98-8971-10d8885db8dd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:38,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;797e541e-6cc7-40f7-9ca8-02ec05aaa83e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;752547d1-af08-4522-a155-bab6962b5c6d&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5042a503-1033-452d-bd25-be90a4e70273&quot;,&quot;title&quot;:&quot;User.getUserStreamDistinctFlowNamesOrg&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\getUserStreamDistinctFlowNamesOrg.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:587,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                env_uid = res.body.output.env_uid;\n                saveBillEntries({\n                    user_uid: user_uid,\n                    authtoken: authToken,\n                    email: data.owner.email\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        saveUserStreamEntries({\n                            user_uid: user_uid,\n                            authtoken: authToken,\n                            email: data.owner.email\n                        }, function(error, userStreamEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _userStreamEntries = userStreamEntries;\n                                done();\n                            }\n                        });\n                    }\n                });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d22c826-9755-413f-a23d-4ba0ca5cf35f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df6ace7d-4068-4ee0-883e-7968f6181661&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get distinct list of flow names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of flow names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;workflows\&quot;))\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac45e606-9077-4cfa-8af3-0e4540823f5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of flow based on projects.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of flow based on projects.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar userStreamURL = apiURL.replace(\&quot;{type}\&quot;, \&quot;workflows\&quot;) + \&quot;&amp;project_uid=\&quot; + project_uids[0] + \&quot;,\&quot; + project_uids[1];\napi.get(userStreamURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4152a2e1-8d7a-4507-891b-cd3f31421dcd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of projects names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should get distinct list of projects names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;{type}\&quot;, \&quot;projects\&quot;))\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.objects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d56d2992-8a9b-4880-bcef-cddebb3862b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.getUserStreamDistinctFlowNamesOrg Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da136b5e-9d0f-4574-9e78-fce32e1a22eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ac45e606-9077-4cfa-8af3-0e4540823f5c&quot;,&quot;4152a2e1-8d7a-4507-891b-cd3f31421dcd&quot;,&quot;d56d2992-8a9b-4880-bcef-cddebb3862b9&quot;,&quot;da136b5e-9d0f-4574-9e78-fce32e1a22eb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:51,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0cc22661-fd98-4cb3-9b45-d7faa7931fc1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\inviteUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\inviteUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8957f6e4-acbb-4538-b501-3a1fb1e3feb2&quot;,&quot;title&quot;:&quot;User.Invite&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\inviteUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\inviteUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner\n        dummyUser.authtoken = dummyUser.authtoken;\n        done()\n    })\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed428f20-0714-406f-907c-6d8eebca4e7b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send(data)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;40714b47-52c3-4c4a-bb4d-0249227d23a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if body is empty not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite Should get error, if body is empty not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidData = _.cloneDeep(data)\ninvalidData.emails = []\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2621f6b5-c014-4c64-b087-c3f673bbbe75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user sents invitations to self.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite Should get error, if user sents invitations to self.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar invalidData = _.cloneDeep(data)\ninvalidData.emails = [dummyUser.email]\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(invalidData)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.INVITATION_CAN_NOT_SENT_TO_SELF);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f26b95e-00da-41a5-9a88-eb20a2dfd156&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if user sents invitations to more than 10 user(s) at a time.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite Should get error, if user sents invitations to more than 10 user(s) at a time.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(data)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(&#x27;The invitation can not be sent with more than 10 users at a time.&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;736f575f-150f-405e-94ad-156cae50fddd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should invite users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.Invite Should invite users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar validData = _.cloneDeep(data)\nvalidData.emails = [validData.emails[0]]\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(validData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var result = res.body.output.message;\n            expect(result).to.be.equal(&#x27;test@1.com has been invited successfully.&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ee8f318-f55d-400a-95fb-a8c3344bd3ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;40714b47-52c3-4c4a-bb4d-0249227d23a7&quot;,&quot;2621f6b5-c014-4c64-b087-c3f673bbbe75&quot;,&quot;2f26b95e-00da-41a5-9a88-eb20a2dfd156&quot;,&quot;736f575f-150f-405e-94ad-156cae50fddd&quot;,&quot;8ee8f318-f55d-400a-95fb-a8c3344bd3ca&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:44,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8caf1a31-61b3-4d94-9517-1964ceb415e0&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d36940b5-b4a5-4cfb-8f10-71700174d5b1&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4dcfb8d0-aca3-41f5-9d48-c397ff7841b4&quot;,&quot;title&quot;:&quot;User.ListUsers&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\listUsers.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.ListUsers \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:348,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        signUpUsers({}, function(error, users) {\n            if (error) {\n                done(error);\n            } else {\n                registerUsers = users;\n                done();\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;09e0c57a-c757-402b-81d7-c30642314932&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.ListUsers \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;097c8d60-2b29-4d76-88ea-65814b64fe65&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get list of users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.ListUsers Should get list of users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar authToken = registerUsers[0].body.output.authtoken;\napi.get(apiURL)\n    .set({ &#x27;authtoken&#x27;: authToken, \&quot;ui_admin_key\&quot;: config.UI_ADMIN_KEY })\n    .expect(httpStatus.OK)\n    .end(function(error, res) {\n        if (error) {\n            done(error);\n        } else {\n            res.body.output.should.be.instanceOf(Array);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;479c67b9-27f0-4420-b66a-b9b3b1fd617b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get list of only uids of register users.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.ListUsers Should get list of only uids of register users.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar authToken = registerUsers[0].body.output.authtoken;\nvar paramURL = apiURL + \&quot;?get=user_uids\&quot;\napi.get(paramURL)\n    .set({ &#x27;authtoken&#x27;: authToken, \&quot;ui_admin_key\&quot;: config.UI_ADMIN_KEY })\n    .expect(httpStatus.OK)\n    .end(function(error, res) {\n        if (error) {\n            done(error);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                var eachMatched = true;\n                _.each(res.body.output, function(item) {\n                    if (!(typeof(item.uid) != \&quot;undefined\&quot; &amp;&amp; typeof(item.email) == \&quot;undefined\&quot;)) {\n                        eachMatched = false;\n                    }\n                });\n                isValid = eachMatched;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a6ace2a6-3141-4ee7-a5e9-0ae9530728e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.ListUsers Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(error, res) {\n        if (error) {\n            done(error);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b32af276-85df-4e21-8434-552813995d8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;479c67b9-27f0-4420-b66a-b9b3b1fd617b&quot;,&quot;a6ace2a6-3141-4ee7-a5e9-0ae9530728e1&quot;,&quot;b32af276-85df-4e21-8434-552813995d8d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;80d204bd-9e04-45cf-bc48-1e68e2e1978e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;39f4238d-d48c-4baf-a6de-fa4dca02a2b6&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;45a82590-6133-4384-9847-f936dee230b8&quot;,&quot;title&quot;:&quot;User.Login&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\login.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:103,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.createFlowUser({}, function(error, user) {\n        if (error) {\n            done(error);\n        } else {\n            authToken = user.authtoken;\n            token = user.activation_token;\n            _id = user._id;\n            uid = user.uid;\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ed27b34-50c9-4d67-8cc0-5015175c3b91&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fa1685db-873d-47d5-bd0c-aba66276a3c8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should login successfully.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should login successfully.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.email == loginBody.email &amp;&amp;\n                res.body.output.active == false &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0d458b0-930f-42e9-abb9-606c8d7a2a11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to re-login successfully.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should allowed to re-login successfully.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:170,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.email == loginBody.email &amp;&amp;\n                res.body.output.active == false &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n\n            if (isValid) {\n                api.post(\&quot;/enterprise/v1/logout\&quot;)\n                    .set(\&quot;authtoken\&quot;, res.body.output.authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                            api.post(apiURL)\n                                .send(loginBody)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = res.body.output.email == loginBody.email &amp;&amp;\n                                            res.body.output.active == false &amp;&amp;\n                                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                        isValid.should.equal(true);\n                                        done();\n                                    }\n                                });\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;591844df-072f-4886-a78e-954a30d95e98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not login if user_type is null.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should not login if user_type is null.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({\n    uid: uid\n}, {\n    user_type: null\n}, function(error, user) {\n    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n    api.post(apiURL)\n        .send(loginBody)\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL);\n                isValid.should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e922837-94a0-48b9-aa95-9169657ba44f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get user_plan for old user records.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should get user_plan for old user records.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOne({ uid: uid }, function(error, user) {\n    var planObjectID = new ObjectId(convert.getJSON(user).plan[0]);\n    _models.User.findOneAndUpdate({ uid: uid }, {\n        plan: planObjectID\n    }, { new: true }, function(error, user) {\n        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n        api.post(apiURL)\n            .send(loginBody)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    var isValid = res.body.output.email == loginBody.email &amp;&amp;\n                        res.body.output.active == false &amp;&amp;\n                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                        typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                    isValid.should.equal(true);\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;198a693c-af61-4937-bd9f-034b4d77cb43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to login if activation is expired.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should not allowed to login if activation is expired.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ uid: uid }, {\n    activation_expired: true\n}, function(error, user) {\n    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n    api.post(apiURL)\n        .send(loginBody)\n        .expect(httpStatus.UNAUTHORIZED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.error.message.should.equal(messageList.USER_LOGIN_ACTIVATION_REQUIRED_ERROR);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;833580be-37c1-4a37-bdad-bbf776a41d25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login with support key.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should allowed to login with support key.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/supportkey\&quot;)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({})\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send({\n                    \&quot;email\&quot;: loginBody.email,\n                    \&quot;password\&quot;: res.body.output.supportKey || \&quot;\&quot;\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.support_key == \&quot;\&quot; &amp;&amp;\n                            res.body.output.email == loginBody.email;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f7b581d-1044-4601-bfb1-b655d245ba84&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to login deleted user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should not allowed to login deleted user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var currentDate = new Date();\n            _models.User.update({\n                \&quot;uid\&quot;: res.body.output.uid\n            }, { $set: { \&quot;deleted_at\&quot;: currentDate } }, function(error, user) {\n                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send(loginBody)\n                    .expect(httpStatus.UNAUTHORIZED)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.error.message.should.equal(messageList.USER_LOGIN_INVALID_CREDENTIAL);\n                            done();\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cc70781c-c4d9-494f-9901-d18b89e07055&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid param errors.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should give invalid param errors.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.email.message == messageList.USER_REG_EMAIL_NOT_VALID &amp;&amp;\n                res.body.error.password.message == messageList.USER_LOGIN_REQUIRED_PASSWORD;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9221e5c7-3c72-4a55-b28a-9360452fe2fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should get default plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:79,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                    //return (plan || {}).enterprise_plan || false;\n                    return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                })) || {};\n                defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                isValid = utils.matchObjects(res.body.output.plan[0], defaultPlan);\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b8502b5-eb3d-486b-95f3-0fa36d44b321&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should get default attributes.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                isValid = utils.isHaveKeyVals(res.body.output, [\n                        \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                        \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                    ]) &amp;&amp;\n                    res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                    moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                    moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5ce7914-a967-4e6f-8185-16f8b96ab165&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should get default user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.user_plan.should.exist;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;718b4237-b5aa-4ba0-b1a6-5f46c8ba67b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login with enterprise account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should login with enterprise account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.user_type.should.equal(config.service_types.enterprise.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54addbe2-140c-465b-b659-323d3c8122bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get different authtoken on re-login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should get different authtoken on re-login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:152,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var firstAuthToken = res.body.output.authtoken;\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var secondAuthToken = res.body.output.authtoken;\n                        firstAuthToken.should.not.equal(secondAuthToken);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f3d130b-7bf1-45ca-aac1-e56ff06472e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create account if express user exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should create account if express user exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2927,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempLoginBody = global.getImmutable(loginBody);\n            tempLoginBody.email = tempRegistrationBody.email;\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempLoginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.email.should.equal(tempLoginBody.email);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46414fce-da06-404b-9781-bc91be0b5784&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create activated account if express account is already created.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should create activated account if express account is already created.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2176,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email\n});\nvar newSignupUid = \&quot;\&quot;;\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            newSignupUid = res.body.output.uid;\n            _models.User.findOneAndUpdate({\n                uid: newSignupUid\n            }, {\n                active: true\n            }, { new: true }, function(error, user) {\n                var tempLoginBody = global.getImmutable(loginBody);\n                tempLoginBody.email = tempRegistrationBody.email;\n                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send(tempLoginBody)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            (res.body.output.email == tempLoginBody.email &amp;&amp;\n                                res.body.output.active).should.equal(true);\n                            done();\n                        }\n                    });\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5bc6104b-faa2-4276-8819-c245e8aa31d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login after three fail attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should login after three fail attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:304,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    tempBody.password = \&quot;Raw@1234\&quot;;\n                                    tempBody.captcha_code = \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;;\n                                    commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.output.email.should.equal(loginBody.email);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ed421b3-8de7-428a-80a4-1317f8ca1ac9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give captcha verification fail error for valid credential.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should give captcha verification fail error for valid credential.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:292,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar loginCount = [];\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            loginCount.push(res.body.error.failed_login_count);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        loginCount.push(res.body.error.failed_login_count);\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    loginCount.push(res.body.error.failed_login_count);\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    tempBody.password = \&quot;Raw@1234\&quot;;\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                loginCount.push(res.body.error.failed_login_count);\n                                                var isValid = res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED &amp;&amp;\n                                                    loginCount[0] == 1 &amp;&amp;\n                                                    loginCount[1] == 2 &amp;&amp;\n                                                    loginCount[2] == 3 &amp;&amp;\n                                                    loginCount[3] == 4;\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7b2ba41-d336-4f97-bfa8-82c65b018d8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give captcha verification fail error for invalid credential.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should give captcha verification fail error for invalid credential.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:293,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    tempBody.password = \&quot;abc123\&quot;;\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.error.message.should.equal(messageList.USER_LOGIN_CAPTCHA_REQUIRED);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88fc608e-bef2-442e-87c1-ddcc73821354&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give invalid credential error if captcha is provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should give invalid credential error if captcha is provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:374,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                tempBody.captcha_code = \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;;\n                                                commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                api.post(apiURL)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            res.body.error.message.should.equal(messageList.USER_LOGIN_INVALID_CREDENTIAL);\n                                                            done();\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;863f2e37-97e6-4c87-b527-ceab5bc8ffc3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should lock user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should lock user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:442,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\nvar loginCount = [];\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                loginCount.push(res.body.error.failed_login_count);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                            loginCount.push(res.body.error.failed_login_count);\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                        loginCount.push(res.body.error.failed_login_count);\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                    loginCount.push(res.body.error.failed_login_count);\n                                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                api.post(apiURL)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                                loginCount.push(res.body.error.failed_login_count);\n                                                            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                            api.post(apiURL)\n                                                                .send(tempBody)\n                                                                .expect(httpStatus.UNAUTHORIZED)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        if (res.body.error.message == messageList.ENTERPRISE_USER_LOGIN_ACCOUNT_LOCK)\n                                                                            loginCount.push(res.body.error.failed_login_count);\n                                                                        var isValid = loginCount[0] == 1 &amp;&amp;\n                                                                            loginCount[1] == 2 &amp;&amp;\n                                                                            loginCount[2] == 3 &amp;&amp;\n                                                                            loginCount[3] == 4 &amp;&amp;\n                                                                            loginCount[4] == 5 &amp;&amp;\n                                                                            loginCount[5] == 6;\n                                                                        isValid.should.equal(true);\n                                                                        done();\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3f0e741-cbb3-4ee6-8d67-903778a814c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login after five fail login attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should allowed to login after five fail login attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:449,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\nvar loginCount = [];\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                loginCount.push(res.body.error.failed_login_count);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                            loginCount.push(res.body.error.failed_login_count);\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                        loginCount.push(res.body.error.failed_login_count);\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                    loginCount.push(res.body.error.failed_login_count);\n                                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                api.post(apiURL)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                                loginCount.push(res.body.error.failed_login_count);\n\n                                                            tempBody.captcha_code = \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;;\n                                                            tempBody.password = \&quot;Raw@1234\&quot;;\n                                                            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                            commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                                            api.post(apiURL)\n                                                                .send(tempBody)\n                                                                .expect(httpStatus.OK)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        var isValid = res.body.output.email == tempBody.email &amp;&amp;\n                                                                            loginCount[0] == 1 &amp;&amp;\n                                                                            loginCount[1] == 2 &amp;&amp;\n                                                                            loginCount[2] == 3 &amp;&amp;\n                                                                            loginCount[3] == 4 &amp;&amp;\n                                                                            loginCount[4] == 5;\n                                                                        isValid.should.equal(true);\n                                                                        done();\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bca5371a-cfb9-4081-b39b-670f6e0a4bc4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login after four fail login attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should allowed to login after four fail login attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:374,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(loginBody);\ntempBody.password = \&quot;abc123\&quot;;\nvar loginCount = [];\ncommonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(tempBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                loginCount.push(res.body.error.failed_login_count);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                            loginCount.push(res.body.error.failed_login_count);\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                        loginCount.push(res.body.error.failed_login_count);\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                    loginCount.push(res.body.error.failed_login_count);\n                                                tempBody.captcha_code = \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;;\n                                                tempBody.password = \&quot;Raw@1234\&quot;;\n                                                commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                api.post(apiURL)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            var isValid = res.body.output.email == tempBody.email &amp;&amp;\n                                                                loginCount[0] == 1 &amp;&amp;\n                                                                loginCount[1] == 2 &amp;&amp;\n                                                                loginCount[2] == 3 &amp;&amp;\n                                                                loginCount[3] == 4\n                                                            isValid.should.equal(true);\n                                                            done();\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6ca40fc1-7e92-4559-a879-602ef50cc2a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login witout 2FA if express account is verified for 2FA.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should allowed to login witout 2FA if express account is verified for 2FA.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4833,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var loginBody2 = global.getImmutable(loginBody);\n            loginBody2.email = \&quot;test.user+1@raweng.com\&quot;;\n            commonMock.flowLogin(httpmock, \&quot;express\&quot;);\n            api.post(\&quot;/express/v1/login\&quot;)\n                .send(loginBody2)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var expressAuthToken = res.body.output.authtoken;\n                        //var tempRegistrationBody = global.getImmutable(registrationBody);\n                        tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n                        tempRegistrationBody.country_code = \&quot;91\&quot;;\n                        delete tempRegistrationBody.password;\n                        commonMock.authyNumberChange(httpmock, \&quot;express\&quot;);\n                        commonMock.authyDelete(httpmock, \&quot;express\&quot;);\n                        api.put(\&quot;/express/v1/user\&quot;)\n                            .send(tempRegistrationBody)\n                            .set(&#x27;authtoken&#x27;, expressAuthToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var authy_userId = res.body.output.authy_user_uid;\n                                    commonMock.authySMSVerification(httpmock, \&quot;express\&quot;);\n                                    api.post(\&quot;/express/v1/authy/sms\&quot;)\n                                        .send({\n                                            authy_id: authy_userId\n                                        })\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                commonMock.authyAppTokenVerification(httpmock, \&quot;express\&quot;);\n                                                api.post(\&quot;/express/v1/authy/verifyotp\&quot;)\n                                                    .send({\n                                                        authy_user_uid: authy_userId,\n                                                        token: otpBody.token,\n                                                        option_selected: \&quot;otp\&quot;\n                                                    })\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            commonMock.authyAppTokenVerification(httpmock, \&quot;express\&quot;);\n                                                            api.post(\&quot;/express/v1/authy/verify\&quot;)\n                                                                .send({\n                                                                    authy_user_uid: authy_userId,\n                                                                    token: otpBody.token\n                                                                })\n                                                                .expect(httpStatus.OK)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                                                                            email: tempRegistrationBody.email\n                                                                        });\n                                                                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                                        api.post(apiURL)\n                                                                            .send(loginBody2)\n                                                                            .expect(httpStatus.OK)\n                                                                            .end(function(err, res) {\n                                                                                if (err) {\n                                                                                    done(err);\n                                                                                } else {\n                                                                                    var isValid = res.body.output.email == loginBody2.email &amp;&amp;\n                                                                                        res.body.output.active == false &amp;&amp;\n                                                                                        typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                        typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                                                                    isValid.should.equal(true);\n                                                                                    done();\n                                                                                }\n                                                                            });\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8254b72e-e30e-4919-9ae9-23474432ea0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login user if two-factor is enabled but not verified.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should login user if two-factor is enabled but not verified.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:98,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.email.should.equal(tempRegistrationBody.email);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3a4dc59-9bac-4d72-a807-e5c0d87e99c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not login user if two-factor is verified.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should not login user if two-factor is verified.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:113,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send(loginBody)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = res.body.output.authy_user_uid == authy_userId &amp;&amp;\n                                                    res.body.output.is_sms_enabled &amp;&amp;\n                                                    res.body.output.is_two_fa_verified &amp;&amp;\n                                                    res.body.output.user_uid != \&quot;\&quot;;\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83c7497d-9f5a-40e5-b6e1-732c7e70570c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not login user if two-factor is verified and user activation is expired.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Login Should not login user if two-factor is verified and user activation is expired.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:117,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    _models.User.findOneAndUpdate({\n                                        uid: uid\n                                    }, {\n                                        activation_expired: true,\n                                        active: false\n                                    }, function(error, result) {\n                                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                        api.post(apiURL)\n                                            .send(loginBody)\n                                            .expect(httpStatus.UNAUTHORIZED)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    res.body.error.message.should.equal(messageList.USER_LOGIN_ACTIVATION_REQUIRED_ERROR);\n                                                    done();\n                                                }\n                                            });\n                                    });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dce04ed2-bfc4-4829-950f-09a26bdac969&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e0d458b0-930f-42e9-abb9-606c8d7a2a11&quot;,&quot;591844df-072f-4886-a78e-954a30d95e98&quot;,&quot;7e922837-94a0-48b9-aa95-9169657ba44f&quot;,&quot;198a693c-af61-4937-bd9f-034b4d77cb43&quot;,&quot;833580be-37c1-4a37-bdad-bbf776a41d25&quot;,&quot;1f7b581d-1044-4601-bfb1-b655d245ba84&quot;,&quot;cc70781c-c4d9-494f-9901-d18b89e07055&quot;,&quot;9221e5c7-3c72-4a55-b28a-9360452fe2fd&quot;,&quot;8b8502b5-eb3d-486b-95f3-0fa36d44b321&quot;,&quot;a5ce7914-a967-4e6f-8185-16f8b96ab165&quot;,&quot;718b4237-b5aa-4ba0-b1a6-5f46c8ba67b3&quot;,&quot;54addbe2-140c-465b-b659-323d3c8122bd&quot;,&quot;6f3d130b-7bf1-45ca-aac1-e56ff06472e1&quot;,&quot;46414fce-da06-404b-9781-bc91be0b5784&quot;,&quot;5bc6104b-faa2-4276-8819-c245e8aa31d5&quot;,&quot;4ed421b3-8de7-428a-80a4-1317f8ca1ac9&quot;,&quot;e7b2ba41-d336-4f97-bfa8-82c65b018d8f&quot;,&quot;88fc608e-bef2-442e-87c1-ddcc73821354&quot;,&quot;863f2e37-97e6-4c87-b527-ceab5bc8ffc3&quot;,&quot;d3f0e741-cbb3-4ee6-8d67-903778a814c0&quot;,&quot;bca5371a-cfb9-4081-b39b-670f6e0a4bc4&quot;,&quot;6ca40fc1-7e92-4559-a879-602ef50cc2a4&quot;,&quot;8254b72e-e30e-4919-9ae9-23474432ea0a&quot;,&quot;c3a4dc59-9bac-4d72-a807-e5c0d87e99c5&quot;,&quot;83c7497d-9f5a-40e5-b6e1-732c7e70570c&quot;,&quot;dce04ed2-bfc4-4829-950f-09a26bdac969&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13796,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;de0cfa6f-0605-448b-b804-15ba6bfc484d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c2e1a6cd-08e6-4f06-96df-fcc1722b4709&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3f786a95-c164-40be-bf81-f0c265a6a2cd&quot;,&quot;title&quot;:&quot;User.LoginGoogle&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\loginWithGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({}, function(error, user) {\n    _models.Mail.remove({}, function(error, user) {\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b3fe796-ccd6-4a0a-983e-d94c680cb79b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7b8782fb-4dfd-40ca-94e4-5e137f45ba26&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should allowed to login into gmail account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should allowed to login into gmail account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.email == registrationBody.email &amp;&amp; res.body.output.active;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;654058d6-d511-4714-9bb8-9def71a86608&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give same plan on login with google account for already register enterprise account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should give same plan on login with google account for already register enterprise account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:140,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var user_uid = res.body.output.uid;\n            var authtoken = res.body.output.authtoken;\n            var plan_uid = res.body.output.plan[0].uid;\n            _models.Plan.find({\n                deleted_at: null,\n                plan_type: \&quot;enterprise\&quot;,\n                default: false\n            }, function(error, plans) {\n                if (err) {\n                    done(err);\n                } else {\n                    var plan = plans[0];\n                    _models.User.findOneAndUpdate({\n                        uid: user_uid\n                    }, {\n                        plan: [plan._id]\n                    }, { new: true }, function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else {\n                            api.get(\&quot;/enterprise/v1/user\&quot;)\n                                .set({\n                                    authtoken: authtoken\n                                })\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                                        commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n                                        api.post(apiURL)\n                                            .send(loginBody)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = res.body.output.email ==\n                                                        registrationBody.email &amp;&amp;\n                                                        res.body.output.plan[0].uid == plan.uid &amp;&amp;\n                                                        res.body.output.active;\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                        }\n                    });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c61e7199-fe6b-42d4-b9e8-8803decb1dd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login into existing account register with same email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should login into existing account register with same email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:119,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid = res.body.output.email == registrationBody.email &amp;&amp;\n                            res.body.output.active == true;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16a71082-929b-4268-a4bb-e04da33dd951&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create another record if existing deleted login record available&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should create another record if existing deleted login record available&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:184,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var uid = res.body.output.uid || \&quot;\&quot;;\n            _models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n                deleted_at: new Date()\n            }, { new: true }, function(err, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n                    commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n                    api.post(apiURL)\n                        .send(loginBody)\n                        .expect(httpStatus.OK)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                _models.User.find({ \&quot;email\&quot;: registrationBody.email }, function(err, users) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        var isValid = users.length == 2;\n                                        isValid.should.equal(true);\n                                        done();\n                                    }\n                                });\n                            }\n                        });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;89818140-b81d-4ca0-8a0f-4395c5cca28a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should get default plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                    //return (plan || {}).express_plan || false;\n                    return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                })) || {};\n                defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9b3d07e-4089-4e1f-a50b-45687e37ef29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should get default attributes.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (res.body.output.plan.length == 1) {\n                isValid = utils.isHaveKeyVals(res.body.output, [\n                        \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                        \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                    ]) &amp;&amp;\n                    res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                    moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                    moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;514baed3-1e4d-4f3b-aa62-d3de9c6efcdf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should get default user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.user_plan.should.exist;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fa61f5b1-d82f-436f-8264-5f79b8f6190b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should login with enterprise account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should login with enterprise account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.user_type.should.equal(config.service_types.enterprise.name);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec49f279-4068-422c-ab1c-e15922783a80&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get different authtoken on re-login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should get different authtoken on re-login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:118,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send(loginBody)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var firstAuthToken = res.body.output.authtoken;\n            commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var secondAuthToken = res.body.output.authtoken;\n                        firstAuthToken.should.not.equal(secondAuthToken);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8aeda75-8abf-46f7-9370-25a1b3e7f75a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create account with enterprise details, if express user exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should create account with enterprise details, if express user exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4687,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email,\n    access_token: plus1User.access_token\n});\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                email: tempRegistrationBody.email,\n                access_token: plus1User.access_token\n            });\n            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n                email: tempRegistrationBody.email,\n                access_token: plus1User.access_token\n            });\n            api.post(apiURL)\n                .send(plus1User)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.email.should.equal(tempRegistrationBody.email);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ccc670b9-67ba-47a7-95f3-98fe56d8f344&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create account with enterprise details, if one active and one deleted express user exists.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should create account with enterprise details, if one active and one deleted express user exists.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5769,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(\&quot;/express/v1/signup\&quot;)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var user_uid = res.body.output.uid;\n            _models.User.findOneAndUpdate({ \&quot;uid\&quot;: user_uid }, {\n                \&quot;deleted_at\&quot;: new Date()\n            }, { new: true }, function(error, result) {\n                if (error) {\n                    done(error);\n                } else {\n                    commonMock.setSignUpMocks(httpmock, \&quot;express\&quot;, {\n                        email: tempRegistrationBody.email\n                    });\n                    api.post(\&quot;/express/v1/signup\&quot;)\n                        .send(tempRegistrationBody)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var user_uid = res.body.output.uid;\n                                commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                                    email: tempRegistrationBody.email\n                                });\n                                commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n                                    email: tempRegistrationBody.email\n                                });\n                                api.post(apiURL)\n                                    .send(plus1User)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            res.body.output.email.should.equal(tempRegistrationBody.email);\n                                            done();\n                                        }\n                                    });\n                            }\n                        });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9c71d59b-2540-4035-9e81-4fb89266d44b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should register user if email dosen&#x27;t register with any service.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should register user if email dosen&#x27;t register with any service.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: tempRegistrationBody.email\n});\ncommonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n    email: tempRegistrationBody.email\n});\napi.post(apiURL)\n    .send(plus1User)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.email.should.equal(tempRegistrationBody.email);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e38fd7c-f00d-4f7c-8b46-edab4e430bae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login with lock user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should allowed to login with lock user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:802,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempBody = getImmutable(registrationBody);\ntempBody.email = \&quot;test.user+1@raweng.com\&quot;;\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: tempBody.email\n});\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(tempBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var curDate = new Date();\n            _models.User.findOneAndUpdate({\n                uid: res.body.output.uid\n            }, {\n                deleted_at: curDate\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                        email: tempBody.email\n                    });\n                    api.post(\&quot;/enterprise/v1/signup\&quot;)\n                        .send(tempBody)\n                        .expect(httpStatus.CREATED)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var tempBody2 = getImmutable(loginBody);\n                                tempBody2.email = tempBody.email;\n                                tempBody2.password = \&quot;abc123\&quot;;\n                                var loginCount = [];\n                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                api.post(\&quot;/enterprise/v1/login\&quot;)\n                                    .send(tempBody2)\n                                    .expect(httpStatus.UNAUTHORIZED)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                                loginCount.push(res.body.error.failed_login_count);\n                                            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                            api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                .send(tempBody2)\n                                                .expect(httpStatus.UNAUTHORIZED)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                                            loginCount.push(res.body.error.failed_login_count);\n                                                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                            .send(tempBody2)\n                                                            .expect(httpStatus.UNAUTHORIZED)\n                                                            .end(function(err, res) {\n                                                                if (err) {\n                                                                    done(err);\n                                                                } else {\n                                                                    if (res.body.error.message == messageList.USER_LOGIN_INVALID_CREDENTIAL)\n                                                                        loginCount.push(res.body.error.failed_login_count);\n                                                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                                        .send(tempBody2)\n                                                                        .expect(httpStatus.UNAUTHORIZED)\n                                                                        .end(function(err, res) {\n                                                                            if (err) {\n                                                                                done(err);\n                                                                            } else {\n                                                                                if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                                                    loginCount.push(res.body.error.failed_login_count);\n                                                                                commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                                                api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                                                    .send(tempBody2)\n                                                                                    .expect(httpStatus.UNAUTHORIZED)\n                                                                                    .end(function(err, res) {\n                                                                                        if (err) {\n                                                                                            done(err);\n                                                                                        } else {\n                                                                                            if (res.body.error.message == messageList.USER_LOGIN_CAPTCHA_REQUIRED)\n                                                                                                loginCount.push(res.body.error.failed_login_count);\n                                                                                            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                                                                            api.post(\&quot;/enterprise/v1/login\&quot;)\n                                                                                                .send(tempBody2)\n                                                                                                .expect(httpStatus.UNAUTHORIZED)\n                                                                                                .end(function(err, res) {\n                                                                                                    if (err) {\n                                                                                                        done(err);\n                                                                                                    } else {\n                                                                                                        if (res.body.error.message == messageList.ENTERPRISE_USER_LOGIN_ACCOUNT_LOCK)\n                                                                                                            loginCount.push(res.body.error.failed_login_count);\n                                                                                                        var isValid = loginCount[0] == 1 &amp;&amp;\n                                                                                                            loginCount[1] == 2 &amp;&amp;\n                                                                                                            loginCount[2] == 3 &amp;&amp;\n                                                                                                            loginCount[3] == 4 &amp;&amp;\n                                                                                                            loginCount[4] == 5 &amp;&amp;\n                                                                                                            loginCount[5] == 6;\n                                                                                                        if (isValid) {\n                                                                                                            api.get(\&quot;/enterprise/v1/status?email=\&quot; + tempBody2.email)\n                                                                                                                .expect(httpStatus.OK)\n                                                                                                                .end(function(err, res) {\n                                                                                                                    if (err) {\n                                                                                                                        done(err);\n                                                                                                                    } else {\n                                                                                                                        if (res.body.output.block &amp;&amp; res.body.output.show_captcha) {\n                                                                                                                            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                                                                                                                                email: tempBody2.email\n                                                                                                                            });\n                                                                                                                            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;, {\n                                                                                                                                email: tempBody2.email\n                                                                                                                            });\n                                                                                                                            api.post(apiURL)\n                                                                                                                                .send(tempBody2)\n                                                                                                                                .expect(httpStatus.OK)\n                                                                                                                                .end(function(err, res) {\n                                                                                                                                    if (err) {\n                                                                                                                                        done(err);\n                                                                                                                                    } else {\n                                                                                                                                        var isValid = res.body.output.email == tempBody2.email &amp;&amp; res.body.output.active;\n                                                                                                                                        isValid.should.equal(true);\n                                                                                                                                        done();\n                                                                                                                                    }\n                                                                                                                                });\n                                                                                                                        } else {\n                                                                                                                            false.should.equal(true);\n                                                                                                                        }\n                                                                                                                    }\n                                                                                                                });\n                                                                                                        } else {\n                                                                                                            false.should.equal(true);\n                                                                                                        }\n                                                                                                    }\n                                                                                                });\n                                                                                        }\n                                                                                    });\n                                                                            }\n                                                                        });\n                                                                }\n                                                            });\n                                                    }\n                                                });\n                                        }\n                                    });\n                            }\n                        });\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;038b1343-92df-4b60-8132-74b29b16428f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to login with captcha, after three fail attempts.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should allowed to login with captcha, after three fail attempts.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:361,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempBody = getImmutable(loginBody);\n            tempBody.email = registrationBody.email;\n            tempBody.password = \&quot;abc123\&quot;;\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                                                commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n                                                commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                                tempBody.password = \&quot;Raw@1234\&quot;;\n                                                tempBody.captcha_code = \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;;\n                                                api.post(apiURL)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            registrationBody.email.should.equal(res.body.output.email);\n                                                            done();\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8166af39-ffb8-4db7-a838-cc04fcc7caa6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not required captcha for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.LoginGoogle Should not required captcha for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:366,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\napi.post(\&quot;/enterprise/v1/signup\&quot;)\n    .send(registrationBody)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var tempBody = getImmutable(loginBody);\n            tempBody.email = registrationBody.email;\n            tempBody.password = \&quot;abc123\&quot;;\n            commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/login\&quot;)\n                .send(tempBody)\n                .expect(httpStatus.UNAUTHORIZED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/login\&quot;)\n                            .send(tempBody)\n                            .expect(httpStatus.UNAUTHORIZED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.flowLogin(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/login\&quot;)\n                                        .send(tempBody)\n                                        .expect(httpStatus.UNAUTHORIZED)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                tempBody.password = registrationBody.password;\n                                                api.get(\&quot;/enterprise/v1/status?email=\&quot; + tempBody.email)\n                                                    .send(tempBody)\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            if (res.body.output.block == false &amp;&amp; res.body.output.show_captcha) {\n                                                                commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n                                                                commonMock.brainTreeFailClientToken(httpmock, \&quot;enterprise\&quot;);\n                                                                api.post(apiURL)\n                                                                    .send(tempBody)\n                                                                    .expect(httpStatus.OK)\n                                                                    .end(function(err, res) {\n                                                                        if (err) {\n                                                                            done(err);\n                                                                        } else {\n                                                                            var isValid = res.body.output.email == registrationBody.email &amp;&amp; res.body.output.active;\n                                                                            isValid.should.equal(true);\n                                                                            done();\n                                                                        }\n                                                                    });\n                                                            } else {\n                                                                false.should.equal(true);\n                                                            }\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df0bdcd5-5ef3-460d-ad9c-170e9bfb6f9a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;654058d6-d511-4714-9bb8-9def71a86608&quot;,&quot;c61e7199-fe6b-42d4-b9e8-8803decb1dd4&quot;,&quot;16a71082-929b-4268-a4bb-e04da33dd951&quot;,&quot;89818140-b81d-4ca0-8a0f-4395c5cca28a&quot;,&quot;e9b3d07e-4089-4e1f-a50b-45687e37ef29&quot;,&quot;514baed3-1e4d-4f3b-aa62-d3de9c6efcdf&quot;,&quot;fa61f5b1-d82f-436f-8264-5f79b8f6190b&quot;,&quot;ec49f279-4068-422c-ab1c-e15922783a80&quot;,&quot;e8aeda75-8abf-46f7-9370-25a1b3e7f75a&quot;,&quot;ccc670b9-67ba-47a7-95f3-98fe56d8f344&quot;,&quot;9c71d59b-2540-4035-9e81-4fb89266d44b&quot;,&quot;4e38fd7c-f00d-4f7c-8b46-edab4e430bae&quot;,&quot;038b1343-92df-4b60-8132-74b29b16428f&quot;,&quot;8166af39-ffb8-4db7-a838-cc04fcc7caa6&quot;,&quot;df0bdcd5-5ef3-460d-ad9c-170e9bfb6f9a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13099,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;927cb6d0-ffe8-4249-bc77-7c821666a9a3&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c858bb1b-8ecc-4e32-9cf9-29b5e9ecdd8d&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a4e0a96c-bceb-4cb9-82ba-90ebd426ea23&quot;,&quot;title&quot;:&quot;User.Logout&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\logout.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({}, function(error, user) {\n    _models.Mail.remove({}, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    userObj = res.body.output\n                    authToken = userObj.authtoken;\n                    _id = userObj._id;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e32e370b-9427-4818-9fa4-51a59c34411d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b17a2992-f1c9-42ab-867c-4a08ecaeb1dd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;User should get logout.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout User should get logout.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.LOGOUT_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ef9dcf3-a03c-4e2a-a843-426881266e45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;User should get logout with get route.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout User should get logout with get route.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.LOGOUT_SUCCESS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21851aa5-c897-4742-858f-ae1250b5edc4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;User should get logout even if his account is suspend.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout User should get logout even if his account is suspend.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar query = _models.User.findOneAndUpdate({ uid: userObj.uid }, { force_suspend: true }, { new: true })\nquery.lean().exec(function(err, user) {\n    if (err) {\n        done(err);\n    } else {\n        api.post(apiURL)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    res.body.output.message.should.equal(messageList.LOGOUT_SUCCESS);\n                    done();\n                }\n            });\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cea50d2b-0ef1-4f59-af5f-4c8aee3b531a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;User authtoken should get remove from user collection.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout User authtoken should get remove from user collection.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({ _id: _id }, function(err, user) {\n                if (err) {\n                    done(err);\n                } else {\n                    (((user || {})[\&quot;_doc\&quot;] || {}).authtoken || []).length.should.equal(0);\n                    done();\n                }\n            });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98de3f15-1aaf-4f57-b7bf-b3e4af0ba5d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.Logout Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;99b3ff56-7df2-4be2-aeed-1d7688aee4c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5ef9dcf3-a03c-4e2a-a843-426881266e45&quot;,&quot;21851aa5-c897-4742-858f-ae1250b5edc4&quot;,&quot;cea50d2b-0ef1-4f59-af5f-4c8aee3b531a&quot;,&quot;98de3f15-1aaf-4f57-b7bf-b3e4af0ba5d6&quot;,&quot;99b3ff56-7df2-4be2-aeed-1d7688aee4c6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:62,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3a2f4e13-9206-4164-9612-0643f1000978&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;46f4236f-3d23-4e02-b461-fd30c74033ef&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e23533cc-1e22-47d5-a068-0ffa179465d1&quot;,&quot;title&quot;:&quot;User.processSSOLogin&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\processSSOLogin.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;053ca1f4-5591-45c7-bb5d-c8706e730117&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a33e1167-2c0a-4632-9ac9-5869472d175e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should login with SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should login with SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1567,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncreateSSOProvider({\n}, function(error, ssoProvider) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var data = getImmutable(usersData.SMALRespWithoutAuthtoken);\n                    delete data.RelayState;\n                    api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                        .send(data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                var _config = config;\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set({ &#x27;authtoken&#x27;: authtoken })\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                res.body.output.plan[0].name.indexOf(\&quot;Trial\&quot;) &gt; -1;\n                                            isValid.should.equal(true);\n                                            done();\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3fc1f9e6-5512-48e0-b4bd-8b750b950a09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should do login with SSO re-login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should do login with SSO re-login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1905,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncreateSSOProvider({\n}, function(error, ssoProvider) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    doSSOLogin({\n                        done: done\n                    }, function() {\n                        doSSOLogin({\n                            done: done,\n                            email: \&quot;Amber.More@raweng.com\&quot;\n                        }, function() {\n                            true.should.equal(true);\n                            done();\n                        });\n                    });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d776fcc3-2289-43a1-ac39-826b1113ad21&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get specific plan to user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should get specific plan to user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3463,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncreateSSOProvider({\n    plan: \&quot;fl4d44d77af613ae44845883\&quot;\n}, function(error, ssoProvider) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var data = getImmutable(usersData.SMALRespWithoutAuthtoken);\n                    delete data.RelayState;\n                    api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                        .send(data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                var _config = config;\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set({ &#x27;authtoken&#x27;: authtoken })\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                res.body.output.plan[0].name.indexOf(\&quot;Light Plan\&quot;) != -1;\n                                            isValid.should.equal(true);\n                                            done();\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80191911-e098-40ee-b9ce-9f8d1604dd4b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get metadata xml.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should get metadata xml.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// sso.getMetadata\nthis.timeout(apiTimeOut);\ncreateSSOProvider({\n}, function(error, ssoProvider) {\n    api.get(\&quot;/enterprise/v1/sso/metadata/raweng\&quot;)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.text.toString().startsWith(\&quot;&lt;?xml\&quot;).should.equal(true);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37c3e172-1537-4504-aa25-b5ccfc514cd2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should overwrite user session management timeout.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should overwrite user session management timeout.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2850,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncreateSSOProvider({\n}, function(error, ssoProvider) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var data = usersData.SMALRespWithoutAuthtoken;\n                    api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                        .send(data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                var date = moment(new Date());\n                                date.subtract({ hours: 4, minutes: 5 });\n                                _models.UserToken.findOneAndUpdate({\n                                    authtoken: authtoken\n                                }, {\n                                    idle_valid_till: date\n                                }, {\n                                    new: true\n                                }, function(error, user) {\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a94e8fa-f7c2-4701-b7d3-5fae03757b9a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should do test login without enabling SSO.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should do test login without enabling SSO.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:139,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar email = \&quot;amber.more@raweng.com\&quot;;\ncreateSSOProvider({\n    enable_sso: false\n}, function(error, ssoProvider) {\n    signUpUser({\n        email: email\n    }, function(res) {\n        var newUserAuthtoken = res.body.output.authtoken;\n        api.get(\&quot;/enterprise/v1/login/raweng?test=true\&quot;)\n            .expect(httpStatus.MOVED_TEMPORARILY)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                        var qs = querystring.parse(res.headers.location);\n                        var data = usersData.SMALRespWithoutAuthtoken;\n                        data.RelayState = qs.RelayState;\n                        api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                            .send(data)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var qs = querystring.parse(res.headers.location);\n                                    var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success_test + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e85a53c2-d28b-470a-9865-5d43e79e713c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should use same token for secondtime login if validtill satisfies.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should use same token for secondtime login if validtill satisfies.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1404,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar SSOLogin = function(sso_data, cb) {\n    var authtoken = \&quot;\&quot;;\n    var ssoLogin = \&quot;/enterprise/v1/login/raweng\&quot;;\n    if (sso_data.RelayState) {\n        authtoken = sso_data.authtoken || \&quot;\&quot;;\n        ssoLogin += \&quot;?sid=\&quot; + authtoken\n    }\n    api.get(ssoLogin)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var qs = querystring.parse(res.headers.location);\n                    var rs = utils.getRelayState({\n                        body: {\n                            RelayState: qs.RelayState\n                        }\n                    });\n                    if ((rs.authtoken || \&quot;\&quot;) == authtoken) {\n                        sso_data.RelayState = encryption.encryptSync(JSON.stringify({\n                            a: authtoken,\n                            t: false\n                        }), encryption.getKeySync());\n                        api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                            .send(sso_data)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var qs = querystring.parse(res.headers.location);\n                                    var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                    typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                                if (isValid) {\n                                                    cb(isValid, authtoken);\n                                                } else {\n                                                    false.should.equal(true);\n                                                    done();\n                                                }\n                                            }\n                                        });\n                                }\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\ncreateSSOProvider({}, function(error, ssoProvider) {\n    var data = usersData.SMALRespWithoutAuthtoken;\n    SSOLogin(data, function(isValid, authtoken) {\n        var firstToken = authtoken;\n        data.RelayState = encryption.encryptSync(JSON.stringify({\n            a: authtoken\n        }), encryption.encryptSync());\n        data.authtoken = authtoken;\n        SSOLogin(data, function(isValid, authtoken) {\n            var secondToken = authtoken;\n            if (firstToken == secondToken) {\n                _models.UserToken.find({}, function(error, tokens) {\n                    (tokens.length == 1).should.equal(true);\n                    done();\n                });\n            } else {\n                false.should.equal(true);\n                done();\n            }\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5df1ed6c-46d5-4864-a806-56e9f83de5aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not do SSO login if SSO is disabled.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should not do SSO login if SSO is disabled.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar email = \&quot;amber.more@raweng.com\&quot;;\nvar loginWithSSO = function(status, callback) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(\&quot;error\&quot;) &gt; -1) {\n                    var qs = querystring.parse(res.headers.location);\n                    var error = qs[\&quot;error\&quot;] || qs[sso_urls.error + \&quot;?error\&quot;] || \&quot;\&quot;;\n                    callback(error, null);\n                } else {\n                    if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                        var data = usersData.SMALRespWithoutAuthtoken;\n                        api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                            .send(data)\n                            .expect(httpStatus.MOVED_TEMPORARILY)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var qs = querystring.parse(res.headers.location);\n                                    var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                    api.get(\&quot;/enterprise/v1/user\&quot;)\n                                        .set(&#x27;authtoken&#x27;, authtoken)\n                                        .expect(status)\n                                        .end(callback);\n                                }\n                            });\n                    } else {\n                        true.should.equal(false);\n                        done();\n                    }\n                }\n            }\n        });\n};\ncreateSSOProvider({\n    enable_sso: false\n}, function(error, ssoProvider) {\n    signUpUser({\n        email: email\n    }, function(res) {\n        var newUserAuthtoken = res.body.output.authtoken;\n        loginWithSSO(httpStatus.BAD_REQUEST, function(err, res) {\n            err.should.equal(messageList.SSO_DISABLE);\n            done();\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;320cc50f-9e28-4c14-bbf4-7340ab7af922&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should logout all tokens.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.processSSOLogin Should logout all tokens.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2135,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar _ssoConfig = getImmutable(ssoConfig);\nvar last_authtoken = \&quot;\&quot;;\nvar SSOLogin = function(cb) {\n    api.get(\&quot;/enterprise/v1/login/raweng\&quot;)\n        .expect(httpStatus.MOVED_TEMPORARILY)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                if (res.headers.location.indexOf(ssoConfig.entry_point) == 0) {\n                    var data = usersData.SMALRespWithoutAuthtoken;\n                    api.post(\&quot;/enterprise/v1/login/raweng\&quot;)\n                        .send(data)\n                        .expect(httpStatus.MOVED_TEMPORARILY)\n                        .end(function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                var qs = querystring.parse(res.headers.location);\n                                var authtoken = qs[\&quot;sid\&quot;] || qs[sso_urls.success + \&quot;?sid\&quot;] || \&quot;\&quot;;\n                                api.get(\&quot;/enterprise/v1/user\&quot;)\n                                    .set(&#x27;authtoken&#x27;, authtoken)\n                                    .expect(httpStatus.OK)\n                                    .end(function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                                                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                            if (isValid) {\n                                                last_authtoken = authtoken;\n                                                cb(isValid);\n                                            } else {\n                                                false.should.equal(true);\n                                                done();\n                                            }\n                                        }\n                                    });\n                            }\n                        });\n                } else {\n                    true.should.equal(false);\n                    done();\n                }\n            }\n        });\n};\ncreateSSOProvider({}, function(error, ssoProvider) {\n    SSOLogin(function() {\n        _models.UserToken.update({}, {\n            valid_till: new Date(2001, 12, 1)\n        }, {\n            multi: true\n        }, function(error, tokens) {\n            SSOLogin(function() {\n                api.post(\&quot;/enterprise/v1/logout\&quot;)\n                    .set(&#x27;authtoken&#x27;, last_authtoken)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        _models.UserToken.find({ authtoken: last_authtoken }, function(error, tokens) {\n                            var is_valid = true;\n                            _.each(tokens, function(item) {\n                                is_valid = is_valid &amp;&amp; item.deleted_at != null;\n                            });\n                            is_valid.should.equal(true);\n                            done();\n                        });\n                    });\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9ae004cc-c63f-4ff1-8a4d-e8cfd723c5c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3fc1f9e6-5512-48e0-b4bd-8b750b950a09&quot;,&quot;d776fcc3-2289-43a1-ac39-826b1113ad21&quot;,&quot;80191911-e098-40ee-b9ce-9f8d1604dd4b&quot;,&quot;37c3e172-1537-4504-aa25-b5ccfc514cd2&quot;,&quot;7a94e8fa-f7c2-4701-b7d3-5fae03757b9a&quot;,&quot;e85a53c2-d28b-470a-9865-5d43e79e713c&quot;,&quot;5df1ed6c-46d5-4864-a806-56e9f83de5aa&quot;,&quot;320cc50f-9e28-4c14-bbf4-7340ab7af922&quot;,&quot;9ae004cc-c63f-4ff1-8a4d-e8cfd723c5c4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13566,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;543ff126-01c1-4948-b44a-de4a014b3b89&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;352dbf1a-1c60-4324-9800-075f287baff8&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c773983a-a00a-4a01-8f2e-6e47d849c99e&quot;,&quot;title&quot;:&quot;User.projectsworkflows&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\projectsworkflows.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:598,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        api.get(\&quot;/enterprise/v1/user\&quot;)\n            .set(&#x27;org_uid&#x27;, org_uid)\n            .set(&#x27;authtoken&#x27;, authToken)\n            .expect(httpStatus.OK)\n            .end(function(err, res) {\n                env_uid = res.body.output.env_uid;\n                saveBillEntries({\n                    user_uid: user_uid,\n                    authtoken: authToken,\n                    email: data.owner.email\n                }, function(error, billEntries) {\n                    if (error) {\n                        done(error);\n                    } else {\n                        _billEntries = billEntries;\n                        saveUserStreamEntries({\n                            user_uid: user_uid,\n                            authtoken: authToken,\n                            email: data.owner.email\n                        }, function(error, userStreamEntries) {\n                            if (error) {\n                                done(error);\n                            } else {\n                                _userStreamEntries = userStreamEntries;\n                                done();\n                            }\n                        });\n                    }\n                });\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;53ed6ce8-2414-43e2-a98d-de37db444f37&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveEntries(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9edeaab-4f52-40f6-ae05-9e641b008564&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get distinct list of flow names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows Should get distinct list of flow names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.flows) &amp;&amp;\n                Array.isArray(res.body.output.projects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5de8cb7d-f29a-46e0-8556-11015724609d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of flow based on projects.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows Should get distinct list of flow based on projects.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.flows) &amp;&amp;\n                Array.isArray(res.body.output.projects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;26b6c3f6-044e-4094-9bb6-4294abab93a0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get distinct list of projects names in user stream.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows Should get distinct list of projects names in user stream.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = Array.isArray(res.body.output.flows) &amp;&amp;\n                Array.isArray(res.body.output.projects);\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f2abd88-1ed1-4e04-94ec-476c622347dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.projectsworkflows Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bbc65387-f074-4f98-9095-f44a9b163e82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5de8cb7d-f29a-46e0-8556-11015724609d&quot;,&quot;26b6c3f6-044e-4094-9bb6-4294abab93a0&quot;,&quot;0f2abd88-1ed1-4e04-94ec-476c622347dc&quot;,&quot;bbc65387-f074-4f98-9095-f44a9b163e82&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:148,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2f45473a-32ae-45c6-8b74-ce9006159c1a&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8b7a1c9c-36f1-4ef2-b0b0-0686887184fc&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1f1c2013-7a9c-4398-8b42-51be85c1abbf&quot;,&quot;title&quot;:&quot;User.resendActivationMail&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resendActivationMail.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({}, function(error, user) {\n    _models.Mail.remove({}, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    _id = res.body.output._id;\n                    activationToken = res.body.output.activation_token;\n                    uid = res.body.output.uid;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fccb1829-c0b3-4321-93f5-7f4aaf378b0d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should send activation email.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail Should send activation email.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        email: registrationBody.email,\n        captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.USER_ACTIVATION_MAIL_SENT);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0feef8e8-7e2b-4d27-be83-3b0d2f8cbaf7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to send activation link when user is locked.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail Should allowed to send activation link when user is locked.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n    failed_login_count: 7\n}, { new: true }, function(err, user) {\n    commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n    api.post(apiURL)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .send({\n            email: registrationBody.email,\n            captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n        })\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                res.body.output.message.should.equal(messageList.USER_ACTIVATION_MAIL_SENT);\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a15b4bc9-9878-4e53-ad31-54d1f6dc7ccf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as user is not register.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail Should give error as user is not register.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        email: \&quot;FAKE_EMAIL@example.com\&quot;,\n        captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_ACTIVATION_NOT_REGISTER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a45470a1-8940-4dea-8361-af0192df8902&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as user has been already activated.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail Should give error as user has been already activated.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/activate\&quot;)\n    .send({\n        user_uid: uid,\n        token: activationToken\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(apiURL)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .send({\n                    email: registrationBody.email,\n                    captcha_code: \&quot;03AHJ_Vuu_lnKuNq-eLmTlTmWe6Aozhp6z0uLva1JGwwIKCkGu0x3S-8qFAHtZxL3TuJatYJnGOxta3250lueM1wWWb89Lk1zNeobupy-bg579yiGTwr4_IHsN_eWANc40w_EToNjf4mmeKxLbspOGq9YEZlWFb6d5pNnT--ImOkvcoiqwrmKjQIKPEoJBlXbuTL2NfNrrEPjhCpnmSQR6z3CRD1G-V3sVFeBbzHjoatg2wpFgnS5ikf42hNcq6JP0TwhQ86pwCqZ86JKm2UQe1ISxQUOckNXx6dG9NuCjypFmEsvOaL7qrhmcbp77hfzNamTEt1GVpNBlpKMtND6FDn8X05Ni3xoZDDhjZzRvlJQWf9ygHjsVByEEQv5GU9l1f4CI1gPbulwHQFN3d_8S0mbpBOfI-YQ_fE3lSWp0dDA2mxdDXOVi7tQgIBZhRFPAa8Jt9R9_TaSch6Ygq6qrkkIuekVIs6jSsLsLavpKZgtUkLJcf1RaUUZharASNuMIt3_s9EbWM42WCs8aMLWPo8qMu4pKa6cS5Bd3D-TFTBmtADFpOvDHjqfXqX_PemEg_ZVEXUYYGQ3YhJhESe8OCuxWqcs84Jzyln7-BIxYrMEDOgejqPrUc8nOU9F2o-MtjWohx_8ci0-078Fg6UGPWUGqZ2ttrvK9mIkFi1iQVhTcThPEFH2SoG993B3YqmEagHtBwOid2pNzYY_hAffXSSvURdJstiZi7qV_ZNxnJ9CSlljI8erdb4cPSrIY8XIEahiC-q3ODrATTXfkv5iGXeYI7_rDO0DmH3OS5g9rmFZb4RTows9Gmp8xOA91_faynmaM0009rOjYx0pxAqZZECTJu20Qyvbu0_d-dd7n7vMPHvoEMqbXQhXQO62zBK-h3PRRWQlLdFgwj498SgMsFkbo1SBRi1943w\&quot;\n                })\n                .expect(httpStatus.BAD_REQUEST)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.error.message.should.equal(messageList.USER_ACTIVATION_ALREADY_ACTIVATED);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16fb898e-fb63-4faa-bad4-5c392380fa36&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give captcha verification fail error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resendActivationMail Should give captcha verification fail error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .send({\n        email: registrationBody.email\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CAPTCHA_VERIFICATION_FAIL);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1b1d6f1-5157-4370-8cd0-990d3b10c661&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0feef8e8-7e2b-4d27-be83-3b0d2f8cbaf7&quot;,&quot;a15b4bc9-9878-4e53-ad31-54d1f6dc7ccf&quot;,&quot;a45470a1-8940-4dea-8361-af0192df8902&quot;,&quot;16fb898e-fb63-4faa-bad4-5c392380fa36&quot;,&quot;f1b1d6f1-5157-4370-8cd0-990d3b10c661&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dd18cd94-261e-4cd9-ae70-35a46ec24f96&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;832e92d8-f112-408f-8929-de58635fd24a&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b927c127-9d50-4345-a36b-dc2c51ebef76&quot;,&quot;title&quot;:&quot;User.resetPassword&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\resetPassword.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                activationToken = res.body.output.activation_token;\n                uid = res.body.output.uid;\n                api.post(\&quot;/enterprise/v1/user/activate\&quot;)\n                    .send({\n                        user_uid: uid,\n                        token: activationToken\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            done();\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f0d0002-be25-45de-b1d7-725eb7853284&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function() {\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2fa387c4-1fbf-455c-b65f-c9e10cf8c686&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e5e6038-0610-441a-89ed-60723569394e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should reset password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should reset password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12345\&quot;,\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.OK\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.output.message.should.equal(messageList.USER_RESET_PASS_SUCCESSFULLY);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4136e223-15cb-46dc-aabd-ca9b0846f367&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to reset password, when user is locked.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should allowed to reset password, when user is locked.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n    failed_login_count: 7\n}, { new: true }, function(err, user) {\n    passwordReseting({\n        password: \&quot;Raw@12345\&quot;,\n        password_confirmation: \&quot;Raw@12345\&quot;,\n        captcha_code: captchaCode,\n        httpStatus: httpStatus.OK\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.USER_RESET_PASS_SUCCESSFULLY);\n            done();\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d06d98b-a910-4db8-a026-75e7ca8c3020&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set failed login count to zero, when user reset password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should set failed login count to zero, when user reset password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.findOneAndUpdate({ \&quot;uid\&quot;: uid }, {\n    failed_login_count: 7\n}, { new: true }, function(err, user) {\n    passwordReseting({\n        password: \&quot;Raw@12345\&quot;,\n        password_confirmation: \&quot;Raw@12345\&quot;,\n        captcha_code: captchaCode,\n        httpStatus: httpStatus.OK\n    }, function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            _models.User.findOne({ \&quot;uid\&quot;: uid }, function(err, user) {\n                user.failed_login_count.should.equal(0);\n                done();\n            });\n        }\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18b86c4d-f095-45e3-a18f-7b291055065b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error for using same password while reseting password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give error for using same password while reseting password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@1234\&quot;,\n    password_confirmation: \&quot;Raw@1234\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.message.should.equal(messageList.PASSWORD_REPEAT_ERROR);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;693022e8-18bd-4fce-b0d8-ae832c3af753&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not passing valid password accordingly to criteria.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should return error for not passing valid password accordingly to criteria.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Rawaaaaaaaaaaaa\&quot;,\n    password_confirmation: \&quot;Rawaaaaaaaaaaaa\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.password.message.should.equal(messageList.USER_REG_INVALID_PASSWORD);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5ed76d8-dadc-4d79-80de-81a4d61d3c7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should return error for not passing confirm password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should return error for not passing confirm password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@1234\&quot;,\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.password_confirmation.message.should.equal(messageList.USER_REG_MATCHED_CONFIRM_PASSWORD);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76c50a46-567e-4d2a-822f-60a0ba41c49d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to use first password on fifth time password reseting.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should not allowed to use first password on fifth time password reseting.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:416,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12341\&quot;,\n    password_confirmation: \&quot;Raw@12341\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.OK\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n            passwordReseting({\n                password: \&quot;Raw@12342\&quot;,\n                password_confirmation: \&quot;Raw@12342\&quot;,\n                captcha_code: captchaCode,\n                httpStatus: httpStatus.OK\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                        passwordReseting({\n                            password: \&quot;Raw@12343\&quot;,\n                            password_confirmation: \&quot;Raw@12343\&quot;,\n                            captcha_code: captchaCode,\n                            httpStatus: httpStatus.OK\n                        }, function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                                    passwordReseting({\n                                        password: \&quot;Raw@12344\&quot;,\n                                        password_confirmation: \&quot;Raw@12344\&quot;,\n                                        captcha_code: captchaCode,\n                                        httpStatus: httpStatus.OK\n                                    }, function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                                                passwordReseting({\n                                                    password: \&quot;Raw@1234\&quot;,\n                                                    password_confirmation: \&quot;Raw@1234\&quot;,\n                                                    captcha_code: captchaCode,\n                                                    httpStatus: httpStatus.BAD_REQUEST\n                                                }, function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        res.body.error.message.should.equal(messageList.PASSWORD_REPEAT_ERROR);\n                                                        done();\n                                                    }\n                                                });\n                                            } else {\n                                                true.should.equal(false);\n                                            }\n                                        }\n                                    });\n                                } else {\n                                    true.should.equal(false);\n                                }\n                            }\n                        });\n                    } else {\n                        true.should.equal(false);\n                    }\n                }\n            });\n        } else {\n            true.should.equal(false);\n        }\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66c044be-f168-48a7-aba3-3c6ed3dc454e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to use first password on sixth time password reseting.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should allowed to use first password on sixth time password reseting.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:509,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12341\&quot;,\n    password_confirmation: \&quot;Raw@12341\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.OK\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n            passwordReseting({\n                password: \&quot;Raw@12342\&quot;,\n                password_confirmation: \&quot;Raw@12342\&quot;,\n                captcha_code: captchaCode,\n                httpStatus: httpStatus.OK\n            }, function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                        passwordReseting({\n                            password: \&quot;Raw@12343\&quot;,\n                            password_confirmation: \&quot;Raw@12343\&quot;,\n                            captcha_code: captchaCode,\n                            httpStatus: httpStatus.OK\n                        }, function(err, res) {\n                            if (err) {\n                                done(err);\n                            } else {\n                                if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                                    passwordReseting({\n                                        password: \&quot;Raw@12344\&quot;,\n                                        password_confirmation: \&quot;Raw@12344\&quot;,\n                                        captcha_code: captchaCode,\n                                        httpStatus: httpStatus.OK\n                                    }, function(err, res) {\n                                        if (err) {\n                                            done(err);\n                                        } else {\n                                            if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                                                passwordReseting({\n                                                    password: \&quot;Raw@12345\&quot;,\n                                                    password_confirmation: \&quot;Raw@12345\&quot;,\n                                                    captcha_code: captchaCode,\n                                                    httpStatus: httpStatus.OK\n                                                }, function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        if (res.body.output.message == messageList.USER_RESET_PASS_SUCCESSFULLY) {\n                                                            passwordReseting({\n                                                                password: \&quot;Raw@1234\&quot;,\n                                                                password_confirmation: \&quot;Raw@1234\&quot;,\n                                                                captcha_code: captchaCode,\n                                                                httpStatus: httpStatus.OK\n                                                            }, function(err, res) {\n                                                                if (err) {\n                                                                    done(err);\n                                                                } else {\n                                                                    res.body.output.message.should.equal(messageList.USER_RESET_PASS_SUCCESSFULLY);\n                                                                    done();\n                                                                }\n                                                            });\n                                                        } else {\n                                                            true.should.equal(false);\n                                                        }\n                                                    }\n                                                });\n                                            } else {\n                                                true.should.equal(false);\n                                            }\n                                        }\n                                    });\n                                } else {\n                                    true.should.equal(false);\n                                }\n                            }\n                        });\n                    } else {\n                        true.should.equal(false);\n                    }\n                }\n            });\n        } else {\n            true.should.equal(false);\n        }\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f19389e8-2a0d-4655-975a-7da24ecd7541&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as password is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give error as password is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.password.message.should.equal(messageList.USER_REG_INVALID_PASSWORD);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f769985-7288-4b72-96df-5a818948b257&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as request toke is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give error as request toke is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12345\&quot;,\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    captcha_code: captchaCode,\n    token: \&quot;\&quot;,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.token.message.should.equal(messageList.USER_RESET_PASS_TOKEN_MUST_NOT_BE_EMPTY);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;814e9ae9-ce29-442d-8061-272f2e1fd384&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid forgot password token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give error as invalid forgot password token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12345\&quot;,\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    captcha_code: captchaCode,\n    token: \&quot;FAKE\&quot;,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.message.should.equal(messageList.USER_INVALID_RESET_PASS_TOKEN);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9da559bf-9de3-439c-982f-c2752d2e9341&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as password and confirm password are not equal.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give error as password and confirm password are not equal.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12345\&quot;,\n    password_confirmation: \&quot;Raw@12346\&quot;,\n    captcha_code: captchaCode,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.password_confirmation.message.should.equal(messageList.USER_REG_MATCHED_CONFIRM_PASSWORD);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05c38505-7ad9-426f-b6be-58029622d88b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give captcha verification fail error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.resetPassword Should give captcha verification fail error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\npasswordReseting({\n    password: \&quot;Raw@12345\&quot;,\n    password_confirmation: \&quot;Raw@12345\&quot;,\n    httpStatus: httpStatus.BAD_REQUEST\n}, function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        res.body.error.message.should.equal(messageList.CAPTCHA_VERIFICATION_FAIL);\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2740244-646f-44bf-99a3-d8ad2031a080&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4136e223-15cb-46dc-aabd-ca9b0846f367&quot;,&quot;2d06d98b-a910-4db8-a026-75e7ca8c3020&quot;,&quot;18b86c4d-f095-45e3-a18f-7b291055065b&quot;,&quot;693022e8-18bd-4fce-b0d8-ae832c3af753&quot;,&quot;a5ed76d8-dadc-4d79-80de-81a4d61d3c7e&quot;,&quot;76c50a46-567e-4d2a-822f-60a0ba41c49d&quot;,&quot;66c044be-f168-48a7-aba3-3c6ed3dc454e&quot;,&quot;f19389e8-2a0d-4655-975a-7da24ecd7541&quot;,&quot;0f769985-7288-4b72-96df-5a818948b257&quot;,&quot;814e9ae9-ce29-442d-8061-272f2e1fd384&quot;,&quot;9da559bf-9de3-439c-982f-c2752d2e9341&quot;,&quot;05c38505-7ad9-426f-b6be-58029622d88b&quot;,&quot;a2740244-646f-44bf-99a3-d8ad2031a080&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1502,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d5c95f04-742d-4645-9707-42b6a51cb0f7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cec4fb31-df63-49dd-87c5-1a32d6d6dd35&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;39363293-c5c9-45cf-9eef-1e8f105fc1f5&quot;,&quot;title&quot;:&quot;User.saveMetadata&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveMetadata.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.saveMetadata \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25a18028-4851-427e-af5e-9cf51126702f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.saveMetadata \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d681d48e-1188-49a7-97a9-c40ea58d58d4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update new password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.saveMetadata Should update new password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserBody = {};\ntempUserBody.metadata = {\n    \&quot;name\&quot;: \&quot;demo\&quot;\n};\napi.put(apiURL)\n    .send(tempUserBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.uid != \&quot;\&quot; &amp;&amp;\n                res.body.output.metadata.name == \&quot;demo\&quot; &amp;&amp;\n                res.body.output.first_name == registrationBody.first_name;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ae06204-884d-4172-9a63-a9a910dcacf6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as metadata is required.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.saveMetadata Should give error as metadata is required.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserBody = {};\napi.put(apiURL)\n    .send(tempUserBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.metadata.message.should.equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9ad8aba-07a7-430b-9163-aa661c915413&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.saveMetadata Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempUserBody = {};\ntempUserBody.metadata = {\n    \&quot;name\&quot;: \&quot;demo\&quot;\n};\napi.put(apiURL)\n    .send(tempUserBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3beae6b9-5401-48de-ba13-40c1f298f76f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8ae06204-884d-4172-9a63-a9a910dcacf6&quot;,&quot;d9ad8aba-07a7-430b-9163-aa661c915413&quot;,&quot;3beae6b9-5401-48de-ba13-40c1f298f76f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:45,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1f24a01e-5abf-423d-95ca-b69af6f8b29c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b4418eee-d8a3-4f5b-8309-c825cfe6a0b6&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0d95e21c-08eb-4a22-b0cc-259ef723baea&quot;,&quot;title&quot;:&quot;User.SaveProfile&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\saveProfile.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d700d3ec-6a70-467b-b47b-bd4aa1bcbdba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52d47dd8-57fe-420f-8a79-c9dca3f64d91&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update first_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update first_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.first_name = \&quot;amber 1\&quot;;\ntempRegistrationBody.last_name = \&quot;More\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.first_name == tempRegistrationBody.first_name &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aeb46f32-ec9f-4e32-861e-fb040c0c56a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give first_name required error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give first_name required error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.first_name;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.first_name.message == messageList.USER_PROFILE_FIRST_NAME_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8d41e3b5-3e19-4a7e-9eb5-234810032b5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give first_name required error for empty spaces first_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give first_name required error for empty spaces first_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.first_name = \&quot;   \&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.first_name.message == messageList.USER_PROFILE_FIRST_NAME_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0a409f4-d337-4eff-bc54-72f6a2d64ca2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update last_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update last_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.last_name = \&quot;more 1\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.last_name == tempRegistrationBody.last_name &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7bbea0d-ae2c-4ac9-8dbb-d64f4dd07e95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give user_plan.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give user_plan.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.last_name = \&quot;more 1\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = typeof(res.body.output.user_plan) != \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18ca269c-1d13-4fd0-af69-ca78a727f119&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give last_name required error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give last_name required error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ndelete tempRegistrationBody.last_name;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.last_name.message == messageList.USER_PROFILE_LAST_NAME_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;238b30ec-db78-495e-978e-510e98ce0013&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give last_name required error for empty spaces last_name.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give last_name required error for empty spaces last_name.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.last_name = \&quot;  \&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.error.last_name.message == messageList.USER_PROFILE_LAST_NAME_REQUIRED;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39caf7fe-5670-4ac5-a4eb-42220578eac1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update company.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update company.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.company = \&quot;built.io 1\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.company == tempRegistrationBody.company &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79331fe7-ee21-4283-9fdc-b8169a0fef7a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update empty company.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update empty company.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.company = \&quot;\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.company == tempRegistrationBody.company &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06db9a69-3fcb-4be4-af2c-e75735b5091f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update empty job_title.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update empty job_title.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.job_title = \&quot;\&quot;; //None 1\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.job_title == tempRegistrationBody.job_title &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bcdbb84b-a7b9-4342-825c-3030f0d261b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update locale.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update locale.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.locale = \&quot;en-uk\&quot;;\ndelete tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.locale == tempRegistrationBody.locale &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7947e28b-7a79-4bbe-8645-0997de4c0a9f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:198,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\ntempRegistrationBody.password = \&quot;raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;raw@1235\&quot;;\ntempRegistrationBody.first_name = \&quot;Amber\&quot;;\ntempRegistrationBody.last_name = \&quot;More\&quot;;\nutils.encryptPassword(tempRegistrationBody.password).then(function(newPassHashed) {\n    api.put(apiURL)\n        .send(tempRegistrationBody)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                if (isValid) {\n                    _models.User.findOne({ uid: res.body.output.uid }, function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else if (user) {\n                            (user.password == newPassHashed).should.equal(true);\n                            done();\n                        } else {\n                            false.should.equal(true);\n                            done();\n                        }\n                    });\n                } else {\n                    isValid.should.equal(true);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3060c6a9-5cbc-41ac-b61a-0e493dd5fb10&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error for using same password while updating password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should give error for using same password while updating password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\ntempRegistrationBody.password = \&quot;Raw@1234\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1234\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_CHANGE_PASS_OLD_PASS_PASS_NOT_BE_SAME);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff550021-8798-4506-9423-6f71e60c4cf9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to use first password on fifth time while updating password.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should not allowed to use first password on fifth time while updating password.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:690,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable({});\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\ntempRegistrationBody.password = \&quot;Raw@1241\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1241\&quot;;\ntempRegistrationBody.first_name = \&quot;Amber\&quot;;\ntempRegistrationBody.last_name = \&quot;More\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            tempRegistrationBody.oldpassword = \&quot;Raw@1241\&quot;;\n            tempRegistrationBody.password = \&quot;Raw@1242\&quot;;\n            tempRegistrationBody.password_confirmation = \&quot;Raw@1242\&quot;;\n            api.put(apiURL)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        tempRegistrationBody.oldpassword = \&quot;Raw@1242\&quot;;\n                        tempRegistrationBody.password = \&quot;Raw@1243\&quot;;\n                        tempRegistrationBody.password_confirmation = \&quot;Raw@1243\&quot;;\n                        api.put(apiURL)\n                            .send(tempRegistrationBody)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    tempRegistrationBody.oldpassword = \&quot;Raw@1243\&quot;;\n                                    tempRegistrationBody.password = \&quot;Raw@1244\&quot;;\n                                    tempRegistrationBody.password_confirmation = \&quot;Raw@1244\&quot;;\n                                    api.put(apiURL)\n                                        .send(tempRegistrationBody)\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                tempRegistrationBody.oldpassword = \&quot;Raw@1244\&quot;;\n                                                tempRegistrationBody.password = \&quot;Raw@1234\&quot;;\n                                                tempRegistrationBody.password_confirmation = \&quot;Raw@1234\&quot;;\n                                                api.put(apiURL)\n                                                    .send(tempRegistrationBody)\n                                                    .set(&#x27;authtoken&#x27;, authToken)\n                                                    .expect(httpStatus.BAD_REQUEST)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            res.body.error.message.should.equal(messageList.PASSWORD_REPEAT_ERROR);\n                                                            done();\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ac06ef0-1bf4-4a0c-8b36-e7cbb7ae29e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should allowed to use first password on sixth time password reseting.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should allowed to use first password on sixth time password reseting.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:899,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.oldpassword = \&quot;Raw@1234\&quot;;\ntempRegistrationBody.password = \&quot;Raw@1241\&quot;;\ntempRegistrationBody.password_confirmation = \&quot;Raw@1241\&quot;;\ntempRegistrationBody.first_name = \&quot;Amber\&quot;;\ntempRegistrationBody.last_name = \&quot;More\&quot;;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            tempRegistrationBody.oldpassword = \&quot;Raw@1241\&quot;;\n            tempRegistrationBody.password = \&quot;Raw@1242\&quot;;\n            tempRegistrationBody.password_confirmation = \&quot;Raw@1242\&quot;;\n            api.put(apiURL)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        tempRegistrationBody.oldpassword = \&quot;Raw@1242\&quot;;\n                        tempRegistrationBody.password = \&quot;Raw@1243\&quot;;\n                        tempRegistrationBody.password_confirmation = \&quot;Raw@1243\&quot;;\n                        api.put(apiURL)\n                            .send(tempRegistrationBody)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    tempRegistrationBody.oldpassword = \&quot;Raw@1243\&quot;;\n                                    tempRegistrationBody.password = \&quot;Raw@1244\&quot;;\n                                    tempRegistrationBody.password_confirmation = \&quot;Raw@1244\&quot;;\n                                    api.put(apiURL)\n                                        .send(tempRegistrationBody)\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                tempRegistrationBody.oldpassword = \&quot;Raw@1244\&quot;;\n                                                tempRegistrationBody.password = \&quot;Raw@1245\&quot;;\n                                                tempRegistrationBody.password_confirmation = \&quot;Raw@1245\&quot;;\n                                                api.put(apiURL)\n                                                    .send(tempRegistrationBody)\n                                                    .set(&#x27;authtoken&#x27;, authToken)\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            tempRegistrationBody.oldpassword = \&quot;Raw@1245\&quot;;\n                                                            tempRegistrationBody.password = \&quot;Raw@1234\&quot;;\n                                                            tempRegistrationBody.password_confirmation = \&quot;Raw@1234\&quot;;\n                                                            utils.encryptPassword(\&quot;Raw@1234\&quot;).then(function(newPassHashed) {\n                                                                api.put(apiURL)\n                                                                    .send(tempRegistrationBody)\n                                                                    .set(&#x27;authtoken&#x27;, authToken)\n                                                                    .expect(httpStatus.OK)\n                                                                    .end(function(err, res) {\n                                                                        var isValid = typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                                                                        if (isValid) {\n                                                                            _models.User.findOne({ uid: res.body.output.uid }, function(error, user) {\n                                                                                if (error) {\n                                                                                    done(error);\n                                                                                } else if (user) {\n                                                                                    (user.password == newPassHashed).should.equal(true);\n                                                                                    done();\n                                                                                } else {\n                                                                                    false.should.equal(true);\n                                                                                    done();\n                                                                                }\n                                                                            });\n                                                                        } else {\n                                                                            isValid.should.equal(true);\n                                                                            done();\n                                                                        }\n                                                                    });\n                                                            });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;faed573c-3b23-4246-961e-b3f940a23f07&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to update password, as old incorrect password provided.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should not allowed to update password, as old incorrect password provided.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:128,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.oldpassword = \&quot;Raw@123\&quot;;\ntempRegistrationBody.password = \&quot;raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_PROFILE_OLD_PASS_INCORRECT);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e3cfa4a-1881-4ec2-99ce-776571233614&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not allowed to update password, as old and new password same.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should not allowed to update password, as old and new password same.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.oldpassword = tempRegistrationBody.password;\ntempRegistrationBody.password_confirmation = tempRegistrationBody.password;\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.USER_CHANGE_PASS_OLD_PASS_PASS_NOT_BE_SAME);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e44202a3-642a-48b3-974c-94e0c02272d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update password for google login.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should update password for google login.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:196,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.oldpassword = tempRegistrationBody.password;\ntempRegistrationBody.password = \&quot;raw@1235\&quot;;\ntempRegistrationBody.password_confirmation = tempRegistrationBody.password;\nutils.encryptPassword(tempRegistrationBody.password).then(function(newPassHashed) {\n    api.put(apiURL)\n        .send(tempRegistrationBody)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var isValid = typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                    typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                if (isValid) {\n                    _models.User.findOne({ uid: res.body.output.uid }, function(error, user) {\n                        if (error) {\n                            done(error);\n                        } else if (user) {\n                            (user.password == newPassHashed).should.equal(true);\n                            done();\n                        } else {\n                            false.should.equal(true);\n                            done();\n                        }\n                    });\n                } else {\n                    isValid.should.equal(true);\n                    done();\n                }\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8452b011-5d05-4978-881e-f7d263437807&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should save phone number with profile.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should save phone number with profile.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.phone = \&quot;9619982150\&quot;;\n//tempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.phone == tempRegistrationBody.phone &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd53c9e9-c704-4f67-a52e-1b28c3efdffb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should register phone number with authy.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should register phone number with authy.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = tempRegistrationBody.authy_number == tempRegistrationBody.authy_number &amp;&amp;\n                res.body.output.enable_twofa == \&quot;enable\&quot; &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29bf3af4-c51f-4bb6-a4eb-724230457d44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should de-register and then register same phone number with authy.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.SaveProfile Should de-register and then register same phone number with authy.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var oldAuthyUserID = res.body.output.authy_user_uid;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(apiURL)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var isValid =\n                            res.body.output.authy_user_uid == oldAuthyUserID &amp;&amp;\n                            (res.body.output.authy_user_uid || \&quot;\&quot;) != \&quot;\&quot; &amp;&amp;\n                            (oldAuthyUserID || \&quot;\&quot;) != \&quot;\&quot; &amp;&amp;\n                            res.body.output.enable_twofa == \&quot;enable\&quot; &amp;&amp;\n                            typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                            typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n                        isValid.should.equal(true);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c6c1cd73-b5b2-458e-9ddb-7a53b2dbb258&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;aeb46f32-ec9f-4e32-861e-fb040c0c56a5&quot;,&quot;8d41e3b5-3e19-4a7e-9eb5-234810032b5e&quot;,&quot;d0a409f4-d337-4eff-bc54-72f6a2d64ca2&quot;,&quot;a7bbea0d-ae2c-4ac9-8dbb-d64f4dd07e95&quot;,&quot;18ca269c-1d13-4fd0-af69-ca78a727f119&quot;,&quot;238b30ec-db78-495e-978e-510e98ce0013&quot;,&quot;39caf7fe-5670-4ac5-a4eb-42220578eac1&quot;,&quot;79331fe7-ee21-4283-9fdc-b8169a0fef7a&quot;,&quot;06db9a69-3fcb-4be4-af2c-e75735b5091f&quot;,&quot;bcdbb84b-a7b9-4342-825c-3030f0d261b0&quot;,&quot;7947e28b-7a79-4bbe-8645-0997de4c0a9f&quot;,&quot;3060c6a9-5cbc-41ac-b61a-0e493dd5fb10&quot;,&quot;ff550021-8798-4506-9423-6f71e60c4cf9&quot;,&quot;4ac06ef0-1bf4-4a0c-8b36-e7cbb7ae29e6&quot;,&quot;faed573c-3b23-4246-961e-b3f940a23f07&quot;,&quot;3e3cfa4a-1881-4ec2-99ce-776571233614&quot;,&quot;e44202a3-642a-48b3-974c-94e0c02272d3&quot;,&quot;8452b011-5d05-4978-881e-f7d263437807&quot;,&quot;dd53c9e9-c704-4f67-a52e-1b28c3efdffb&quot;,&quot;29bf3af4-c51f-4bb6-a4eb-724230457d44&quot;,&quot;c6c1cd73-b5b2-458e-9ddb-7a53b2dbb258&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2503,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9b19f49c-be05-4b1d-90fd-2a18a4b7fec1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6a2abf2f-f046-4ed3-9f7b-9e48020a2bd9&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7525b0a3-9513-486a-9e36-62c5b5224628&quot;,&quot;title&quot;:&quot;User.search&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\search.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.search \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:217,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nremoveRecords(function(error, output) {\n    commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(registrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                authToken = res.body.output.authtoken;\n                _id = res.body.output._id;\n                user_uid = res.body.output.uid;\n                email = res.body.output.email;\n                saveUserFlows({\n                    authtoken: authToken,\n                    user_uid: user_uid\n                }, function(error, flows) {\n                    saveBillEntries({\n                        authtoken: authToken,\n                        user_uid: user_uid,\n                        flow_uid: flows[0].uid\n                    }, function(error, billEntries) {\n                        saveTemplateEntries({\n                            authtoken: authToken,\n                            user_uid: user_uid\n                        }, function(error, billEntries) {\n                            done();\n                        });\n                    });\n                });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e38873ab-d533-4662-a750-c3cd0a59e4f7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.search \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;removeRecords(function(error, output) {\n    if (error) {\n        done(error);\n    } else {\n        done();\n    }\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6cf88bc8-cf0c-4705-9de5-624c3cce78dc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.search \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5fbcec0e-05cc-47a1-bcad-d8ced07e1805&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should search within user&#x27;s flows and templates.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.search Should search within user&#x27;s flows and templates.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL + \&quot;?search=UNIT_TEST_1\&quot;;\napi.get(paramURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = false;\n            if (Array.isArray(res.body.output)) {\n                isValid = res.body.output.length == 2;\n            }\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4abacd3-303d-49f5-934f-0f336bef0271&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.search Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar paramURL = apiURL + \&quot;?search=UNIT_TEST_1\&quot;;\napi.get(paramURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e44f0089-ebf1-4ae7-a407-1dad2db55af1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f4abacd3-303d-49f5-934f-0f336bef0271&quot;,&quot;e44f0089-ebf1-4ae7-a407-1dad2db55af1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4a8632b2-efcb-4cb4-ae35-e97576e6fd79&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bb42bca4-b3c7-4b54-a9fa-2e22b5d9dc9c&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;545ae1d0-1d51-48da-b558-60d246d80c43&quot;,&quot;title&quot;:&quot;User.sendLeadActivityLog&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\sendLeadActivityLog.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        authToken = data.owner.authtoken;\n        user_uid = data.owner.uid;\n        org_account_uid = data.organization_account.uid;\n        org_uid = data.organization.uid;\n        userPlan = data.owner.user_plan;\n        adminUser = data.admin;\n        done();\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a8c6d3e7-7fc7-4efd-b93a-92bb889762b2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.organizationRemoveRecords({}, function() {\n    httpmock.cleanAll();\n    done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6bd4f58-ea67-4274-81de-6669f6c1b705&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should log leads activity.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog Should log leads activity.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n        \&quot;email\&quot;: adminUser.email\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.LEAD_ACTIVITY_LOGGED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a14bed94-2901-47b6-9013-b42b98f69739&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should log leads activity for second time.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog Should log leads activity for second time.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n        \&quot;email\&quot;: adminUser.email\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.LEAD_ACTIVITY_LOGGED) {\n                commonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send({\n                        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n                        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n                        \&quot;email\&quot;: adminUser.email\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.message.should.equal(messageList.LEAD_ACTIVITY_LOGGED);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;710660a3-a312-40f3-ac70-4dbefc3596e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should log leads activity with organization.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog Should log leads activity with organization.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n        \&quot;email\&quot;: adminUser.email\n    })\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(messageList.LEAD_ACTIVITY_LOGGED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea91b281-93b7-4ab8-bfb4-0aa2861f4421&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should log leads activity with organization for second time.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.sendLeadActivityLog Should log leads activity with organization for second time.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\napi.post(apiURL)\n    .send({\n        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n        \&quot;email\&quot;: adminUser.email\n    })\n    .set(&#x27;org_uid&#x27;, org_uid)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            if (res.body.output.message == messageList.LEAD_ACTIVITY_LOGGED) {\n                commonMock.marketoActivityLogging(httpmock, \&quot;enterprise\&quot;);\n                api.post(apiURL)\n                    .send({\n                        \&quot;event_id\&quot;: \&quot;__flow_payment\&quot;,\n                        \&quot;event_data\&quot;: \&quot;payment made.\&quot;,\n                        \&quot;email\&quot;: adminUser.email\n                    })\n                    .set(&#x27;org_uid&#x27;, org_uid)\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            res.body.output.message.should.equal(messageList.LEAD_ACTIVITY_LOGGED);\n                            done();\n                        }\n                    });\n            } else {\n                true.should.equal(false);\n                done();\n            }\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d0d5da3-9411-4234-aeab-ae9129c8579d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a14bed94-2901-47b6-9013-b42b98f69739&quot;,&quot;710660a3-a312-40f3-ac70-4dbefc3596e0&quot;,&quot;ea91b281-93b7-4ab8-bfb4-0aa2861f4421&quot;,&quot;3d0d5da3-9411-4234-aeab-ae9129c8579d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:44,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c7bf2507-469d-477c-847c-7ee6da32f9ab&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;10cb56ba-ceab-40d3-87c8-f0c24eff801a&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;11ccb056-4c78-487e-807a-6361169e6bef&quot;,&quot;title&quot;:&quot;User.updateActivationExpired&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateActivationExpired.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateActivationExpired \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5bca2296-6be7-48f0-bbf4-3c960ce28737&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateActivationExpired \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20ab2e10-fcc4-4083-9308-9e4de8db173b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should expire account.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateActivationExpired Should expire account.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.activation_expired.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7b06ff32-00f4-4d1f-9118-e63a6cb5770a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateActivationExpired Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d36fbf4c-d1b9-44c5-9bc2-faf491ca2639&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7b06ff32-00f4-4d1f-9118-e63a6cb5770a&quot;,&quot;d36fbf4c-d1b9-44c5-9bc2-faf491ca2639&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;060e3e30-3ecc-4b88-a7b5-8561cda85aef&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5a6e19fc-f74e-4894-ba3b-3d3495ed9136&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;669859fa-786b-4274-bd47-1534bd3383cf&quot;,&quot;title&quot;:&quot;User.updateAutoRefresh&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAutoRefresh.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;555bcbb6-56d9-4eda-908e-ebfca8d55554&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a555eeaa-2bc6-450b-9197-fff688632b03&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update auto_refresh to true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh Should update auto_refresh to true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .send({\n        auto_refresh: true\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.auto_refresh.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c454a805-8d13-41c1-a5d8-78405a4eeb0b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update auto_refresh to true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh Should update auto_refresh to true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .send({\n        auto_refresh: \&quot;true1\&quot;\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.auto_refresh.message.should.equal(messageList.AUTO_REFRESH_SHOULD_BE_BOOLEAN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81584c3b-e674-456a-8794-33939d50bf8b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error for invalid auto_refresh flag in old api.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh Should give error for invalid auto_refresh flag in old api.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/autorefresh\&quot;)\n    .send({\n        data: \&quot;true1\&quot;\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .set(&#x27;driver&#x27;, \&quot;enterprise\&quot;)\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.data.message.should.equal(messageList.AUTO_REFRESH_SHOULD_BE_BOOLEAN);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c861720b-1ffa-4f9f-9aac-52740ee91e50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAutoRefresh Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL)\n    .send({\n        auto_refresh: true\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47bbd062-aa3f-4c09-b874-bdae99933e0d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c454a805-8d13-41c1-a5d8-78405a4eeb0b&quot;,&quot;81584c3b-e674-456a-8794-33939d50bf8b&quot;,&quot;c861720b-1ffa-4f9f-9aac-52740ee91e50&quot;,&quot;47bbd062-aa3f-4c09-b874-bdae99933e0d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:45,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;61db7151-39af-4550-b482-601e4870e1e9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bb515b0f-0238-43f3-91d6-7282f352b197&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1e7b1f77-cc46-4f4c-b4d2-c3c1ac5882d2&quot;,&quot;title&quot;:&quot;User.updateAvatar&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateAvatar.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(registrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    authToken = res.body.output.authtoken;\n                    user_uid = res.body.output.uid;\n                    _id = res.body.output._id;\n                    done();\n                }\n            });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bfddceea-dd67-48ea-bd48-c63a26c50c67&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c30a51b-25ca-4fe2-9a7e-7bc2ca8cced6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update avatar.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar Should update avatar.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.myCroppedImage = \&quot;/img/user-img2.png\&quot;;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, tempRegistrationBody.myCroppedImage);\n};\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.avatar.should.equal(tempRegistrationBody.myCroppedImage);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72b041d2-3bc1-4631-a826-5afc05d22304&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update avatar twice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar Should update avatar twice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.myCroppedImage = \&quot;/img/user-img2.png\&quot;;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, tempRegistrationBody.myCroppedImage);\n};\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var temp2RegistrationBody = global.getImmutable(registrationBody);\n            temp2RegistrationBody.myCroppedImage = \&quot;/img/user-img3.png\&quot;;\n            server.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n                callback(null, temp2RegistrationBody.myCroppedImage);\n            };\n            api.put(apiURL)\n                .send(temp2RegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        res.body.output.avatar.should.equal(temp2RegistrationBody.myCroppedImage);\n                        done();\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7b82e4b2-b3c5-4873-8b01-5ca9c0be0d7a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update avatar trice.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar Should update avatar trice.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.myCroppedImage = \&quot;/img/user-img2.png\&quot;;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, tempRegistrationBody.myCroppedImage);\n};\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var temp2RegistrationBody = global.getImmutable(registrationBody);\n            temp2RegistrationBody.myCroppedImage = \&quot;/img/user-img3.png\&quot;;\n            server.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n                callback(null, temp2RegistrationBody.myCroppedImage);\n            };\n            api.put(apiURL)\n                .send(temp2RegistrationBody)\n                .set(&#x27;authtoken&#x27;, authToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        var temp3RegistrationBody = global.getImmutable(registrationBody);\n                        temp3RegistrationBody.myCroppedImage = \&quot;/img/user-img4.png\&quot;;\n                        server.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n                            callback(null, temp3RegistrationBody.myCroppedImage);\n                        };\n                        api.put(apiURL)\n                            .send(temp3RegistrationBody)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.avatar.should.equal(temp3RegistrationBody.myCroppedImage);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9de718ec-4754-4e4e-97a3-a651465bf24e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.myCroppedImage = \&quot;/img/user-img2.png\&quot;;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, tempRegistrationBody.myCroppedImage);\n};\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9bbc532-5503-4d7a-97b8-b7049208dbe4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should able to remove avatar.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateAvatar Should able to remove avatar.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar defaultImage = \&quot;https://example.com/region/fl0e7d7815746566ce65a2ae?v=f0491af1-cdf3-11e8-a60a-f340282cec93\&quot;;\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.avatar = null;\nserver.agents[\&quot;enterprise\&quot;].s3.UploadAvatar = function(options, callback) {\n    callback(null, {\n        ETag: \&quot;sdfdsf35s6dfsdfdsf6565656565655665\&quot;\n    });\n};\nserver.agents[\&quot;enterprise\&quot;].s3.DownloadAvatar = function(options, callback) {\n    callback(null, defaultImage);\n};\napi.put(apiURL)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.avatar.should.equal(defaultImage);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c143e8a8-0a7c-4e97-a30e-8953158c4a16&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;72b041d2-3bc1-4631-a826-5afc05d22304&quot;,&quot;7b82e4b2-b3c5-4873-8b01-5ca9c0be0d7a&quot;,&quot;9de718ec-4754-4e4e-97a3-a651465bf24e&quot;,&quot;a9bbc532-5503-4d7a-97b8-b7049208dbe4&quot;,&quot;c143e8a8-0a7c-4e97-a30e-8953158c4a16&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:101,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2874a8a1-36b1-4fca-9326-8cd5c97e8083&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateCanvasTourUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateCanvasTourUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c687b805-ff8b-4b80-b448-201388a72070&quot;,&quot;title&quot;:&quot;User.updateCanvasTour&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateCanvasTourUser.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateCanvasTourUser.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.updateCanvasTour \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(userTrigger, cbk) {\n        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e790e169-2b6b-4cfd-b0e6-1f3225047e7b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.updateCanvasTour \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c02749df-90fd-4c28-b131-1bec615ee950&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.updateCanvasTour Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9eba176-1de5-4615-ba32-10c9a1dc4b4a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should set \&quot;canvas_first_tour\&quot; to true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User.updateCanvasTour Should set \&quot;canvas_first_tour\&quot; to true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.canvas_first_tour;\n            isValid = isValid &amp;&amp;\n                typeof(res.body.output._id) == \&quot;undefined\&quot; &amp;&amp;\n                typeof(res.body.output.__v) == \&quot;undefined\&quot;;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f02999d9-650c-452c-a849-c88ae48195e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c9eba176-1de5-4615-ba32-10c9a1dc4b4a&quot;,&quot;f02999d9-650c-452c-a849-c88ae48195e4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d28c7c71-008a-4f39-bce5-2f743687b786&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a3b24242-95de-463a-abc6-f9c1bd01db3b&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f642fe51-537e-41a7-a936-fc7d80965a54&quot;,&quot;title&quot;:&quot;User.updateLastSeen&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\updateLastSeen.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateLastSeen \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;638b6aa8-08ff-442b-be8d-c81555b5559d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateLastSeen \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78945bfa-2394-48fc-9066-5a3a445ca91a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should update when last announcements seen.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateLastSeen Should update when last announcements seen.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar dt = (new Date()).toISOString();\napi.post(apiURL)\n    .send({\n        timestamp: dt\n    })\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.last_product_announcement_seen.should.equal(dt);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;474f19c1-1c08-4c95-9625-faeffd5ef3b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.updateLastSeen Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .send({\n        auto_refresh: true\n    })\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6eb3ac2d-7051-4646-aeb9-dd94682e78fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;474f19c1-1c08-4c95-9625-faeffd5ef3b4&quot;,&quot;6eb3ac2d-7051-4646-aeb9-dd94682e78fd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;03acc20d-3d2f-4c75-916c-8d692b445d4b&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3970bd18-6f4f-4635-a62d-5f7b5f62bc65&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6621ffce-68d2-489b-b00b-c72176e78cad&quot;,&quot;title&quot;:&quot;User.validateToken&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\validateToken.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.validateToken \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        activationToken = res.body.output.activation_token;\n                        user_uid = res.body.output.uid;\n                        _id = res.body.output._id;\n                        apiURL = apiURL.replace(\&quot;:uid\&quot;, res.body.output.uid);\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41a6b2d2-1ff5-4e75-aa09-529114442e25&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.validateToken \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a8923f4-2f90-40a9-abc5-a74edee13d73&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should validate valid reset password token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.validateToken Should validate valid reset password token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/activate\&quot;)\n    .send({\n        user_uid: user_uid,\n        token: activationToken\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/forgotpassword\&quot;)\n                .send({\n                    email: registrationBody.email,\n                    captcha_code: captchaCode\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var options = {\n                                        \&quot;token\&quot;: res.body.output.password_token || \&quot;\&quot;\n                                    };\n                                    api.post(apiURL.replace(\&quot;:token_type\&quot;, \&quot;resetpassword\&quot;))\n                                        .send(options)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.output.message.should.equal(messageList.VALID_RESET_PASSWORD_TOKEN);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fda9268b-4be2-4b9b-9115-bf502b6f26c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid reset password token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.validateToken Should give error as invalid reset password token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(\&quot;/enterprise/v1/user/activate\&quot;)\n    .send({\n        user_uid: user_uid,\n        token: activationToken\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/forgotpassword\&quot;)\n                .send({\n                    email: registrationBody.email,\n                    captcha_code: captchaCode\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\n                        api.get(\&quot;/enterprise/v1/user\&quot;)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var options = {\n                                        password: \&quot;Raw@12345\&quot;,\n                                        password_confirmation: \&quot;Raw@12345\&quot;,\n                                        captcha_code: captchaCode,\n                                        token: res.body.output.password_token || \&quot;\&quot;\n                                    };\n                                    commonMock.captchaVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/resetpassword\&quot;)\n                                        .send(options)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                api.post(apiURL.replace(\&quot;:token_type\&quot;, \&quot;resetpassword\&quot;))\n                                                    .send({\n                                                        token: options.token || \&quot;\&quot;\n                                                    })\n                                                    .expect(httpStatus.BAD_REQUEST)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            res.body.error.message.should.equal(messageList.INVALID_RESET_PASSWORD_TOKEN);\n                                                            done();\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;89970f59-eaf5-4e53-b427-27df038e8a94&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as invalid token type.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.validateToken Should give error as invalid token type.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL.replace(\&quot;:token_type\&quot;, \&quot;FAKE\&quot;))\n    .send({\n        token: \&quot;FAKE\&quot;\n    })\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.INVALID_TOKEN_TYPE);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2782a11c-300d-435e-98d1-bac66391e449&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fda9268b-4be2-4b9b-9115-bf502b6f26c9&quot;,&quot;89970f59-eaf5-4e53-b427-27df038e8a94&quot;,&quot;2782a11c-300d-435e-98d1-bac66391e449&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:129,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6603281e-a4e8-4503-a6e0-e4fe3924fe27&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a823350c-2264-4dd0-b3c2-4145ab4286f5&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5eb663ed-c83c-45bc-8c6b-f23078eb042e&quot;,&quot;title&quot;:&quot;User.verifyAuthy&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthy.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:172,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ deleted_at: null }, function(error, user) {\n    _models.Mail.remove({ deleted_at: null }, function(error, user) {\n        _models.Authy.remove({ deleted_at: null }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        uid = res.body.output.uid;\n                        var tempRegistrationBody = global.getImmutable(registrationBody);\n                        tempRegistrationBody.email = secondUserEmail;\n                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                            email: tempRegistrationBody.email\n                        });\n                        api.post(\&quot;/enterprise/v1/signup\&quot;)\n                            .send(tempRegistrationBody)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    secondAuthToken = res.body.output.authtoken;\n                                    secondId = res.body.output._id;\n                                    done();\n                                }\n                            });\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0d6cad0-1b09-455e-9eb3-ca3ed89f96e0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1508a3a-e1d1-43bd-b750-596b69a0a6ff&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:87,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    _models.User.findOne({\n                                        authy_user_uid: authy_userId\n                                    }, function(error, user) {\n                                        var authtoken = [\&quot;\&quot;].concat(user.authtoken);\n                                        _models.User.findOneAndUpdate({\n                                            uid: user.uid\n                                        }, {\n                                            authtoken: authtoken\n                                        }, {\n                                            new: true\n                                        }, function(error, user) {\n                                            api.post(apiURL)\n                                                .send({\n                                                    authy_user_uid: authy_userId,\n                                                    token: otpBody.token\n                                                })\n                                                .set(&#x27;authtoken&#x27;, authToken)\n                                                .expect(httpStatus.OK)\n                                                .end(function(err, res) {\n                                                    if (err) {\n                                                        done(err);\n                                                    } else {\n                                                        var isValid = res.body.output.is_twofa_sms_enabled.should &amp;&amp;\n                                                            typeof(res.body.output.plan[0]._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(res.body.output.plan[0].__v) == \&quot;undefined\&quot; &amp;&amp;\n                                                            res.body.output.authtoken != \&quot;\&quot;;\n                                                        if (isValid) {\n                                                            _.each(res.body.output.plan[0].features, function(item) {\n                                                                isValid = isValid &amp;&amp;\n                                                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                                                            });\n                                                        }\n                                                        isValid.should.equal(true);\n                                                        done();\n                                                    }\n                                                });\n                                        });\n                                    });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f758cc6b-6c05-4d49-b67d-29a193ba1e3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should verify OTP for user in 2FA disable enterprise user exist.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should verify OTP for user in 2FA disable enterprise user exist.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:197,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.brainTreeClientToken(httpmock, \&quot;enterprise\&quot;);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n    email: registrationBody.email\n});\n\napi.post(\&quot;/enterprise/v1/login\&quot;)\n    .send({\n        \&quot;email\&quot;: registrationBody.email,\n        \&quot;password\&quot;: registrationBody.password,\n    })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var enterpriseAuthToken = res.body.output.authtoken;\n            var tempRegistrationBody = global.getImmutable(registrationBody);\n            tempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\n            tempRegistrationBody.country_code = \&quot;91\&quot;;\n            delete tempRegistrationBody.password;\n            commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n            commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n            api.put(\&quot;/enterprise/v1/user\&quot;)\n                .send(tempRegistrationBody)\n                .set(&#x27;authtoken&#x27;, enterpriseAuthToken)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\n                        commonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n                        api.put(\&quot;/enterprise/v1/user\&quot;)\n                            .send(tempRegistrationBody)\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var authy_userId = res.body.output.authy_user_uid;\n                                    commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                                        .send({\n                                            authy_id: authy_userId\n                                        })\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                                api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                                    .send({\n                                                        authy_user_uid: authy_userId,\n                                                        token: otpBody.token,\n                                                        option_selected: \&quot;otp\&quot;\n                                                    })\n                                                    .set(&#x27;authtoken&#x27;, authToken)\n                                                    .expect(httpStatus.OK)\n                                                    .end(function(err, res) {\n                                                        if (err) {\n                                                            done(err);\n                                                        } else {\n                                                            commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                                            api.post(apiURL)\n                                                                .send({\n                                                                    authy_user_uid: authy_userId,\n                                                                    token: otpBody.token\n                                                                })\n                                                                .set(&#x27;authtoken&#x27;, authToken)\n                                                                .expect(httpStatus.OK)\n                                                                .end(function(err, res) {\n                                                                    if (err) {\n                                                                        done(err);\n                                                                    } else {\n                                                                        var isValid = res.body.output.is_twofa_sms_enabled.should &amp;&amp;\n                                                                            typeof(res.body.output.plan[0]._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                            typeof(res.body.output.plan[0].__v) == \&quot;undefined\&quot;;\n                                                                        if (isValid) {\n                                                                            _.each(res.body.output.plan[0].features, function(item) {\n                                                                                isValid = isValid &amp;&amp;\n                                                                                    typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                                    typeof(item.__v) == \&quot;undefined\&quot;;\n                                                                            });\n                                                                        }\n                                                                        isValid.should.equal(true);\n                                                                        done();\n                                                                    }\n                                                                });\n                                                        }\n                                                    });\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8fc9bc7-0496-4f09-a38e-b68c8da40fb0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should get default plan for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = false;\n                                                if (res.body.output.plan.length == 1) {\n                                                    var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                        //return (plan || {}).enterprise_plan || false;\n                                                        return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                    })) || {};\n                                                    defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                    isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                }\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3007f374-187f-485c-8278-52ed800cc1c4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should get default attributes for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = false;\n                                                if (res.body.output.plan.length == 1) {\n                                                    isValid = utils.isHaveKeyVals(res.body.output, [\n                                                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                        ]) &amp;&amp;\n                                                        res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                }\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;96d0a74f-0089-4a6b-a357-89ecb8d206cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should give error as authy need to verified before using twofa.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should give error as authy need to verified before using twofa.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.BAD_REQUEST)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.error.message.should.equal(messageList.NEED_TO_VERIFY_2FA);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e50c191f-2d73-4dce-9d20-48fe1890c23b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should reset login fail count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should reset login fail count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n_models.User.findOneAndUpdate({ uid: uid }, { failed_login_count: 0 }, function(error, user) {\n    api.put(\&quot;/enterprise/v1/user\&quot;)\n        .send(tempRegistrationBody)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var authy_userId = res.body.output.authy_user_uid;\n                commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                    .send({\n                        authy_id: authy_userId\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                            api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                .send({\n                                    authy_user_uid: authy_userId,\n                                    token: otpBody.token,\n                                    option_selected: \&quot;otp\&quot;\n                                })\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                        api.post(apiURL)\n                                            .send({\n                                                authy_user_uid: authy_userId,\n                                                token: otpBody.token\n                                            })\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = res.body.output.is_twofa_sms_enabled &amp;&amp;\n                                                        res.body.output.failed_login_count == 0 &amp;&amp;\n                                                        typeof(res.body.output.plan[0]._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                        typeof(res.body.output.plan[0].__v) == \&quot;undefined\&quot;;\n                                                    if (isValid) {\n                                                        _.each(res.body.output.plan[0].features, function(item) {\n                                                            isValid = isValid &amp;&amp;\n                                                                typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                                typeof(item.__v) == \&quot;undefined\&quot;;\n                                                        });\n                                                    }\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8f5668e0-f707-4797-9fa0-c27dd4f292f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should verify authy, by email and token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthy Should verify authy, by email and token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ntempRegistrationBody.email = secondUserEmail;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, secondAuthToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    email: tempRegistrationBody.email\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                email: tempRegistrationBody.email,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            email: tempRegistrationBody.email,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = tempRegistrationBody.email == res.body.output.email &amp;&amp;\n                                                    res.body.output.is_twofa_sms_enabled &amp;&amp;\n                                                    typeof(res.body.output.plan[0]._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                    typeof(res.body.output.plan[0].__v) == \&quot;undefined\&quot;;\n                                                if (isValid) {\n                                                    _.each(res.body.output.plan[0].features, function(item) {\n                                                        isValid = isValid &amp;&amp;\n                                                            typeof(item._id) == \&quot;undefined\&quot; &amp;&amp;\n                                                            typeof(item.__v) == \&quot;undefined\&quot;;\n                                                    });\n                                                }\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a8e53175-fc4e-4dfe-a335-a015eb5e9bfb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f758cc6b-6c05-4d49-b67d-29a193ba1e3f&quot;,&quot;b8fc9bc7-0496-4f09-a38e-b68c8da40fb0&quot;,&quot;3007f374-187f-485c-8278-52ed800cc1c4&quot;,&quot;96d0a74f-0089-4a6b-a357-89ecb8d206cb&quot;,&quot;e50c191f-2d73-4dce-9d20-48fe1890c23b&quot;,&quot;8f5668e0-f707-4797-9fa0-c27dd4f292f4&quot;,&quot;a8e53175-fc4e-4dfe-a335-a015eb5e9bfb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:659,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e1c74f48-d03c-4ed0-802a-f6a85ac9c15c&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2806213a-c2ea-49a0-b345-6a2d6bf1c8ab&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fc4923c8-0eeb-4f89-8f1b-6f5289e3d454&quot;,&quot;title&quot;:&quot;User.verifyAuthyForGoogle&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyAuthyForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/login/google\&quot;)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        uid = res.body.output.uid;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8d7adae-fdea-4815-a315-c7fe13322f98&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;50624620-48de-42d9-9782-16021213f583&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle Should verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                res.body.output.is_twofa_sms_enabled.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;991945b5-928a-43bc-834d-7bcc58d657fd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle Should get default plan for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = false;\n                                                if (res.body.output.plan.length == 1) {\n                                                    var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                                        //return (plan || {}).enterprise_plan || false;\n                                                        return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                                    })) || {};\n                                                    defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                                    isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                                }\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86764e7a-16e6-4bc4-9b4e-b97ef29d2426&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle Should get default attributes for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            authy_user_uid: authy_userId,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = false;\n                                                if (res.body.output.plan.length == 1) {\n                                                    isValid = utils.isHaveKeyVals(res.body.output, [\n                                                            \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                            \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                                        ]) &amp;&amp;\n                                                        res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                                        moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                                        moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                                }\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75c0158a-a003-42ab-8aec-4b23f7836511&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should reset login fail count.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle Should reset login fail count.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\n_models.User.findOneAndUpdate({ uid: uid }, { failed_login_count: 0 }, function(error, user) {\n    api.put(\&quot;/enterprise/v1/user\&quot;)\n        .send(tempRegistrationBody)\n        .set(&#x27;authtoken&#x27;, authToken)\n        .expect(httpStatus.OK)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                var authy_userId = res.body.output.authy_user_uid;\n                commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n                api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                    .send({\n                        authy_id: authy_userId\n                    })\n                    .expect(httpStatus.OK)\n                    .end(function(err, res) {\n                        if (err) {\n                            done(err);\n                        } else {\n                            commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                            api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                                .send({\n                                    authy_user_uid: authy_userId,\n                                    token: otpBody.token,\n                                    option_selected: \&quot;otp\&quot;\n                                })\n                                .set(&#x27;authtoken&#x27;, authToken)\n                                .expect(httpStatus.OK)\n                                .end(function(err, res) {\n                                    if (err) {\n                                        done(err);\n                                    } else {\n                                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                        api.post(apiURL)\n                                            .send({\n                                                authy_user_uid: authy_userId,\n                                                token: otpBody.token\n                                            })\n                                            .set(&#x27;authtoken&#x27;, authToken)\n                                            .expect(httpStatus.OK)\n                                            .end(function(err, res) {\n                                                if (err) {\n                                                    done(err);\n                                                } else {\n                                                    var isValid = res.body.output.is_twofa_sms_enabled &amp;&amp;\n                                                        res.body.output.failed_login_count == 0;\n                                                    isValid.should.equal(true);\n                                                    done();\n                                                }\n                                            });\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5319ce4e-08d1-4b4e-83d0-d4ab5bcecf49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should verify authy, by email and token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyAuthyForGoogle Should verify authy, by email and token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    email: tempRegistrationBody.email\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(\&quot;/enterprise/v1/authy/verifyotp\&quot;)\n                            .send({\n                                email: tempRegistrationBody.email,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                                    api.post(apiURL)\n                                        .send({\n                                            email: tempRegistrationBody.email,\n                                            token: otpBody.token\n                                        })\n                                        .set(&#x27;authtoken&#x27;, authToken)\n                                        .expect(httpStatus.OK)\n                                        .end(function(err, res) {\n                                            if (err) {\n                                                done(err);\n                                            } else {\n                                                var isValid = tempRegistrationBody.email == res.body.output.email &amp;&amp;\n                                                    res.body.output.is_twofa_sms_enabled;\n                                                isValid.should.equal(true);\n                                                done();\n                                            }\n                                        });\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00e8effc-1d24-44e5-9d8c-c3d764dba21e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;991945b5-928a-43bc-834d-7bcc58d657fd&quot;,&quot;86764e7a-16e6-4bc4-9b4e-b97ef29d2426&quot;,&quot;75c0158a-a003-42ab-8aec-4b23f7836511&quot;,&quot;5319ce4e-08d1-4b4e-83d0-d4ab5bcecf49&quot;,&quot;00e8effc-1d24-44e5-9d8c-c3d764dba21e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:399,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f26c2b0a-56d3-4aca-9d85-6c124a9318fa&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;50f0cba8-0c35-4f57-98c4-99e318859add&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;fcdb7038-1d0a-44b0-825f-15278d13f3f6&quot;,&quot;title&quot;:&quot;User.verifyOTP&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTP.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:177,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                email: registrationBody.email\n            });\n            api.post(\&quot;/enterprise/v1/signup\&quot;)\n                .send(registrationBody)\n                .expect(httpStatus.CREATED)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        var tempRegistrationBody = global.getImmutable(registrationBody);\n                        tempRegistrationBody.email = secondUserEmail;\n                        commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;, {\n                            email: tempRegistrationBody.email\n                        });\n                        api.post(\&quot;/enterprise/v1/signup\&quot;)\n                            .send(tempRegistrationBody)\n                            .expect(httpStatus.CREATED)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    secondAuthToken = res.body.output.authtoken;\n                                    secondId = res.body.output._id;\n                                    done();\n                                }\n                            });\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14e61fa7-b4f3-454f-9f89-390d376b0fe8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a471b67-120f-4012-a63e-21c71cb3121c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP Should verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.enable_twofa.should.equal(\&quot;verified\&quot;);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4515a3c6-1167-4f32-8a5b-98425e1bebd2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP Should get default plan for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = false;\n                                    if (res.body.output.plan.length == 1) {\n                                        var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                            //return (plan || {}).enterprise_plan || false;\n                                            return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                        })) || {};\n                                        defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                        isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                    }\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;89dc97dd-634b-4972-93e7-c028ac9917bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP Should get default attributes for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = false;\n                                    if (res.body.output.plan.length == 1) {\n                                        isValid = utils.isHaveKeyVals(res.body.output, [\n                                                \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                            ]) &amp;&amp;\n                                            res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                            moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                            moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                    }\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff88c598-5fcd-48ff-bdea-822f9c653203&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should verify OTP, by email and token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTP Should verify OTP, by email and token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ntempRegistrationBody.email = secondUserEmail;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, secondAuthToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                email: tempRegistrationBody.email,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, secondAuthToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = tempRegistrationBody.email == res.body.output.email &amp;&amp;\n                                        res.body.output.is_twofa_sms_enabled &amp;&amp;\n                                        res.body.output.enable_twofa == \&quot;verified\&quot;;\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;84926294-d4fb-40e5-84d5-0beed4974de4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4515a3c6-1167-4f32-8a5b-98425e1bebd2&quot;,&quot;89dc97dd-634b-4972-93e7-c028ac9917bc&quot;,&quot;ff88c598-5fcd-48ff-bdea-822f9c653203&quot;,&quot;84926294-d4fb-40e5-84d5-0beed4974de4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:233,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0f7db9a7-043d-4c48-bf40-ac083636f1cf&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3495b48f-0cab-41be-8ac0-667d363f0282&quot;,&quot;title&quot;:&quot;User&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3243ad3e-d9a2-48ed-aba3-e281dcc77c1f&quot;,&quot;title&quot;:&quot;User.verifyOTPForGoogle&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\users\\verifyOTPForGoogle.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:96,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.Authy.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n            commonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n            commonMock.googleLogin(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/login/google\&quot;)\n                .send(loginBody)\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        authToken = res.body.output.authtoken;\n                        _id = res.body.output._id;\n                        done();\n                    }\n                });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a35a2a2f-153a-43e8-a8a0-f32b21abdf1f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle \&quot;after each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;httpmock.cleanAll();\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e4e85c62-34ff-446e-bf70-ba0fcf2327d9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle Should verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    res.body.output.enable_twofa.should.equal(\&quot;verified\&quot;);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;214935bf-5c6d-403e-9f6a-fd4c1f70ae34&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default plan for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle Should get default plan for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = false;\n                                    if (res.body.output.plan.length == 1) {\n                                        var defaultPlan = _.first(_.filter(server.plan.list, function(plan) {\n                                            //return (plan || {}).enterprise_plan || false;\n                                            return ((plan || {}).plan_type || \&quot;\&quot;) == \&quot;enterprise\&quot;;\n                                        })) || {};\n                                        defaultPlan = utils.skipAttr(convert.getJSON(defaultPlan));\n                                        isValid = res.body.output.plan[0].uid == defaultPlan.uid;\n                                    }\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c37973d-af79-411d-a851-be2ca1d00d57&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get default attributes for verify OTP.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle Should get default attributes for verify OTP.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                authy_user_uid: authy_userId,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = false;\n                                    if (res.body.output.plan.length == 1) {\n                                        isValid = utils.isHaveKeyVals(res.body.output, [\n                                                \&quot;first_name\&quot;, \&quot;flow_uid\&quot;, \&quot;job_title\&quot;, \&quot;last_name\&quot;, \&quot;locale\&quot;,\n                                                \&quot;merchantid\&quot;, \&quot;payment_set\&quot;, \&quot;subscription\&quot;\n                                            ]) &amp;&amp;\n                                            res.body.output.subscription.days == server.plan.enterprise.TrialPeriod &amp;&amp;\n                                            moment(new Date(res.body.output.subscription.start_date)).format(\&quot;YYYY-MM-DD\&quot;) ==\n                                            moment(new Date()).format(\&quot;YYYY-MM-DD\&quot;);\n                                    }\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ce11ae3-afd9-425d-87b9-97b87515f061&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should verify OTP, by email and token.&quot;,&quot;fullTitle&quot;:&quot;Enterprise User User.verifyOTPForGoogle Should verify OTP, by email and token.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nvar tempRegistrationBody = global.getImmutable(registrationBody);\ntempRegistrationBody.authy_number = \&quot;9619982150\&quot;;\ntempRegistrationBody.country_code = \&quot;91\&quot;;\ndelete tempRegistrationBody.password;\ncommonMock.authyNumberChange(httpmock, \&quot;enterprise\&quot;);\ncommonMock.authyDelete(httpmock, \&quot;enterprise\&quot;);\napi.put(\&quot;/enterprise/v1/user\&quot;)\n    .send(tempRegistrationBody)\n    .set(&#x27;authtoken&#x27;, authToken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var authy_userId = res.body.output.authy_user_uid;\n            commonMock.authySMSVerification(httpmock, \&quot;enterprise\&quot;);\n            api.post(\&quot;/enterprise/v1/authy/sms\&quot;)\n                .send({\n                    authy_id: authy_userId\n                })\n                .expect(httpStatus.OK)\n                .end(function(err, res) {\n                    if (err) {\n                        done(err);\n                    } else {\n                        commonMock.authyAppTokenVerification(httpmock, \&quot;enterprise\&quot;);\n                        api.post(apiURL)\n                            .send({\n                                email: tempRegistrationBody.email,\n                                token: otpBody.token,\n                                option_selected: \&quot;otp\&quot;\n                            })\n                            .set(&#x27;authtoken&#x27;, authToken)\n                            .expect(httpStatus.OK)\n                            .end(function(err, res) {\n                                if (err) {\n                                    done(err);\n                                } else {\n                                    var isValid = tempRegistrationBody.email == res.body.output.email &amp;&amp;\n                                        res.body.output.is_twofa_sms_enabled &amp;&amp;\n                                        res.body.output.enable_twofa == \&quot;verified\&quot;;\n                                    isValid.should.equal(true);\n                                    done();\n                                }\n                            });\n                    }\n                });\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac481c8c-1612-401d-9bba-af870b7cfda1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;214935bf-5c6d-403e-9f6a-fd4c1f70ae34&quot;,&quot;7c37973d-af79-411d-a851-be2ca1d00d57&quot;,&quot;4ce11ae3-afd9-425d-87b9-97b87515f061&quot;,&quot;ac481c8c-1612-401d-9bba-af870b7cfda1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:226,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;59afab58-4d45-4aee-ab4b-c6c99ba94857&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\createArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\createArbitrary.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;935848e2-e08c-4e6c-8800-b7d553386bdc&quot;,&quot;title&quot;:&quot;Arbitrary.Create&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\createArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\createArbitrary.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Create \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:66,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken[0];\n        done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee280809-6c03-479f-ba9e-2f0be2e7e106&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Create \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Arbitrary.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [arbitrary.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a8d52fd-5b8b-4041-ab58-07dc4c66dae3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Create Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHORIZED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46c2ce43-d988-4ea8-9747-74d0c3152c7a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should create arbitrary, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Create Should create arbitrary, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send(arbitraryData)\n    .expect(httpStatus.CREATED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            arbitrary = res.body.output\n            expect(arbitrary.data).to.be.a(&#x27;object&#x27;);\n            expect(arbitrary.uid).to.be.equal(&#x27;dummy&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1a980cd-d266-4d52-af02-51f052154e61&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error,  if \&quot;data\&quot; key is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Create Should get error,  if \&quot;data\&quot; key is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f582840-f6f3-42e4-8321-23edb7c096dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;46c2ce43-d988-4ea8-9747-74d0c3152c7a&quot;,&quot;f1a980cd-d266-4d52-af02-51f052154e61&quot;,&quot;6f582840-f6f3-42e4-8321-23edb7c096dd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ef727d13-51fb-48a7-8796-ca200a1d6a8e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\deleteArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\deleteArbitrary.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;63db992f-66ee-4e78-b279-4cd9ccafca47&quot;,&quot;title&quot;:&quot;Arbitrary.Delete&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\deleteArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\deleteArbitrary.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Delete \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken[0];\n        api.post(apiURL)\n            .set({ ui_admin_key: config.UI_ADMIN_KEY })\n            .send(arbitraryData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    arbitrary = res.body.output\n                    done();\n                }\n            });\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;814508a9-fdea-4b8d-a274-a267e4b1804f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Delete \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Arbitrary.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [arbitrary.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd91839e-b834-4e98-a5f8-1f2a30a5d2c0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Delete Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + arbitrary.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHORIZED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c681f7f2-81d5-469c-8cc9-d4277144f362&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if arbitrary not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Delete Should get error if arbitrary not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + &#x27;dummy&#x27;)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send(arbitraryData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.RECORD_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7da5cbb2-fc91-4039-988a-9ab497b609d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should delete arbitrary, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Delete Should delete arbitrary, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.delete(apiURL + arbitrary.uid)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            arbitrary = res.body.output\n            expect(arbitrary.delete_at).not.to.be.null;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b98d4e7-6826-45a2-936c-e1621d5fa1f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c681f7f2-81d5-469c-8cc9-d4277144f362&quot;,&quot;7da5cbb2-fc91-4039-988a-9ab497b609d7&quot;,&quot;3b98d4e7-6826-45a2-936c-e1621d5fa1f3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:11,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;812a1d75-de8b-49bc-8fe7-314817db13a9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\fetchConfig.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\fetchConfig.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;32a0dbe9-3fb0-47d7-bc96-fc45a33bae1e&quot;,&quot;title&quot;:&quot;Utility.FetchConfig&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\fetchConfig.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\fetchConfig.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get required config.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.FetchConfig Should get required config.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output).to.have.any.keys(keySet);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;824e0ddf-75e0-4c32-a086-efe198c7d381&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;824e0ddf-75e0-4c32-a086-efe198c7d381&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:6,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b2de1497-29c4-4067-a0c5-d847f70f0d5d&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getArbitrary.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3d7535c6-ceab-4170-9b92-35cd88a9f070&quot;,&quot;title&quot;:&quot;Arbitrary.Get&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getArbitrary.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Get \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken[0];\n        api.post(apiURL)\n            .set({ ui_admin_key: config.UI_ADMIN_KEY })\n            .send(arbitraryData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    arbitrary = res.body.output\n                    done();\n                }\n            });\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f26c9a1-3182-49c8-a592-fe147058cee9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Get \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Arbitrary.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [arbitrary.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;759c8a98-2c34-4881-9f25-f00f51c0f47c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get error if arbitrary not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Get Should get error if arbitrary not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;dummy&#x27;)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.RECORD_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1282840-6745-42ff-9a5b-54cea91d6009&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get arbitrary.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Get Should get arbitrary.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + arbitrary.uid)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            arbitrary = res.body.output\n            expect(arbitrary.data).to.be.a(&#x27;object&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17a56204-530d-4940-b691-50d5bc80567a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get arbitrary by sending only[data]=true.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Get Should get arbitrary by sending only[data]=true.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + arbitrary.uid + &#x27;?only[data]=true&#x27;)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body).to.be.a(&#x27;object&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f7074ff9-373b-4214-8267-ba92c971ddc3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f1282840-6745-42ff-9a5b-54cea91d6009&quot;,&quot;17a56204-530d-4940-b691-50d5bc80567a&quot;,&quot;f7074ff9-373b-4214-8267-ba92c971ddc3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a2f48332-f406-4f21-be48-2bf125990ac4&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getAuditLogs.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getAuditLogs.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4555adfd-5e35-42cc-baa9-8a52717f7ea4&quot;,&quot;title&quot;:&quot;Utility.getAuditLogs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getAuditLogs.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getAuditLogs.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:126,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                dummyUser.authtoken = dummyUser.authtoken;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                    cbk(err, userTrigger);\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                _id = dummyUser._id\n                flowData.trigger.handlers = [userTriggerObj]\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res, userTriggerObj)\n                    })\n            },\n            function(res, userTrigger, cbk) {\n                userFlow = res.body.output;\n                flowData.trigger.handlers = [userTriggerObj]\n                api.post(flowURL)\n                    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                orgFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4f073ef-1980-4212-9f37-75ff7e5519f6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cb) {\n        _models.ConfigData.remove({ flow_uid: userFlow.uid }, function(err) {\n            cb(err);\n        })\n    },\n    function(cb) {\n        _models.ConfigSchema.remove({ flow_uid: userFlow.uid }, function(err) {\n            cb(err);\n        })\n    },\n    function(cb) {\n        removeFlow([userFlow.uid, (sharedFlow || {}).uid], function(err, deletedFlows) {\n            cb(err, deletedFlows);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56bf7a91-cce2-4618-bc88-811fd24d4936&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .send(shareCriteria)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8883c5a7-eb63-49b4-b43d-387df451c3b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get org audit logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get org audit logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set({ &#x27;authtoken&#x27;: dummyUser.authtoken, org_uid: orgData.organization.uid })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).metadata.org_uid).to.be.equal(orgData.organization.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;396a5dce-4ff5-40dc-8f3a-75cc181b4b40&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get own audit logs.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get own audit logs.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).owner_uid).to.be.equal(dummyUser.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5163ffd3-7d6e-46f4-812f-b95459e94e89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by module.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by module.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?modules=Workflow&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).module).to.be.equal(&#x27;Workflow&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19f44730-ff66-4971-95b6-67e8be07035c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by actions.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by actions.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?actions=Create&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).event_type).to.be.equal(&#x27;Create&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;083bcf66-683a-4443-beb0-6a57bc47c427&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by created_by.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by created_by.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?created_by=&#x27; + dummyUser.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).created_by).to.be.equal(dummyUser.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c4bec400-6999-4208-b94d-c7022e0cea1f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by project_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by project_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?project_uid=&#x27; + userFlow.project_uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).metadata.project_uid).to.be.equal(userFlow.project_uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;230ccd8c-3ac4-4a80-a15f-8c7e21d04228&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by workflow_uid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by workflow_uid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?workflow_uid=&#x27; + userFlow.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).metadata.workflow_uid).to.be.equal(userFlow.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;af353ef9-09ca-4125-94bb-45d0be9ec92e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get audit logs by startDate.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getAuditLogs Should get audit logs by startDate.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?startDate=&#x27; + moment.utc().format())\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output.objects).metadata.project_uid).to.be.equal(userFlow.project_uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;edcb41a1-98f0-4277-8122-1c8315bb73ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8883c5a7-eb63-49b4-b43d-387df451c3b9&quot;,&quot;396a5dce-4ff5-40dc-8f3a-75cc181b4b40&quot;,&quot;5163ffd3-7d6e-46f4-812f-b95459e94e89&quot;,&quot;19f44730-ff66-4971-95b6-67e8be07035c&quot;,&quot;083bcf66-683a-4443-beb0-6a57bc47c427&quot;,&quot;c4bec400-6999-4208-b94d-c7022e0cea1f&quot;,&quot;230ccd8c-3ac4-4a80-a15f-8c7e21d04228&quot;,&quot;af353ef9-09ca-4125-94bb-45d0be9ec92e&quot;,&quot;edcb41a1-98f0-4277-8122-1c8315bb73ee&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:153,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f966d87a-9f01-4d80-b1d3-5395d356ced9&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0641d2bb-70c3-4d0f-8211-8b093627516e&quot;,&quot;title&quot;:&quot;Utility&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;af72faad-659c-4e65-8a4e-3ee1d550e2c1&quot;,&quot;title&quot;:&quot;Utility.getCustomCss&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.getCustomCss \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({$or:[{email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;)},{email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;)}]}, function(error, user) {\n    _models.Mail.remove({$or:[{to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;)},{to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;)}]}, function(error, user) {\n        _models.CustomCss.remove({ label: new RegExp(&#x27;^UNIT_TEST_LABEL_+&#x27;, \&quot;i\&quot;) }, function(error, user) {\n            saveCustomCSS({}, function(errors, cssEntries) {\n                _cssEntries = cssEntries;\n                done();\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3faffcaf-e2b2-4775-bc82-6300e1259dba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get specific published custom css.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.getCustomCss Should get specific published custom css.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:uid\&quot;, _cssEntries[1].uid))\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.uid.should.not.empty;\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ecb499ce-e44a-453d-a6c7-a59f40ed26b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error, if customcss not found .&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.getCustomCss Should get error, if customcss not found .&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_CSS_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;01d550c3-583e-4e0f-b590-6e0000dc3af8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should not get unpublished custom css.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.getCustomCss Should not get unpublished custom css.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL.replace(\&quot;:uid\&quot;, _cssEntries[0].uid))\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.CUSTOM_CSS_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3cb48f7-3cf9-4a70-a46d-780f93bdf8ef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ecb499ce-e44a-453d-a6c7-a59f40ed26b5&quot;,&quot;01d550c3-583e-4e0f-b590-6e0000dc3af8&quot;,&quot;c3cb48f7-3cf9-4a70-a46d-780f93bdf8ef&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;00ac91d8-33fb-4d00-b093-ce73e6fc4ed7&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getUsage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getUsage.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a1fa8cac-ec16-4be7-b010-bd22705c74c7&quot;,&quot;title&quot;:&quot;Utility.getUsage&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getUsage.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getUsage.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        async.waterfall([\n            function(cbk) {\n                dummyUser = orgData.owner;\n                testData.mongoUserTriggerObj.user_uid = dummyUser.uid;\n                _models.CustomIntegration.remove().exec(function(err) {\n                    _models.UserTrigger.create(testData.mongoUserTriggerObj, function(err, userTrigger) {\n                        cbk(err, userTrigger);\n                    })\n                })\n            },\n            function(userTrigger, cbk) {\n                userTriggerObj = userTrigger\n                _id = dummyUser._id\n                flowData.trigger.handlers = [userTriggerObj]\n                api.post(flowURL)\n                    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n                    .send(flowData)\n                    .expect(httpStatus.CREATED)\n                    .end(function(err, res) {\n                        cbk(err, res)\n                    })\n            }\n        ], function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                userFlow = res.body.output;\n                done()\n            }\n        })\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c6cee41-d8e2-47c8-931a-bf903e03b32b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.waterfall([\n    function(cb) {\n        removeFlow([userFlow.uid, (sharedFlow || {}).uid], function(err, deletedFlows) {\n            cb(err, deletedFlows);\n        })\n    },\n    function(deletedFlows, cb) {\n        _models.UserTrigger.remove({ uid: userTriggerObj.uid }, function(err, deletedUserTrigger) {\n            cb(err, deletedUserTrigger);\n        })\n    }\n], function(err, result) {\n    if (err) {\n        done(err)\n    } else {\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ce00403-ad03-4b79-9a7b-2e1e75ffff07&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage Should give unauthenticated user error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?trigger=&#x27; + userTriggerObj.uid)\n    .send(shareCriteria)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHENTICATED_USER);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e13583e1-a92c-4d49-a9c2-c4699eea4a4e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get trigger data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage Should get trigger data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?trigger=&#x27; + userTriggerObj.uid)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output.length).to.be.equal(1)\n            expect(_.first(_.first(res.body.output).activities)).to.be.equal(&#x27;start&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c255dfe-ead2-4899-9de8-f5bd2c88d1ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get auth data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage Should get auth data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?auth=fl5adf8ba83fd0ec3ddb949f&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output.length).to.be.equal(1)\n            expect(_.first(_.first(res.body.output).activities)).to.be.equal(&#x27;a0&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8abc02f-2bb3-447e-9e89-e4b10bad1451&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get connection data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage Should get connection data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?connection=fl2a1c66a0103e97e0f2cec5&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            //expect(res.body.output.length).to.be.equal(1)\n            expect(_.first(_.first(res.body.output).activities)).to.be.equal(&#x27;a1&#x27;)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9c1c53a-6033-4180-b5f6-e33847dd00af&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get agent data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsage Should get agent data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL + &#x27;?agent=ega9d1573323eb3fa10436fe0&#x27;)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(shareCriteria)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            Array.isArray(res.body.output).should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6a3ea406-c983-4676-aca2-734f1033e9eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e13583e1-a92c-4d49-a9c2-c4699eea4a4e&quot;,&quot;6c255dfe-ead2-4899-9de8-f5bd2c88d1ec&quot;,&quot;e8abc02f-2bb3-447e-9e89-e4b10bad1451&quot;,&quot;b9c1c53a-6033-4180-b5f6-e33847dd00af&quot;,&quot;6a3ea406-c983-4676-aca2-734f1033e9eb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:51,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;cc62f065-ce23-4b50-a50d-59663ca78b69&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getUsersData.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getUsersData.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f7fc2b26-9d4d-4289-bc9b-e2c4365d01d1&quot;,&quot;title&quot;:&quot;Utility.getUsersData&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\getUsersData.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\getUsersData.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsersData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken;\n        usersData = { users: [dummyUser.uid] }\n        done()\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9d09abe-ebd8-4919-9f62-a4c038f83833&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get users data.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility.getUsersData Should get users data.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send(usersData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(_.first(res.body.output).uid).to.be.equal(dummyUser.uid)\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea162b0c-93cc-4cb2-9225-2f6ff2c415c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ea162b0c-93cc-4cb2-9225-2f6ff2c415c1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;02758c0e-a82e-4ada-9be6-78ad8d11f0c1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a0c4116f-8671-4d18-9ba1-4c1f27210057&quot;,&quot;title&quot;:&quot;Utility&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dc81c85e-4f4d-4f1c-b4e3-326d9fdd1cb3&quot;,&quot;title&quot;:&quot;Utility.createInstallationData&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\installationDataProxy.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.createInstallationData \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\n_models.User.remove({ email: testData.testRegistrationBody.email }, function(error, user) {\n    api.post(\&quot;/enterprise/v1/signup\&quot;)\n        .send(testData.testRegistrationBody)\n        .expect(httpStatus.CREATED)\n        .end(function(err, res) {\n            if (err) {\n                done(err);\n            } else {\n                dummyUser = res.body.output;\n                done();\n            }\n        });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8665d557-fd1b-4311-abed-46ca69be9916&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should create installation data at builtio backend.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.createInstallationData Should create installation data at builtio backend.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.builtInstallationData(httpmock, \&quot;enterprise\&quot;);\n\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .expect(httpStatus.OK)\n    .send(data)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.output.notice).to.be.equal(response.output.notice);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5da0781c-78cb-476b-ba4b-519affe01335&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5da0781c-78cb-476b-ba4b-519affe01335&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;132de80f-58e6-437d-ad07-23d461b572f2&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1009d876-7792-4d87-8b0a-a04afbac4fdb&quot;,&quot;title&quot;:&quot;Utility&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;18966e5a-f632-4ad8-9484-386f217bdfd1&quot;,&quot;title&quot;:&quot;Utility.listCustomCss&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\listCustomCss.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.listCustomCss \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n_models.User.remove({ $or: [{ email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { email: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n    _models.Mail.remove({ $or: [{ to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }, { to: new RegExp(&#x27;^test.user+&#x27;, \&quot;i\&quot;) }] }, function(error, user) {\n        _models.CustomCss.remove({ label: new RegExp(&#x27;^UNIT_TEST_LABEL_+&#x27;, \&quot;i\&quot;) }, function(error, user) {\n            saveCustomCSS({}, function(errors, cssEntries) {\n                done();\n            });\n        });\n    });\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;24be2a5b-64a2-40d3-be22-a9c118df925e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should get publish list of custom css.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.listCustomCss Should get publish list of custom css.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(apiURL)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            var isValid = res.body.output.length &gt;= 5;\n            isValid.should.equal(true);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd1234f1-374e-43f5-8527-4cfc048cd9b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cd1234f1-374e-43f5-8527-4cfc048cd9b3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;dc7d7f71-58b7-470b-b58b-e94c0034eef1&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;004016af-d19a-4d31-b4cc-dfe59e4d0e41&quot;,&quot;title&quot;:&quot;Utility&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8d2bea23-3a77-4656-a104-34d863ad31e0&quot;,&quot;title&quot;:&quot;Utility.LogError&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\logError.enterprise.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.LogError \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nasync.waterfall([\n    function(cbk) {\n        _models.User.remove({ email: testData.testRegistrationBody.email }, function(err, user) {\n            cbk(err, user);\n        })\n    },\n    function(user, cbk) {\n        api.post(\&quot;/enterprise/v1/signup\&quot;)\n            .send(testData.testRegistrationBody)\n            .expect(httpStatus.CREATED)\n            .end(function(err, result) {\n                cbk(err, result);\n            })\n    }\n], function(err, res) {\n    if (err) {\n        done(err);\n    } else {\n        dummyUser = res.body.output;\n        done()\n    }\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b464c5bf-3254-4644-936e-601337525eb8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should log an error.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Utility Utility.LogError Should log an error.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(apiURL)\n    .set(&#x27;authtoken&#x27;, dummyUser.authtoken)\n    .send({ error: &#x27;error&#x27; })\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.output.message.should.equal(&#x27;done&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ac56802-36a4-4ce6-b449-36ef36e9d421&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7ac56802-36a4-4ce6-b449-36ef36e9d421&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;30d24d10-adfc-4c6b-bef9-36608621822e&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\updateArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\updateArbitrary.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;07dd516f-a516-4d88-a0f5-045b133753e0&quot;,&quot;title&quot;:&quot;Arbitrary.Update&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\utility\\updateArbitrary.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\utility\\updateArbitrary.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, \&quot;enterprise\&quot;);\nvar testCollection = require(\&quot;../testCollection\&quot;);\ntestCollection.organizationRemoveRecords({}, function() {\n    testCollection.organizationRecordsEntry({}, function(data) {\n        orgData = data;\n        dummyUser = orgData.owner;\n        dummyUser.authtoken = dummyUser.authtoken[0];\n        api.post(apiURL)\n            .set({ ui_admin_key: config.UI_ADMIN_KEY })\n            .send(arbitraryData)\n            .expect(httpStatus.CREATED)\n            .end(function(err, res) {\n                if (err) {\n                    done(err);\n                } else {\n                    arbitrary = res.body.output\n                    done();\n                }\n            });\n    });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dee31ef3-e612-4465-aa79-bcc887132369&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update \&quot;after all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nasync.parallel([\n        function(cb) {\n            _models.Arbitrary.remove({\n                    uid: {\n                        \&quot;$in\&quot;: [arbitrary.uid]\n                    }\n                },\n                function(err) {\n                    cb(err)\n                })\n        }\n    ],\n    function(err, result) {\n        if (err) {\n            done(err)\n        } else {\n            done()\n        }\n    })&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fca1c955-c50f-4a69-a209-8a540de72c72&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;Should give unauthenticated user error for unauthorised user.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update Should give unauthenticated user error for unauthorised user.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + arbitrary.uid)\n    .expect(httpStatus.UNAUTHORIZED)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            res.body.error.message.should.equal(messageList.UNAUTHORIZED);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b64aa0a1-e007-4cb4-b035-709395d9e8f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error if arbitrary not found.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update Should get error if arbitrary not found.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + &#x27;dummy&#x27;)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send(arbitraryData)\n    .expect(httpStatus.NOT_FOUND)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).to.be.equal(messageList.RECORD_NOT_FOUND);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;92a669d5-ade5-48ee-a08c-5a22e8a6cd80&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should update arbitrary, if data is valid.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update Should update arbitrary, if data is valid.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + arbitrary.uid)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send(arbitraryData)\n    .expect(httpStatus.OK)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            arbitrary = res.body.output\n            expect(arbitrary.data).to.be.a(&#x27;object&#x27;);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6199f7a2-bf3c-4f4e-8914-f2fd99380ddb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Should get error,  if \&quot;data\&quot; key is missing.&quot;,&quot;fullTitle&quot;:&quot;Enterprise Arbitrary.Update Should get error,  if \&quot;data\&quot; key is missing.&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(apiURL + arbitrary.uid)\n    .set({ ui_admin_key: config.UI_ADMIN_KEY })\n    .send({})\n    .expect(httpStatus.BAD_REQUEST)\n    .end(function(err, res) {\n        if (err) {\n            done(err);\n        } else {\n            expect(res.body.error.message).equal(messageList.PLEASE_SEND_VALID_PARAMETERS);\n            done();\n        }\n    });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62dc0b30-8306-4dc3-8b50-3a565f3444c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b64aa0a1-e007-4cb4-b035-709395d9e8f5&quot;,&quot;92a669d5-ade5-48ee-a08c-5a22e8a6cd80&quot;,&quot;6199f7a2-bf3c-4f4e-8914-f2fd99380ddb&quot;,&quot;62dc0b30-8306-4dc3-8b50-3a565f3444c8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;598f3e38-ffd9-4da3-a6f5-54c009d32d60&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\z_synergy\\portal.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\z_synergy\\portal.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e481a8ef-f026-426f-8115-79188edc5792&quot;,&quot;title&quot;:&quot;Synergy APIs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\z_synergy\\portal.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\z_synergy\\portal.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1541,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ntestCollection.setupEmbedDB(()=&gt;{\n  commonMock.setSignUpMocks(httpmock, &#x27;enterprise&#x27;);\n  \n  // MOCK TRIGGER SERVER CALLS------------\n     const trigger = nmock(&#x27;http://localhost:9090&#x27;).get(&#x27;/triggers/tg0d1de171b253ddc0c37ae2&#x27;).reply(200,synergyData.createSolutionTriggerData);\n  //---------------------------------------\n  \n  api.post(&#x27;/enterprise/v1/login&#x27;)\n  .send(synergyData.login)\n  .end((err, res) =&gt; {\n      if (err) {\n          done(err);\n      } else {\n          loginData = res.body;\n          accountHeader.authtoken = loginData.output.authtoken;\n          done();\n      }\n  });\n})&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19df456e-e35a-4bcf-8915-608d29d6cdfb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create the specified solution&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should create the specified solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.post(&#x27;/synergy/v1/embed/solution&#x27;).set(accountHeader).send(synergyData.solutionCreate).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;uid&#x27;);\n res.body.output.should.have.property(&#x27;updated_at&#x27;);\n res.body.output.should.have.property(&#x27;created_at&#x27;);\n solution.solutionId = res.body.output.uid;\ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e6f4c5e-1413-4eee-9dbc-33199ee6cb77&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should publish the solution version to production&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should publish the solution version to production&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.post(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/deploy&#x27;).set(accountHeader).send({\&quot;publish\&quot;:true}).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;uid&#x27;);\n res.body.output.uid.should.be.a(&#x27;string&#x27;);\n res.body.output.should.have.property(&#x27;environment&#x27;);\n res.body.output.environment.should.be.a(&#x27;object&#x27;);\n res.body.output.environment.should.have.property(&#x27;project_params&#x27;);\n res.body.output.environment.project_params.should.be.a(&#x27;array&#x27;);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ab3d3ba-0d95-4b6a-9236-c4e0f876144c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all the types of embed accounts&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all the types of embed accounts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/accounts?sortBy=desc&amp;orderBy=created_at&amp;limit=15&#x27;).set(accountHeader).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.be.a(&#x27;object&#x27;);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;count&#x27;);\n   res.body.output.should.have.property(&#x27;skip&#x27;);\n   res.body.output.should.have.property(&#x27;accounts&#x27;);\n   res.body.output.should.have.property(&#x27;limit&#x27;);\n   res.body.output.accounts.should.be.a(&#x27;array&#x27;);\n   miscAccUid = res.body.output.accounts[0].uid;\n   if(res.body.output.limit &gt;= res.body.output.count) {\n     expect(parseInt(res.body.output.count,10)).equals(res.body.output.accounts.length);\n   }else {\n     expect(parseInt(res.body.output.limit,10)).equals(res.body.output.accounts.length);\n   }\n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cbff1ab9-ad0e-47bd-9684-94874ccee4da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all the users for a apecific account&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all the users for a apecific account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n         api.get(&#x27;/synergy/v1/embed/accounts/&#x27;+miscAccUid+&#x27;/users&#x27;).set(accountHeader).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;count&#x27;);\n res.body.output.should.have.property(&#x27;skip&#x27;);\n res.body.output.should.have.property(&#x27;limit&#x27;);\n done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83f95691-dc18-475d-b147-3d258cbdb23a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all the consumer plans&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all the consumer plans&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(&#x27;/synergy/v1/embed/consumers/plans?sortBy=desc&amp;orderBy=created_at&amp;limit=15&#x27;).set(accountHeader).end((err, res) =&gt; {\n \n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;count&#x27;);\n res.body.output.should.have.property(&#x27;skip&#x27;);\n res.body.output.should.have.property(&#x27;limit&#x27;);\n res.body.output.should.have.property(&#x27;plans&#x27;);\n res.body.output.plans.should.be.a(&#x27;array&#x27;);  \n \n if(res.body.output.limit &gt;= res.body.output.count) {\n   expect(parseInt(res.body.output.count,10)).equals(res.body.output.plans.length);\n }else {\n   expect(parseInt(res.body.output.limit,10)).equals(res.body.output.plans.length);\n }   \n done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e568660-086f-42a3-8de6-7d8888353fc3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all the user details for embed&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all the user details for embed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/users?orderBy=created_at&amp;sortBy=desc&amp;limit=15&#x27;).set(accountHeader).end((err, res) =&gt; {\n  \n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;count&#x27;);\n  res.body.output.should.have.property(&#x27;skip&#x27;);\n  res.body.output.should.have.property(&#x27;limit&#x27;);\n  res.body.output.should.have.property(&#x27;objects&#x27;);\n  res.body.output.objects.should.be.a(&#x27;array&#x27;);  \n  \n  if(res.body.output.limit &gt;= res.body.output.count) {\n    expect(parseInt(res.body.output.count,10)).equals(res.body.output.objects.length);\n  }else {\n    expect(parseInt(res.body.output.limit,10)).equals(res.body.output.objects.length);\n  }   \n  done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;709db34d-2dd5-4619-9deb-e46962ca7f3b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all the auths &quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all the auths &quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n             api.get(&#x27;/synergy/v1/auths?orderBy=created_at&amp;sortBy=desc&amp;limit=15&#x27;).set(accountHeader).end((err, res) =&gt; {\n\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;output&#x27;);\nres.body.output.should.be.a(&#x27;object&#x27;);\nres.body.output.should.have.property(&#x27;count&#x27;);\nres.body.output.should.have.property(&#x27;skip&#x27;);\nres.body.output.should.have.property(&#x27;limit&#x27;);\nres.body.output.should.have.property(&#x27;auths&#x27;);\nres.body.output.auths.should.be.a(&#x27;array&#x27;);  \n\nif(res.body.output.limit &gt;= res.body.output.count) {\n  expect(parseInt(res.body.output.count,10)).equals(res.body.output.auths.length);\n}else {\n  expect(parseInt(res.body.output.limit,10)).equals(res.body.output.auths.length);\n}   \ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;459d1d01-74d8-4ddd-89bf-86f365f1c9c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all enabled the auths &quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all enabled the auths &quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n       api.get(&#x27;/synergy/v1/embed/auths?orderBy=created_at&amp;sortBy=desc&amp;limit=15&#x27;).set(accountHeader).end((err, res) =&gt; {\n\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;output&#x27;);\nres.body.output.should.be.a(&#x27;object&#x27;);\nres.body.output.should.have.property(&#x27;count&#x27;);\nres.body.output.should.have.property(&#x27;skip&#x27;);\nres.body.output.should.have.property(&#x27;limit&#x27;);\nres.body.output.should.have.property(&#x27;auths&#x27;);\nres.body.output.auths.should.be.a(&#x27;array&#x27;);  \n\nif(res.body.output.limit &gt;= res.body.output.count) {\n  expect(parseInt(res.body.output.count,10)).equals(res.body.output.auths.length);\n}else {\n  expect(parseInt(res.body.output.limit,10)).equals(res.body.output.auths.length);\n}   \ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;642487f5-c555-416b-82e2-1f2eef7414eb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all required keys for embed admin&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all required keys for embed admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n           api.get(&#x27;/synergy/v1/embed/environment/keys&#x27;).set(accountHeader).end((err, res) =&gt; {\n\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;output&#x27;);\nres.body.output.should.be.a(&#x27;object&#x27;);\nres.body.output.should.have.property(&#x27;provider_verification_token&#x27;);\nres.body.output.should.have.property(&#x27;source_verification_token&#x27;);\nres.body.output.should.have.property(&#x27;identifier&#x27;);\nres.body.output.should.have.property(&#x27;api_key&#x27;);        \ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a83dcc5-492b-468b-9292-3cb615d98f7a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all available solutions embed admin&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all available solutions embed admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:140,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n           api.get(&#x27;/synergy/v1/embed/solution?orderBy=created_at&amp;sortBy=desc&amp;limit=15&#x27;).set(accountHeader).end((err, res) =&gt; {\n\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;output&#x27;);\nres.body.output.should.be.a(&#x27;object&#x27;);\nres.body.output.should.have.property(&#x27;count&#x27;);\nres.body.output.should.have.property(&#x27;skip&#x27;);\nres.body.output.should.have.property(&#x27;limit&#x27;);  \nres.body.output.should.have.property(&#x27;solutions&#x27;); \nres.body.output.solutions.should.be.a(&#x27;array&#x27;);  \n   \nif(res.body.output.limit &gt;= res.body.output.count) {\n  expect(parseInt(res.body.output.count,10)).equals(res.body.output.solutions.length);\n }else {\n expect(parseInt(res.body.output.limit,10)).equals(res.body.output.solutions.length);\n }    \ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb1f367c-6190-47dd-8410-7e467413a5d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fetch all solution versions for given solution&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fetch all solution versions for given solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n           api.get(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/version&#x27;).set(accountHeader).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;output&#x27;);\nres.body.output.should.be.a(&#x27;array&#x27;);\ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;732e8455-cedd-4ff3-89f2-a3ceea16ecb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fetch a specific solution version for given solution&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fetch a specific solution version for given solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n               api.get(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/version/1&#x27;).set(accountHeader).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;output&#x27;);\nres.body.output.should.be.a(&#x27;object&#x27;);\ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fa9cb8b-8687-4141-b79e-10a8ce668822&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fetch all solution users given solution&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fetch all solution users given solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/users&#x27;).set(accountHeader).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.be.a(&#x27;object&#x27;);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;count&#x27;);\n   res.body.output.should.have.property(&#x27;skip&#x27;);\n   res.body.output.should.have.property(&#x27;limit&#x27;);  \n   res.body.output.should.have.property(&#x27;users&#x27;); \n   res.body.output.users.should.be.a(&#x27;array&#x27;);  \n      \n   if(res.body.output.limit &gt;= res.body.output.count) {\n     expect(parseInt(res.body.output.count,10)).equals(res.body.output.users.length);\n    }else {\n    expect(parseInt(res.body.output.limit,10)).equals(res.body.output.users.length);\n    }    \n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98bd8d15-9e0e-495b-8d9c-51e205d7aa56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fetch all plans by consumer id&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fetch all plans by consumer id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/consumers/&#x27;+synergyData.miscData.consumer.id+&#x27;/plan&#x27;).set(accountHeader).end((err, res) =&gt; {\n       \n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.be.a(&#x27;object&#x27;);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;consumer_count&#x27;);\n   res.body.output.should.have.property(&#x27;uid&#x27;);\n   res.body.output.should.have.property(&#x27;users&#x27;);  \n   res.body.output.users.should.be.a(&#x27;array&#x27;);         \n     expect(parseInt(res.body.output.consumer_count,10)).equals(res.body.output.users.length);            \n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;752c1e21-cf38-4a96-a534-297ec033fe3e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fetch all consumer deployments by consumer id&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fetch all consumer deployments by consumer id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/consumers/&#x27;+synergyData.deployments.consumerId+&#x27;/deployments&#x27;).set(accountHeader).end((err, res) =&gt; {\n       \n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.be.a(&#x27;object&#x27;);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);   \n   res.body.output.should.have.property(&#x27;deployments&#x27;);\n   res.body.output.deployments.should.be.a(&#x27;array&#x27;); \n   depUid = res.body.output.deployments[0].uid;\n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14982752-f5e1-473a-8f40-0f5d4fd0e0ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fetch all deployment stats by deployment id&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fetch all deployment stats by deployment id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/deployment/&#x27;+depUid+&#x27;/stats&#x27;).set(accountHeader).end((err, res) =&gt; {\n         \n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.be.a(&#x27;object&#x27;);\n   res.body.should.have.property(&#x27;output&#x27;);\n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4da6125-2d04-42ff-96e9-5339d0c90da4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fetch all consumer stats by consumer id&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fetch all consumer stats by consumer id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/consumers/&#x27;+synergyData.miscData.consumer.id+&#x27;/stats&#x27;).set(accountHeader).end((err, res) =&gt; {\n       \n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.be.a(&#x27;object&#x27;);\n   res.body.should.have.property(&#x27;output&#x27;);       \n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b744cc09-7e87-4657-b678-b6b2df4a99ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get usage stats for embed admin&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get usage stats for embed admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.get(&#x27;/synergy/v1/embed/stats/usage&#x27;).set(accountHeader).end((err, res) =&gt; {\n\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;output&#x27;);      \n});\ndone();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9051cb0e-4ef3-499c-9f34-363a7bce9713&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all active accounts under stats for embed admin&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all active accounts under stats for embed admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n         api.get(&#x27;/synergy/v1/embed/stats/active_accounts&#x27;).set(accountHeader).end((err, res) =&gt; {\n         \n         res.should.have.property(&#x27;status&#x27;,200);\n         res.body.should.be.a(&#x27;object&#x27;);\n         res.body.should.have.property(&#x27;output&#x27;);      \n         });\n         done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9216908f-3299-4522-a010-32e293d85bc2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get integrations under stats for embed admin&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get integrations under stats for embed admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n           api.get(&#x27;/synergy/v1/embed/stats/integrations&#x27;).set(accountHeader).end((err, res) =&gt; {\n           \n           res.should.have.property(&#x27;status&#x27;,200);\n           res.body.should.be.a(&#x27;object&#x27;);\n           res.body.should.have.property(&#x27;output&#x27;);      \n           });\n           done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46fe51d6-0b2c-4f54-bef9-8846fbb7e758&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all active consumers under stats for embed admin&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all active consumers under stats for embed admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/stats/active_consumers&#x27;).set(accountHeader).end((err, res) =&gt; {\n \n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;output&#x27;);      \n });\n done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc30183f-3b9e-442b-930e-856f9782dc3d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get all active integrations under stats for embed admin&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should get all active integrations under stats for embed admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/stats/active_integrations&#x27;).set(accountHeader).end((err, res) =&gt; {\n \n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;output&#x27;);      \n });\n done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55d8cb7a-6553-4232-8b5d-eae2eaa7c62e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail while getting embed accounts , missing auth token&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail while getting embed accounts , missing auth token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\naccountHeaderFalse.authtoken = &#x27;&#x27;;\n api.get(&#x27;/synergy/v1/embed/accounts?sortBy=desc&amp;orderBy=created_at&amp;limit=15&#x27;).set(accountHeaderFalse).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,401);\n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6392eb0-28e4-48ed-bf4c-fecbefbea127&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail while getting embed accounts , wrong auth token&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail while getting embed accounts , wrong auth token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n       accountHeaderFalse.authtoken = &#x27;fxccmbtytyu&#x27;;\n api.get(&#x27;/synergy/v1/embed/accounts?sortBy=desc&amp;orderBy=created_at&amp;limit=15&#x27;).set(accountHeaderFalse).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,401);\n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba39d3cc-042d-48c4-8be1-d31ab41ab5f6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail while getting embed accounts , wrong org uid&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail while getting embed accounts , wrong org uid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;accountHeaderFalse = _.cloneDeep(accountHeader)\naccountHeaderFalse.org_uid = &#x27;sadsadjhasdh&#x27;\n        this.timeout(apiTimeOut);\napi.get(&#x27;/synergy/v1/embed/accounts?sortBy=desc&amp;orderBy=created_at&amp;limit=15&#x27;).set(accountHeaderFalse).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,404);\n  done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;591e4fdb-5fc2-4b37-8870-d69650e1b8a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail while getting embed accounts , no org uid&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail while getting embed accounts , no org uid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;accountHeaderFalse = _.cloneDeep(accountHeader)\naccountHeaderFalse.org_uid = &#x27;&#x27;;\naccountHeaderFalse.environment = &#x27;sandbox&#x27;;\n       this.timeout(apiTimeOut);\napi.get(&#x27;/synergy/v1/embed/accounts?sortBy=desc&amp;orderBy=created_at&amp;limit=15&#x27;).set(accountHeaderFalse).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,401);\n  done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f1fb2ba-ebdb-4dab-818a-831658cab0dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail while getting embed accounts , no environment&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail while getting embed accounts , no environment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;accountHeaderFalse = _.cloneDeep(accountHeader)\naccountHeaderFalse.environment = &#x27;&#x27;;\n       this.timeout(apiTimeOut);\napi.get(&#x27;/synergy/v1/embed/accounts?sortBy=desc&amp;orderBy=created_at&amp;limit=15&#x27;).set(accountHeaderFalse).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91cfe50e-f18f-43f1-9aad-7325d158b1aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail while getting embed accounts , wrong environment&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail while getting embed accounts , wrong environment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;accountHeaderFalse = _.cloneDeep(accountHeader)\naccountHeaderFalse.org_uid = &#x27;handbox&#x27;;\n       this.timeout(apiTimeOut);\napi.get(&#x27;/synergy/v1/embed/accounts?sortBy=desc&amp;orderBy=created_at&amp;limit=15&#x27;).set(accountHeaderFalse).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,404);\n  done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2745cbce-2644-4a1e-a351-1758c7cbbc12&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail while getting embed accounts , no header&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail while getting embed accounts , no header&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/accounts?sortBy=desc&amp;orderBy=created_at&amp;limit=15&#x27;).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,401);\n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9f326efe-09e9-4d13-8a37-c307b6c28f6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail in fetching all solution by consumer id, (WRONG ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail in fetching all solution by consumer id, (WRONG ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/consumers/dsjhfkhadf8879/plan&#x27;).set(accountHeader).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,400);       \n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3e66eb54-e1fe-45ef-a949-079d0b0792b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail in fetching all solution versions for given solution, (WRONG ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail in fetching all solution versions for given solution, (WRONG ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n           api.get(&#x27;/synergy/v1/embed/solution/sahjdbjabd87d98/version&#x27;).set(accountHeader).end((err, res) =&gt; {  \nres.should.have.property(&#x27;status&#x27;,400);\ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;89e53f99-9284-4f9d-acdc-38d5e59fcf8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail in fetching a specific version for given solution&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail in fetching a specific version for given solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n           api.get(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/version/8&#x27;).set(accountHeader).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,400);\n  done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20089555-f268-4bad-a21f-ecfffbbfc23e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail in fetching all solution users given solution (WRONG ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail in fetching all solution users given solution (WRONG ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/solution/skjdhiusahidu5695sad/users&#x27;).set(accountHeader).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,400);    \n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;26b94d0b-2957-485a-ac19-b5b961189509&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get all the users for a apecific account (WRONG UID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to get all the users for a apecific account (WRONG UID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n       api.get(&#x27;/synergy/v1/embed/accounts/dfs54s6f5sf87f/users&#x27;).set(accountHeader).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,400);\n done();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;303d7a5b-072e-49f7-9b45-b87ff5d38ce1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail in fetching all consumer deployments by consumer id (WRONG ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail in fetching all consumer deployments by consumer id (WRONG ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/consumers/sad64sad6f54854f/deployments&#x27;).set(accountHeader).end((err, res) =&gt; {\n   \n   res.should.have.property(&#x27;status&#x27;,400);      \n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0ff7dd4f-65fd-4f29-92bc-8b91dcb8abd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail in fetching all deployment stats by deployment id&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail in fetching all deployment stats by deployment id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/deployment/snhdjisahdkd4787d/stats&#x27;).set(accountHeader).end((err, res) =&gt; {\n       \n   res.should.have.property(&#x27;status&#x27;,400);\n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f44722c9-5b4c-4c2b-9310-ddc1f47b9035&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail in fetching all consumer stats by consumer id (WRONG ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail in fetching all consumer stats by consumer id (WRONG ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.get(&#x27;/synergy/v1/embed/consumers/fds6a4f5644846gds/stats&#x27;).set(accountHeader).end((err, res) =&gt; {\n   \n   res.should.have.property(&#x27;status&#x27;,400);    \n   done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;beb82807-b27d-4a1a-b680-c59e85178930&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add a new account with a plan&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should add a new account with a plan&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n     api.post(&#x27;/synergy/v1/embed/accounts&#x27;).set(accountHeader).send({\&quot;name\&quot;:synergyData.account.name, \&quot;plan\&quot;: synergyData.account.plan}).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;uid&#x27;);\n res.body.output.uid.should.be.a(&#x27;string&#x27;);\n res.body.output.should.have.property(&#x27;plan&#x27;);\n res.body.output.plan.should.be.a(&#x27;object&#x27;);\n accUid =  res.body.output.uid;\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9e6097a-2c16-4c43-8ac7-c0f506499056&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add a new plan&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should add a new plan&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n     api.post(&#x27;/synergy/v1/embed/consumers/plans&#x27;).set(accountHeader).send({\&quot;name\&quot;:synergyData.plan.name,\&quot;plan_code\&quot;: synergyData.plan.plan_code,\&quot;type\&quot;: synergyData.plan.type,\&quot;transactions\&quot;: synergyData.plan.transactions,\&quot;default\&quot;: synergyData.plan.default}).end((err, res) =&gt; {\n \n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;uid&#x27;);\n res.body.output.uid.should.be.a(&#x27;string&#x27;);\n planUid =  res.body.output.uid;\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25da6deb-12c4-488b-a368-587daa0c43f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should create a new auth&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should create a new auth&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.post(&#x27;/synergy/v1/auths&#x27;).set(accountHeader).send(synergyData.auths).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.be.a(&#x27;object&#x27;);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;uid&#x27;);\n   res.body.output.uid.should.be.a(&#x27;string&#x27;);\n   //store authId for deletion later\n   authUid = res.body.output.uid;\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e907ed5-2ac5-4248-9158-159fd6cb4884&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add specified user by admin to the organization&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should add specified user by admin to the organization&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.post(&#x27;/synergy/v1/embed/collaborator/add&#x27;).set(accountHeader).send({\&quot;emails\&quot;:[synergyData.miscData.testUser.email]}).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.be.a(&#x27;object&#x27;);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;organization_users&#x27;);\n   res.body.output.organization_users.should.be.a(&#x27;array&#x27;);\n   res.body.output.should.have.property(&#x27;user_uids&#x27;);\n   res.body.output.user_uids.should.be.a(&#x27;array&#x27;);\n   res.body.output.should.have.property(&#x27;organization&#x27;);\n   res.body.output.organization.should.be.a(&#x27;object&#x27;);\n   //store org user uid for later use\n   orgUserId = res.body.output.organization_users[0].uid;\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d09beaab-a305-4f3b-8429-02340665a4aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to generate the api key for embed (ALREADY EXISTS)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to generate the api key for embed (ALREADY EXISTS)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n     api.post(&#x27;/synergy/v1/embed/environment/keys/generate&#x27;).set(accountHeader).send({\&quot;type\&quot;:\&quot;api\&quot;}).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2e2cc5b-cef7-4b8c-bfcd-63cb68936f03&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to generate the api key for embed (NO PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to generate the api key for embed (NO PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n     api.post(&#x27;/synergy/v1/embed/environment/keys/generate&#x27;).set(accountHeader).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21dab223-93a5-4728-9fc4-fedcc901a2ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to generate the source verification token for embed (ALREADY EXISTS)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to generate the source verification token for embed (ALREADY EXISTS)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/environment/keys/generate&#x27;).set(accountHeader).send({\&quot;type\&quot;:\&quot;source\&quot;}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f841898-57e3-41f0-8a45-0d7202adc0c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to publish the solution version to production (WRONG ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to publish the solution version to production (WRONG ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.post(&#x27;/synergy/v1/embed/solution/d98784dbcbhbhs46/deploy&#x27;).set(accountHeader).send({\&quot;publish\&quot;:true}).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;daa8e019-32c4-42ff-bedf-3bcca3f573ce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to publish the solution version to production (PAYLOAD MISSING)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to publish the solution version to production (PAYLOAD MISSING)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.post(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/deploy&#x27;).set(accountHeader).end((err, res) =&gt; {\n      res.should.have.property(&#x27;status&#x27;,400);\n      res.body.should.be.a(&#x27;object&#x27;);\n      res.body.should.have.property(&#x27;error&#x27;);\n      res.body.error.should.be.a(&#x27;object&#x27;);\n      res.body.error.should.have.property(&#x27;message&#x27;);\n      expect(res.body.error.message).equals(&#x27;PARAMETER_PUBLISH_MISSING&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;528f1c80-1679-4dbe-9a60-ac3da2dcd08c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to publish the solution version to production (UNPUBLISHED SOLUTION)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to publish the solution version to production (UNPUBLISHED SOLUTION)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.post(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/deploy&#x27;).set(accountHeader).send({\&quot;publish\&quot;:false}).end((err, res) =&gt; {\n      res.should.have.property(&#x27;status&#x27;,400);\n      res.body.should.be.a(&#x27;object&#x27;);\n      res.body.should.have.property(&#x27;error&#x27;);\n      res.body.error.should.be.a(&#x27;object&#x27;);\n      res.body.error.should.have.property(&#x27;message&#x27;);\n      expect(res.body.error.message).equals(&#x27;SOLUTION_NOT_PUBLISHED&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3db5a623-e33f-467f-b17b-980561d89abd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add a new account with a plan, (NO PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add a new account with a plan, (NO PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/accounts&#x27;).set(accountHeader).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0a3e1b60-de1b-4f7a-ba51-3a53be53bb68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add a new account with a plan, (USER PLAN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add a new account with a plan, (USER PLAN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/accounts&#x27;).set(accountHeader).send({\&quot;name\&quot;:\&quot;API Account\&quot;, \&quot;plan\&quot;: \&quot;flaf80a8fb169c2094eb5446\&quot;}).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,400);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;error&#x27;);\n res.body.error.should.be.a(&#x27;object&#x27;);\n res.body.error.should.have.property(&#x27;message&#x27;);\n expect(res.body.error.message).equals(&#x27;USER_PLAN_NOT_ALLOWED_IN_ACCOUNT&#x27;);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46ce7fcc-63b5-4fa2-946c-b8755ed1c024&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add a new plan, (INVALID PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add a new plan, (INVALID PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/consumers/plans&#x27;).set(accountHeader).send({\&quot;nme\&quot;:synergyData.plan.ame,\&quot;pln_code\&quot;: synergyData.plan.plan_code,\&quot;type\&quot;: synergyData.plan.type,\&quot;transactions\&quot;: synergyData.plan.transactions,\&quot;default\&quot;: synergyData.plan.default}).end((err, res) =&gt; {       \n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0ee115c-9d5a-41e2-9276-1fd4d7b7bf9f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add a new plan, (NO PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add a new plan, (NO PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/consumers/plans&#x27;).set(accountHeader).end((err, res) =&gt; {       \n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb57aaa0-b78a-4b68-86c6-a625bca342cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add a new plan, (PLAN CODE MISSING)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add a new plan, (PLAN CODE MISSING)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let plan = synergyData.plan;\nplan.plan_code = &#x27;&#x27;;\nthis.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/consumers/plans&#x27;).set(accountHeader).send(plan).end((err, res) =&gt; {       \n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b150156d-7cec-4006-86cc-baf4870aebfa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add a new plan, (INVALID CONSUMER COUNT NaN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add a new plan, (INVALID CONSUMER COUNT NaN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let plan = synergyData.plan;\nplan.consumer_count = &#x27;hello&#x27;\nthis.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/consumers/plans&#x27;).set(accountHeader).send(plan).end((err, res) =&gt; {       \n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06a10136-cd96-42f1-a6ff-35260ac9c273&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add a new plan, (INVALID CONSUMER COUNT &lt; 0)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add a new plan, (INVALID CONSUMER COUNT &lt; 0)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let plan = synergyData.plan;\nplan.consumer_count = -1\nthis.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/consumers/plans&#x27;).set(accountHeader).send(plan).end((err, res) =&gt; {       \n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8901d714-b2cf-4d46-95f1-5b7abe70f2b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add a new plan, (INVALID TRANSACTIONS NaN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add a new plan, (INVALID TRANSACTIONS NaN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let plan = synergyData.plan;\nplan.transactions = &#x27;hello&#x27;\nthis.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/consumers/plans&#x27;).set(accountHeader).send(plan).end((err, res) =&gt; {       \n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76351f19-213f-4234-82b4-244945f9d549&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add a new plan, (INVALID TRANSACTIONS &lt; 0)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add a new plan, (INVALID TRANSACTIONS &lt; 0)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let plan = synergyData.plan;\nplan.transactions = -1;\nthis.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/consumers/plans&#x27;).set(accountHeader).send(plan).end((err, res) =&gt; {       \n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d44d384d-e4a0-4c6e-a91e-9812449611b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to create a new auth, (NO PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to create a new auth, (NO PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.post(&#x27;/synergy/v1/auths&#x27;).set(accountHeader).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,400);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;92ae6edf-bc36-49f4-8ea9-b6758fc63d34&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to create a new auth, (ALREADY EXISTS)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to create a new auth, (ALREADY EXISTS)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.post(&#x27;/synergy/v1/auths&#x27;).set(accountHeader).send(synergyData.auths).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,400);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2ecc6d75-7a10-433b-a640-a598cb2817c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add specified user by admin to the organization, (ALREADY EXISTS)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add specified user by admin to the organization, (ALREADY EXISTS)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.post(&#x27;/synergy/v1/embed/collaborator/add&#x27;).set(accountHeader).send({\&quot;emails\&quot;:[synergyData.miscData.testUser.email]}).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,400);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7fcfb5bb-8c8b-4056-859d-316989b4e577&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add specified user by admin to the organization, (INVALID EMAIL)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add specified user by admin to the organization, (INVALID EMAIL)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.post(&#x27;/synergy/v1/embed/collaborator/add&#x27;).set(accountHeader).send({\&quot;emails\&quot;:[\&quot;ggg@gmail.com\&quot;]}).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,400);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91fc6d38-26a5-46dd-961a-aa218b501b8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add specified user by admin to the organization, (NO PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add specified user by admin to the organization, (NO PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.post(&#x27;/synergy/v1/embed/collaborator/add&#x27;).set(accountHeader).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,500);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81ae74cc-1cd7-44da-b32b-c44e692c565d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should regenerate the api key for embed&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should regenerate the api key for embed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n     api.put(&#x27;/synergy/v1/embed/environment/key/regenerate&#x27;).set(accountHeader).send({\&quot;type\&quot;:\&quot;api\&quot;}).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;key&#x27;);\n res.body.output.key.should.be.a(&#x27;string&#x27;);\n global.token = res.body.output.key;\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a69cd804-20ac-4642-8aa6-862db6a969bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should regenerate the api key for embed&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should regenerate the api key for embed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n     api.put(&#x27;/synergy/v1/embed/environment/key/regenerate&#x27;).set(accountHeader).send({\&quot;type\&quot;:\&quot;master_token\&quot;}).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.be.a(&#x27;object&#x27;);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;key&#x27;);\n res.body.output.key.should.be.a(&#x27;string&#x27;);\n global.master_token = res.body.output.key;\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04af4ec2-16b2-41d4-aea1-dcaf414d40c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should regenerate the source verification token for embed&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should regenerate the source verification token for embed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/environment/key/regenerate&#x27;).set(accountHeader).send({\&quot;type\&quot;:\&quot;source\&quot;}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;key&#x27;);\n  res.body.output.key.should.be.a(&#x27;string&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6068adaa-2e3b-4c8b-9876-ec6bc16e691a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should insert the session_timeout for embed&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should insert the session_timeout for embed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/environment/session&#x27;).set(accountHeader).send({\&quot;session_timeout\&quot;: {\&quot;idle\&quot;:1234, \&quot;absolute\&quot;:5000}}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;session_timeout&#x27;);\n  res.body.output.session_timeout.should.be.a(&#x27;object&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4cf57d01-efb3-4ed1-a239-bf31510a816d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should insert the auth_domain url for embed&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should insert the auth_domain url for embed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/environment/auth/domain&#x27;).set(accountHeader).send({\&quot;auth_domain\&quot;: \&quot;ggg.com\&quot; }).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;auth_domain&#x27;);\n  expect(res.body.output.auth_domain).equals(&#x27;ggg.com&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05e3f14a-ee44-4d17-b398-8f3066db4392&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should insert the auth_domain url for embed&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should insert the auth_domain url for embed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/environment/trigger/domain&#x27;).set(accountHeader).send({\&quot;trigger_domain\&quot;: \&quot;ggg.com\&quot; }).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;trigger_domain&#x27;);\n  expect(res.body.output.trigger_domain).equals(&#x27;ggg.com&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;036db766-f1dd-4af2-b43e-6abedd7cdd4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change the solution published state to OFF&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should change the solution published state to OFF&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/status&#x27;).set(accountHeader).send({\&quot;status\&quot;:false,\&quot;version\&quot;:1}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;uid&#x27;);\n  res.body.output.uid.should.be.a(&#x27;string&#x27;);\n  res.body.output.should.have.property(&#x27;environment&#x27;);\n  res.body.output.environment.should.be.a(&#x27;object&#x27;);\n  res.body.output.environment.should.have.property(&#x27;project_params&#x27;);\n  res.body.output.environment.project_params.should.be.a(&#x27;array&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86adea1b-1aea-4a5b-8c2f-f8891c15d4df&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add an user to an embed account, (USER DOES NOT EXIST)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should add an user to an embed account, (USER DOES NOT EXIST)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;:\&quot;bot@built.io\&quot;, \&quot;account\&quot;:accountId}).end((err, res) =&gt; {    \n // console.log(&#x27;res = &#x27;, res.body);\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;user&#x27;);\n  res.body.output.user.should.be.a(&#x27;object&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eef680c0-7b00-45e4-9a2f-26e67086b131&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add an user to an embed user plan&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should add an user to an embed user plan&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:88,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;:\&quot;bot2@built.io\&quot;, \&quot;plan\&quot;: planId}).end((err, res) =&gt; {    \n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;user&#x27;);\n  res.body.output.user.should.be.a(&#x27;object&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d32eb85f-5ccd-4da3-a96d-878594aefe93&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add an user to a default plan, (USER DOES NOT EXIST)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should add an user to a default plan, (USER DOES NOT EXIST)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;:\&quot;bot3@built.io\&quot;}).end((err, res) =&gt; {    \n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;user&#x27;);\n  res.body.output.user.should.be.a(&#x27;object&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;239dff86-2467-4207-a773-14b3b1da00fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change the solution published state to ON&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should change the solution published state to ON&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/status&#x27;).set(accountHeader).send({\&quot;status\&quot;:true,\&quot;version\&quot;:1}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;uid&#x27;);\n  res.body.output.uid.should.be.a(&#x27;string&#x27;);\n  res.body.output.should.have.property(&#x27;environment&#x27;);\n  res.body.output.environment.should.be.a(&#x27;object&#x27;);\n  res.body.output.environment.should.have.property(&#x27;project_params&#x27;);\n  res.body.output.environment.project_params.should.be.a(&#x27;array&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4bdf4f0f-8dce-4c79-8d04-93ef7281aa88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should disable the google auth via embed admin&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should disable the google auth via embed admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/auths/&#x27;+synergyData.miscData.google+&#x27;/status&#x27;).set(accountHeader).send({\&quot;status\&quot;:false}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;uid&#x27;);\n  res.body.output.uid.should.be.a(&#x27;string&#x27;);\n  res.body.output.should.have.property(&#x27;updated_at&#x27;);\n  res.body.output.updated_at.should.be.a(&#x27;string&#x27;);\n  res.body.output.should.have.property(&#x27;name&#x27;);\n  res.body.output.name.should.be.a(&#x27;string&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;74510f9e-fd6d-45a8-9f44-cf161bf70e23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should enable the google auth via embed admin&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should enable the google auth via embed admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/auths/&#x27;+synergyData.miscData.google+&#x27;/status&#x27;).set(accountHeader).send({\&quot;status\&quot;:true}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;uid&#x27;);\n  res.body.output.uid.should.be.a(&#x27;string&#x27;);\n  res.body.output.should.have.property(&#x27;updated_at&#x27;);\n  res.body.output.updated_at.should.be.a(&#x27;string&#x27;);\n  res.body.output.should.have.property(&#x27;name&#x27;);\n  res.body.output.name.should.be.a(&#x27;string&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ce1a953-c24a-4d4c-91d5-1dc0d578dad9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change the plan for target consumer&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should change the plan for target consumer&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/consumers/&#x27;+synergyData.miscData.consumer.id+&#x27;/plan&#x27;).set(accountHeader).send({\&quot;plan\&quot;:synergyData.miscData.plan}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;uid&#x27;);\n  res.body.output.uid.should.be.a(&#x27;string&#x27;);\n  expect(res.body.output.uid).eql(synergyData.miscData.plan);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b056aae4-eaac-4234-97b6-8649928dd889&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change general plan by plan id&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should change general plan by plan id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n    api.put(&#x27;/synergy/v1/embed/consumers/plans/&#x27;+planUid).set(accountHeader).send({\&quot;name\&quot;:\&quot;Test Plan\&quot;,\&quot;default\&quot;:false,\&quot;transactions\&quot;:10}).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;output&#x27;);\nres.body.output.should.be.a(&#x27;object&#x27;);\nres.body.output.should.have.property(&#x27;uid&#x27;);\nres.body.output.uid.should.be.a(&#x27;string&#x27;);\nexpect(res.body.output.uid).eql(planUid);\ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;651de7b3-0b9a-441b-a3f6-dffd0272e8dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change the plan for target account&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should change the plan for target account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n      api.put(&#x27;/synergy/v1/embed/accounts/&#x27;+accUid).set(accountHeader).send({\&quot;name\&quot;: synergyData.account.name,\&quot;plan\&quot;:synergyData.account.plan2}).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;output&#x27;);\nres.body.output.should.be.a(&#x27;object&#x27;);\nres.body.output.should.have.property(&#x27;uid&#x27;);\nres.body.output.uid.should.be.a(&#x27;string&#x27;);\nres.body.output.should.have.property(&#x27;plan&#x27;);\nres.body.output.plan.should.be.a(&#x27;object&#x27;);\n      done();\n      });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1cedf2b-d20f-4b5c-9397-3c560053648a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to regenerate the api key for embed (ALREADY EXISTS)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to regenerate the api key for embed (ALREADY EXISTS)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n         api.put(&#x27;/synergy/v1/embed/environment/key/regenerate&#x27;).set(accountHeader).send({\&quot;type\&quot;:\&quot;xx\&quot;}).end((err, res) =&gt; {\n  \n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bef6003a-c7f6-45d0-b6f7-8f1bd64638f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to insert the session_timeout for embed, (INVALID KEY)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to insert the session_timeout for embed, (INVALID KEY)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/environment/session&#x27;).set(accountHeader).send({\&quot;session\&quot;:1234}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;INVALID_BODY&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;63f64746-90f3-4a0a-9cee-9daf9a3b93f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to insert the session_timeout for embed, (INVALID KEY TYPE)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to insert the session_timeout for embed, (INVALID KEY TYPE)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/environment/session&#x27;).set(accountHeader).send({\&quot;session_timeout\&quot;: {\&quot;idle\&quot;:true, \&quot;absolute\&quot;:5000}}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;INVALID_TYPE_OF_PARAMETER&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e892e979-fb7e-43e4-8008-a2cc7adc1afb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to insert the session_timeout for embed, (Idle timeout &gt; than Absolute timeout)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to insert the session_timeout for embed, (Idle timeout &gt; than Absolute timeout)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/environment/session&#x27;).set(accountHeader).send({\&quot;session_timeout\&quot;: {\&quot;idle\&quot;:7000, \&quot;absolute\&quot;:5000}}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;IDLE_TIMEOUT_SHOULD_BE_LESSER_THAN_EQUAL_TO_ABSOLUTE_TIMEOUT&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a7d9224-9b27-4396-a2a5-9b3c0744a57c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to insert the auth domain url for embed, (INVALID KEY)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to insert the auth domain url for embed, (INVALID KEY)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/environment/auth/domain&#x27;).set(accountHeader).send({\&quot;session\&quot;:1234}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;INVALID_BODY&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9baa1b9-79bd-4b64-8c0b-1f88c643395f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to insert the auth domain url for embed, (EMPTY PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to insert the auth domain url for embed, (EMPTY PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/environment/auth/domain&#x27;).set(accountHeader).send({}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;INVALID_BODY&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2b62943-06de-4fee-96c7-ecb9e2bc18f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to insert the trigger domain url for embed, (INVALID KEY)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to insert the trigger domain url for embed, (INVALID KEY)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/environment/trigger/domain&#x27;).set(accountHeader).send({\&quot;auth_domain\&quot;:1234}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;INVALID_BODY&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9fc257d4-f99b-45a8-ac63-3665c9efc1fa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to insert the trigger domain url for embed, (EMPTY PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to insert the trigger domain url for embed, (EMPTY PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/environment/trigger/domain&#x27;).set(accountHeader).send({}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;INVALID_BODY&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b45f85c1-d47b-4386-96b3-105b4cbb2a2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to update the specified solution , (WRONG UID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to update the specified solution , (WRONG UID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n   api.put(&#x27;/synergy/v1/embed/solution/sadjhsakhkd&#x27;).set(accountHeader).send(synergyData.solution.data).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,400);\nres.body.should.be.a(&#x27;object&#x27;);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0e0d2a7-63f0-440c-a152-f70af2b5c9a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to update the specified solution , (NO UID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to update the specified solution , (NO UID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n   api.put(&#x27;/synergy/v1/embed/solution/&#x27;).set(accountHeader).send(synergyData.solution.data).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,404);\nres.body.should.be.a(&#x27;object&#x27;);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fa2cdadc-428d-4482-a566-ef4f79483154&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to update the specified solution , (NO PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to update the specified solution , (NO PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n   api.put(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId).set(accountHeader).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,400);\nres.body.should.be.a(&#x27;object&#x27;);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f6adc97-fea2-4222-ad6a-d4c5dbba7d5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to update the specified solution , (INVALID PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to update the specified solution , (INVALID PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n   api.put(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId).set(accountHeader).send({\&quot;keys\&quot;:\&quot;hello\&quot;}).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,400);\nres.body.should.be.a(&#x27;object&#x27;);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9462d4b1-a0e3-4608-80b7-9eb24ee455f6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to change the solution published state&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to change the solution published state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/solution/sxnmoisakj47as987sa4d/status&#x27;).set(accountHeader).send({\&quot;status\&quot;:true,\&quot;version\&quot;:1}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d04d23c-55ec-41f6-8c07-b36e2670a645&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should  fail to change the solution published state (INVALID PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should  fail to change the solution published state (INVALID PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/status&#x27;).set(accountHeader).send({\&quot;status\&quot;:false}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a585a01-af3a-4aae-b0e9-41aceeba9b99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to change the solution published state (NO PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to change the solution published state (NO PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId+&#x27;/status&#x27;).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;74abe061-e2d0-4f89-9521-6179ec9a7e72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to toggle auth via embed admin, (WRONG UID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to toggle auth via embed admin, (WRONG UID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/auths/skbgdcjahs98798/status&#x27;).set(accountHeader).send({\&quot;status\&quot;:false}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;407dea36-a56d-4eb6-993b-5d0ea1f42c0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to toggle auth via embed admin, (NO PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to toggle auth via embed admin, (NO PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/auths/&#x27;+synergyData.miscData.google+&#x27;/status&#x27;).set(accountHeader).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97788ad8-15d3-4467-9b33-8883950f24ab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to change the plan for target consumer,(INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to change the plan for target consumer,(INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/consumers/shjdbhjsbdjh888/plan&#x27;).set(accountHeader).send({\&quot;plan\&quot;:synergyData.miscData.plan}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;aa7aec08-2bae-481a-a487-2d4eb552e04b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to change the plan for target consumer, (INVALID PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to change the plan for target consumer, (INVALID PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/consumers/&#x27;+synergyData.miscData.consumer.id+&#x27;/plan&#x27;).set(accountHeader).send({\&quot;plan\&quot;:\&quot;sds\&quot;}).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c6698d04-ac65-4075-976a-b28e7a0690e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to change the plan for target consumer, (NO PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to change the plan for target consumer, (NO PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.put(&#x27;/synergy/v1/embed/consumers/&#x27;+synergyData.miscData.consumer.id+&#x27;/plan&#x27;).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98de5520-87d6-4d5a-9b8a-3f5749383a2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to change general plan by plan id (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to change general plan by plan id (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n    api.put(&#x27;/synergy/v1/embed/consumers/plans/kbdfhkjhfikj98+9df54&#x27;).set(accountHeader).send({\&quot;name\&quot;:\&quot;Test Plan\&quot;,\&quot;default\&quot;:false,\&quot;transactions\&quot;:10}).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;, 400);\ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6c87eab-8c44-46f3-80e1-c76c99edfd87&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to change the plan for target account, (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to change the plan for target account, (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n   api.put(&#x27;/synergy/v1/embed/accounts/sanbdjsahdhsa&#x27;).set(accountHeader).send({\&quot;name\&quot;: synergyData.account.name,\&quot;plan\&quot;:synergyData.account.plan2}).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,400);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d7a1a6a3-71cb-44a1-b6de-c856b52d489f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to change the plan for target account, (INVALID PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to change the plan for target account, (INVALID PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n   api.put(&#x27;/synergy/v1/embed/accounts/&#x27;+accUid).set(accountHeader).send({\&quot;name\&quot;: \&quot;Hello\&quot;}).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,400);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d21c4848-f1e2-49bb-8efb-c298b4609939&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add an user to an embed account&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add an user to an embed account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;:\&quot;bot@built.io\&quot;, \&quot;account\&quot;: accountId}).end((err, res) =&gt; {    \n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;USER_ALREADY_EXISTS_IN_AN_ACCOUNT&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ecda903c-fd3b-4daf-b606-7c23af994bae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add an user to an embed account&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add an user to an embed account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;:\&quot;bot@built.io\&quot;, \&quot;plan\&quot;: planId}).end((err, res) =&gt; {    \n  res.should.have.property(&#x27;status&#x27;,400);     \n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;USER_ALREADY_ADDED_TO_A_PLAN&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37f8aee0-5cd6-4354-ba3e-7867e035bcd9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add an user to an embed account&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add an user to an embed account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;:\&quot;bot2@built.io\&quot;, \&quot;account\&quot;: accountId}).end((err, res) =&gt; {    \n  res.should.have.property(&#x27;status&#x27;,400);     \n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;USER_ALREADY_ADDED_TO_A_PLAN&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f5cdc51-7283-46d3-a871-2b42f5fae734&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to add an user to an embed account&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to add an user to an embed account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;:\&quot;bot2@built.io\&quot;, \&quot;plan\&quot;: planId}).end((err, res) =&gt; {    \n  res.should.have.property(&#x27;status&#x27;,400);     \n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;USER_ALREADY_ADDED_TO_A_PLAN&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b335c73-b9e0-4e81-a440-bb0650fbaf58&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail add an user to an embed consumer, (WRONG PLAN CODE)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail add an user to an embed consumer, (WRONG PLAN CODE)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;:\&quot;bot@built.io\&quot;, \&quot;plan\&quot;:\&quot;acc\&quot;}).end((err, res) =&gt; {    \n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;INVALID_PLAN&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de00cd96-2c7b-4395-97ca-4f427bdb367d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail add an user to an embed consumer, (WRONG ACCOUNT ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail add an user to an embed consumer, (WRONG ACCOUNT ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;:\&quot;bot@built.io\&quot;, \&quot;account\&quot;: &#x27;asdasdsda&#x27;}).end((err, res) =&gt; {    \n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;INVALID_ACCOUNT&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77a6c5c3-63b7-4c22-a274-7dcdb0e87901&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail add an user to an embed consumer, (WRONG ACCOUNT ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail add an user to an embed consumer, (WRONG ACCOUNT ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;:\&quot;bot34@built.io\&quot;, \&quot;account\&quot;: accountId2}).end((err, res) =&gt; {    \n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;ACCOUNT_HAS_NO_PLAN&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77c3620d-3ca8-4f20-a4d7-5ee2fd64065d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to change the plan for target account, (NO PAYLOAD)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to change the plan for target account, (NO PAYLOAD)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n   api.put(&#x27;/synergy/v1/embed/accounts/&#x27;+accUid).set(accountHeader).end((err, res) =&gt; {\n    res.should.have.property(&#x27;status&#x27;,400);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4df5c9d-6470-444b-93d3-b4ec47dba804&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove specified user by admin from organization&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should remove specified user by admin from organization&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/enterprise/v1/organizations/&#x27;+synergyData.miscData.testOrgId+&#x27;/users/&#x27;+orgUserId).set(accountHeader).end((err, res) =&gt; {\n  \n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.be.a(&#x27;object&#x27;);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;message&#x27;);\n   res.body.output.message.should.be.a(&#x27;string&#x27;);\n   expect(res.body.output.message).eql(&#x27;Organization user removed.&#x27;);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44c481bd-58ae-49d1-89fc-e504cd778069&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove the account specified&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should remove the account specified&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/accounts/&#x27;+accUid).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;message&#x27;);\n  res.body.output.message.should.be.a(&#x27;string&#x27;);\n  expect(res.body.output.message).equals(\&quot;ACCOUNT_DELETE_SUCCESS\&quot;);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10207c6a-bad1-4afb-9351-bc3b9f3fdae0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove the specified plan&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should remove the specified plan&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/consumers/plans/&#x27;+planUid).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;message&#x27;);\n  res.body.output.message.should.be.a(&#x27;string&#x27;);\n  expect(res.body.output.message).equals(\&quot;PLAN_DELETE_SUCCESS\&quot;);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0e8a9aa-b4ab-4763-ba15-534a368c6c45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should delete the specified auth&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should delete the specified auth&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/auths/&#x27;+authUid).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;message&#x27;);\n  res.body.output.message.should.be.a(&#x27;string&#x27;);\n  expect(res.body.output.message).equals(\&quot;AUTH_DELETE_SUCCESS\&quot;);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9cc445ee-062f-4f4a-951b-3b1ceb216136&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should delete the specified solution&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should delete the specified solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/solution/&#x27;+solution.solutionId).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;message&#x27;);\n  res.body.output.message.should.be.a(&#x27;string&#x27;);\n  expect(res.body.output.message).equals(\&quot;SOLUTION_DELETE_SUCCESS\&quot;);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2fb53237-2fe5-4328-86eb-485cd855b3c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail in deleting the specified auth , (wrong uid)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail in deleting the specified auth , (wrong uid)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/auths/&#x27;+&#x27;kdnbiahdds&#x27;).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;, 400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e44cfd7-d839-4f25-be75-9562b4adbb26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail in deleting the specified auth , (no uid)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail in deleting the specified auth , (no uid)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/auths/&#x27;).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,404);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7d27f3ef-b684-451a-85f9-73c440e719c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to remove the account specified, (WRONG UID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to remove the account specified, (WRONG UID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/accounts/s6ds6df87d5f4&#x27;).set(accountHeader).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a46f201b-9941-4971-a597-a901620b9096&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove the account specified, (NO UID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should remove the account specified, (NO UID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/accounts/&#x27;).set(accountHeader).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,404);\n   done();\n   });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fdfd6f90-bae3-4bf9-90d8-48dffef7c170&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to remove the specified plan, (WRONG UID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to remove the specified plan, (WRONG UID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/consumers/plans/kjfahjfbkjahui11&#x27;).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bca4e518-3135-4c14-b2e8-f4690bb45f82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove the specified plan&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should remove the specified plan&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/consumers/plans/&#x27;).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,404);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f03aacce-b0a3-4eed-bc5b-2b74cc721d0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to delete the specified solution, (WRONG UID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to delete the specified solution, (WRONG UID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/solution/jsadhjgdi3146548&#x27;).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;70f46700-50ec-4ea5-9451-9cc4c71acb3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to delete the specified solution, (NO UID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should fail to delete the specified solution, (NO UID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\n api.delete(&#x27;/synergy/v1/embed/solution/&#x27;).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,404);\n done();\n });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21100e26-e2d1-441b-aac8-7957ba618b73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should delete the specified user&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should delete the specified user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.delete(&#x27;/synergy/v1/embed/consumers/removeuser/&#x27;+userId2).set(accountHeader).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.be.a(&#x27;object&#x27;);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;message&#x27;);\n   res.body.output.message.should.be.a(&#x27;string&#x27;);\n   expect(res.body.output.message).equals(\&quot;User successfully removed\&quot;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fa1fe050-d53e-4d67-a9a3-3dac82de53c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add an user to an embed account, (RE-ADD USER )&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy APIs should add an user to an embed account, (RE-ADD USER )&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;api.put(&#x27;/synergy/v1/embed/consumers/adduser&#x27;).set(accountHeader).send({\&quot;email\&quot;: \&quot;chaitrali.naik+2@built.io\&quot;, \&quot;account\&quot;:accountId}).end((err, res) =&gt; {    \n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;output&#x27;);\n  res.body.output.should.be.a(&#x27;object&#x27;);\n  res.body.output.should.have.property(&#x27;user&#x27;);\n  res.body.output.user.should.be.a(&#x27;object&#x27;);\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;65bcf28f-6bbc-44d0-8023-a8bfae953498&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2e6f4c5e-1413-4eee-9dbc-33199ee6cb77&quot;,&quot;1ab3d3ba-0d95-4b6a-9236-c4e0f876144c&quot;,&quot;cbff1ab9-ad0e-47bd-9684-94874ccee4da&quot;,&quot;83f95691-dc18-475d-b147-3d258cbdb23a&quot;,&quot;9e568660-086f-42a3-8de6-7d8888353fc3&quot;,&quot;709db34d-2dd5-4619-9deb-e46962ca7f3b&quot;,&quot;459d1d01-74d8-4ddd-89bf-86f365f1c9c5&quot;,&quot;642487f5-c555-416b-82e2-1f2eef7414eb&quot;,&quot;1a83dcc5-492b-468b-9292-3cb615d98f7a&quot;,&quot;cb1f367c-6190-47dd-8410-7e467413a5d8&quot;,&quot;732e8455-cedd-4ff3-89f2-a3ceea16ecb7&quot;,&quot;0fa9cb8b-8687-4141-b79e-10a8ce668822&quot;,&quot;98bd8d15-9e0e-495b-8d9c-51e205d7aa56&quot;,&quot;752c1e21-cf38-4a96-a534-297ec033fe3e&quot;,&quot;14982752-f5e1-473a-8f40-0f5d4fd0e0ad&quot;,&quot;b4da6125-2d04-42ff-96e9-5339d0c90da4&quot;,&quot;b744cc09-7e87-4657-b678-b6b2df4a99ac&quot;,&quot;9051cb0e-4ef3-499c-9f34-363a7bce9713&quot;,&quot;9216908f-3299-4522-a010-32e293d85bc2&quot;,&quot;46fe51d6-0b2c-4f54-bef9-8846fbb7e758&quot;,&quot;bc30183f-3b9e-442b-930e-856f9782dc3d&quot;,&quot;55d8cb7a-6553-4232-8b5d-eae2eaa7c62e&quot;,&quot;f6392eb0-28e4-48ed-bf4c-fecbefbea127&quot;,&quot;ba39d3cc-042d-48c4-8be1-d31ab41ab5f6&quot;,&quot;591e4fdb-5fc2-4b37-8870-d69650e1b8a7&quot;,&quot;1f1fb2ba-ebdb-4dab-818a-831658cab0dc&quot;,&quot;91cfe50e-f18f-43f1-9aad-7325d158b1aa&quot;,&quot;2745cbce-2644-4a1e-a351-1758c7cbbc12&quot;,&quot;9f326efe-09e9-4d13-8a37-c307b6c28f6f&quot;,&quot;3e66eb54-e1fe-45ef-a949-079d0b0792b3&quot;,&quot;89e53f99-9284-4f9d-acdc-38d5e59fcf8c&quot;,&quot;20089555-f268-4bad-a21f-ecfffbbfc23e&quot;,&quot;26b94d0b-2957-485a-ac19-b5b961189509&quot;,&quot;303d7a5b-072e-49f7-9b45-b87ff5d38ce1&quot;,&quot;0ff7dd4f-65fd-4f29-92bc-8b91dcb8abd4&quot;,&quot;f44722c9-5b4c-4c2b-9310-ddc1f47b9035&quot;,&quot;beb82807-b27d-4a1a-b680-c59e85178930&quot;,&quot;d9e6097a-2c16-4c43-8ac7-c0f506499056&quot;,&quot;25da6deb-12c4-488b-a368-587daa0c43f4&quot;,&quot;9e907ed5-2ac5-4248-9158-159fd6cb4884&quot;,&quot;d09beaab-a305-4f3b-8429-02340665a4aa&quot;,&quot;a2e2cc5b-cef7-4b8c-bfcd-63cb68936f03&quot;,&quot;21dab223-93a5-4728-9fc4-fedcc901a2ac&quot;,&quot;2f841898-57e3-41f0-8a45-0d7202adc0c3&quot;,&quot;daa8e019-32c4-42ff-bedf-3bcca3f573ce&quot;,&quot;528f1c80-1679-4dbe-9a60-ac3da2dcd08c&quot;,&quot;3db5a623-e33f-467f-b17b-980561d89abd&quot;,&quot;0a3e1b60-de1b-4f7a-ba51-3a53be53bb68&quot;,&quot;46ce7fcc-63b5-4fa2-946c-b8755ed1c024&quot;,&quot;f0ee115c-9d5a-41e2-9276-1fd4d7b7bf9f&quot;,&quot;cb57aaa0-b78a-4b68-86c6-a625bca342cf&quot;,&quot;b150156d-7cec-4006-86cc-baf4870aebfa&quot;,&quot;06a10136-cd96-42f1-a6ff-35260ac9c273&quot;,&quot;8901d714-b2cf-4d46-95f1-5b7abe70f2b9&quot;,&quot;76351f19-213f-4234-82b4-244945f9d549&quot;,&quot;d44d384d-e4a0-4c6e-a91e-9812449611b8&quot;,&quot;92ae6edf-bc36-49f4-8ea9-b6758fc63d34&quot;,&quot;2ecc6d75-7a10-433b-a640-a598cb2817c9&quot;,&quot;7fcfb5bb-8c8b-4056-859d-316989b4e577&quot;,&quot;91fc6d38-26a5-46dd-961a-aa218b501b8c&quot;,&quot;81ae74cc-1cd7-44da-b32b-c44e692c565d&quot;,&quot;a69cd804-20ac-4642-8aa6-862db6a969bf&quot;,&quot;04af4ec2-16b2-41d4-aea1-dcaf414d40c7&quot;,&quot;6068adaa-2e3b-4c8b-9876-ec6bc16e691a&quot;,&quot;4cf57d01-efb3-4ed1-a239-bf31510a816d&quot;,&quot;05e3f14a-ee44-4d17-b398-8f3066db4392&quot;,&quot;036db766-f1dd-4af2-b43e-6abedd7cdd4d&quot;,&quot;86adea1b-1aea-4a5b-8c2f-f8891c15d4df&quot;,&quot;eef680c0-7b00-45e4-9a2f-26e67086b131&quot;,&quot;d32eb85f-5ccd-4da3-a96d-878594aefe93&quot;,&quot;239dff86-2467-4207-a773-14b3b1da00fe&quot;,&quot;4bdf4f0f-8dce-4c79-8d04-93ef7281aa88&quot;,&quot;74510f9e-fd6d-45a8-9f44-cf161bf70e23&quot;,&quot;4ce1a953-c24a-4d4c-91d5-1dc0d578dad9&quot;,&quot;b056aae4-eaac-4234-97b6-8649928dd889&quot;,&quot;651de7b3-0b9a-441b-a3f6-dffd0272e8dd&quot;,&quot;f1cedf2b-d20f-4b5c-9397-3c560053648a&quot;,&quot;bef6003a-c7f6-45d0-b6f7-8f1bd64638f4&quot;,&quot;63f64746-90f3-4a0a-9cee-9daf9a3b93f0&quot;,&quot;e892e979-fb7e-43e4-8008-a2cc7adc1afb&quot;,&quot;1a7d9224-9b27-4396-a2a5-9b3c0744a57c&quot;,&quot;a9baa1b9-79bd-4b64-8c0b-1f88c643395f&quot;,&quot;a2b62943-06de-4fee-96c7-ecb9e2bc18f7&quot;,&quot;9fc257d4-f99b-45a8-ac63-3665c9efc1fa&quot;,&quot;b45f85c1-d47b-4386-96b3-105b4cbb2a2a&quot;,&quot;d0e0d2a7-63f0-440c-a152-f70af2b5c9a1&quot;,&quot;fa2cdadc-428d-4482-a566-ef4f79483154&quot;,&quot;3f6adc97-fea2-4222-ad6a-d4c5dbba7d5e&quot;,&quot;9462d4b1-a0e3-4608-80b7-9eb24ee455f6&quot;,&quot;5d04d23c-55ec-41f6-8c07-b36e2670a645&quot;,&quot;8a585a01-af3a-4aae-b0e9-41aceeba9b99&quot;,&quot;74abe061-e2d0-4f89-9521-6179ec9a7e72&quot;,&quot;407dea36-a56d-4eb6-993b-5d0ea1f42c0c&quot;,&quot;97788ad8-15d3-4467-9b33-8883950f24ab&quot;,&quot;aa7aec08-2bae-481a-a487-2d4eb552e04b&quot;,&quot;c6698d04-ac65-4075-976a-b28e7a0690e5&quot;,&quot;98de5520-87d6-4d5a-9b8a-3f5749383a2c&quot;,&quot;e6c87eab-8c44-46f3-80e1-c76c99edfd87&quot;,&quot;d7a1a6a3-71cb-44a1-b6de-c856b52d489f&quot;,&quot;d21c4848-f1e2-49bb-8efb-c298b4609939&quot;,&quot;ecda903c-fd3b-4daf-b606-7c23af994bae&quot;,&quot;37f8aee0-5cd6-4354-ba3e-7867e035bcd9&quot;,&quot;3f5cdc51-7283-46d3-a871-2b42f5fae734&quot;,&quot;9b335c73-b9e0-4e81-a440-bb0650fbaf58&quot;,&quot;de00cd96-2c7b-4395-97ca-4f427bdb367d&quot;,&quot;77a6c5c3-63b7-4c22-a274-7dcdb0e87901&quot;,&quot;77c3620d-3ca8-4f20-a4d7-5ee2fd64065d&quot;,&quot;b4df5c9d-6470-444b-93d3-b4ec47dba804&quot;,&quot;44c481bd-58ae-49d1-89fc-e504cd778069&quot;,&quot;10207c6a-bad1-4afb-9351-bc3b9f3fdae0&quot;,&quot;b0e8a9aa-b4ab-4763-ba15-534a368c6c45&quot;,&quot;9cc445ee-062f-4f4a-951b-3b1ceb216136&quot;,&quot;2fb53237-2fe5-4328-86eb-485cd855b3c2&quot;,&quot;8e44cfd7-d839-4f25-be75-9562b4adbb26&quot;,&quot;7d27f3ef-b684-451a-85f9-73c440e719c0&quot;,&quot;a46f201b-9941-4971-a597-a901620b9096&quot;,&quot;fdfd6f90-bae3-4bf9-90d8-48dffef7c170&quot;,&quot;bca4e518-3135-4c14-b2e8-f4690bb45f82&quot;,&quot;f03aacce-b0a3-4eed-bc5b-2b74cc721d0a&quot;,&quot;70f46700-50ec-4ea5-9451-9cc4c71acb3f&quot;,&quot;21100e26-e2d1-441b-aac8-7957ba618b73&quot;,&quot;fa1fe050-d53e-4d67-a9a3-3dac82de53c3&quot;,&quot;65bcf28f-6bbc-44d0-8023-a8bfae953498&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2959,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:1000000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;402804cc-f4b1-4352-97e2-6d38aed97a43&quot;,&quot;title&quot;:&quot;Enterprise&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\z_synergy\\wrapper.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\z_synergy\\wrapper.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;de21e0ec-80d0-4174-a768-b2d876139fda&quot;,&quot;title&quot;:&quot;Synergy Wrapper APIs&quot;,&quot;fullFile&quot;:&quot;C:\\work\\api\\controllers\\test\\z_synergy\\wrapper.js&quot;,&quot;file&quot;:&quot;\\controllers\\test\\z_synergy\\wrapper.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs \&quot;before all\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\ncommonMock.setSignUpMocks(httpmock, &#x27;enterprise&#x27;);\n // MOCK TRIGGER SERVER CALLS------------\n const trigger = nmock(&#x27;http://localhost:9090&#x27;).post(&#x27;/triggers/create&#x27;).reply(200, synergyWrapperData.createDeploymentTriggerData);\n //---------------------------------------\n\n           done();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e32ca875-3345-448d-adbc-937b4c2edb25&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should successfully get a jwt token&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should successfully get a jwt token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1650,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let payload = synergyWrapperData.jwt_payload;\n payload.token = global.token;\n chai.request(&#x27;https://synergy-test-aid.herokuapp.com&#x27;).post(&#x27;/jwt&#x27;).auth(&#x27;flow&#x27;,&#x27;2p)F&amp;kRn!L&#x27;).send(payload).end((err, res) =&gt; {  \n  res.should.have.property(&#x27;status&#x27;,200);\n  res.body.should.be.a(&#x27;object&#x27;);\n  res.body.should.have.property(&#x27;token&#x27;);\n  //store the token for later use\n  jwt_token = res.body.token;\n  done();\n  });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;770281b9-1ff0-4116-a565-b91a06962404&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should do a successful handshake&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should do a successful handshake&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\napi.post(&#x27;/synergy/v1/embed/consumer/handshake&#x27;).set(synergyWrapperData.header1).send(synergyWrapperData.handshakeBody).end((err, res) =&gt; {  \nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.have.property(&#x27;output&#x27;);\nres.body.output.should.be.a(&#x27;object&#x27;);\nres.body.output.should.have.property(&#x27;message&#x27;);\nres.body.output.should.have.property(&#x27;padding&#x27;);\nres.body.output.should.have.property(&#x27;auth_domain&#x27;);\nclientId = res.body.output.padding;\ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51bae705-c650-49df-bb19-fbea2b6925d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should successfully login and get auth token&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should successfully login and get auth token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\n       api.post(&#x27;/synergy/v1/embed/consumer/login&#x27;).set(header).send({\&quot;payload\&quot;:jwt_token}).end((err, res) =&gt; {\n        res.should.have.property(&#x27;status&#x27;,200);\n        res.body.should.be.a(&#x27;object&#x27;);\n        res.body.should.have.property(&#x27;output&#x27;);\n        res.body.output.should.be.a(&#x27;object&#x27;);\n        res.body.output.should.have.property(&#x27;authtoken&#x27;);\n        //store the token for later use\n        authtoken = res.body.output.authtoken;\n        done();\n        });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f82c1a1-8e2d-4755-8c0a-c328f287ff13&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should successfully create a deployment&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should successfully create a deployment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n      api.post(&#x27;/synergy/v1/embed/consumer/deployments&#x27;).set(header).send(synergyWrapperData.deployments).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;); \n res.body.output.should.have.property(&#x27;deployment&#x27;);\n res.body.output.deployment.should.be.a(&#x27;object&#x27;);   \n res.body.output.deployment.should.have.property(&#x27;uid&#x27;);\n res.body.output.deployment.should.have.property(&#x27;updated_at&#x27;);\n res.body.output.deployment.should.have.property(&#x27;created_at&#x27;);\n res.body.output.deployment.should.have.property(&#x27;name&#x27;);\n res.body.output.deployment.should.have.property(&#x27;solution&#x27;);\n res.body.output.deployment.should.have.property(&#x27;synergy_organization&#x27;);\n res.body.output.deployment.should.have.property(&#x27;org_uid&#x27;);\n res.body.output.deployment.should.have.property(&#x27;context&#x27;);\n res.body.output.deployment.should.have.property(&#x27;deployment_instance&#x27;);\n res.body.output.deployment.deployment_instance.should.be.a(&#x27;object&#x27;);\n res.body.output.deployment.deployment_instance.should.have.property(&#x27;compact&#x27;);\n res.body.output.deployment.deployment_instance.compact.should.be.a(&#x27;array&#x27;);\n res.body.output.deployment.should.have.property(&#x27;solution_version&#x27;);\n res.body.output.deployment.should.have.property(&#x27;consumer&#x27;);\n res.body.output.deployment.should.have.property(&#x27;consumer_ref&#x27;);\n res.body.output.deployment.should.have.property(&#x27;trigger_icon&#x27;);\n res.body.output.deployment.should.have.property(&#x27;action_icons&#x27;);\n res.body.output.deployment.should.have.property(&#x27;flows&#x27;);\n res.body.output.deployment.should.have.property(&#x27;active&#x27;);\n//store a deployment uid\ndeployment_uid = res.body.output.deployment.uid;\n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36846b53-09b0-45f8-847b-17543365d3e9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get Bot Handshake lookup object&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should get Bot Handshake lookup object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\n           api.post(&#x27;/synergy/v1/embed/bots/link&#x27;).set(header).send({\&quot;payload\&quot; :{\&quot;link\&quot;: \&quot;1122@my.com\&quot;}}).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;lookupinstance&#x27;);    \n res.body.output.lookupinstance.should.be.a(&#x27;object&#x27;);\n res.body.output.lookupinstance.should.have.property(&#x27;link_id&#x27;);\n           done();\n           });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e550707c-3f72-43dc-ab60-be5b9c09ad76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get Bot Handshake lookup object, (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get Bot Handshake lookup object, (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\n       api.post(&#x27;/synergy/v1/embed/bots/link&#x27;).set(header).send({\&quot;payload\&quot;:{\&quot;link\&quot;:\&quot;11@my.com\&quot;}}).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;lookupinstance&#x27;);    \n expect(Object.keys(res.body.output.lookupinstance).length).equals(0); \n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ddc1fb63-c928-48d7-8048-6fcef1ab9928&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to do a successful handshake, (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to do a successful handshake, (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.corporation = &#x27;123&#x27;;\napi.post(&#x27;/synergy/v1/embed/consumer/handshake&#x27;).set(header).send(synergyWrapperData.handshakeBody).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,400);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;error&#x27;);\nres.body.error.should.be.a(&#x27;object&#x27;);\nres.body.error.should.have.property(&#x27;message&#x27;);\nexpect(res.body.error.message).equals(&#x27;INVALID_IDENTIFIER&#x27;);\ndone();\n});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a8050bd3-547f-4249-bf46-b642dbab620c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to login and get auth token, (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to login and get auth token, (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;123&#x27;;\n       api.post(&#x27;/synergy/v1/embed/consumer/login&#x27;).set(header).send({\&quot;payload\&quot;:jwt_token}).end((err, res) =&gt; {\n        res.should.have.property(&#x27;status&#x27;,400);\n        res.body.should.be.a(&#x27;object&#x27;);\n        res.body.should.have.property(&#x27;error&#x27;);\n        res.body.error.should.be.a(&#x27;object&#x27;);\n        res.body.error.should.have.property(&#x27;message&#x27;);\n        expect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);\n        done();\n        });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;74d1e6ec-4bf4-4db8-ada8-396d8953d1d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to login and get auth token, (NO ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to login and get auth token, (NO ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;&#x27;;\n        api.post(&#x27;/synergy/v1/embed/consumer/login&#x27;).set(header).send({\&quot;payload\&quot;:jwt_token}).end((err, res) =&gt; {\n         res.should.have.property(&#x27;status&#x27;,400);\n         res.body.should.be.a(&#x27;object&#x27;);\n         res.body.should.have.property(&#x27;error&#x27;);\n         res.body.error.should.be.a(&#x27;object&#x27;);\n         res.body.error.should.have.property(&#x27;message&#x27;);\n         expect(res.body.error.message).equals(&#x27;IDENTIFIER_ABSENT&#x27;);\n         done();\n         });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf192ad6-a210-47e5-b82b-157f7c39e883&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to create deployments, (INVALID AUTHTOKEN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to create deployments, (INVALID AUTHTOKEN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = &#x27;123&#x27;;\n        api.post(&#x27;/synergy/v1/embed/consumer/deployments&#x27;).set(header).send(synergyWrapperData.deployments).end((err, res) =&gt; {\n         res.should.have.property(&#x27;status&#x27;,400);\n         res.body.should.be.a(&#x27;object&#x27;);\n         res.body.should.have.property(&#x27;error&#x27;);\n         res.body.error.should.be.a(&#x27;object&#x27;);\n         res.body.error.should.have.property(&#x27;message&#x27;);\n         expect(res.body.error.message).equals(&#x27;INVALID_AUTHTOKEN&#x27;);\n         done();\n         });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29dfb589-5b2a-4825-93c4-af5edb2994e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to create deployments, (INVALID CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to create deployments, (INVALID CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;123&#x27;;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n        api.post(&#x27;/synergy/v1/embed/consumer/deployments&#x27;).set(header).send(synergyWrapperData.deployments).end((err, res) =&gt; {\n         res.should.have.property(&#x27;status&#x27;,400);\n         res.body.should.be.a(&#x27;object&#x27;);\n         res.body.should.have.property(&#x27;error&#x27;);\n         res.body.error.should.be.a(&#x27;object&#x27;);\n         res.body.error.should.have.property(&#x27;message&#x27;);\n         expect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);\n         done();\n         });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1abde4e1-1b3b-46a8-8d4b-90bfed3122ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to create deployments, (NO CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to create deployments, (NO CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;&#x27;;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n        api.post(&#x27;/synergy/v1/embed/consumer/deployments&#x27;).set(header).send(synergyWrapperData.deployments).end((err, res) =&gt; {\n         res.should.have.property(&#x27;status&#x27;,400);\n         res.body.should.be.a(&#x27;object&#x27;);\n         res.body.should.have.property(&#x27;error&#x27;);\n         res.body.error.should.be.a(&#x27;object&#x27;);\n         res.body.error.should.have.property(&#x27;message&#x27;);\n         expect(res.body.error.message).equals(&#x27;IDENTIFIER_ABSENT&#x27;);\n         done();\n         });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7e51c5e-837b-4f0f-a9d9-0803b2f326b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should get a list of the connectors&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should get a list of the connectors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/consumer/connectors&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;array&#x27;);           \n   res.body.output.forEach(element =&gt; {\n     element.should.have.property(&#x27;title&#x27;);\n     element.should.have.property(&#x27;icon&#x27;);\n     element.should.have.property(&#x27;solutions_count&#x27;);\n     element.should.have.property(&#x27;name&#x27;);\n   });\ndone();\n        });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df8c256a-eadb-4727-b9ea-7f0662265a9a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should get organization user&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should get organization user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\nheader.master_token = global.master_token;\napi.get(&#x27;/synergy/v1/embed/consumer/organizationuser/fl0455813d1fa32a9999e23b&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\ndone();\n     });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b986f0f-c293-4092-abc4-69fec3b4c062&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should get a list of bot solutions&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should get a list of bot solutions&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/bots/&#x27; + synergyWrapperData.bot.id +&#x27;/solutions&#x27;).set(header).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;limit&#x27;);\n   res.body.output.should.have.property(&#x27;skip&#x27;);\n   res.body.output.should.have.property(&#x27;count&#x27;);\n   res.body.output.should.have.property(&#x27;solutions&#x27;);\n   res.body.output.solutions.should.be.a(&#x27;array&#x27;);\n   if(res.body.output.limit &gt;= res.body.output.count) {\n     expect(parseInt(res.body.output.count,10)).equals(res.body.output.solutions.length);\n   }else {\n     expect(parseInt(res.body.output.limit,10)).equals(res.body.output.solutions.length);\n   }\ndone();\n        });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;973f00e0-8871-4178-89b0-e6a53e3fe76f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should get a bot object&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should get a bot object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/bots/&#x27; + synergyWrapperData.bot.id).set(header).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;bot&#x27;);\n   res.body.output.bot.should.be.a(&#x27;object&#x27;);\n   res.body.output.bot.should.have.property(&#x27;token&#x27;);\ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4ebfb463-0365-45e5-8e73-f30dfe6de286&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should get a list of bot solutions (WITH QUERY)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should get a list of bot solutions (WITH QUERY)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/bots/&#x27; + synergyWrapperData.bot.id + &#x27;/solutions?limit=1&amp;skip=0&amp;orderBy=created_at&amp;sortBy=asc&#x27;).set(header).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;limit&#x27;);\n   res.body.output.should.have.property(&#x27;skip&#x27;);\n   res.body.output.should.have.property(&#x27;count&#x27;);\n   res.body.output.should.have.property(&#x27;solutions&#x27;);\n   res.body.output.solutions.should.be.a(&#x27;array&#x27;);\n   if(res.body.output.limit &gt;= res.body.output.count) {\n     expect(parseInt(res.body.output.count,10)).equals(res.body.output.solutions.length);\n   }else {\n     expect(parseInt(res.body.output.limit,10)).equals(res.body.output.solutions.length);\n   }\ndone();\n        });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5577b370-af7a-483e-9860-d2f3ab645029&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should get a list of bot solutions(WITH NAME QUERY)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should get a list of bot solutions(WITH NAME QUERY)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/bots/&#x27; + synergyWrapperData.bot.id +&#x27;/solutions?name=Gmail&#x27;).set(header).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;limit&#x27;);\n   res.body.output.should.have.property(&#x27;skip&#x27;);\n   res.body.output.should.have.property(&#x27;count&#x27;);\n   res.body.output.should.have.property(&#x27;solutions&#x27;);\n   res.body.output.solutions.should.be.a(&#x27;array&#x27;);\n   if(res.body.output.limit &gt;= res.body.output.count) {\n     expect(parseInt(res.body.output.count,10)).equals(res.body.output.solutions.length);\n   }else {\n     expect(parseInt(res.body.output.limit,10)).equals(res.body.output.solutions.length);\n   }\ndone();\n        });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5e04816-6496-4ef9-b983-8d5a6ab178fb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should get connector cisco spark&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should get connector cisco spark&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/consumer/templates/connectors/ciscospark&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;array&#x27;);\n    \n    res.body.output.forEach(element =&gt; {\n     element.should.have.property(&#x27;updated_at&#x27;);\n     element.should.have.property(&#x27;created_at&#x27;);\n     element.should.have.property(&#x27;uid&#x27;);\n     element.should.have.property(&#x27;trigger_icon&#x27;);\n     element.should.have.property(&#x27;environment&#x27;);\n     element.should.have.property(&#x27;previous_version&#x27;);\n     element.should.have.property(&#x27;next_version&#x27;);\n     element.should.have.property(&#x27;origin&#x27;);\n     element.should.have.property(&#x27;name&#x27;);\n     element.should.have.property(&#x27;org_uid&#x27;);\n     element.should.have.property(&#x27;synergy_organization&#x27;);\n     element.should.have.property(&#x27;context&#x27;);\n     element.should.have.property(&#x27;published_on&#x27;);\n     element.should.have.property(&#x27;action_icons&#x27;);\n     element.should.have.property(&#x27;templates&#x27;);\n     element.should.have.property(&#x27;published&#x27;);\n     element.should.have.property(&#x27;deleted_at&#x27;);\n     element.should.have.property(&#x27;tags&#x27;);\n     element.should.have.property(&#x27;is_head&#x27;);\n     element.should.have.property(&#x27;version&#x27;);\n     element.should.have.property(&#x27;download&#x27;);\n   });\ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a18d685f-3f3c-4b64-b848-4b85ed2792b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should retrieve wonderlist info&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should retrieve wonderlist info&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/consumer/userauths/wunderlist&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;array&#x27;);\n   \n   res.body.output.forEach(element =&gt; {\n     element.should.have.property(&#x27;uid&#x27;);\n     element.should.have.property(&#x27;name&#x27;);\n     element.should.have.property(&#x27;type&#x27;);\n     element.should.have.property(&#x27;icon&#x27;);\n     element.should.have.property(&#x27;created_at&#x27;);\n     element.should.have.property(&#x27;description&#x27;);\n   });\ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6add9385-0e56-42b9-b05a-aa744394c937&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should retrieve respective solution&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should retrieve respective solution&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/consumer/solutions/&#x27;+synergyWrapperData.solution.id).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,200);\n   res.body.should.have.property(&#x27;output&#x27;);\n   res.body.output.should.be.a(&#x27;object&#x27;);\n   res.body.output.should.have.property(&#x27;published&#x27;);\n   res.body.output.should.have.property(&#x27;action_icons&#x27;);\n   res.body.output.should.have.property(&#x27;trigger_icon&#x27;);\n   res.body.output.should.have.property(&#x27;name&#x27;);\n   res.body.output.should.have.property(&#x27;context&#x27;);\n   res.body.output.should.have.property(&#x27;published_on&#x27;);\n   res.body.output.should.have.property(&#x27;created_at&#x27;);\n   res.body.output.should.have.property(&#x27;updated_at&#x27;);\n   res.body.output.should.have.property(&#x27;uid&#x27;);\n   res.body.output.should.have.property(&#x27;environment&#x27;);\n   res.body.output.environment.should.be.a(&#x27;object&#x27;);\n   res.body.output.environment.should.have.property(&#x27;project_params&#x27;);\n   res.body.output.environment.project_params.should.be.a(&#x27;array&#x27;);\n   \ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;61e324cc-ad8d-4e7f-8e13-23c969485002&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get a list of deployments&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should get a list of deployments&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n        api.get(&#x27;/synergy/v1/embed/consumer/deployments&#x27;).set(header).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;array&#x27;);\n res.body.output.forEach(element =&gt; { \n    element.should.have.property(&#x27;uid&#x27;);\n    element.should.have.property(&#x27;updated_at&#x27;);\n    element.should.have.property(&#x27;created_at&#x27;);\n    element.should.have.property(&#x27;name&#x27;);\n    element.should.have.property(&#x27;solution&#x27;);\n    element.should.have.property(&#x27;trigger_icon&#x27;);\n    element.should.have.property(&#x27;action_icons&#x27;);\n    element.should.have.property(&#x27;active&#x27;);\n    \n });\n         done();\n         });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;735b26d3-9a76-49c7-bd0f-46aa02dee87d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get a list of deployments, (WITH SEARCH QUERY)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should get a list of deployments, (WITH SEARCH QUERY)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n        api.get(&#x27;/synergy/v1/embed/consumer/deployments?limit=1&amp;skip=0&#x27;).set(header).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,200);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;count&#x27;);\n res.body.output.should.have.property(&#x27;flows&#x27;);\n res.body.output.flows.should.be.a(&#x27;array&#x27;);\n         done();\n         });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eb758e76-61e7-4d9a-94f5-5f4cdc06f8d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get deployment details&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should get deployment details&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n      api.get(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid).set(header).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);       \n res.body.output.should.have.property(&#x27;uid&#x27;);\n res.body.output.should.have.property(&#x27;updated_at&#x27;);\n res.body.output.should.have.property(&#x27;created_at&#x27;);\n res.body.output.should.have.property(&#x27;name&#x27;);\n res.body.output.should.have.property(&#x27;solution&#x27;);\n res.body.output.should.have.property(&#x27;synergy_organization&#x27;);\n res.body.output.should.have.property(&#x27;org_uid&#x27;);\n res.body.output.should.have.property(&#x27;context&#x27;);\n res.body.output.should.have.property(&#x27;deployment_instance&#x27;);\n res.body.output.deployment_instance.should.be.a(&#x27;object&#x27;);\n res.body.output.deployment_instance.should.have.property(&#x27;compact&#x27;);\n res.body.output.deployment_instance.compact.should.be.a(&#x27;array&#x27;);\n res.body.output.should.have.property(&#x27;solution_version&#x27;);\n res.body.output.should.have.property(&#x27;consumer&#x27;);\n res.body.output.should.have.property(&#x27;consumer_ref&#x27;);\n res.body.output.should.have.property(&#x27;trigger_icon&#x27;);\n res.body.output.should.have.property(&#x27;action_icons&#x27;);\n res.body.output.should.have.property(&#x27;flows&#x27;);\n res.body.output.should.have.property(&#x27;active&#x27;);\n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e028596-614e-4fbb-9aff-a552dda7e56d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get CSS&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should get CSS&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\n       api.get(&#x27;/synergy/v1/embed/css&#x27;).set(header).end((err, res) =&gt; {\n res.should.have.property(&#x27;status&#x27;,200);\n res.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;);\n res.body.output.should.have.property(&#x27;css&#x27;);    \n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;023a3fd4-9fcb-4e3f-bb94-2375847f02e8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to get a bot object, (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to get a bot object, (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/bots/hwjqdjqh26321876&#x27;).set(header).end((err, res) =&gt; {\n  res.should.have.property(&#x27;status&#x27;,400);\n  res.body.should.have.property(&#x27;error&#x27;);\n  res.body.error.should.be.a(&#x27;object&#x27;);\n  res.body.error.should.have.property(&#x27;message&#x27;);\n  expect(res.body.error.message).equals(&#x27;INVALID_ID&#x27;);\ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b6fae4c-22a8-4d5f-8546-06ec37314d58&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to get organization user, (INVALID_TOKEN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to get organization user, (INVALID_TOKEN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\nheader.master_token = corporation;\napi.get(&#x27;/synergy/v1/embed/consumer/organizationuser/fl0455813d1fa32a9999e23b&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;INVALID_MASTER_TOKEN&#x27;);\ndone();\n     });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;525162cb-e8bf-49f4-aa04-0d8a8760b146&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to get a list of the connectors, (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to get a list of the connectors, (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = &#x27;123&#x27;;\napi.get(&#x27;/synergy/v1/embed/consumer/connectors&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);\ndone();\n        });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ed9bbdc-4f12-4297-94fa-90f4268e4219&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to validate a user auth&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to validate a user auth&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\n     api.get(&#x27;/synergy/v1/embed/consumer/auths/&#x27;+ synergyWrapperData.userAuthId + &#x27;/validate&#x27;).set(header).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,400);       \ndone();\n     });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a402099-b895-49c1-a784-61dc60c3abf2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to get a list of bot solutions, (INVALID BOT ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to get a list of bot solutions, (INVALID BOT ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/bots/hsdsgdjhsdhjhb/solutions&#x27;).set(header).end((err, res) =&gt; {\n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.an(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\ndone();\n     });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;294f0a7b-d174-4941-9c8b-fb9e7fd2ab4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to get a list of the connectors, (NO ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to get a list of the connectors, (NO ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = &#x27;&#x27;;\napi.get(&#x27;/synergy/v1/embed/consumer/connectors&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;IDENTIFIER_ABSENT&#x27;);\ndone();\n        });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb15b9f5-8ec0-491f-9f2f-7085bd51a41d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to get connector CISCO SPARK, (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to get connector CISCO SPARK, (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = &#x27;123&#x27;;\napi.get(&#x27;/synergy/v1/embed/consumer/templates/connectors/ciscospark&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);\ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9d3f9e89-10c9-493a-8891-36d7cced5061&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to retrieve wonderlist info, (INVALID TOKEN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to retrieve wonderlist info, (INVALID TOKEN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = &#x27;123&#x27;;\napi.get(&#x27;/synergy/v1/embed/consumer/userauths/wunderlist&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;INVALID_AUTHTOKEN&#x27;);\ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49ead13a-5f62-4883-ae20-a04b9a833c09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to retrieve wonderlist info, (INVALID CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to retrieve wonderlist info, (INVALID CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = &#x27;123&#x27;;\nheader.embedtoken = authtoken;\napi.get(&#x27;/synergy/v1/embed/consumer/userauths/wunderlist&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);\ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;418ed80a-26c0-46eb-bc3b-330724b4ef0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to retrieve wonderlist info, (NO CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to retrieve wonderlist info, (NO CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = &#x27;&#x27;;\nheader.embedtoken = authtoken;\napi.get(&#x27;/synergy/v1/embed/consumer/userauths/wunderlist&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;IDENTIFIER_ABSENT&#x27;);\ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b74f60dc-7abc-43c3-bb95-bfc5c721b64d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to retrieve respective solution, (INVALID SOLUTION ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to retrieve respective solution, (INVALID SOLUTION ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = authtoken;\nheader.corporation = corporation;\napi.get(&#x27;/synergy/v1/embed/consumer/solutions/123&#x27;).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;INVALID_SOLUTION_ID&#x27;);      \ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56de1ed9-86f3-43db-b12f-47e01cef9256&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to retrieve respective solution, (INVALID AUTH TOKEN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to retrieve respective solution, (INVALID AUTH TOKEN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = clientId;\nheader.embedtoken = &#x27;123&#x27;;\napi.get(&#x27;/synergy/v1/embed/consumer/solutions/&#x27;+synergyWrapperData.solution.id).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;INVALID_AUTHTOKEN&#x27;);      \ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba5a0921-6fa1-4f1e-bffb-f009a7ed9ce8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to retrieve respective solution, (INVALID CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to retrieve respective solution, (INVALID CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = &#x27;123&#x27;;\nheader.embedtoken = authtoken;\napi.get(&#x27;/synergy/v1/embed/consumer/solutions/&#x27;+synergyWrapperData.solution.id).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);      \ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3813cbec-efc0-4074-be55-fa3bc0974bd5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;it should fail to retrieve respective solution, (NO CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs it should fail to retrieve respective solution, (NO CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(apiTimeOut);\nheader.client = &#x27;&#x27;;\nheader.embedtoken = authtoken;\napi.get(&#x27;/synergy/v1/embed/consumer/solutions/&#x27;+synergyWrapperData.solution.id).set(header).end((err, res) =&gt; {        \n   res.should.have.property(&#x27;status&#x27;,400);\n   res.body.should.have.property(&#x27;error&#x27;);\n   res.body.error.should.be.a(&#x27;object&#x27;);\n   res.body.error.should.have.property(&#x27;message&#x27;);\n   expect(res.body.error.message).equals(&#x27;IDENTIFIER_ABSENT&#x27;);      \ndone();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69ef2f1f-58af-4a8a-b493-5a642703fd7c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get a list of deployments, (INVALID AUTHTOKEN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get a list of deployments, (INVALID AUTHTOKEN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = &#x27;123&#x27;;\n      api.get(&#x27;/synergy/v1/embed/consumer/deployments&#x27;).set(header).end((err, res) =&gt; {\n       res.should.have.property(&#x27;status&#x27;,400);\n       res.body.should.be.a(&#x27;object&#x27;);\n       res.body.should.have.property(&#x27;error&#x27;);\n       res.body.error.should.be.a(&#x27;object&#x27;);\n       res.body.error.should.have.property(&#x27;message&#x27;);\n       expect(res.body.error.message).equals(&#x27;INVALID_AUTHTOKEN&#x27;);\n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f49f446a-e91b-4854-8e86-439de283c0e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get a list of deployments, (INVALID CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get a list of deployments, (INVALID CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;123&#x27;;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n      api.get(&#x27;/synergy/v1/embed/consumer/deployments&#x27;).set(header).end((err, res) =&gt; {\n       res.should.have.property(&#x27;status&#x27;,400);\n       res.body.should.be.a(&#x27;object&#x27;);\n       res.body.should.have.property(&#x27;error&#x27;);\n       res.body.error.should.be.a(&#x27;object&#x27;);\n       res.body.error.should.have.property(&#x27;message&#x27;);\n       expect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);\n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;630c0c2e-adc8-4321-b547-77e62707fc8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get a list of deployments, (NO CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get a list of deployments, (NO CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;&#x27;;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n      api.get(&#x27;/synergy/v1/embed/consumer/deployments&#x27;).set(header).end((err, res) =&gt; {\n       res.should.have.property(&#x27;status&#x27;,400);\n       res.body.should.be.a(&#x27;object&#x27;);\n       res.body.should.have.property(&#x27;error&#x27;);\n       res.body.error.should.be.a(&#x27;object&#x27;);\n       res.body.error.should.have.property(&#x27;message&#x27;);\n       expect(res.body.error.message).equals(&#x27;IDENTIFIER_ABSENT&#x27;);\n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0dd01290-7957-4182-bfc6-372844bf54dc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get deployment details, (INVALID AUTHTOKEN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get deployment details, (INVALID AUTHTOKEN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = &#x27;123&#x27;;\n      api.get(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid).set(header).end((err, res) =&gt; {\n       res.should.have.property(&#x27;status&#x27;,400);\n       res.body.should.be.a(&#x27;object&#x27;);\n       res.body.should.have.property(&#x27;error&#x27;);\n       res.body.error.should.be.a(&#x27;object&#x27;);\n       res.body.error.should.have.property(&#x27;message&#x27;);\n       expect(res.body.error.message).equals(&#x27;INVALID_AUTHTOKEN&#x27;);\n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b85b56ea-58d0-425b-8502-3198514eea07&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get deployment details, (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get deployment details, (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n      api.get(&#x27;/synergy/v1/embed/consumer/deployments/123&#x27;).set(header).end((err, res) =&gt; {\n       res.should.have.property(&#x27;status&#x27;,400);\n       res.body.should.be.a(&#x27;object&#x27;);\n       res.body.should.have.property(&#x27;error&#x27;);\n       res.body.error.should.be.a(&#x27;object&#x27;);\n       res.body.error.should.have.property(&#x27;message&#x27;);\n       expect(res.body.error.message).equals(&#x27;INVALID_DEPLOYMENT_ID&#x27;);\n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a39f5615-013a-4ab6-992b-98ae7c9e73ae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get deployment details, (INVALID CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get deployment details, (INVALID CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;123&#x27;;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n      api.get(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid).set(header).end((err, res) =&gt; {\n       res.should.have.property(&#x27;status&#x27;,400);\n       res.body.should.be.a(&#x27;object&#x27;);\n       res.body.should.have.property(&#x27;error&#x27;);\n       res.body.error.should.be.a(&#x27;object&#x27;);\n       res.body.error.should.have.property(&#x27;message&#x27;);\n       expect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);\n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd809552-310a-4036-9a4e-67953e2d8cc1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get deployment details, (NO CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get deployment details, (NO CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;&#x27;;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n      api.get(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid).set(header).end((err, res) =&gt; {\n       res.should.have.property(&#x27;status&#x27;,400);\n       res.body.should.be.a(&#x27;object&#x27;);\n       res.body.should.have.property(&#x27;error&#x27;);\n       res.body.error.should.be.a(&#x27;object&#x27;);\n       res.body.error.should.have.property(&#x27;message&#x27;);\n       expect(res.body.error.message).equals(&#x27;IDENTIFIER_ABSENT&#x27;);\n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14984266-2c00-4eef-a172-e1788f465207&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get CSS, (INVALID CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get CSS, (INVALID CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;123&#x27;;\n       api.get(&#x27;/synergy/v1/embed/css&#x27;).set(header).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,400);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;error&#x27;);\nres.body.error.should.be.a(&#x27;object&#x27;);\nres.body.error.should.have.property(&#x27;message&#x27;);\nexpect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);    \n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b20b60f-f0f8-47ef-8abe-9e38904b1e03&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get CSS, (NO CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get CSS, (NO CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;&#x27;;\n       api.get(&#x27;/synergy/v1/embed/css&#x27;).set(header).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,400);\nres.body.should.be.a(&#x27;object&#x27;);\nres.body.should.have.property(&#x27;error&#x27;);\nres.body.error.should.be.a(&#x27;object&#x27;);\nres.body.error.should.have.property(&#x27;message&#x27;);\nexpect(res.body.error.message).equals(&#x27;IDENTIFIER_ABSENT&#x27;);    \n       done();\n       });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d3b5f86-3918-4fff-9f7e-9700c8444e52&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should delete deployment&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should delete deployment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\n    api.post(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid).set(header).send({\&quot;operation\&quot;:\&quot;delete\&quot;}).end((err, res) =&gt; {\nres.should.have.property(&#x27;status&#x27;,200);\nres.body.should.have.property(&#x27;output&#x27;);\n res.body.output.should.be.a(&#x27;object&#x27;); \n res.body.output.should.have.property(&#x27;deployment&#x27;);\n res.body.output.deployment.should.be.a(&#x27;object&#x27;);   \n res.body.output.deployment.should.have.property(&#x27;uid&#x27;);\n res.body.output.deployment.should.have.property(&#x27;updated_at&#x27;);\n res.body.output.deployment.should.have.property(&#x27;created_at&#x27;);\n res.body.output.deployment.should.have.property(&#x27;name&#x27;);\n res.body.output.deployment.should.have.property(&#x27;solution&#x27;);\n res.body.output.deployment.should.have.property(&#x27;synergy_organization&#x27;);\n res.body.output.deployment.should.have.property(&#x27;org_uid&#x27;);\n res.body.output.deployment.should.have.property(&#x27;context&#x27;);\n res.body.output.deployment.should.have.property(&#x27;deployment_instance&#x27;);\n res.body.output.deployment.deployment_instance.should.be.a(&#x27;object&#x27;);\n res.body.output.deployment.deployment_instance.should.have.property(&#x27;compact&#x27;);\n res.body.output.deployment.deployment_instance.compact.should.be.a(&#x27;array&#x27;);\n res.body.output.deployment.should.have.property(&#x27;solution_version&#x27;);\n res.body.output.deployment.should.have.property(&#x27;consumer&#x27;);\n res.body.output.deployment.should.have.property(&#x27;consumer_ref&#x27;);\n res.body.output.deployment.should.have.property(&#x27;trigger_icon&#x27;);\n res.body.output.deployment.should.have.property(&#x27;action_icons&#x27;);\n res.body.output.deployment.should.have.property(&#x27;flows&#x27;);\n res.body.output.deployment.should.have.property(&#x27;active&#x27;);\n \n     done();\n     });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f126a8a-95d3-47cc-8ee0-2a35eb4b355e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to make deployment active/inactive, (INVALID AUTHTOKEN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to make deployment active/inactive, (INVALID AUTHTOKEN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = &#x27;123&#x27;;\n          api.post(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid+&#x27;/active&#x27;).set(header).send({\&quot;flag\&quot;:\&quot;false\&quot;}).end((err, res) =&gt; {\n           res.should.have.property(&#x27;status&#x27;,400);\n           res.body.should.be.a(&#x27;object&#x27;);\n           res.body.should.have.property(&#x27;error&#x27;);\n           res.body.error.should.be.a(&#x27;object&#x27;);\n           res.body.error.should.have.property(&#x27;message&#x27;);\n           expect(res.body.error.message).equals(&#x27;INVALID_AUTHTOKEN&#x27;);\n           done();\n           });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5323d6df-0281-4945-b19d-172412762104&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get deployment details, (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get deployment details, (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\napi.post(&#x27;/synergy/v1/embed/consumer/deployments/123/active&#x27;).set(header).send({\&quot;flag\&quot;:\&quot;false\&quot;}).end((err, res) =&gt; {\n           res.should.have.property(&#x27;status&#x27;,400);\n           res.body.should.be.a(&#x27;object&#x27;);\n           res.body.should.have.property(&#x27;error&#x27;);\n           res.body.error.should.be.a(&#x27;object&#x27;);\n           res.body.error.should.have.property(&#x27;message&#x27;);\n           expect(res.body.error.message).equals(&#x27;INVALID_DEPLOYMENT_ID&#x27;);\n           done();\n           });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17cf3282-6802-4c13-8bda-826717d0d390&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get deployment details, (INVALID CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get deployment details, (INVALID CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;123&#x27;;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\napi.post(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid+&#x27;/active&#x27;).set(header).send({\&quot;flag\&quot;:\&quot;false\&quot;}).end((err, res) =&gt; {\n           res.should.have.property(&#x27;status&#x27;,400);\n           res.body.should.be.a(&#x27;object&#x27;);\n           res.body.should.have.property(&#x27;error&#x27;);\n           res.body.error.should.be.a(&#x27;object&#x27;);\n           res.body.error.should.have.property(&#x27;message&#x27;);\n           expect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);\n           done();\n           });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25140e9f-634d-4adf-9ba5-5a928a6442ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to get deployment details, (NO CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to get deployment details, (NO CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;&#x27;;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\napi.post(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid+&#x27;/active&#x27;).set(header).send({\&quot;flag\&quot;:\&quot;false\&quot;}).end((err, res) =&gt; {\n           res.should.have.property(&#x27;status&#x27;,400);\n           res.body.should.be.a(&#x27;object&#x27;);\n           res.body.should.have.property(&#x27;error&#x27;);\n           res.body.error.should.be.a(&#x27;object&#x27;);\n           res.body.error.should.have.property(&#x27;message&#x27;);\n           expect(res.body.error.message).equals(&#x27;IDENTIFIER_ABSENT&#x27;);\n           done();\n           });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;470350d3-1b99-49da-8dcf-73f9ba36923b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to delete deployment, (INVALID AUTHTOKEN)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to delete deployment, (INVALID AUTHTOKEN)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = &#x27;123&#x27;;\n    api.post(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid).set(header).send({\&quot;operation\&quot;:\&quot;delete\&quot;}).end((err, res) =&gt; {\n     res.should.have.property(&#x27;status&#x27;,400);\n     res.body.should.be.a(&#x27;object&#x27;);\n     res.body.should.have.property(&#x27;error&#x27;);\n     res.body.error.should.be.a(&#x27;object&#x27;);\n     res.body.error.should.have.property(&#x27;message&#x27;);\n     expect(res.body.error.message).equals(&#x27;INVALID_AUTHTOKEN&#x27;);\n     done();\n     });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a476fe1a-56d6-4512-a99c-3de350955282&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to delete deployment, (INVALID ID)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to delete deployment, (INVALID ID)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = clientId;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\napi.post(&#x27;/synergy/v1/embed/consumer/deployments/123&#x27;).set(header).send({\&quot;operation\&quot;:\&quot;delete\&quot;}).end((err, res) =&gt; {\n     res.should.have.property(&#x27;status&#x27;,400);\n     res.body.should.be.a(&#x27;object&#x27;);\n     res.body.should.have.property(&#x27;error&#x27;);\n     res.body.error.should.be.a(&#x27;object&#x27;);\n     res.body.error.should.have.property(&#x27;message&#x27;);\n     expect(res.body.error.message).equals(&#x27;INVALID_DEPLOYMENT_ID&#x27;);\n     done();\n     });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1eade8d1-fc64-4f5a-a958-a502765afd4d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to delete deployment, (INVALID CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to delete deployment, (INVALID CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;123&#x27;;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\napi.post(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid).set(header).send({\&quot;operation\&quot;:\&quot;delete\&quot;}).end((err, res) =&gt; {\n     res.should.have.property(&#x27;status&#x27;,400);\n     res.body.should.be.a(&#x27;object&#x27;);\n     res.body.should.have.property(&#x27;error&#x27;);\n     res.body.error.should.be.a(&#x27;object&#x27;);\n     res.body.error.should.have.property(&#x27;message&#x27;);\n     expect(res.body.error.message).equals(&#x27;INVALID_CLIENT&#x27;);\n     done();\n     });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9b3831f0-3839-4f5a-82d4-8dce53672ca6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail to delete deployment, (NO CLIENT)&quot;,&quot;fullTitle&quot;:&quot;Enterprise Synergy Wrapper APIs should fail to delete deployment, (NO CLIENT)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;header.client = &#x27;&#x27;;\nheader.corporation = corporation;\nheader.embedtoken = authtoken;\napi.post(&#x27;/synergy/v1/embed/consumer/deployments/&#x27;+deployment_uid).set(header).send({\&quot;operation\&quot;:\&quot;delete\&quot;}).end((err, res) =&gt; {\n     res.should.have.property(&#x27;status&#x27;,400);\n     res.body.should.be.a(&#x27;object&#x27;);\n     res.body.should.have.property(&#x27;error&#x27;);\n     res.body.error.should.be.a(&#x27;object&#x27;);\n     res.body.error.should.have.property(&#x27;message&#x27;);\n     expect(res.body.error.message).equals(&#x27;IDENTIFIER_ABSENT&#x27;);\n     done();\n     });&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9959bb0-4c50-49de-9855-52bc646a50f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;770281b9-1ff0-4116-a565-b91a06962404&quot;,&quot;51bae705-c650-49df-bb19-fbea2b6925d4&quot;,&quot;4f82c1a1-8e2d-4755-8c0a-c328f287ff13&quot;,&quot;36846b53-09b0-45f8-847b-17543365d3e9&quot;,&quot;e550707c-3f72-43dc-ab60-be5b9c09ad76&quot;,&quot;ddc1fb63-c928-48d7-8048-6fcef1ab9928&quot;,&quot;a8050bd3-547f-4249-bf46-b642dbab620c&quot;,&quot;74d1e6ec-4bf4-4db8-ada8-396d8953d1d0&quot;,&quot;cf192ad6-a210-47e5-b82b-157f7c39e883&quot;,&quot;29dfb589-5b2a-4825-93c4-af5edb2994e7&quot;,&quot;1abde4e1-1b3b-46a8-8d4b-90bfed3122ac&quot;,&quot;e7e51c5e-837b-4f0f-a9d9-0803b2f326b0&quot;,&quot;df8c256a-eadb-4727-b9ea-7f0662265a9a&quot;,&quot;6b986f0f-c293-4092-abc4-69fec3b4c062&quot;,&quot;973f00e0-8871-4178-89b0-e6a53e3fe76f&quot;,&quot;4ebfb463-0365-45e5-8e73-f30dfe6de286&quot;,&quot;5577b370-af7a-483e-9860-d2f3ab645029&quot;,&quot;a5e04816-6496-4ef9-b983-8d5a6ab178fb&quot;,&quot;a18d685f-3f3c-4b64-b848-4b85ed2792b3&quot;,&quot;6add9385-0e56-42b9-b05a-aa744394c937&quot;,&quot;61e324cc-ad8d-4e7f-8e13-23c969485002&quot;,&quot;735b26d3-9a76-49c7-bd0f-46aa02dee87d&quot;,&quot;eb758e76-61e7-4d9a-94f5-5f4cdc06f8d3&quot;,&quot;4e028596-614e-4fbb-9aff-a552dda7e56d&quot;,&quot;023a3fd4-9fcb-4e3f-bb94-2375847f02e8&quot;,&quot;0b6fae4c-22a8-4d5f-8546-06ec37314d58&quot;,&quot;525162cb-e8bf-49f4-aa04-0d8a8760b146&quot;,&quot;8ed9bbdc-4f12-4297-94fa-90f4268e4219&quot;,&quot;5a402099-b895-49c1-a784-61dc60c3abf2&quot;,&quot;294f0a7b-d174-4941-9c8b-fb9e7fd2ab4d&quot;,&quot;fb15b9f5-8ec0-491f-9f2f-7085bd51a41d&quot;,&quot;9d3f9e89-10c9-493a-8891-36d7cced5061&quot;,&quot;49ead13a-5f62-4883-ae20-a04b9a833c09&quot;,&quot;418ed80a-26c0-46eb-bc3b-330724b4ef0c&quot;,&quot;b74f60dc-7abc-43c3-bb95-bfc5c721b64d&quot;,&quot;56de1ed9-86f3-43db-b12f-47e01cef9256&quot;,&quot;ba5a0921-6fa1-4f1e-bffb-f009a7ed9ce8&quot;,&quot;3813cbec-efc0-4074-be55-fa3bc0974bd5&quot;,&quot;69ef2f1f-58af-4a8a-b493-5a642703fd7c&quot;,&quot;f49f446a-e91b-4854-8e86-439de283c0e3&quot;,&quot;630c0c2e-adc8-4321-b547-77e62707fc8c&quot;,&quot;0dd01290-7957-4182-bfc6-372844bf54dc&quot;,&quot;b85b56ea-58d0-425b-8502-3198514eea07&quot;,&quot;a39f5615-013a-4ab6-992b-98ae7c9e73ae&quot;,&quot;dd809552-310a-4036-9a4e-67953e2d8cc1&quot;,&quot;14984266-2c00-4eef-a172-e1788f465207&quot;,&quot;6b20b60f-f0f8-47ef-8abe-9e38904b1e03&quot;,&quot;2d3b5f86-3918-4fff-9f7e-9700c8444e52&quot;,&quot;3f126a8a-95d3-47cc-8ee0-2a35eb4b355e&quot;,&quot;5323d6df-0281-4945-b19d-172412762104&quot;,&quot;17cf3282-6802-4c13-8bda-826717d0d390&quot;,&quot;25140e9f-634d-4adf-9ba5-5a928a6442ac&quot;,&quot;470350d3-1b99-49da-8dcf-73f9ba36923b&quot;,&quot;a476fe1a-56d6-4512-a99c-3de350955282&quot;,&quot;1eade8d1-fc64-4f5a-a958-a502765afd4d&quot;,&quot;9b3831f0-3839-4f5a-82d4-8dce53672ca6&quot;,&quot;e9959bb0-4c50-49de-9855-52bc646a50f7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1953,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:1000000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000},&quot;copyrightYear&quot;:2018}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;api&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:true,&quot;enableCharts&quot;:true,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report\\assets&quot;,&quot;jsonFile&quot;:&quot;C:\\work\\api\\mochawesome-report\\mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;C:\\work\\api\\mochawesome-report\\mochawesome.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>